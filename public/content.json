{"meta":{"title":"rainbowhorse's blog","subtitle":"ä¸å¿˜åˆå¿ƒ æ–¹å¾—å§‹ç»ˆ","description":"æ€»ç»“ä¸ªäººå¿ƒå¾—ï¼Œè®°å½•ä¸ªäººçŸ¥è¯†","author":"rainbowhorse","url":"https://sunny0715.github.io"},"pages":[{"title":"","date":"2017-08-14T09:26:38.043Z","updated":"2017-06-04T01:41:33.000Z","comments":true,"path":"404.html","permalink":"https://sunny0715.github.io/404.html","excerpt":"","text":"404 - rainbowhorse's blog"},{"title":"About","date":"2017-03-07T01:00:07.000Z","updated":"2017-06-04T01:41:33.000Z","comments":true,"path":"about/index.html","permalink":"https://sunny0715.github.io/about/index.html","excerpt":"","text":"â€‹ â€‹ å–œæ¬¢æ–°é²œçš„äº‹ç‰©ï¼Œé’»ç ”æŠ€æœ¯ï¼Œçƒ­çˆ±äº’è”ç½‘è¡Œä¸šã€‚ â€‹ åšè‡ªå·±å–œæ¬¢åšçš„äº‹ã€‚ â€‹ èœé¸Ÿç¨‹åºçŒ¿ä¸€åªï¼Œæ¬¢è¿åˆ†äº«çŸ¥è¯†ã€‚ â€‹ From å½©è™¹é©¬ ğŸ§ 1223585957"},{"title":"æ ‡ç­¾","date":"2017-03-22T01:01:22.000Z","updated":"2017-06-04T01:41:33.000Z","comments":true,"path":"tags/index.html","permalink":"https://sunny0715.github.io/tags/index.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2017-03-22T01:01:55.000Z","updated":"2017-06-04T01:41:33.000Z","comments":true,"path":"categories/index.html","permalink":"https://sunny0715.github.io/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"Springä¹‹åŠ¨æ€ä»£ç†","slug":"Springä¹‹åŠ¨æ€ä»£ç†","date":"2018-04-02T01:55:03.000Z","updated":"2018-04-03T01:29:56.827Z","comments":true,"path":"2018/04/02/Springä¹‹åŠ¨æ€ä»£ç†/","link":"","permalink":"https://sunny0715.github.io/2018/04/02/Springä¹‹åŠ¨æ€ä»£ç†/","excerpt":"å¼•è¨€Springä¸»è¦æœ‰ä¸¤å¤§æ€æƒ³ï¼Œä¸€ä¸ªæ˜¯AOPï¼Œä¸€ä¸ªæ˜¯IOCã€‚å¯¹äºSpringçš„æ ¸å¿ƒAOPæ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æœºåˆ¶æ˜¯å…¶æ ¸å¿ƒï¼Œæƒ³è¦æ˜ç™½AOPåŸç†ï¼Œä¸€å®šè¦äº†è§£åŠ¨æ€ä»£ç†æœºåˆ¶ã€‚","text":"å¼•è¨€Springä¸»è¦æœ‰ä¸¤å¤§æ€æƒ³ï¼Œä¸€ä¸ªæ˜¯AOPï¼Œä¸€ä¸ªæ˜¯IOCã€‚å¯¹äºSpringçš„æ ¸å¿ƒAOPæ¥è¯´ï¼ŒåŠ¨æ€ä»£ç†æœºåˆ¶æ˜¯å…¶æ ¸å¿ƒï¼Œæƒ³è¦æ˜ç™½AOPåŸç†ï¼Œä¸€å®šè¦äº†è§£åŠ¨æ€ä»£ç†æœºåˆ¶ã€‚ ä»£ç†æ¨¡å¼ ç»™æŸä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹äºåŸå¯¹è±¡çš„è®¿é—®ï¼Œå³æ“ä½œè€…ä¸ç›´æ¥æ“æ§åŸå¯¹è±¡ï¼Œè€Œæ˜¯é€šè¿‡ä»£ç†å¯¹è±¡ç®€ä»‹åœ°æ“æ§åŸå¯¹è±¡ã€‚ å®ç°ä»£ç†æ¨¡å¼åˆ†ä¸ºé™æ€ä»£ç†å’ŒåŠ¨æ€ä»£ç†ï¼š é™æ€ä»£ç†ï¼šä»£ç†ç±»æ˜¯åœ¨ç¼–è¯‘æ—¶å°±å®ç°å¥½ã€‚ä¹Ÿå°±æ˜¯è¯´ Java ç¼–è¯‘å®Œæˆåä»£ç†ç±»æ˜¯ä¸€ä¸ªå®é™…çš„ class æ–‡ä»¶ã€‚ åŠ¨æ€ä»£ç†ï¼šåŠ¨æ€ä»£ç†ç±»çš„å­—èŠ‚ç æ˜¯åœ¨ç¨‹åºè¿è¡Œæ—¶ç”±Javaåå°„æœºåˆ¶åŠ¨æ€ç”Ÿæˆã€‚ä¹Ÿå°±æ˜¯è¯´ Java ç¼–è¯‘å®Œä¹‹åå¹¶æ²¡æœ‰å®é™…çš„ class æ–‡ä»¶ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆçš„ç±»å­—èŠ‚ç ï¼Œå¹¶åŠ è½½åˆ°JVMä¸­ã€‚ Springé™æ€ä»£ç† ç”±ç¨‹åºå‘˜åˆ›å»ºæˆ–å·¥å…·ç”Ÿæˆä»£ç†ç±»çš„æºç ï¼Œå†ç¼–è¯‘ä»£ç†ç±»ã€‚æ‰€è°“é™æ€ä¹Ÿå°±æ˜¯åœ¨ç¨‹åºè¿è¡Œå‰å°±å·²ç»å­˜åœ¨ä»£ç†ç±»çš„å­—èŠ‚ç æ–‡ä»¶ï¼Œä»£ç†ç±»å’Œå§”æ‰˜ç±»çš„å…³ç³»åœ¨è¿è¡Œå‰å°±ç¡®å®šäº†ã€‚ é™æ€ä»£ç†ä¹‹å‰å·²ç»è¯´è¿‡ Spring-AOPä¸¤ç§é…ç½®æ–¹å¼ SpringåŠ¨æ€ä»£ç†JDKåŠ¨æ€ä»£ç†(å¯¹æœ‰å®ç°æ¥å£çš„å¯¹è±¡åšä»£ç†) å®ç°æ–¹å¼è¯´æ˜JDKåŠ¨æ€ä»£ç†ä¸­ éœ€è¦äº†è§£çš„ä¸¤ä¸ªé‡è¦çš„ç±»æˆ–æ¥å£ [InvocationHandler å’Œ Proxy] InvocationHandleræ¥å£ 1234567public interface InvocationHandler &#123; // å‚æ•°è¯´æ˜ï¼š // Object proxyï¼šæŒ‡è¢«ä»£ç†çš„å¯¹è±¡ // Method methodï¼šæ‰€è¦è°ƒç”¨è¢«ä»£ç†å¯¹è±¡çš„æŸä¸ªæ–¹æ³•çš„Methodå¯¹è±¡ // Object[] argsï¼šè¢«ä»£ç†å¯¹è±¡æŸä¸ªæ–¹æ³•è°ƒç”¨æ—¶æ‰€éœ€è¦çš„å‚æ•° public Object invoke(Object proxy, Method method, Object[] args) throws Throwable; &#125; å¯ä»¥å°†InvocationHandleræ¥å£çš„å­ç±»æƒ³è±¡æˆä¸€ä¸ªä»£ç†çš„æœ€ç»ˆæ“ä½œç±»ã€‚ è¯´æ˜ï¼šæ¯ä¸€ä¸ªåŠ¨æ€ä»£ç†å¯¹è±¡éƒ½å¿…é¡»è¦å®ç°InvocationHandlerè¿™ä¸ªæ¥å£ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†ç±»ï¼ˆProxyï¼‰çš„å®ä¾‹éƒ½å…³è”åˆ°äº†ä¸€ä¸ªhandleï¼Œå½“æˆ‘ä»¬é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•çš„æ—¶å€™ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨å°±ä¼šè¢«è½¬å‘ä¸ºInvocationHandlerè¿™ä¸ªæ¥å£çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚åŒæ—¶åœ¨invokeçš„æ–¹æ³•é‡Œï¼Œå¯ä»¥å¯¹è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨åšå¢å¼ºå¤„ç†(å¦‚æ·»åŠ äº‹åŠ¡ã€æ—¥å¿—ã€æƒé™è®¤è¯ç­‰æ“ä½œ)ã€‚ Proxyç±» Proxyç±»æ˜¯ä¸“é—¨å®Œæˆä»£ç†çš„æ“ä½œç±»ï¼Œå¯ä»¥é€šè¿‡æ­¤ç±»ä¸ºä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£åŠ¨æ€åœ°ç”Ÿæˆå®ç°ç±»ï¼Œè¯¥ç±»å¸¸ç”¨çš„è°ƒç”¨æ–¹æ³•ä¸ºnewProxyInstance newProxyInstanceæ–¹æ³•å‚æ•°è¯´æ˜å¦‚ä¸‹ï¼š ClassLoader loaderï¼šç±»åŠ è½½å™¨ï¼Œå®šä¹‰äº†ç”±å“ªä¸ªClassLoaderå¯¹è±¡æ¥å¯¹ç”Ÿæˆçš„ä»£ç†å¯¹è±¡è¿›è¡ŒåŠ è½½ Class&lt;?&gt;[] interfacesï¼šå¾—åˆ°è¢«ä»£ç†ç±»å…¨éƒ¨çš„æ¥å£ï¼Œå¦‚æœæˆ‘æä¾›äº†ä¸€ç»„æ¥å£ç»™å®ƒï¼Œé‚£ä¹ˆè¿™ä¸ªä»£ç†å¯¹è±¡å°±å®£ç§°å®ç°äº†è¯¥æ¥å£ï¼Œè¿™æ ·æˆ‘å°±èƒ½è°ƒç”¨è¿™ç»„æ¥å£ä¸­çš„æ–¹æ³•äº† InvocationHandler hï¼šå¾—åˆ°InvocationHandleræ¥å£çš„å­ç±»å®ä¾‹ å®ç°å®ä¾‹ä¸€ã€é¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªSubjectç±»å‹çš„æ¥å£ï¼šSubject.java 12345678public interface Subject &#123; // å­¦ä¹  void study(); // è¯´è¯ String say(String words);&#125; äºŒã€æ¥ç€å®šä¹‰ä¸€ä¸ªæ¥å£çš„å®ç°ç±»ï¼Œè¿™ä¸ªç±»å°±æ˜¯æˆ‘ä»¬ç¤ºä¾‹ä¸­çš„è¢«ä»£ç†å¯¹è±¡ï¼šRealSubject.java 1234567891011121314151617/** * è¢«ä»£ç†ç±» * ClassName: RealSubject * @author rainbowhorse */public class RealSubject implements Subject &#123; @Override public void study() &#123; System.out.println(\"I am study now.\"); &#125; @Override public String say(String words) &#123; return \"I say \" + words; &#125;&#125; ä¸‰ã€å®šä¹‰ä¸€ä¸ªåŠ¨æ€ä»£ç†ç±»ï¼ˆå¿…é¡»è¦å®ç° InvocationHandler æ¥å£ï¼‰ï¼šDynamicProxy.java 123456789101112131415161718192021222324252627282930313233import java.lang.reflect.InvocationHandler;import java.lang.reflect.Method;/** * JDKåŠ¨æ€ä»£ç†ç±» * ClassName: DynamicProxy * @author rainbowhorse */public class DynamicProxy implements InvocationHandler &#123; // è¿™ä¸ªå°±æ˜¯è¦ä»£ç†çš„çœŸå®å¯¹è±¡ private Object subject; // æ„é€ æ–¹æ³•ï¼Œç»™è¦ä»£ç†çš„çœŸå®å¯¹è±¡èµ‹åˆå€¼ public DynamicProxy(Object subject) &#123; this.subject = subject; &#125; @Override public Object invoke(Object proxy, Method method, Object[] args) throws Throwable &#123; // åœ¨ä»£ç†çœŸå®å¯¹è±¡å‰å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ System.out.println(\"before method\"); System.out.println(\"Method:\" + method); // å½“ä»£ç†å¯¹è±¡è°ƒç”¨çœŸå®å¯¹è±¡çš„æ–¹æ³•æ—¶ï¼Œå…¶ä¼šè‡ªåŠ¨çš„è·³è½¬åˆ°ä»£ç†å¯¹è±¡å…³è”çš„handlerå¯¹è±¡çš„invokeæ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ Object invoke = method.invoke(subject, args); // åœ¨ä»£ç†çœŸå®å¯¹è±¡åä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ System.out.println(\"after method\"); return invoke; &#125;&#125; å››ã€ä»£ç†æµ‹è¯•ç±»ï¼šClient.java 1234567891011121314151617181920212223242526272829import java.lang.reflect.InvocationHandler;import java.lang.reflect.Proxy;public class Client &#123; public static void main(String[] args) &#123; // è¦ä»£ç†çš„çœŸå®å¯¹è±¡ Subject realSubject = new RealSubject(); // è¦ä»£ç†å“ªä¸ªçœŸå®å¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›å»ï¼Œæœ€åæ˜¯é€šè¿‡è¯¥çœŸå®å¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³•çš„ InvocationHandler handler = new DynamicProxy(realSubject); /* * é€šè¿‡Proxyçš„newProxyInstanceæ–¹æ³•æ¥åŠ¨æ€åˆ›å»ºæˆ‘ä»¬çš„ä»£ç†å¯¹è±¡ * å‚æ•°ä¸€ï¼šè¿™é‡Œä½¿ç”¨handlerè¿™ä¸ªç±»çš„ClassLoaderå¯¹è±¡æ¥åŠ è½½ä»£ç†å¯¹è±¡ * å‚æ•°äºŒï¼šè¿™é‡Œä¸ºä»£ç†å¯¹è±¡æä¾›çš„æ¥å£æ˜¯çœŸå®å¯¹è±¡æ‰€å®è¡Œçš„æ¥å£ï¼Œè¡¨ç¤ºæˆ‘è¦ä»£ç†çš„æ˜¯è¯¥çœŸå®å¯¹è±¡ï¼Œè¿™æ ·å°±èƒ½è°ƒç”¨è¿™ç»„æ¥å£ä¸­çš„æ–¹æ³•äº† * å‚æ•°ä¸‰ï¼šè¿™é‡Œå°†è¿™ä¸ªä»£ç†å¯¹è±¡å…³è”åˆ°äº†ä¸Šæ–¹çš„ InvocationHandler è¿™ä¸ªå¯¹è±¡ä¸Š */ Subject subject = (Subject) Proxy.newProxyInstance(handler.getClass().getClassLoader(), realSubject.getClass().getInterfaces(), handler); System.out.println(subject.getClass().getName()); subject.study(); System.out.println(); String string = subject.say(\"Hellow World.\"); System.out.println(string); &#125;&#125; è¿è¡Œ-&gt;æ§åˆ¶å°è¾“å‡ºç»“æœå¦‚ä¸‹ CGLibåŠ¨æ€ä»£ç†[å¯¹æ²¡æœ‰å®ç°æ¥å£çš„æ™®é€šç±»åšä»£ç†]è¯´æ˜æ¦‚è¿° CGLibï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªä¼˜ç§€çš„åŠ¨æ€ä»£ç†æ¡†æ¶ï¼Œå®ƒçš„åº•å±‚ä½¿ç”¨ASMï¼ˆJAVAå­—èŠ‚ç å¤„ç†æ¡†æ¶ï¼‰åœ¨å†…å­˜ä¸­åŠ¨æ€çš„ç”Ÿæˆè¢«ä»£ç†ç±»çš„å­ç±»ã€‚ä½¿ç”¨CGLibå³ä½¿è¢«ä»£ç†ç±»æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ä¹Ÿå¯ä»¥å®ç°åŠ¨æ€ä»£ç†åŠŸèƒ½ã€‚ä½†æ˜¯ä¸èƒ½å¯¹finalä¿®é¥°çš„ç±»è¿›è¡Œä»£ç†ã€‚ åŸç† é€šè¿‡å­—èŠ‚ç æŠ€æœ¯ä¸ºä¸€ä¸ªç±»åˆ›å»ºå­ç±»ï¼Œå¹¶åœ¨å­ç±»ä¸­é‡‡ç”¨æ–¹æ³•æ‹¦æˆªçš„æŠ€æœ¯æ‹¦æˆªæ‰€æœ‰çˆ¶ç±»æ–¹æ³•çš„è°ƒç”¨ã€‚JDKåŠ¨æ€ä»£ç†ä¸CGLibåŠ¨æ€ä»£ç†å‡æ˜¯å®ç°Spring AOPçš„åŸºç¡€ã€‚ å®ç°å®ä¾‹ä¸€ã€å®šä¹‰ä¸€ä¸ªæ²¡æœ‰å®ç°æ¥å£çš„ä»£ç†å§”æ‰˜ç±»ï¼šCGLibRealSubject.java 123456789101112131415/** * æ²¡æœ‰å®ç°æ¥å£çš„ä»£ç†å§”æ‰˜ç±» * ClassName: CGLibRealSubject * @author rainbowhorse */public class CGLibRealSubject &#123; public void study() &#123; System.out.println(\"I am study now.\"); &#125; public String say(String words) &#123; return \"I say \" + words; &#125;&#125; äºŒã€å®šä¹‰ä¸€ä¸ªCGLibåŠ¨æ€ä»£ç†ç±»: CGLibDynamicProxy.java 123456789101112131415161718192021222324252627282930313233343536373839404142import java.lang.reflect.Method;import net.sf.cglib.proxy.Enhancer;import net.sf.cglib.proxy.MethodInterceptor;import net.sf.cglib.proxy.MethodProxy;public class CGLibDynamicProxy implements MethodInterceptor &#123; private Object target; /** * åˆ›å»ºä»£ç†å¯¹è±¡ * * @param target * è¢«ä»£ç†çš„å¯¹è±¡ * @return */ public Object getProxyInstance(Object target) &#123; this.target = target; // å£°æ˜å¢å¼ºç±»å®ä¾‹ Enhancer enhancer = new Enhancer(); // è®¾ç½®è¢«ä»£ç†ç±»å­—èŠ‚ç ï¼ŒCGLIBæ ¹æ®å­—èŠ‚ç ç”Ÿæˆè¢«ä»£ç†ç±»çš„å­ç±» enhancer.setSuperclass(this.target.getClass()); // è®¾ç½®è¦ä»£ç†çš„æ‹¦æˆªå™¨ï¼Œå›è°ƒå‡½æ•°ï¼Œå³ä¸€ä¸ªæ–¹æ³•æ‹¦æˆª new MethodInterceptor() enhancer.setCallback(this); // åˆ›å»ºä»£ç†å¯¹è±¡ å®ä¾‹ return enhancer.create(); &#125; @Override public Object intercept(Object obj, Method method, Object[] args, MethodProxy proxy) throws Throwable &#123; // åœ¨ä»£ç†çœŸå®å¯¹è±¡æ“ä½œå‰ æˆ‘ä»¬å¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ System.out.println(\"before method\"); Object object = proxy.invokeSuper(obj, args); // åœ¨ä»£ç†çœŸå®å¯¹è±¡æ“ä½œå æˆ‘ä»¬ä¹Ÿå¯ä»¥æ·»åŠ ä¸€äº›è‡ªå·±çš„æ“ä½œ System.out.println(\"after method\"); return object; &#125;&#125; ä¸‰ã€åˆ›å»ºæµ‹è¯•å®¢æˆ·ç«¯ç±»ï¼šCGLibClient.java 1234567891011121314151617/** * CGLibåŠ¨æ€ä»£ç†æµ‹è¯•ç±» * ClassName: CGLibClient * @author rainbowhorse */public class CGLibClient &#123; public static void main(String[] args) &#123; CGLibDynamicProxy cglib = new CGLibDynamicProxy(); CGLibRealSubject realSubject = (CGLibRealSubject) cglib.getProxyInstance(new CGLibRealSubject()); realSubject.study(); System.out.println(); System.out.println(realSubject.say(\"Hello World.\")); &#125;&#125; è¿è¡Œ-&gt;æ§åˆ¶å°è¾“å‡ºç»“æœå¦‚ä¸‹ æ€»ç»“Spirngçš„AOPçš„åŠ¨æ€ä»£ç†å®ç°æœºåˆ¶æœ‰ä¸¤ç§ï¼Œåˆ†åˆ«æ˜¯: 1ï¼‰JDKåŠ¨æ€ä»£ç† å…·ä½“å®ç°åŸç†ï¼š é€šè¿‡å®ç°InvocationHandletæ¥å£åˆ›å»ºè‡ªå·±çš„è°ƒç”¨å¤„ç†å™¨ é€šè¿‡ä¸ºProxyç±»æŒ‡å®šClassLoaderå¯¹è±¡å’Œä¸€ç»„interfaceæ¥åˆ›å»ºåŠ¨æ€ä»£ç† é€šè¿‡åå°„æœºåˆ¶è·å–åŠ¨æ€ä»£ç†ç±»çš„æ„é€ å‡½æ•°ï¼Œå…¶å”¯ä¸€å‚æ•°ç±»å‹å°±æ˜¯è°ƒç”¨å¤„ç†å™¨æ¥å£ç±»å‹ é€šè¿‡æ„é€ å‡½æ•°åˆ›å»ºåŠ¨æ€ä»£ç†ç±»å®ä¾‹ï¼Œæ„é€ æ—¶è°ƒç”¨å¤„ç†å™¨å¯¹è±¡ä½œä¸ºå‚æ•°å‚å…¥ JDKåŠ¨æ€ä»£ç†æ˜¯é¢å‘æ¥å£çš„ä»£ç†æ¨¡å¼ï¼Œå¦‚æœè¢«ä»£ç†ç›®æ ‡æ²¡æœ‰æ¥å£é‚£ä¹ˆSpringä¹Ÿæ— èƒ½ä¸ºåŠ› Springé€šè¿‡javaçš„åå°„æœºåˆ¶ç”Ÿäº§è¢«ä»£ç†æ¥å£çš„æ–°çš„åŒ¿åå®ç°ç±»ï¼Œé‡å†™äº†å…¶ä¸­AOPçš„å¢å¼ºæ–¹æ³•ã€‚ 2ï¼‰CGLibåŠ¨æ€ä»£ç† CGLibæ˜¯ä¸€ä¸ªå¼ºå¤§ã€é«˜æ€§èƒ½çš„Codeç”Ÿäº§ç±»åº“ï¼Œå¯ä»¥å®ç°è¿è¡ŒæœŸåŠ¨æ€æ‰©å±•javaç±»ï¼ŒSpringåœ¨è¿è¡ŒæœŸé—´é€šè¿‡CGlibç»§æ‰¿è¦è¢«åŠ¨æ€ä»£ç†çš„ç±»ï¼Œé‡å†™çˆ¶ç±»çš„æ–¹æ³•ï¼Œå®ç°AOPé¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚ å¯¹æ¯” JDKåŠ¨æ€ä»£ç†æ˜¯é¢å‘æ¥å£ï¼Œåœ¨åˆ›å»ºä»£ç†å®ç°ç±»æ—¶æ¯”CGLibè¦å¿«ï¼Œåˆ›å»ºä»£ç†é€Ÿåº¦å¿«ã€‚ CGLibåŠ¨æ€ä»£ç†æ˜¯é€šè¿‡å­—èŠ‚ç åº•å±‚ç»§æ‰¿è¦ä»£ç†ç±»æ¥å®ç°ï¼ˆå¦‚æœè¢«ä»£ç†ç±»è¢«finalå…³é”®å­—æ‰€ä¿®é¥°ï¼Œé‚£ä¹ˆä¼šå¤±è´¥ï¼‰ï¼Œåœ¨åˆ›å»ºä»£ç†è¿™ä¸€å—æ²¡æœ‰JDKåŠ¨æ€ä»£ç†å¿«ï¼Œä½†æ˜¯è¿è¡Œé€Ÿåº¦æ¯”JDKåŠ¨æ€ä»£ç†è¦å¿«ã€‚ æ³¨æ„ å¦‚æœè¦è¢«ä»£ç†çš„å¯¹è±¡æ˜¯ä¸ªå®ç°ç±»ï¼Œé‚£ä¹ˆSpringä¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†æ¥å®Œæˆæ“ä½œï¼ˆSpirngé»˜è®¤é‡‡ç”¨JDKåŠ¨æ€ä»£ç†å®ç°æœºåˆ¶ï¼‰ å¦‚æœè¦è¢«ä»£ç†çš„å¯¹è±¡ä¸æ˜¯ä¸ªå®ç°ç±»ï¼Œé‚£ä¹ˆSpringä¼šå¼ºåˆ¶ä½¿ç”¨CGLibæ¥å®ç°åŠ¨æ€ä»£ç†ã€‚ Springä¸­é…ç½®åŠ¨æ€ä»£ç†æ–¹å¼é€šè¿‡é…ç½®Springçš„ä¸­æ ‡ç­¾æ¥æ˜¾ç¤ºçš„æŒ‡å®šä½¿ç”¨åŠ¨æ€ä»£ç†æœºåˆ¶ proxy-target-class=trueè¡¨ç¤ºä½¿ç”¨CGLibä»£ç†ï¼Œå¦‚æœä¸ºfalseå°±æ˜¯é»˜è®¤ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://sunny0715.github.io/tags/spring/"}]},{"title":"Apache-Commons-Emailå‘é€é‚®ä»¶","slug":"Apache-Commons-Emailå‘é€é‚®ä»¶","date":"2018-03-28T10:18:13.000Z","updated":"2018-03-28T11:30:19.408Z","comments":true,"path":"2018/03/28/Apache-Commons-Emailå‘é€é‚®ä»¶/","link":"","permalink":"https://sunny0715.github.io/2018/03/28/Apache-Commons-Emailå‘é€é‚®ä»¶/","excerpt":"å¼•è¨€ä½¿ç”¨Apache-Commons-Emailå‘é€é‚®ä»¶","text":"å¼•è¨€ä½¿ç”¨Apache-Commons-Emailå‘é€é‚®ä»¶ ç¯å¢ƒå‡†å¤‡Mavençš„pom.xml æ–‡ä»¶ä¸­å¼•å…¥ä¾èµ– 12345&lt;dependency&gt; &lt;groupId&gt;org.apache.commons&lt;/groupId&gt; &lt;artifactId&gt;commons-email&lt;/artifactId&gt; &lt;version&gt;1.5&lt;/version&gt;&lt;/dependency&gt; ä¸€ä¸ªç®€å•çš„çº¯æ–‡æœ¬é‚®ä»¶HTTPæ¨¡å¼ä¸‹ç¬¬ä¸€ä¸ªä¾‹å­æ˜¯åˆ›å»ºä¸€ä¸ªç®€å•çš„emailã€‚ 123456789101112131415161718192021222324252627282930313233343536373839import org.apache.commons.mail.EmailException;import org.apache.commons.mail.SimpleEmail;/*** ç±»å: TestSimpleEmail.java &lt;br/&gt;* è¯¦ç»†æè¿°: ä¸€ä¸ªç®€å•çš„çº¯æ–‡æœ¬é‚®ä»¶ &lt;br/&gt;* å‘å¸ƒç‰ˆæœ¬ï¼š V1.0 &lt;br/&gt; */public class TestSimpleEmail &#123; public static void main(String[] args) &#123; SimpleEmail email = new SimpleEmail(); //è®¾ç½®å‘é€ä¸»æœºçš„æœåŠ¡å™¨åœ°å€(å¦‚æœä¸è®¾ç½®ï¼Œé»˜è®¤æ˜¯\"mail.host\") email.setHostName (\"smtp.163.com\"); // å¼€å¯debugæ¨¡å¼ email.setDebug(true); //è®¾ç½®ç«¯å£å· email.setSmtpPort(25);//é»˜è®¤ä¹Ÿæ˜¯25 //å¦‚æœè¦æ±‚èº«ä»½éªŒè¯ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç ï¼Œåˆ†åˆ«ä¸ºå‘ä»¶äººåœ¨é‚®ä»¶æœåŠ¡å™¨ä¸Šæ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç  email.setAuthentication ( \"from@163.com\", \"password\" ); try &#123; //è®¾ç½®æ”¶ä»¶äººé‚®ç®±ä»¥åŠåç§° email.addTo (\"to@qq.com\", \"æ”¶ä»¶äººåç§°\"); //å‘ä»¶äººé‚®ç®±ä»¥åŠåç§° //email.setFrom (\"from@163.com\", \"å‘ä»¶äººåç§°\"); //å‘ä»¶äººé‚®ç®±ä»¥åŠåç§°ï¼Œé‚®ä»¶ç¼–ç æ ¼å¼ email.setFrom(\"from@163.com\", \"å‘ä»¶äººåç§°\", \"UTF-8\"); //è®¾ç½®é‚®ä»¶çš„ä¸»é¢˜ email.setSubject (\"è¿™æ˜¯é‚®ä»¶ä¸»é¢˜å†…å®¹\"); //é‚®ä»¶æ­£æ–‡æ¶ˆæ¯ email.setMsg (\"è¿™æ˜¯é‚®ä»¶å†…å®¹ï¼\"); // å‘é€ email.send (); System.out.println (\"Send email successful!\"); &#125; catch (EmailException e) &#123; e.printStackTrace(); &#125; &#125;&#125; å¦‚æœé‡åˆ°ä¹±ç æƒ…å†µå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹æ¡ˆè§£å†³ï¼š 1234//è®¾ç½®ä¸»é¢˜çš„å­—ç¬¦é›†ä¸ºUTF-8email.setCharset(\"UTF-8\");//è®¾ç½®å†…å®¹çš„å­—ç¬¦é›†ä¸ºUTF-8,å…ˆbuildMimeMessageæ‰èƒ½è®¾ç½®å†…å®¹æ–‡æœ¬email.getMimeMessage().setText(\"æµ‹è¯•é‚®ä»¶å†…å®¹\",\"UTF-8\"); å¼€å¯äº†HTTPSéœ€è¦æ·»åŠ sslç«¯å£ï¼Œä»¥åŠå¼€å¯SSLOnConnectã€‚ 1234567891011121314151617181920212223242526272829303132333435363738import org.apache.commons.mail.EmailException;import org.apache.commons.mail.SimpleEmail;/*** ç±»å: TestSimpleSSLEmail.java &lt;br/&gt;* è¯¦ç»†æè¿°: ä¸€ä¸ªç®€å•çš„çº¯æ–‡æœ¬é‚®ä»¶ --å¼€å¯äº†httpsçš„æƒ…å†µä¸‹ &lt;br/&gt;* å‘å¸ƒç‰ˆæœ¬ï¼š V1.0 &lt;br/&gt; */public class TestSimpleSSLEmail &#123; public static void main(String[] args) &#123; SimpleEmail email = new SimpleEmail (); // smtp host email.setHostName (\"smtp.qq.com\"); //ç«¯å£å· email.setSslSmtpPort(\"465\"); // ç™»é™†é‚®ä»¶æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç  email.setAuthentication (\"from@qq.com\", \"password\");//æ³¨æ„qqé‚®ç®±éœ€è¦æˆæƒï¼Œåœ¨è®¾ç½®é‚£é‡Œç”Ÿæˆä¸€ä¸ªéšæœºç ï¼Œç„¶åå¡«å†™åˆ°å¯†ç æ¡†ã€‚ // æ¥æ”¶äºº email.setSSLOnConnect(true); try &#123; //è®¾ç½®æ”¶ä»¶äººé‚®ç®±ä»¥åŠåç§° email.addTo (\"to@qq.com\", \"to\"); // å‘é€äºº //email.setFrom (\"from@163.com\", \"from\"); email.setFrom(\"from@qq.com\", \"from\", \"UTF-8\"); //è®¾ç½®é‚®ä»¶çš„ä¸»é¢˜ email.setSubject (\"è¿™æ˜¯é‚®ä»¶ä¸»é¢˜å†…å®¹\"); //é‚®ä»¶æ­£æ–‡æ¶ˆæ¯ email.setMsg (\"è¿™æ˜¯é‚®ä»¶å†…å®¹ï¼--ä¸€ä¸ªç®€å•çš„çº¯æ–‡æœ¬é‚®ä»¶ --å¼€å¯äº†httpsçš„æƒ…å†µä¸‹ \"); // å‘é€ email.send (); System.out.println (\"Send email successful!\"); &#125; catch (EmailException e) &#123; e.printStackTrace(); &#125; &#125;&#125; ç‰¹åˆ«è¦æ³¨æ„çš„æ˜¯qqé‚®ç®±è¿›è¡Œäº†åŠ å¯†ï¼Œæ‰€ä»¥éœ€è¦åˆ°qqè´¦æˆ·è®¾ç½®é‡Œé¢æ‹¿åˆ°å¼€å¯stmpå‘ä¿¡å®¢æˆ·ç«¯çš„å¯†ç ã€‚ å–åˆ°ä¸€ä¸²å­—ç¬¦ä¸²ï¼Œç„¶åå¡«å†™åˆ°å¯†ç å¤„ã€‚ä¸ç„¶ä¼šæŠ¥ä»¥ä¸‹çš„é”™è¯¯ã€‚è€Œä¸æ˜¯å¡«å†™QQè´¦å·å¯†ç åˆ°å¯†ç è®¤è¯å¤„ã€‚è¯¦ç»†ä¹Ÿå¯ä»¥å‚ç…§QQå®¢æˆ·ç«¯è¯´æ˜æ–‡æ¡£ã€‚ å‘é€å¸¦é™„ä»¶çš„é‚®ä»¶å‘é€å¸¦é™„ä»¶çš„é‚®ä»¶å¾—ç”¨MultiPartEmail ç±»æ¥ç»™é‚®ä»¶æ·»åŠ é™„ä»¶ã€‚é™¤è¿‡è¦†ç›–attach()æ–¹æ³•æ¥ç»™é‚®ä»¶æ·»åŠ é™„ä»¶å¤–ï¼Œè¿™ä¸ªç±»å°±å’ŒSimpleEmailç±»å·®ä¸å¤šã€‚å¯¹äºå†…è”æˆ–æ˜¯åŠ å…¥é™„ä»¶çš„ä¸ªæ•°æ˜¯æ²¡æœ‰é™åˆ¶çš„ã€‚ä½†é™„ä»¶å¿…é¡»æ˜¯MIMEç¼–ç ã€‚æœ€ç®€å•çš„æ·»åŠ é™„ä»¶çš„æ–¹å¼æ˜¯ç”¨ EmailAttachmentç±»ã€‚ æœ¬åœ°é™„ä»¶123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051import org.apache.commons.mail.EmailAttachment;import org.apache.commons.mail.EmailException;import org.apache.commons.mail.MultiPartEmail;/*** ç±»å: TestEmailAttachment.java &lt;br/&gt;* è¯¦ç»†æè¿°:å‘é€å¸¦é™„ä»¶çš„é‚®ä»¶--è¯»å–æœ¬åœ°è·¯å¾„çš„æ–‡ä»¶ &lt;br/&gt;* å‘å¸ƒç‰ˆæœ¬ï¼š V1.0 &lt;br/&gt; */public class TestEmailAttachment &#123; public static void main(String[] args) &#123; // åˆ›å»ºä¸€ä¸ªEmailé™„ä»¶ EmailAttachment attachment = new EmailAttachment(); // æœ¬åœ°èµ„æºéœ€è¦å­˜åœ¨ attachment.setPath(\"E:\\\\qrcode.jpg\"); attachment.setDisposition(EmailAttachment.ATTACHMENT); attachment.setDescription(\"å›¾ç‰‡\"); // è‡ªå®šä¹‰æ–‡ä»¶åï¼Œå¹¶ä¸”æ ¼å¼è¦ä¸€è‡´ï¼Œä¸ç„¶é™„è¿‘æ”¶åˆ°çš„è¯ï¼Œæœ‰å¯èƒ½è¯»ä¸å‡ºæ¥ã€‚ attachment.setName(\"qrcode.jpg\"); // Create the email message MultiPartEmail email = new MultiPartEmail(); // smtp host email.setHostName (\"smtp.163.com\"); //è®¾ç½®ç«¯å£å· email.setSmtpPort(25);//é»˜è®¤ä¹Ÿæ˜¯25 // ç™»é™†é‚®ä»¶æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç  email.setAuthentication (\"from@163.com\",\"password\"); try &#123; //è®¾ç½®æ”¶ä»¶äººé‚®ç®±ä»¥åŠåç§° email.addTo (\"to@qq.com\", \"æ”¶ä»¶äººåç§°\"); //å‘ä»¶äººé‚®ç®±ä»¥åŠåç§° //email.setFrom (\"from@163.com\", \"å‘ä»¶äººåç§°\"); //å‘ä»¶äººé‚®ç®±ä»¥åŠåç§°ï¼Œé‚®ä»¶ç¼–ç æ ¼å¼ email.setFrom(\"from@163.com\", \"å‘ä»¶äººåç§°\", \"UTF-8\"); //è®¾ç½®é‚®ä»¶çš„ä¸»é¢˜ email.setSubject (\"è¿™æ˜¯é‚®ä»¶ä¸»é¢˜å†…å®¹\"); //é‚®ä»¶æ­£æ–‡æ¶ˆæ¯ email.setMsg (\"è¿™æ˜¯é‚®ä»¶å†…å®¹ï¼\"); // add the attachment email.attach(attachment); // send the email email.send(); System.out.println (\"Send email successful!\"); &#125; catch (EmailException e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¿œç¨‹é™„ä»¶å¦‚æœæ²¡æœ‰æœ¬åœ°æ–‡ä»¶ï¼Œå¯ä»¥ç”¨ EmailAttachment æ·»åŠ ä»»ä½•å¯ç”¨çš„URLã€‚å½“é‚®ä»¶å‘é€åï¼Œæ–‡ä»¶ä¼šè‡ªåŠ¨åŠ è½½å¹¶åŠ å…¥åˆ°é‚®ä»¶å†…å®¹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354import java.net.MalformedURLException;import java.net.URL; import org.apache.commons.mail.EmailAttachment;import org.apache.commons.mail.EmailException;import org.apache.commons.mail.MultiPartEmail;/*** ç±»å: TestEmailAttachment.java &lt;br/&gt;* è¯¦ç»†æè¿°:å‘é€å¸¦é™„ä»¶çš„é‚®ä»¶--è¯»å–æœ¬åœ°è·¯å¾„çš„æ–‡ä»¶ &lt;br/&gt;* å‘å¸ƒç‰ˆæœ¬ï¼š V1.0 &lt;br/&gt; */public class TestEmailAttachment2 &#123; public static void main(String[] args) throws MalformedURLException &#123; // åˆ›å»ºä¸€ä¸ªEmailé™„ä»¶ EmailAttachment attachment = new EmailAttachment(); attachment.setURL(new URL(\"http://www.apache.org/images/asf_logo_wide.gif\")); attachment.setDisposition(EmailAttachment.ATTACHMENT); attachment.setDescription(\"Apache logo\"); // è‡ªå®šä¹‰æ–‡ä»¶åï¼Œå¹¶ä¸”æ ¼å¼è¦ä¸€è‡´ï¼Œä¸ç„¶é™„è¿‘æ”¶åˆ°çš„è¯ï¼Œæœ‰å¯èƒ½è¯»ä¸å‡ºæ¥ attachment.setName(\"asf_logo_wide.gif\"); // Create the email message MultiPartEmail email = new MultiPartEmail(); // smtp host email.setHostName (\"smtp.163.com\"); //è®¾ç½®ç«¯å£å·(é»˜è®¤25) email.setSmtpPort(25); // ç™»é™†é‚®ä»¶æœåŠ¡å™¨çš„ç”¨æˆ·åå’Œå¯†ç  email.setAuthentication (\"from@163.com\",\"password\"); try &#123; // è®¾ç½®æ”¶ä»¶äººé‚®ç®±ä»¥åŠåç§° email.addTo (\"to@qq.com\", \"æ”¶ä»¶äººåç§°\"); // å‘ä»¶äººé‚®ç®±ä»¥åŠåç§° // email.setFrom (\"from@163.com\", \"å‘ä»¶äººåç§°\"); // å‘ä»¶äººé‚®ç®±ä»¥åŠåç§°ï¼Œé‚®ä»¶ç¼–ç æ ¼å¼ email.setFrom(\"from@163.com\", \"å‘ä»¶äººåç§°\", \"UTF-8\"); // è®¾ç½®é‚®ä»¶çš„ä¸»é¢˜ email.setSubject (\"è¿™æ˜¯é‚®ä»¶ä¸»é¢˜å†…å®¹\"); // é‚®ä»¶æ­£æ–‡æ¶ˆæ¯ email.setMsg (\"è¿™æ˜¯é‚®ä»¶å†…å®¹ï¼\"); // æ·»åŠ é™„ä»¶ email.attach(attachment); // å‘é€é‚®ä»¶ email.send(); System.out.println (\"Send email successful!\"); &#125; catch (EmailException e) &#123; e.printStackTrace(); &#125; &#125;&#125; å‘é€å¸¦HTMLæ ¼å¼çš„é‚®ä»¶12345678910111213141516171819202122232425262728293031323334353637383940414243444546import java.net.MalformedURLException;import java.net.URL; import org.apache.commons.mail.EmailException;import org.apache.commons.mail.HtmlEmail;/*** ç±»å: TestHtmlEmail.java &lt;br/&gt;* è¯¦ç»†æè¿°: å‘é€å¸¦HTMLæ ¼å¼çš„é‚®ä»¶&lt;br/&gt;* å‘å¸ƒç‰ˆæœ¬ï¼š V1.0 &lt;br/&gt; */public class TestHtmlEmail &#123; public static void main(String[] args) &#123; // åˆ›å»ºHTMLé‚®ä»¶ HtmlEmail email = new HtmlEmail(); // è®¾ç½®å‘é€ä¸»æœºçš„æœåŠ¡å™¨åœ°å€ email.setHostName (\"smtp.163.com\"); // è®¾ç½®ç«¯å£å·(é»˜è®¤25) email.setSmtpPort(25); // å¦‚æœè¦æ±‚èº«ä»½éªŒè¯ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç ï¼Œåˆ†åˆ«ä¸ºå‘ä»¶äººåœ¨é‚®ä»¶æœåŠ¡å™¨ä¸Šæ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç  email.setAuthentication (\"from@163.com\", \"password\" ); try &#123; URL url = new URL(\"http://www.apache.org/images/asf_logo_wide.gif\"); String cid = email.embed(url, \"Apache logo\"); //è®¾ç½®æ”¶ä»¶äººé‚®ç®±ä»¥åŠåç§° email.addTo (\"to@qq.com\", \"æ”¶ä»¶äººåç§°\"); //å‘ä»¶äººé‚®ç®±ä»¥åŠåç§° //email.setFrom (\"from@163.com\", \"å‘ä»¶äººåç§°\"); //å‘ä»¶äººé‚®ç®±ä»¥åŠåç§°ï¼Œé‚®ä»¶ç¼–ç æ ¼å¼ email.setFrom(\"from@163.com\", \"å‘ä»¶äººåç§°\", \"UTF-8\"); //è®¾ç½®é‚®ä»¶çš„ä¸»é¢˜ email.setSubject (\"è¿™æ˜¯é‚®ä»¶ä¸»é¢˜å†…å®¹-å‘é€å¸¦HTMLæ ¼å¼çš„é‚®ä»¶\"); // HTMLä¿¡æ¯ email.setHtmlMsg(\"&lt;html&gt;The apache logo - &lt;img src=\\\"cid:\" + cid + \"\\\"&gt;&lt;/html&gt;\"); // set the alternative message email.setTextMsg(\"Your email client does not support HTML messages\"); // å‘é€é‚®ä»¶ email.send(); System.out.println (\"Send email successful!\"); &#125; catch (EmailException | MalformedURLException e) &#123; e.printStackTrace(); &#125; &#125;&#125; æ³¨æ„ï¼š embed()æ–¹æ³•è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ã€‚è¯¥å­—ç¬¦ä¸²æ˜¯ä¸€ä¸ªéšæœºç”Ÿæˆçš„æ ‡è¯†ç¬¦ï¼Œå¿…é¡»åœ¨å›¾åƒæ ‡è®°ä¸­å¼•ç”¨å›¾åƒçš„å›¾åƒã€‚ æ²¡æœ‰è°ƒç”¨setmsg()è¿™ä¸ªä¾‹å­ã€‚å› ä¸ºå¦‚æœHTMLå†…å®¹é‡Œæœ‰å†…è”å›¾ç‰‡çš„è¯ï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä¸èƒ½ç”¨çš„ã€‚è¿™æ ·æˆ‘ä»¬å¯ä»¥ç”¨setHtmlMsgå’ŒsetTextMsgæ–¹æ³•ã€‚ å‘é€å¸¦åµŒå…¥å›¾ç‰‡çš„HTMLæ–‡æœ¬å‰é¢è¯´çš„æ˜¯åˆ›å»ºå¸¦åµŒå…¥å›¾ç‰‡çš„HTMLé‚®ä»¶ï¼Œä½†æ˜¯ç”¨HTMLé‚®ä»¶æ¨¡æ¿æ¥å¤„ç†å›¾ç‰‡æ˜¯å¾ˆéº»çƒ¦çš„ã€‚ImageHtmlEmailç±»èƒ½è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œå®ƒèƒ½å¾ˆæ–¹ä¾¿çš„å°†æ‰€æœ‰å¤–éƒ¨å›¾ç‰‡è½¬åŒ–ä¸ºå†…è”å›¾ç‰‡ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152import java.net.MalformedURLException;import java.net.URL;import org.apache.commons.mail.EmailException;import org.apache.commons.mail.ImageHtmlEmail;import org.apache.commons.mail.resolver.DataSourceUrlResolver; /*** ç±»å: TestHtmlEmail.java &lt;br/&gt;* è¯¦ç»†æè¿°: å‘é€å¸¦HTMLæ ¼å¼çš„é‚®ä»¶--åµŒå…¥å›¾ç‰‡çš„HTMLæ–‡æœ¬ &lt;br/&gt;* å‘å¸ƒç‰ˆæœ¬ï¼š V1.0 &lt;br/&gt; */public class TestHtmlEmail2 &#123; public static void main(String[] args) &#123; // create the email message ImageHtmlEmail email = new ImageHtmlEmail(); // è®¾ç½®å‘é€ä¸»æœºçš„æœåŠ¡å™¨åœ°å€ email.setHostName (\"smtp.163.com\"); // è®¾ç½®ç«¯å£å·(é»˜è®¤25) email.setSmtpPort(25); // å¦‚æœè¦æ±‚èº«ä»½éªŒè¯ï¼Œè®¾ç½®ç”¨æˆ·åã€å¯†ç ï¼Œåˆ†åˆ«ä¸ºå‘ä»¶äººåœ¨é‚®ä»¶æœåŠ¡å™¨ä¸Šæ³¨å†Œçš„ç”¨æˆ·åå’Œå¯†ç  email.setAuthentication ( \"from@163.com\", \"password\" ); // load your HTML email template String htmlEmailTemplate = \"åµŒå…¥å›¾ç‰‡çš„HTMLæ–‡æœ¬:&lt;img src=\\\"http://www.apache.org/images/feather.gif\\\"&gt; ....\"; try &#123; URL url = new URL(\"http://www.apache.org\"); email.setDataSourceResolver(new DataSourceUrlResolver(url)); // è®¾ç½®æ”¶ä»¶äººé‚®ç®±ä»¥åŠåç§° email.addTo(\"to@sina.com\", \"æ”¶ä»¶äººåç§°\"); // å‘ä»¶äººé‚®ç®±ä»¥åŠåç§° // å‘ä»¶äººé‚®ç®±ä»¥åŠåç§°ï¼Œé‚®ä»¶ç¼–ç æ ¼å¼ email.setFrom(\"from@qq.com\", \"å‘ä»¶äººåç§°\", \"UTF-8\"); // è®¾ç½®é‚®ä»¶çš„ä¸»é¢˜ email.setSubject(\"è¿™æ˜¯é‚®ä»¶ä¸»é¢˜å†…å®¹\"); // set the html message email.setHtmlMsg(htmlEmailTemplate); email.setCharset(\"UTF-8\"); // set the alternative message email.setTextMsg(\"Your email client does not support HTML messages\"); // å‘é€é‚®ä»¶ email.send(); System.out.println(\"Send email successful!\"); &#125; catch (MalformedURLException | EmailException e) &#123; e.printStackTrace(); &#125; &#125;&#125; è°ƒè¯•JavaMail APIæ”¯æŒè°ƒè¯•é€‰é¡¹ï¼Œé€šè¿‡è°ƒç”¨setDebug(true)æ¥å¼€å¯è°ƒè¯•ã€‚è°ƒè¯•ä¿¡æ¯ä¼šé€šè¿‡System.outæ‰“å°å‡ºæ¥ã€‚ commons-emailçš„å®‰å…¨è®¾ç½®çš„ç‰¹æ€§ã€‚å¯ä»¥ç”¨EmailLiveTestå’ŒEmailConfigurationç±»åœ¨çœŸæ­£çš„SMTPæœåŠ¡å™¨ä¸Šæµ‹è¯•commons-emailã€‚ è®¤è¯å¦‚æœè¦å¯¹SMTPæœåŠ¡å™¨è¿›è¡Œè®¤è¯ï¼Œå¯ä»¥åœ¨å‘é‚®ä»¶å‰è°ƒç”¨setAuthentication(userName,password)æ–¹æ³•æµ‹è¯•ã€‚è¿™å°†ä¼šåœ¨JavaMail APIå‘é€é‚®ä»¶æ—¶åˆ›å»ºDefaultAuthenticatorå®ä¾‹ï¼Œè¦æ”¯æŒæ­¤æ–¹æ³•å¾—è®©ä½ çš„æœåŠ¡å™¨æ”¯æŒRFC255åè®®ã€‚ å¯ä»¥ç”¨javax.mail.Authenticatorçš„å­ç±»æ¥å®Œæˆæ›´åŠ å¤æ‚çš„è®¤è¯ï¼Œå¦‚å¼¹å‡ºä¸ªå¯¹è¯æ¡†ç­‰ã€‚å½“æƒ³æ”¶é›†å¹¶å¤„ç†ç”¨æˆ·ä¿¡æ¯æ—¶ï¼Œå¿…é¡»è¦†ç›–getPasswordAuthentication()æ–¹æ³•ã€‚ç”¨Email.setAuthenticatoræ–¹æ³•å¯ä»¥åˆ›å»ºæ–°çš„Authenticatorç±»ã€‚ å‚è€ƒæ–‡ç« http://commons.apache.org/proper/commons-email/userguide.html Apache Commons Email å‘é€é‚®ä»¶çš„ç”¨æ³•ä»‹ç»ä»¥åŠå®æˆ˜ç»ƒä¹ ","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"}]},{"title":"Mybatisä¹‹ç¼“å­˜","slug":"Mybatisä¹‹ç¼“å­˜","date":"2018-03-20T02:43:53.000Z","updated":"2018-03-20T06:17:57.946Z","comments":true,"path":"2018/03/20/Mybatisä¹‹ç¼“å­˜/","link":"","permalink":"https://sunny0715.github.io/2018/03/20/Mybatisä¹‹ç¼“å­˜/","excerpt":"å¼•è¨€Mybatisä¸­æœ‰ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸€çº§ç¼“å­˜æ˜¯å¼€å¯çš„ï¼Œè€Œä¸”æ˜¯ä¸èƒ½å…³é—­çš„ã€‚ä¸€çº§ç¼“å­˜æ˜¯æŒ‡SqlSessionçº§åˆ«çš„ç¼“å­˜ï¼Œå½“åœ¨åŒä¸€ä¸ªSqlSessionä¸­è¿›è¡Œç›¸åŒçš„SQLè¯­å¥æŸ¥è¯¢æ—¶ï¼Œç¬¬äºŒæ¬¡ä»¥åçš„æŸ¥è¯¢ä¸ä¼šä»æ•°æ®åº“æŸ¥è¯¢ï¼Œè€Œæ˜¯ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œä¸€çº§ç¼“å­˜æœ€å¤šç¼“å­˜1024æ¡SQLã€‚äºŒçº§ç¼“å­˜æ˜¯æŒ‡å¯ä»¥è·¨SqlSessionçš„ç¼“å­˜ã€‚","text":"å¼•è¨€Mybatisä¸­æœ‰ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¸€çº§ç¼“å­˜æ˜¯å¼€å¯çš„ï¼Œè€Œä¸”æ˜¯ä¸èƒ½å…³é—­çš„ã€‚ä¸€çº§ç¼“å­˜æ˜¯æŒ‡SqlSessionçº§åˆ«çš„ç¼“å­˜ï¼Œå½“åœ¨åŒä¸€ä¸ªSqlSessionä¸­è¿›è¡Œç›¸åŒçš„SQLè¯­å¥æŸ¥è¯¢æ—¶ï¼Œç¬¬äºŒæ¬¡ä»¥åçš„æŸ¥è¯¢ä¸ä¼šä»æ•°æ®åº“æŸ¥è¯¢ï¼Œè€Œæ˜¯ç›´æ¥ä»ç¼“å­˜ä¸­è·å–ï¼Œä¸€çº§ç¼“å­˜æœ€å¤šç¼“å­˜1024æ¡SQLã€‚äºŒçº§ç¼“å­˜æ˜¯æŒ‡å¯ä»¥è·¨SqlSessionçš„ç¼“å­˜ã€‚ Mybatisç¼“å­˜ç¼“å­˜çš„æ„ä¹‰ï¼šå°†ç”¨æˆ·ç»å¸¸æŸ¥è¯¢çš„æ•°æ®æ”¾åœ¨ç¼“å­˜ï¼ˆå†…å­˜ï¼‰ä¸­ï¼Œç”¨æˆ·å»æŸ¥è¯¢æ•°æ®å°±ä¸ç”¨ä»ç£ç›˜ä¸Š(å…³ç³»å‹æ•°æ®åº“æ•°æ®æ–‡ä»¶)æŸ¥è¯¢ï¼Œä»ç¼“å­˜ä¸­æŸ¥è¯¢ï¼Œä»è€Œæé«˜æŸ¥è¯¢æ•ˆç‡ï¼Œè§£å†³äº†é«˜å¹¶å‘ç³»ç»Ÿçš„æ€§èƒ½é—®é¢˜ã€‚ Mybatisæä¾›ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ mybatisä¸€çº§ç¼“å­˜æ˜¯ä¸€ä¸ªSqlSessionçº§åˆ«ï¼Œsqlsessionåªèƒ½è®¿é—®è‡ªå·±çš„ä¸€çº§ç¼“å­˜çš„æ•°æ®ã€‚ äºŒçº§ç¼“å­˜æ˜¯è·¨sqlSessionï¼Œæ˜¯mapperçº§åˆ«çš„ç¼“å­˜ï¼Œå¯¹äºmapperçº§åˆ«çš„ç¼“å­˜ä¸åŒçš„sqlsessionæ˜¯å¯ä»¥å…±äº«çš„ã€‚ Mybatisä¸€çº§ç¼“å­˜Mybatisçš„ä¸€çº§ç¼“å­˜åŸç†ï¼š ç¬¬ä¸€æ¬¡å‘å‡ºä¸€ä¸ªæŸ¥è¯¢sqlï¼ŒsqlæŸ¥è¯¢ç»“æœå†™å…¥sqlsessionçš„ä¸€çº§ç¼“å­˜ä¸­ï¼Œç¼“å­˜ä½¿ç”¨çš„æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªmap&lt;key,value&gt; keyï¼šhashcode + sql + sqlè¾“å…¥å‚æ•° + è¾“å‡ºå‚æ•°ï¼ˆsqlçš„å”¯ä¸€æ ‡è¯†ï¼‰ valueï¼šç”¨æˆ·ä¿¡æ¯ åŒä¸€ä¸ªsqlsessionå†æ¬¡å‘å‡ºç›¸åŒçš„sqlï¼Œå°±ä»ç¼“å­˜ä¸­å–ä¸èµ°æ•°æ®åº“ã€‚å¦‚æœä¸¤æ¬¡ä¸­é—´å‡ºç°commitæ“ä½œï¼ˆä¿®æ”¹ã€æ·»åŠ ã€åˆ é™¤ï¼‰ï¼Œæœ¬sqlsessionä¸­çš„ä¸€çº§ç¼“å­˜åŒºåŸŸå…¨éƒ¨æ¸…ç©ºï¼Œä¸‹æ¬¡å†å»ç¼“å­˜ä¸­æŸ¥è¯¢ä¸åˆ°æ‰€ä»¥è¦ä»æ•°æ®åº“æŸ¥è¯¢ï¼Œä»æ•°æ®åº“æŸ¥è¯¢åˆ°å†å†™å…¥ç¼“å­˜ã€‚ Mybatisä¸€çº§ç¼“å­˜å€¼å¾—æ³¨æ„çš„åœ°æ–¹ï¼š Mybatisé»˜è®¤å°±æ˜¯æ”¯æŒä¸€çº§ç¼“å­˜çš„ï¼Œå¹¶ä¸éœ€è¦æˆ‘ä»¬é…ç½®ã€‚ mybatiså’Œspringæ•´åˆåè¿›è¡Œmapperä»£ç†å¼€å‘ï¼Œä¸æ”¯æŒä¸€çº§ç¼“å­˜ï¼Œmybatiså’Œspringæ•´åˆï¼ŒspringæŒ‰ç…§mapperçš„æ¨¡æ¿å»ç”Ÿæˆmapperä»£ç†å¯¹è±¡ï¼Œæ¨¡æ¿ä¸­åœ¨æœ€åç»Ÿä¸€å…³é—­sqlsessionã€‚ MybatisäºŒçº§ç¼“å­˜äºŒçº§ç¼“å­˜åŸç†ï¼š äºŒçº§ç¼“å­˜çš„èŒƒå›´æ˜¯mapperçº§åˆ«ï¼ˆmapperåŒä¸€ä¸ªå‘½åç©ºé—´ï¼‰ï¼Œmapperä»¥å‘½åç©ºé—´ä¸ºå•ä½åˆ›å»ºç¼“å­˜æ•°æ®ç»“æ„ï¼Œç»“æ„æ˜¯map&lt;keyã€value&gt;ã€‚ äºŒçº§ç¼“å­˜é…ç½®MybatisäºŒçº§ç¼“å­˜éœ€è¦æ‰‹åŠ¨å¼€å¯ï¼Œéœ€è¦åœ¨Mybatisçš„é…ç½®æ–‡ä»¶ä¸­é…ç½®äºŒçº§ç¼“å­˜ 12345&lt;!-- å…¨å±€é…ç½®å‚æ•° --&gt;&lt;settings&gt; &lt;!-- å¼€å¯äºŒçº§ç¼“å­˜ --&gt; &lt;setting name=\"cacheEnabled\" value=\"true\"/&gt;&lt;/settings&gt; ä¸Šé¢å·²ç»è¯´äº†ï¼ŒäºŒçº§ç¼“å­˜çš„èŒƒå›´æ˜¯mapperçº§åˆ«çš„ï¼Œå› æ­¤Mapperå¦‚æœè¦ä½¿ç”¨äºŒçº§ç¼“å­˜ï¼Œè¿˜éœ€è¦åœ¨å¯¹åº”çš„æ˜ å°„æ–‡ä»¶ä¸­é…ç½®ã€‚ 123&lt;mapper namespace=\"com.rainbowhorse.test.dao.TestDataDao\"&gt;&lt;!-- åœ¨mapperä¸­å¼€å¯äºŒçº§ç¼“å­˜ --&gt;&lt;cache/&gt; æŸ¥è¯¢ç»“æœæ˜ å°„çš„pojoåºåˆ—åŒ– mybatisäºŒçº§ç¼“å­˜éœ€è¦å°†æŸ¥è¯¢ç»“æœæ˜ å°„çš„pojoå®ç° java.io.serializableæ¥å£ï¼Œå¦‚æœä¸å®ç°åˆ™æŠ›å‡ºå¼‚å¸¸ï¼š 1org.apache.ibatis.cache.CacheException: Error serializing object. Cause: java.io.NotSerializableException: com.rainbowhorse.test.po.User äºŒçº§ç¼“å­˜å¯ä»¥å°†å†…å­˜çš„æ•°æ®å†™åˆ°ç£ç›˜ï¼Œå­˜åœ¨å¯¹è±¡çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼Œæ‰€ä»¥è¦å®ç°java.io.serializableæ¥å£ã€‚ å¦‚æœç»“æœæ˜ å°„çš„pojoä¸­è¿˜åŒ…æ‹¬äº†pojoï¼Œéƒ½è¦å®ç°java.io.serializableæ¥å£ã€‚ ç¦ç”¨äºŒçº§ç¼“å­˜å¯¹äºå˜åŒ–é¢‘ç‡è¾ƒé«˜çš„sqlï¼Œéœ€è¦ç¦ç”¨äºŒçº§ç¼“å­˜ï¼š åœ¨statementä¸­è®¾ç½®useCache=falseå¯ä»¥ç¦ç”¨å½“å‰selectè¯­å¥çš„äºŒçº§ç¼“å­˜ï¼Œå³æ¯æ¬¡æŸ¥è¯¢éƒ½ä¼šå‘å‡ºsqlå»æŸ¥è¯¢ï¼Œé»˜è®¤æƒ…å†µæ˜¯trueï¼Œå³è¯¥sqlä½¿ç”¨äºŒçº§ç¼“å­˜ã€‚ 1&lt;select id=\"findOrderListResultMap\" resultMap=\"ordersUserMap\" useCache=\"false\"&gt; åˆ·æ–°ç¼“å­˜æˆ‘ä»¬çš„ç¼“å­˜éƒ½æ˜¯åœ¨æŸ¥è¯¢è¯­å¥ä¸­é…ç½®ï¼Œè€Œä½¿ç”¨å¢åˆ æ”¹çš„æ—¶å€™ï¼Œç¼“å­˜é»˜è®¤å°±ä¼šè¢«æ¸…ç©ºã€åˆ·æ–°äº†ã€‘ã€‚ç¼“å­˜å…¶å®å°±æ˜¯ä¸ºæˆ‘ä»¬çš„æŸ¥è¯¢æœåŠ¡çš„ï¼Œå¯¹äºå¢åˆ æ”¹è€Œè¨€ï¼Œå¦‚æœæˆ‘ä»¬çš„ç¼“å­˜ä¿å­˜äº†å¢åˆ æ”¹åçš„æ•°æ®ï¼Œé‚£ä¹ˆå†æ¬¡è¯»å–æ—¶å°±ä¼šè¯»åˆ°è„æ•°æ®äº†ï¼ æˆ‘ä»¬åœ¨ç‰¹å®šçš„æƒ…å†µä¸‹ï¼Œè¿˜å¯ä»¥å•ç‹¬é…ç½®åˆ·æ–°ç¼“å­˜ã€ä½†ä¸å»ºè®®ä½¿ç”¨ã€‘flushCacheï¼Œé»˜è®¤æ˜¯çš„trueã€‚ 123&lt;update id=\"updateUser\" parameterType=\"cn.itcast.mybatis.po.User\" flushCache=\"false\"&gt; update user set username=#&#123;username&#125;,birthday=#&#123;birthday&#125;,sex=#&#123;sex&#125;,address=#&#123;address&#125; where id=#&#123;id&#125; &lt;/update&gt; ç¼“å­˜å‚æ•°mybatisçš„cacheå‚æ•°åªé€‚ç”¨äºmybatisç»´æŠ¤ç¼“å­˜ã€‚ flushIntervalï¼ˆåˆ·æ–°é—´éš”ï¼‰å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„çš„æ­£æ•´æ•°ï¼Œè€Œä¸”å®ƒä»¬ä»£è¡¨ä¸€ä¸ªåˆç†çš„æ¯«ç§’å½¢å¼çš„æ—¶é—´æ®µã€‚é»˜è®¤æƒ…å†µæ˜¯ä¸è®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ²¡æœ‰åˆ·æ–°é—´éš”ï¼Œç¼“å­˜ä»…ä»…è°ƒç”¨è¯­å¥æ—¶åˆ·æ–°ã€‚sizeï¼ˆå¼•ç”¨æ•°ç›®ï¼‰å¯ä»¥è¢«è®¾ç½®ä¸ºä»»æ„æ­£æ•´æ•°ï¼Œè¦è®°ä½ä½ ç¼“å­˜çš„å¯¹è±¡æ•°ç›®å’Œä½ è¿è¡Œç¯å¢ƒçš„å¯ç”¨å†…å­˜èµ„æºæ•°ç›®ã€‚é»˜è®¤å€¼æ˜¯1024ã€‚readOnlyï¼ˆåªè¯»ï¼‰å±æ€§å¯ä»¥è¢«è®¾ç½®ä¸ºtrueæˆ–falseã€‚åªè¯»çš„ç¼“å­˜ä¼šç»™æ‰€æœ‰è°ƒç”¨è€…è¿”å›ç¼“å­˜å¯¹è±¡çš„ç›¸åŒå®ä¾‹ã€‚å› æ­¤è¿™äº›å¯¹è±¡ä¸èƒ½è¢«ä¿®æ”¹ã€‚è¿™æä¾›äº†å¾ˆé‡è¦çš„æ€§èƒ½ä¼˜åŠ¿ã€‚å¯è¯»å†™çš„ç¼“å­˜ä¼šè¿”å›ç¼“å­˜å¯¹è±¡çš„æ‹·è´ï¼ˆé€šè¿‡åºåˆ—åŒ–ï¼‰ã€‚è¿™ä¼šæ…¢ä¸€äº›ï¼Œä½†æ˜¯å®‰å…¨ï¼Œå› æ­¤é»˜è®¤æ˜¯falseã€‚ å¦‚ä¸‹ä¾‹å­ï¼š&lt;cache eviction=&quot;FIFO&quot; flushInterval=&quot;60000&quot; size=&quot;512&quot; readOnly=&quot;true&quot;/&gt;è¿™ä¸ªæ›´é«˜çº§çš„é…ç½®åˆ›å»ºäº†ä¸€ä¸ª FIFO ç¼“å­˜,å¹¶æ¯éš” 60 ç§’åˆ·æ–°,å­˜æ•°ç»“æœå¯¹è±¡æˆ–åˆ—è¡¨çš„ 512 ä¸ªå¼•ç”¨,è€Œä¸”è¿”å›çš„å¯¹è±¡è¢«è®¤ä¸ºæ˜¯åªè¯»çš„,å› æ­¤åœ¨ä¸åŒçº¿ç¨‹ä¸­çš„è°ƒç”¨è€…ä¹‹é—´ä¿®æ”¹å®ƒä»¬ä¼šå¯¼è‡´å†²çªã€‚å¯ç”¨çš„æ”¶å›ç­–ç•¥æœ‰, é»˜è®¤çš„æ˜¯ LRU: LRU â€“ æœ€è¿‘æœ€å°‘ä½¿ç”¨çš„:ç§»é™¤æœ€é•¿æ—¶é—´ä¸è¢«ä½¿ç”¨çš„å¯¹è±¡ã€‚ FIFO â€“ å…ˆè¿›å…ˆå‡º:æŒ‰å¯¹è±¡è¿›å…¥ç¼“å­˜çš„é¡ºåºæ¥ç§»é™¤å®ƒä»¬ã€‚ SOFT â€“ è½¯å¼•ç”¨:ç§»é™¤åŸºäºåƒåœ¾å›æ”¶å™¨çŠ¶æ€å’Œè½¯å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ã€‚ WEAK â€“ å¼±å¼•ç”¨:æ›´ç§¯æåœ°ç§»é™¤åŸºäºåƒåœ¾æ”¶é›†å™¨çŠ¶æ€å’Œå¼±å¼•ç”¨è§„åˆ™çš„å¯¹è±¡ã€‚ Mybatiså’ŒEhcacheæ•´åˆEhcacheæ˜¯ä¸“é—¨ç”¨äºç®¡ç†ç¼“å­˜çš„ï¼ŒMybatisçš„ç¼“å­˜äº¤ç”±ehcacheç®¡ç†ä¼šæ›´åŠ å¾—å½“ã€‚åœ¨mybatisä¸­æä¾›ä¸€ä¸ªcacheæ¥å£ï¼Œåªè¦å®ç°cacheæ¥å£å°±å¯ä»¥æŠŠç¼“å­˜æ•°æ®çµæ´»çš„ç®¡ç†èµ·æ¥ã€‚ æ•´åˆjaråŒ… mybatis-ehcache-1.0.2.jar ehcache-core-2.6.5.jar Ehcacheå¯¹cacheæ¥å£çš„å®ç°ç±»ï¼š ehcache.xmlé…ç½®ä¿¡æ¯è¿™ä¸ªxmlé…ç½®æ–‡ä»¶æ˜¯é…ç½®å…¨å±€çš„ç¼“å­˜ç®¡ç†æ–¹æ¡ˆ 12345678910111213141516&lt;ehcache xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xsi:noNamespaceSchemaLocation=\"../config/ehcache.xsd\"&gt; &lt;!--diskStoreï¼šç¼“å­˜æ•°æ®æŒä¹…åŒ–çš„ç›®å½• åœ°å€ --&gt; &lt;diskStore path=\"F:\\develop\\ehcache\" /&gt; &lt;defaultCache maxElementsInMemory=\"1000\" maxElementsOnDisk=\"10000000\" eternal=\"false\" overflowToDisk=\"false\" diskPersistent=\"true\" timeToIdleSeconds=\"120\" timeToLiveSeconds=\"120\" diskExpiryThreadIntervalSeconds=\"120\" memoryStoreEvictionPolicy=\"LRU\"&gt; &lt;/defaultCache&gt;&lt;/ehcache&gt; å¦‚æœæˆ‘ä»¬Mapperæƒ³å•ç‹¬æ‹¥æœ‰ä¸€äº›ç‰¹æ€§ï¼Œéœ€è¦åœ¨mapper.xmlä¸­å•ç‹¬é…ç½® 12345678910&lt;!-- å•ä½ï¼šæ¯«ç§’ --&gt;&lt;cache type=\"org.mybatis.caches.ehcache.EhcacheCache\"&gt; &lt;property name=\"timeToIdleSeconds\" value=\"12000\"/&gt; &lt;property name=\"timeToLiveSeconds\" value=\"3600\"/&gt; &lt;!-- åŒehcacheå‚æ•°maxElementsInMemory --&gt; &lt;property name=\"maxEntriesLocalHeap\" value=\"1000\"/&gt; &lt;!-- åŒehcacheå‚æ•°maxElementsOnDisk --&gt; &lt;property name=\"maxEntriesLocalDisk\" value=\"10000000\"/&gt; &lt;property name=\"memoryStoreEvictionPolicy\" value=\"LRU\"/&gt;&lt;/cache&gt; åº”ç”¨åœºæ™¯ä¸å±€é™æ€§åº”ç”¨åœºæ™¯ å¯¹æŸ¥è¯¢é¢‘ç‡é«˜ï¼Œå˜åŒ–é¢‘ç‡ä½çš„æ•°æ®å»ºè®®ä½¿ç”¨äºŒçº§ç¼“å­˜ã€‚ å¯¹äºè®¿é—®å¤šçš„æŸ¥è¯¢è¯·æ±‚ä¸”ç”¨æˆ·å¯¹æŸ¥è¯¢ç»“æœå®æ—¶æ€§è¦æ±‚ä¸é«˜ï¼Œæ­¤æ—¶å¯é‡‡ç”¨mybatisäºŒçº§ç¼“å­˜æŠ€æœ¯é™ä½æ•°æ®åº“è®¿é—®é‡ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ ä¸šåŠ¡åœºæ™¯æ¯”å¦‚ï¼š è€—æ—¶è¾ƒé«˜çš„ç»Ÿè®¡åˆ†æsql ç”µè¯è´¦å•æŸ¥è¯¢sqlç­‰ã€‚ å®ç°æ–¹æ³•å¦‚ä¸‹ï¼šé€šè¿‡è®¾ç½®åˆ·æ–°é—´éš”æ—¶é—´ï¼Œç”±mybatisæ¯éš”ä¸€æ®µæ—¶é—´è‡ªåŠ¨æ¸…ç©ºç¼“å­˜ï¼Œæ ¹æ®æ•°æ®å˜åŒ–é¢‘ç‡è®¾ç½®ç¼“å­˜åˆ·æ–°é—´éš”flushIntervalï¼Œæ¯”å¦‚è®¾ç½®ä¸º30åˆ†é’Ÿã€60åˆ†é’Ÿã€24å°æ—¶ç­‰ï¼Œæ ¹æ®éœ€æ±‚è€Œå®šã€‚ å±€é™æ€§mybatisäºŒçº§ç¼“å­˜å¯¹ç»†ç²’åº¦çš„æ•°æ®çº§åˆ«çš„ç¼“å­˜å®ç°ä¸å¥½ï¼Œæ¯”å¦‚å¦‚ä¸‹éœ€æ±‚ï¼šå¯¹å•†å“ä¿¡æ¯è¿›è¡Œç¼“å­˜ï¼Œç”±äºå•†å“ä¿¡æ¯æŸ¥è¯¢è®¿é—®é‡å¤§ï¼Œä½†æ˜¯è¦æ±‚ç”¨æˆ·æ¯æ¬¡éƒ½èƒ½æŸ¥è¯¢æœ€æ–°çš„å•†å“ä¿¡æ¯ï¼Œæ­¤æ—¶å¦‚æœä½¿ç”¨mybatisçš„äºŒçº§ç¼“å­˜å°±æ— æ³•å®ç°å½“ä¸€ä¸ªå•†å“å˜åŒ–æ—¶åªåˆ·æ–°è¯¥å•†å“çš„ç¼“å­˜ä¿¡æ¯è€Œä¸åˆ·æ–°å…¶å®ƒå•†å“çš„ä¿¡æ¯ï¼Œå› ä¸ºmybaitsçš„äºŒçº§ç¼“å­˜åŒºåŸŸä»¥mapperä¸ºå•ä½åˆ’åˆ†ï¼Œå½“ä¸€ä¸ªå•†å“ä¿¡æ¯å˜åŒ–ä¼šå°†æ‰€æœ‰å•†å“ä¿¡æ¯çš„ç¼“å­˜æ•°æ®å…¨éƒ¨æ¸…ç©ºã€‚è§£å†³æ­¤ç±»é—®é¢˜éœ€è¦åœ¨ä¸šåŠ¡å±‚æ ¹æ®éœ€æ±‚å¯¹æ•°æ®æœ‰é’ˆå¯¹æ€§ç¼“å­˜ã€‚ æ€»ç»“ Mybatisçš„ä¸€çº§ç¼“å­˜æ˜¯SqlSessionçº§åˆ«çš„ã€‚åªèƒ½è®¿é—®è‡ªå·±çš„sqlSessionå†…çš„ç¼“å­˜ã€‚å¦‚æœMybatisä¸Springæ•´åˆäº†ï¼ŒSpringä¼šè‡ªåŠ¨å…³é—­sqlSessionçš„ã€‚æ‰€ä»¥ä¸€çº§ç¼“å­˜ä¼šå¤±æ•ˆã€‚ ä¸€çº§ç¼“å­˜çš„åŸç†æ˜¯mapé›†åˆï¼ŒMybatisé»˜è®¤å°±æ”¯æŒä¸€çº§ç¼“å­˜ã€‚ äºŒçº§ç¼“å­˜æ˜¯Mapperçº§åˆ«çš„ã€‚åªè¦åœ¨Mapper namespaceä¸‹éƒ½å¯ä»¥ä½¿ç”¨äºŒçº§ç¼“å­˜ã€‚éœ€è¦è‡ªå·±æ‰‹åŠ¨å»é…ç½®äºŒçº§ç¼“å­˜ã€‚ Mybatisçš„ç¼“å­˜æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Ehcacheæ¡†æ¶æ¥è¿›è¡Œç®¡ç†ï¼ŒEhcacheå®ç°Cacheæ¥å£å°±ä»£è¡¨ä½¿ç”¨Ehcacheæ¥ç¯å¢ƒMybatisç¼“å­˜ã€‚ å‚è€ƒMybatisã€é€†å‘å·¥ç¨‹ï¼Œç¼“å­˜ï¼Œä»£ç†ã€‘çŸ¥è¯†è¦ç‚¹","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"mybatis","slug":"mybatis","permalink":"https://sunny0715.github.io/tags/mybatis/"}]},{"title":"çº¿ç¨‹æ± ä¹‹ThreadPoolExecutor","slug":"çº¿ç¨‹æ± ä¹‹ThreadPoolExecutor","date":"2018-03-17T06:09:10.000Z","updated":"2018-03-20T01:58:33.008Z","comments":true,"path":"2018/03/17/çº¿ç¨‹æ± ä¹‹ThreadPoolExecutor/","link":"","permalink":"https://sunny0715.github.io/2018/03/17/çº¿ç¨‹æ± ä¹‹ThreadPoolExecutor/","excerpt":"å¼•è¨€JAVAå¯¹äºå¤šçº¿ç¨‹çš„å°è£…éå¸¸ä¸°å¯Œï¼Œæä¾›äº†å¤šç§é€‚ç”¨äºä¸åŒåœºæ™¯çš„å¤šå¹¶å‘å®ç°ã€‚ä½†å¦‚æœå¹¶å‘çš„çº¿ç¨‹æ•°é‡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ—¶é—´å¾ˆçŸ­çš„ä»»åŠ¡å°±ç»“æŸäº†ï¼Œè¿™æ ·é¢‘ç¹åˆ›å»ºçº¿ç¨‹å°±ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ï¼Œå› ä¸ºé¢‘ç¹åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹éœ€è¦æ—¶é—´ã€‚è¿™é‡Œå°±å¼•å…¥äº†çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œå…¶ä¸­æœ€åŸºç¡€ã€æœ€æ ¸å¿ƒçš„çº¿ç¨‹æ± è¦å±ThreadPoolExecutorç±»äº†ã€‚","text":"å¼•è¨€JAVAå¯¹äºå¤šçº¿ç¨‹çš„å°è£…éå¸¸ä¸°å¯Œï¼Œæä¾›äº†å¤šç§é€‚ç”¨äºä¸åŒåœºæ™¯çš„å¤šå¹¶å‘å®ç°ã€‚ä½†å¦‚æœå¹¶å‘çš„çº¿ç¨‹æ•°é‡å¾ˆå¤šï¼Œå¹¶ä¸”æ¯ä¸ªçº¿ç¨‹éƒ½æ˜¯æ‰§è¡Œä¸€ä¸ªæ—¶é—´å¾ˆçŸ­çš„ä»»åŠ¡å°±ç»“æŸäº†ï¼Œè¿™æ ·é¢‘ç¹åˆ›å»ºçº¿ç¨‹å°±ä¼šå¤§å¤§é™ä½ç³»ç»Ÿçš„æ•ˆç‡ï¼Œå› ä¸ºé¢‘ç¹åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹éœ€è¦æ—¶é—´ã€‚è¿™é‡Œå°±å¼•å…¥äº†çº¿ç¨‹æ± æ¥ç®¡ç†çº¿ç¨‹ï¼Œå…¶ä¸­æœ€åŸºç¡€ã€æœ€æ ¸å¿ƒçš„çº¿ç¨‹æ± è¦å±ThreadPoolExecutorç±»äº†ã€‚ Javaä¸­çš„ThreadPoolExecutorç±»java.uitl.concurrent.ThreadPoolExecutorç±»æ˜¯çº¿ç¨‹æ± ä¸­æœ€æ ¸å¿ƒçš„ä¸€ä¸ªç±»ï¼Œå› æ­¤å¦‚æœè¦é€å½»åœ°äº†è§£Javaä¸­çš„çº¿ç¨‹æ± ï¼Œå¿…é¡»å…ˆäº†è§£è¿™ä¸ªç±»ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ThreadPoolExecutorç±»çš„å…·ä½“å®ç°æºç ã€‚ åœ¨ThreadPoolExecutorç±»ä¸­æä¾›äº†å››ä¸ªæ„é€ æ–¹æ³•ï¼š 123456789101112131415161718192021public class ThreadPoolExecutor extends AbstractExecutorService &#123; ..... public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue); public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue,ThreadFactory threadFactory); public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue,RejectedExecutionHandler handler); public ThreadPoolExecutor(int corePoolSize,int maximumPoolSize,long keepAliveTime,TimeUnit unit, BlockingQueue&lt;Runnable&gt; workQueue,ThreadFactory threadFactory,RejectedExecutionHandler handler); ...&#125;//corePoolSizeï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å°‘æ•°é‡ //maximumPoolSizeï¼šçº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹çš„æœ€å¤§æ•°é‡ //keepAliveTimeï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´ //unitï¼š çº¿ç¨‹æ± ç»´æŠ¤çº¿ç¨‹æ‰€å…è®¸çš„ç©ºé—²æ—¶é—´çš„å•ä½ //workQueueï¼š çº¿ç¨‹æ± æ‰€ä½¿ç”¨çš„ç¼“å†²é˜Ÿåˆ— //handlerï¼š çº¿ç¨‹æ± å¯¹æ‹’ç»ä»»åŠ¡çš„å¤„ç†ç­–ç•¥ ä»ä¸Šé¢çš„ä»£ç å¯ä»¥å¾—çŸ¥ï¼ŒThreadPoolExecutorç»§æ‰¿äº†AbstractExecutorServiceç±»ï¼Œå¹¶æä¾›äº†å››ä¸ªæ„é€ å™¨ï¼Œäº‹å®ä¸Šï¼Œé€šè¿‡è§‚å¯Ÿæ¯ä¸ªæ„é€ å™¨çš„æºç å…·ä½“å®ç°ï¼Œå‘ç°å‰é¢ä¸‰ä¸ªæ„é€ å™¨éƒ½æ˜¯è°ƒç”¨çš„ç¬¬å››ä¸ªæ„é€ å™¨è¿›è¡Œçš„åˆå§‹åŒ–å·¥ä½œã€‚ corePoolSizeï¼šæ ¸å¿ƒæ± çš„å¤§å°ã€‚åœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­å¹¶æ²¡æœ‰ä»»ä½•çº¿ç¨‹ï¼Œè€Œæ˜¯ç­‰å¾…æœ‰ä»»åŠ¡åˆ°æ¥æ‰åˆ›å»ºçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œé™¤éè°ƒç”¨äº†prestartAllCoreThreads()æˆ–è€…prestartCoreThread()æ–¹æ³•ï¼Œä»è¿™2ä¸ªæ–¹æ³•çš„åå­—å°±å¯ä»¥çœ‹å‡ºï¼Œæ˜¯é¢„åˆ›å»ºçº¿ç¨‹çš„æ„æ€ï¼Œå³åœ¨æ²¡æœ‰ä»»åŠ¡åˆ°æ¥ä¹‹å‰å°±åˆ›å»ºcorePoolSizeä¸ªçº¿ç¨‹æˆ–è€…ä¸€ä¸ªçº¿ç¨‹ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨åˆ›å»ºäº†çº¿ç¨‹æ± åï¼Œçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼Œå½“æœ‰ä»»åŠ¡æ¥ä¹‹åï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡ï¼Œå½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°corePoolSizeåï¼Œå°±ä¼šæŠŠåˆ°è¾¾çš„ä»»åŠ¡æ”¾åˆ°ç¼“å­˜é˜Ÿåˆ—å½“ä¸­ï¼› maximumPoolSizeï¼šçº¿ç¨‹æ± æœ€å¤§çº¿ç¨‹æ•°ï¼Œå®ƒè¡¨ç¤ºåœ¨çº¿ç¨‹æ± ä¸­æœ€å¤šèƒ½åˆ›å»ºå¤šå°‘ä¸ªçº¿ç¨‹ï¼› keepAliveTimeï¼šè¡¨ç¤ºçº¿ç¨‹æ²¡æœ‰ä»»åŠ¡æ‰§è¡Œæ—¶æœ€å¤šä¿æŒå¤šä¹…æ—¶é—´ä¼šç»ˆæ­¢ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œåªæœ‰å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶ï¼ŒkeepAliveTimeæ‰ä¼šèµ·ä½œç”¨ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸å¤§äºcorePoolSizeï¼Œå³å½“çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°å¤§äºcorePoolSizeæ—¶ï¼Œå¦‚æœä¸€ä¸ªçº¿ç¨‹ç©ºé—²çš„æ—¶é—´è¾¾åˆ°keepAliveTimeï¼Œåˆ™ä¼šç»ˆæ­¢ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸è¶…è¿‡corePoolSizeã€‚ä½†æ˜¯å¦‚æœè°ƒç”¨äº†allowCoreThreadTimeOut(boolean)æ–¹æ³•ï¼Œåœ¨çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸å¤§äºcorePoolSizeæ—¶ï¼ŒkeepAliveTimeå‚æ•°ä¹Ÿä¼šèµ·ä½œç”¨ï¼Œç›´åˆ°çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ä¸º0ï¼› unitï¼šå‚æ•°keepAliveTimeçš„æ—¶é—´å•ä½ï¼Œæœ‰7ç§å–å€¼ï¼Œåœ¨TimeUnitç±»ä¸­æœ‰7ç§é™æ€å±æ€§ï¼š 1234567TimeUnit.DAYS; //å¤©TimeUnit.HOURS; //å°æ—¶TimeUnit.MINUTES; //åˆ†é’ŸTimeUnit.SECONDS; //ç§’TimeUnit.MILLISECONDS; //æ¯«ç§’TimeUnit.MICROSECONDS; //å¾®å¦™TimeUnit.NANOSECONDS; //çº³ç§’ workQueueï¼šä¸€ä¸ªé˜»å¡é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜å‚¨ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ï¼Œè¿™ä¸ªå‚æ•°çš„é€‰æ‹©ä¹Ÿå¾ˆé‡è¦ï¼Œä¼šå¯¹çº¿ç¨‹æ± çš„è¿è¡Œè¿‡ç¨‹äº§ç”Ÿé‡å¤§å½±å“ï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™é‡Œçš„é˜»å¡é˜Ÿåˆ—æœ‰ä»¥ä¸‹å‡ ç§é€‰æ‹©ï¼š 123ArrayBlockingQueue;LinkedBlockingQueue;SynchronousQueue; ArrayBlockingQueueå’ŒPriorityBlockingQueueä½¿ç”¨è¾ƒå°‘ï¼Œä¸€èˆ¬ä½¿ç”¨LinkedBlockingQueueå’ŒSynchronousã€‚çº¿ç¨‹æ± çš„æ’é˜Ÿç­–ç•¥ä¸BlockingQueueæœ‰å…³ã€‚ threadFactoryï¼šçº¿ç¨‹å·¥å‚ï¼Œä¸»è¦ç”¨æ¥åˆ›å»ºçº¿ç¨‹ï¼› handlerï¼šè¡¨ç¤ºå½“æ‹’ç»å¤„ç†ä»»åŠ¡æ—¶çš„ç­–ç•¥ï¼Œæœ‰ä»¥ä¸‹å››ç§å–å€¼ï¼š 1234ThreadPoolExecutor.AbortPolicy:ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardPolicyï¼šä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ ThreadPoolExecutor.DiscardOldestPolicyï¼šä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ThreadPoolExecutor.CallerRunsPolicyï¼šç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ ç”±å›¾ä¸­æˆ‘ä»¬å¯å¾—çŸ¥ThreadPoolExecutorç»§æ‰¿äº†AbstractExecutorServiceï¼ŒAbstractExecutorServiceæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒå®ç°äº†ExecutorServiceæ¥å£ï¼Œè€ŒExecutorServiceåˆæ˜¯ç»§æ‰¿äº†Executoræ¥å£ã€‚ çº¿ç¨‹æ± å®ç°åŸç†çº¿ç¨‹æ± çŠ¶æ€åœ¨ThreadPoolExecutorä¸­å®šä¹‰äº†å‡ ä¸ªstatic finalå˜é‡è¡¨ç¤ºçº¿ç¨‹æ± çš„å„ä¸ªçŠ¶æ€ï¼š 1234567891011121314151617181920private final AtomicInteger ctl = new AtomicInteger(ctlOf(RUNNING, 0));private static final int COUNT_BITS = Integer.SIZE - 3;private static final int CAPACITY = (1 &lt;&lt; COUNT_BITS) - 1; * RUNNING -&gt; SHUTDOWN * On invocation of shutdown(), perhaps implicitly in finalize() * (RUNNING or SHUTDOWN) -&gt; STOP * On invocation of shutdownNow() * SHUTDOWN -&gt; TIDYING * When both queue and pool are empty * STOP -&gt; TIDYING * When pool is empty * TIDYING -&gt; TERMINATED * When the terminated() hook method has completed **/private static final int RUNNING = -1 &lt;&lt; COUNT_BITS;private static final int SHUTDOWN = 0 &lt;&lt; COUNT_BITS;private static final int STOP = 1 &lt;&lt; COUNT_BITS;private static final int TIDYING = 2 &lt;&lt; COUNT_BITS;private static final int TERMINATED = 3 &lt;&lt; COUNT_BITS; ä¸‹é¢çš„å‡ ä¸ªstatic finalå˜é‡è¡¨ç¤ºrunStateå¯èƒ½çš„å‡ ä¸ªå–å€¼ã€‚ RUNNINGï¼šå…è®¸æ¥æ”¶æ–°ä»»åŠ¡å¹¶ä¸”å¤„ç†é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚ SHUTDOWNï¼šä¸å†æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œä»…æ¶ˆåŒ–å®Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ã€‚ STOPï¼šä¸ä»…ä¸å†æ¥æ”¶æ–°çš„ä»»åŠ¡ï¼Œè¿é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½ä¸å†æ¶ˆåŒ–å¤„ç†äº†ï¼Œå¹¶ä¸”å°è¯•ä¸­æ–­æ­£åœ¨æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹ã€‚ TIDYINGï¼šæ‰€æœ‰ä»»åŠ¡è¢«ç»ˆæ­¢äº†ï¼Œå·¥ä½œçº¿ç¨‹æ•°workCountä¹Ÿè¢«è®¾ä¸º0ï¼Œçº¿ç¨‹çš„çŠ¶æ€ä¹Ÿè¢«è®¾ä¸ºTIDYINGï¼Œå¹¶å¼€å§‹è°ƒç”¨é’©å­å‡½æ•°terminated()ã€‚ TERMINATEDï¼šé’©å­å‡½æ•°terminated()æ‰§è¡Œå®Œæ¯•ã€‚ ä»»åŠ¡çš„æ‰§è¡Œ123456789101112131415161718private final BlockingQueue&lt;Runnable&gt; workQueue; //ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œç”¨æ¥å­˜æ”¾ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡private final ReentrantLock mainLock = new ReentrantLock(); //çº¿ç¨‹æ± çš„ä¸»è¦çŠ¶æ€é”ï¼Œå¯¹çº¿ç¨‹æ± çŠ¶æ€ï¼ˆæ¯”å¦‚çº¿ç¨‹æ± å¤§å°/runStateç­‰ï¼‰çš„æ”¹å˜éƒ½è¦ä½¿ç”¨è¿™ä¸ªé”private final HashSet&lt;Worker&gt; workers = new HashSet&lt;Worker&gt;(); //ç”¨æ¥å­˜æ”¾å·¥ä½œé›†private volatile long keepAliveTime; //çº¿ç¨‹å­˜æ´»æ—¶é—´ private volatile boolean allowCoreThreadTimeOut; //æ˜¯å¦å…è®¸ä¸ºæ ¸å¿ƒçº¿ç¨‹è®¾ç½®å­˜æ´»æ—¶é—´private volatile int corePoolSize; //æ ¸å¿ƒæ± çš„å¤§å°ï¼ˆå³çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®å¤§äºè¿™ä¸ªå‚æ•°æ—¶ï¼Œæäº¤çš„ä»»åŠ¡ä¼šè¢«æ”¾è¿›ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼‰private volatile int maximumPoolSize; //çº¿ç¨‹æ± æœ€å¤§èƒ½å®¹å¿çš„çº¿ç¨‹æ•°private volatile int poolSize; //çº¿ç¨‹æ± ä¸­å½“å‰çš„çº¿ç¨‹æ•°private volatile RejectedExecutionHandler handler; //ä»»åŠ¡æ‹’ç»ç­–ç•¥private volatile ThreadFactory threadFactory; //çº¿ç¨‹å·¥å‚ï¼Œç”¨æ¥åˆ›å»ºçº¿ç¨‹private int largestPoolSize; //ç”¨æ¥è®°å½•çº¿ç¨‹æ± ä¸­æ›¾ç»å‡ºç°è¿‡çš„æœ€å¤§çº¿ç¨‹æ•°private long completedTaskCount; //ç”¨æ¥è®°å½•å·²ç»æ‰§è¡Œå®Œæ¯•çš„ä»»åŠ¡ä¸ªæ•° æ¯ä¸ªå˜é‡çš„ä½œç”¨éƒ½å·²ç»æ ‡æ˜å‡ºæ¥äº†ï¼Œè¿™é‡Œè¦é‡ç‚¹è§£é‡Šä¸€ä¸‹corePoolSizeã€maximumPoolSizeã€largestPoolSizeä¸‰ä¸ªå˜é‡ã€‚ å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®å°äºcorePoolSizeï¼Œåˆ™æ¯æ¥ä¸€ä¸ªä»»åŠ¡ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªçº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼› å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®&gt;=corePoolSizeï¼Œåˆ™æ¯æ¥ä¸€ä¸ªä»»åŠ¡ï¼Œä¼šå°è¯•å°†å…¶æ·»åŠ åˆ°ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å½“ä¸­ï¼Œè‹¥æ·»åŠ æˆåŠŸï¼Œåˆ™è¯¥ä»»åŠ¡ä¼šç­‰å¾…ç©ºé—²çº¿ç¨‹å°†å…¶å–å‡ºå»æ‰§è¡Œï¼›è‹¥æ·»åŠ å¤±è´¥ï¼ˆä¸€èˆ¬æ¥è¯´æ˜¯ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡ï¼‰ï¼Œåˆ™ä¼šå°è¯•åˆ›å»ºæ–°çš„çº¿ç¨‹å»æ‰§è¡Œè¿™ä¸ªä»»åŠ¡ï¼› å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°maximumPoolSizeï¼Œåˆ™ä¼šé‡‡å–ä»»åŠ¡æ‹’ç»ç­–ç•¥è¿›è¡Œå¤„ç†ï¼› å¦‚æœçº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡å¤§äº corePoolSizeæ—¶ï¼Œå¦‚æœæŸçº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeï¼Œçº¿ç¨‹å°†è¢«ç»ˆæ­¢ï¼Œç›´è‡³çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®ä¸å¤§äºcorePoolSizeï¼›å¦‚æœå…è®¸ä¸ºæ ¸å¿ƒæ± ä¸­çš„çº¿ç¨‹è®¾ç½®å­˜æ´»æ—¶é—´ï¼Œé‚£ä¹ˆæ ¸å¿ƒæ± ä¸­çš„çº¿ç¨‹ç©ºé—²æ—¶é—´è¶…è¿‡keepAliveTimeï¼Œçº¿ç¨‹ä¹Ÿä¼šè¢«ç»ˆæ­¢ã€‚ ä»»åŠ¡ç¼“å­˜åŠæ’é˜Ÿç­–ç•¥åœ¨å‰é¢æˆ‘ä»¬å¤šæ¬¡æåˆ°äº†ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œå³workQueueï¼Œå®ƒç”¨æ¥å­˜æ”¾ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡ã€‚workQueueçš„ç±»å‹ä¸ºBlockingQueue&lt;Runnable&gt;ï¼Œé€šå¸¸å¯ä»¥å–ä¸‹é¢ä¸‰ç§ç±»å‹ï¼š 1ï¼‰ArrayBlockingQueueï¼šæœ‰ç•Œé˜Ÿåˆ—ï¼Œæœ‰åŠ©äºé˜²æ­¢èµ„æºè€—å°½ï¼Œä½†æ˜¯å¯èƒ½è¾ƒéš¾è°ƒæ•´å’Œæ§åˆ¶ã€‚é˜Ÿåˆ—å¤§å°å’Œæœ€å¤§æ± å¤§å°å¯èƒ½éœ€è¦ç›¸äº’æŠ˜è¡·ï¼šä½¿ç”¨å¤§å‹é˜Ÿåˆ—å’Œå°å‹æ± å¯ä»¥æœ€å¤§é™åº¦åœ°é™ä½ CPU ä½¿ç”¨ç‡ã€æ“ä½œç³»ç»Ÿèµ„æºå’Œä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ï¼Œä½†æ˜¯å¯èƒ½å¯¼è‡´äººå·¥é™ä½ååé‡ã€‚å¦‚æœä»»åŠ¡é¢‘ç¹é˜»å¡ï¼ˆä¾‹å¦‚ï¼Œå¦‚æœå®ƒä»¬æ˜¯ I/O è¾¹ç•Œï¼‰ï¼Œåˆ™ç³»ç»Ÿå¯èƒ½ä¸ºè¶…è¿‡è®¸å¯çš„æ›´å¤šçº¿ç¨‹å®‰æ’æ—¶é—´ã€‚ä½¿ç”¨å°å‹é˜Ÿåˆ—é€šå¸¸è¦æ±‚è¾ƒå¤§çš„æ± å¤§å°ï¼ŒCPU ä½¿ç”¨ç‡è¾ƒé«˜ï¼Œä½†æ˜¯å¯èƒ½é‡åˆ°ä¸å¯æ¥å—çš„è°ƒåº¦å¼€é”€ï¼Œè¿™æ ·ä¹Ÿä¼šé™ä½ååé‡ã€‚ 2ï¼‰LinkedBlockingQueueï¼šæ— ç•Œé˜Ÿåˆ—ï¼Œå°†å¯¼è‡´åœ¨æ‰€æœ‰ corePoolSize çº¿ç¨‹éƒ½å¿™æ—¶æ–°ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­ç­‰å¾…ã€‚è¿™æ ·ï¼Œåˆ›å»ºçš„çº¿ç¨‹å°±ä¸ä¼šè¶…è¿‡ corePoolSizeã€‚ï¼ˆå› æ­¤ï¼ŒmaximumPoolSize çš„å€¼ä¹Ÿå°±æ— æ•ˆäº†ã€‚ï¼‰å½“æ¯ä¸ªä»»åŠ¡å®Œå…¨ç‹¬ç«‹äºå…¶ä»–ä»»åŠ¡ï¼Œå³ä»»åŠ¡æ‰§è¡Œäº’ä¸å½±å“æ—¶ï¼Œé€‚åˆäºä½¿ç”¨æ— ç•Œé˜Ÿåˆ—ï¼›ä¾‹å¦‚ï¼Œåœ¨ Web é¡µæœåŠ¡å™¨ä¸­ã€‚è¿™ç§æ’é˜Ÿå¯ç”¨äºå¤„ç†ç¬æ€çªå‘è¯·æ±‚ï¼Œå½“å‘½ä»¤ä»¥è¶…è¿‡é˜Ÿåˆ—æ‰€èƒ½å¤„ç†çš„å¹³å‡æ•°è¿ç»­åˆ°è¾¾æ—¶ï¼Œæ­¤ç­–ç•¥å…è®¸æ— ç•Œçº¿ç¨‹å…·æœ‰å¢é•¿çš„å¯èƒ½æ€§ã€‚ 3ï¼‰SynchronousQueueï¼šå·¥ä½œé˜Ÿåˆ—çš„é»˜è®¤é€‰é¡¹æ˜¯ SynchronousQueueï¼Œå®ƒå°†ä»»åŠ¡ç›´æ¥æäº¤ç»™çº¿ç¨‹è€Œä¸ä¿æŒå®ƒä»¬ã€‚åœ¨æ­¤ï¼Œå¦‚æœä¸å­˜åœ¨å¯ç”¨äºç«‹å³è¿è¡Œä»»åŠ¡çš„çº¿ç¨‹ï¼Œåˆ™è¯•å›¾æŠŠä»»åŠ¡åŠ å…¥é˜Ÿåˆ—å°†å¤±è´¥ï¼Œå› æ­¤ä¼šæ„é€ ä¸€ä¸ªæ–°çš„çº¿ç¨‹ã€‚æ­¤ç­–ç•¥å¯ä»¥é¿å…åœ¨å¤„ç†å¯èƒ½å…·æœ‰å†…éƒ¨ä¾èµ–æ€§çš„è¯·æ±‚é›†æ—¶å‡ºç°é”ã€‚ç›´æ¥æäº¤é€šå¸¸è¦æ±‚æ— ç•Œ maximumPoolSizes ä»¥é¿å…æ‹’ç»æ–°æäº¤çš„ä»»åŠ¡ã€‚å½“å‘½ä»¤ä»¥è¶…è¿‡é˜Ÿåˆ—æ‰€èƒ½å¤„ç†çš„å¹³å‡æ•°è¿ç»­åˆ°è¾¾æ—¶ï¼Œæ­¤ç­–ç•¥å…è®¸æ— ç•Œçº¿ç¨‹å…·æœ‰å¢é•¿çš„å¯èƒ½æ€§ã€‚ ä»»åŠ¡æ‹’ç»ç­–ç•¥å½“çº¿ç¨‹æ± çš„ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—å·²æ»¡å¹¶ä¸”çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°ç›®è¾¾åˆ°maximumPoolSizeï¼Œå¦‚æœè¿˜æœ‰ä»»åŠ¡åˆ°æ¥å°±ä¼šé‡‡å–ä»»åŠ¡æ‹’ç»ç­–ç•¥ï¼Œé€šå¸¸æœ‰ä»¥ä¸‹å››ç§ç­–ç•¥ï¼š 1234ThreadPoolExecutor.AbortPolicy: ä¸¢å¼ƒä»»åŠ¡å¹¶æŠ›å‡ºRejectedExecutionExceptionå¼‚å¸¸ã€‚ThreadPoolExecutor.DiscardPolicyï¼š ä¹Ÿæ˜¯ä¸¢å¼ƒä»»åŠ¡ï¼Œä½†æ˜¯ä¸æŠ›å‡ºå¼‚å¸¸ã€‚ThreadPoolExecutor.DiscardOldestPolicyï¼š ä¸¢å¼ƒé˜Ÿåˆ—æœ€å‰é¢çš„ä»»åŠ¡ï¼Œç„¶åé‡æ–°å°è¯•æ‰§è¡Œä»»åŠ¡ï¼ˆé‡å¤æ­¤è¿‡ç¨‹ï¼‰ThreadPoolExecutor.CallerRunsPolicyï¼š ç”±è°ƒç”¨çº¿ç¨‹å¤„ç†è¯¥ä»»åŠ¡ çº¿ç¨‹æ± çš„å…³é—­ThreadPoolExecutoræä¾›äº†ä¸¤ä¸ªæ–¹æ³•ï¼Œç”¨äºçº¿ç¨‹æ± çš„å…³é—­ï¼Œåˆ†åˆ«æ˜¯shutdown()å’ŒshutdownNow()ï¼š shutdown()ï¼šä¸ä¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œè€Œæ˜¯è¦ç­‰æ‰€æœ‰ä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œåæ‰ç»ˆæ­¢ï¼Œä½†å†ä¹Ÿä¸ä¼šæ¥å—æ–°çš„ä»»åŠ¡ã€‚ shutdownNow()ï¼šç«‹å³ç»ˆæ­¢çº¿ç¨‹æ± ï¼Œå¹¶å°è¯•æ‰“æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ï¼Œå¹¶ä¸”æ¸…ç©ºä»»åŠ¡ç¼“å­˜é˜Ÿåˆ—ï¼Œè¿”å›å°šæœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚ çº¿ç¨‹æ± å®¹é‡çš„åŠ¨æ€è°ƒæ•´ThreadPoolExecutoræä¾›äº†åŠ¨æ€è°ƒæ•´çº¿ç¨‹æ± å®¹é‡å¤§å°çš„æ–¹æ³•ï¼šsetCorePoolSize()å’ŒsetMaximumPoolSize()ï¼š setCorePoolSizeï¼šè®¾ç½®æ ¸å¿ƒæ± å¤§å°ã€‚ setMaximumPoolSizeï¼šè®¾ç½®çº¿ç¨‹æ± æœ€å¤§èƒ½åˆ›å»ºçš„çº¿ç¨‹æ•°ç›®å¤§å°ã€‚ ä½¿ç”¨Executorsåˆ›å»ºçº¿ç¨‹æ± Executorsæä¾›çš„å·¥å‚æ–¹æ³•ï¼Œå¯ä»¥åˆ›å»ºä»¥ä¸‹å››ç§ç±»å‹çº¿ç¨‹æ± ï¼š newFixedThreadPoolï¼šè¯¥æ–¹æ³•å°†ç”¨äºåˆ›å»ºä¸€ä¸ªå›ºå®šå¤§å°çš„çº¿ç¨‹æ± ï¼ˆæ­¤æ—¶corePoolSize = maxPoolSizeï¼‰ï¼Œæ¯æäº¤ä¸€ä¸ªä»»åŠ¡å°±åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œç›´åˆ°çº¿ç¨‹æ± è¾¾åˆ°æœ€å¤§æ•°é‡ï¼Œçº¿ç¨‹æ± çš„è§„æ¨¡åœ¨æ­¤åä¸ä¼šå‘ç”Ÿä»»ä½•å˜åŒ–ï¼› newCachedThreadPoolï¼šè¯¥æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªå¯ç¼“å­˜çš„çº¿ç¨‹æ± ï¼Œï¼ˆæ­¤æ—¶corePoolSize = 0ï¼ŒmaxPoolSize = Integer.MAX_VALUEï¼‰ï¼Œç©ºé—²çº¿ç¨‹è¶…è¿‡60ç§’å°±ä¼šè¢«è‡ªåŠ¨å›æ”¶ï¼Œè¯¥çº¿ç¨‹æ± å­˜åœ¨çš„é£é™©æ˜¯ï¼Œå¦‚æœæœåŠ¡å™¨åº”ç”¨è¾¾åˆ°è¯·æ±‚é«˜å³°æœŸæ—¶ï¼Œä¼šä¸æ–­åˆ›å»ºæ–°çš„çº¿ç¨‹ï¼Œç›´åˆ°å†…å­˜è€—å°½ï¼› newSingleThreadExecutorï¼šè¯¥æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªå•çº¿ç¨‹çš„çº¿ç¨‹æ± ï¼Œè¯¥çº¿ç¨‹æ± æŒ‰ç…§ä»»åŠ¡åœ¨é˜Ÿåˆ—ä¸­çš„é¡ºåºä¸²è¡Œæ‰§è¡Œï¼ˆå¦‚ï¼šFIFOã€LIFOã€ä¼˜å…ˆçº§ï¼‰ï¼› newScheduledThreadPoolï¼šè¯¥æ–¹æ³•åˆ›å»ºäº†ä¸€ä¸ªå›ºå®šé•¿åº¦çš„çº¿ç¨‹æ± ï¼Œå¯ä»¥ä»¥å»¶è¿Ÿæˆ–è€…å®šæ—¶çš„æ–¹å¼æ‰§è¡Œä»»åŠ¡ï¼› å®ä¾‹12345678910111213141516171819202122232425262728293031323334public class Test &#123; public static void main(String[] args) &#123; ThreadFactory factory = new ThreadFactoryBuilder().setNameFormat(\"test\").build(); ThreadPoolExecutor executor = new ThreadPoolExecutor(2, 5, 200, TimeUnit.MILLISECONDS, new LinkedBlockingQueue&lt;Runnable&gt;(5),factory,new ThreadPoolExecutor.CallerRunsPolicy()); for (int i = 1; i &lt;= 10; i++) &#123; MyTask myTask = new MyTask(i); executor.execute(myTask); System.out.println(\"çº¿ç¨‹æ± ä¸­çº¿ç¨‹æ•°ç›®ï¼š\" + executor.getPoolSize() + \"ï¼Œé˜Ÿåˆ—ä¸­ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡æ•°ç›®ï¼š\" + executor.getQueue().size() + \"ï¼Œå·²æ‰§è¡Œç©åˆ«çš„ä»»åŠ¡æ•°ç›®ï¼š\" + executor.getCompletedTaskCount()); &#125; executor.shutdown(); &#125;&#125;class MyTask implements Runnable &#123; private int taskNum; public MyTask(int num) &#123; this.taskNum = num; &#125; @Override public void run() &#123; System.out.println(\"æ­£åœ¨æ‰§è¡Œtask \" + taskNum); try &#123; Thread.currentThread().sleep(2000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; System.out.println(\"task \" + taskNum + \"æ‰§è¡Œå®Œæ¯•\"); &#125;&#125; æ‰§è¡Œç»“æœï¼š åˆç†é…ç½®çº¿ç¨‹æ± å¤§å°ä¸€èˆ¬éœ€è¦æ ¹æ®ä»»åŠ¡çš„ç±»å‹æ¥é…ç½®çº¿ç¨‹æ± å¤§å°ï¼š å¦‚æœæ˜¯CPUå¯†é›†å‹ä»»åŠ¡ï¼Œå°±éœ€è¦å°½é‡å‹æ¦¨CPUï¼Œå‚è€ƒå€¼å¯ä»¥è®¾ä¸º NCPU+1 å¦‚æœæ˜¯IOå¯†é›†å‹ä»»åŠ¡ï¼Œå‚è€ƒå€¼å¯ä»¥è®¾ç½®ä¸º2*NCPU è¿™åªæ˜¯ä¸€ä¸ªå‚è€ƒå€¼ï¼Œå…·ä½“çš„è®¾ç½®è¿˜éœ€è¦æ ¹æ®å®é™…æƒ…å†µè¿›è¡Œè°ƒæ•´ï¼Œæ¯”å¦‚å¯ä»¥å…ˆå°†çº¿ç¨‹æ± å¤§å°è®¾ç½®ä¸ºå‚è€ƒå€¼ï¼Œå†è§‚å¯Ÿä»»åŠ¡è¿è¡Œæƒ…å†µå’Œç³»ç»Ÿè´Ÿè½½ã€èµ„æºåˆ©ç”¨ç‡æ¥è¿›è¡Œé€‚å½“è°ƒæ•´ã€‚ å‚è€ƒJavaå¹¶å‘ç¼–ç¨‹ï¼šçº¿ç¨‹æ± çš„ä½¿ç”¨","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"}]},{"title":"Spring+webSocket","slug":"Spring-webSocket","date":"2018-03-16T06:00:11.000Z","updated":"2018-03-17T04:30:47.275Z","comments":true,"path":"2018/03/16/Spring-webSocket/","link":"","permalink":"https://sunny0715.github.io/2018/03/16/Spring-webSocket/","excerpt":"å¼•è¨€websocket æ˜¯ HTML5æ–°å¢åŠ ç‰¹æ€§ä¹‹ä¸€ï¼Œç›®çš„æ˜¯æµè§ˆå™¨ä¸æœåŠ¡ç«¯å»ºç«‹å…¨åŒå·¥çš„é€šä¿¡æ–¹å¼ï¼Œè§£å†³ HTTPè¯·æ±‚-å“åº”å¸¦æ¥è¿‡å¤šçš„èµ„æºæ¶ˆè€—ï¼ŒåŒæ—¶å¯¹ç‰¹æ®Šåœºæ™¯åº”ç”¨æä¾›äº†å…¨æ–°çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚èŠå¤©ã€è‚¡ç¥¨äº¤æ˜“ã€æ¸¸æˆç­‰å¯¹å¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¡Œä¸šé¢†åŸŸã€‚","text":"å¼•è¨€websocket æ˜¯ HTML5æ–°å¢åŠ ç‰¹æ€§ä¹‹ä¸€ï¼Œç›®çš„æ˜¯æµè§ˆå™¨ä¸æœåŠ¡ç«¯å»ºç«‹å…¨åŒå·¥çš„é€šä¿¡æ–¹å¼ï¼Œè§£å†³ HTTPè¯·æ±‚-å“åº”å¸¦æ¥è¿‡å¤šçš„èµ„æºæ¶ˆè€—ï¼ŒåŒæ—¶å¯¹ç‰¹æ®Šåœºæ™¯åº”ç”¨æä¾›äº†å…¨æ–°çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚èŠå¤©ã€è‚¡ç¥¨äº¤æ˜“ã€æ¸¸æˆç­‰å¯¹å¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„è¡Œä¸šé¢†åŸŸã€‚ STOMPSTOMP(Simple Text-Orientated Messaging Protocol) é¢å‘æ¶ˆæ¯çš„ç®€å•æ–‡æœ¬åè®®ã€‚ WebSocketæ˜¯ä¸€ä¸ªæ¶ˆæ¯æ¶æ„ï¼Œä¸å¼ºåˆ¶ä½¿ç”¨ä»»ä½•ç‰¹å®šçš„æ¶ˆæ¯åè®®ï¼Œå®ƒä¾èµ–äºåº”ç”¨å±‚è§£é‡Šæ¶ˆæ¯çš„å«ä¹‰ï¼› ä¸å¤„åœ¨åº”ç”¨å±‚çš„HTTPä¸åŒï¼ŒWebSocketå¤„åœ¨TCPä¸Šéå¸¸è–„çš„ä¸€å±‚ï¼Œä¼šå°†å­—èŠ‚æµè½¬æ¢ä¸ºæ–‡æœ¬/äºŒè¿›åˆ¶æ¶ˆæ¯ï¼Œå› æ­¤ï¼Œå¯¹äºå®é™…åº”ç”¨æ¥è¯´ï¼ŒWebSocketçš„é€šä¿¡å½¢å¼å±‚çº§è¿‡ä½ï¼Œå› æ­¤ï¼Œå¯ä»¥åœ¨ WebSocket ä¹‹ä¸Šä½¿ç”¨ STOMPåè®®ï¼Œæ¥ä¸ºæµè§ˆå™¨ å’Œ serveré—´çš„ é€šä¿¡å¢åŠ é€‚å½“çš„æ¶ˆæ¯è¯­ä¹‰ã€‚ å¦‚ä½•ç†è§£ STOMP ä¸ WebSocket çš„å…³ç³»ï¼š1) HTTPåè®®è§£å†³äº† web æµè§ˆå™¨å‘èµ·è¯·æ±‚ä»¥åŠ web æœåŠ¡å™¨å“åº”è¯·æ±‚çš„ç»†èŠ‚ï¼Œå‡è®¾ HTTP åè®® å¹¶ä¸å­˜åœ¨ï¼Œåªèƒ½ä½¿ç”¨ TCP å¥—æ¥å­—æ¥ ç¼–å†™ web åº”ç”¨ï¼Œä½ å¯èƒ½è®¤ä¸ºè¿™æ˜¯ä¸€ä»¶ç–¯ç‹‚çš„äº‹æƒ…ï¼›2) ç›´æ¥ä½¿ç”¨ WebSocketï¼ˆSockJSï¼‰ å°±å¾ˆç±»ä¼¼äº ä½¿ç”¨ TCP å¥—æ¥å­—æ¥ç¼–å†™ web åº”ç”¨ï¼Œå› ä¸ºæ²¡æœ‰é«˜å±‚åè®®ï¼Œå°±éœ€è¦æˆ‘ä»¬å®šä¹‰åº”ç”¨é—´æ‰€å‘é€æ¶ˆæ¯çš„è¯­ä¹‰ï¼Œè¿˜éœ€è¦ç¡®ä¿è¿æ¥çš„ä¸¤ç«¯éƒ½èƒ½éµå¾ªè¿™äº›è¯­ä¹‰ï¼›3) åŒ HTTP åœ¨ TCP å¥—æ¥å­—ä¸Šæ·»åŠ è¯·æ±‚-å“åº”æ¨¡å‹å±‚ä¸€æ ·ï¼ŒSTOMP åœ¨ WebSocket ä¹‹ä¸Šæä¾›äº†ä¸€ä¸ªåŸºäºå¸§çš„çº¿è·¯æ ¼å¼å±‚ï¼Œç”¨æ¥å®šä¹‰æ¶ˆæ¯è¯­ä¹‰ï¼› Spring+websocketæ·»åŠ ä¾èµ–éœ€è¦æ·»åŠ spring-websocketå’Œspring-messagingä¾èµ–ï¼Œæ³¨æ„å’Œspring-coreçš„ç‰ˆæœ¬ä¿æŒä¸€è‡´ã€‚ 1234567891011&lt;!-- spring-websocket --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-websocket&lt;/artifactId&gt; &lt;version&gt;4.1.9.RELEASE&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework&lt;/groupId&gt; &lt;artifactId&gt;spring-messaging&lt;/artifactId&gt; &lt;version&gt;4.1.9.RELEASE&lt;/version&gt;&lt;/dependency&gt; æœåŠ¡ç«¯ä»£ç æœåŠ¡ç«¯çš„åˆå§‹åŒ–ï¼Œåªéœ€è¦ä¸¤ä¸ªç±»ï¼šWebsocketConfigï¼ˆstompèŠ‚ç‚¹é…ç½®ï¼‰å’ŒWebSocketControllerã€‚ 12345678910111213141516171819202122232425262728import org.springframework.context.annotation.Configuration;import org.springframework.messaging.simp.config.MessageBrokerRegistry;import org.springframework.web.socket.config.annotation.AbstractWebSocketMessageBrokerConfigurer;import org.springframework.web.socket.config.annotation.EnableWebSocketMessageBroker;import org.springframework.web.socket.config.annotation.StompEndpointRegistry;/** * é€šè¿‡EnableWebSocketMessageBroker å¼€å¯ä½¿ç”¨STOMPåè®®æ¥ä¼ è¾“åŸºäºä»£ç†(message broker)çš„æ¶ˆæ¯,æ­¤æ—¶æµè§ˆå™¨æ”¯æŒä½¿ç”¨@MessageMapping å°±åƒæ”¯æŒ@RequestMappingä¸€æ ·ã€‚ */@Configuration@EnableWebSocketMessageBrokerpublic class WebSocketConfig extends AbstractWebSocketMessageBrokerConfigurer &#123; @Override public void registerStompEndpoints(StompEndpointRegistry registry) &#123; //endPoint æ³¨å†Œåè®®èŠ‚ç‚¹,å¹¶æ˜ å°„æŒ‡å®šçš„URl //æ³¨å†Œä¸€ä¸ªåå­—ä¸º\"endpointChat\" çš„endpoint,å¹¶æŒ‡å®š SockJSåè®®ï¼Œå®¢æˆ·ç«¯å°±å¯ä»¥é€šè¿‡è¿™ä¸ªç«¯ç‚¹æ¥è¿›è¡Œè¿æ¥ï¼›withSockJSä½œç”¨æ˜¯æ·»åŠ SockJSæ”¯æŒã€‚ registry.addEndpoint(\"/endpointChat\").withSockJS(); &#125; @Override public void configureMessageBroker(MessageBrokerRegistry registry) &#123; //é…ç½®æ¶ˆæ¯ä»£ç†(message broker)ï¼Œå®šä¹‰äº†ä¸¤ä¸ªå®¢æˆ·ç«¯è®¢é˜…åœ°å€çš„å‰ç¼€ä¿¡æ¯ï¼Œä¹Ÿå°±æ˜¯å®¢æˆ·ç«¯æ¥æ”¶æœåŠ¡ç«¯å‘é€æ¶ˆæ¯çš„å‰ç¼€ä¿¡æ¯ //ç‚¹å¯¹ç‚¹å¼å¢åŠ ä¸€ä¸ª/queue æ¶ˆæ¯ä»£ç† registry.enableSimpleBroker(\"/queue\", \"/topic\"); //å®šä¹‰äº†æœåŠ¡ç«¯æ¥æ”¶åœ°å€çš„å‰ç¼€ï¼Œä¹Ÿå³å®¢æˆ·ç«¯ç»™æœåŠ¡ç«¯å‘æ¶ˆæ¯çš„åœ°å€å‰ç¼€ //registry.setApplicationDestinationPrefixes(â€œ/userâ€); &#125;&#125; å¯¹ä»¥ä¸Šä»£ç åˆ†æï¼š EnableWebSocketMessageBroker æ³¨è§£è¡¨æ˜ï¼š è¿™ä¸ªé…ç½®ç±»ä¸ä»…é…ç½®äº† WebSocketï¼Œè¿˜é…ç½®äº†åŸºäºä»£ç†çš„ STOMP æ¶ˆæ¯ï¼› å®ƒå¤å†™äº† registerStompEndpoints() æ–¹æ³•ï¼šæ·»åŠ ä¸€ä¸ªæœåŠ¡ç«¯ç‚¹ï¼Œæ¥æ¥æ”¶å®¢æˆ·ç«¯çš„è¿æ¥ã€‚å°† â€œ/endpointChatâ€ è·¯å¾„æ³¨å†Œä¸º STOMP ç«¯ç‚¹ã€‚è¿™ä¸ªè·¯å¾„ä¸ä¹‹å‰å‘é€å’Œæ¥æ”¶æ¶ˆæ¯çš„ç›®çš„è·¯å¾„æœ‰æ‰€ä¸åŒï¼Œ è¿™æ˜¯ä¸€ä¸ªç«¯ç‚¹ï¼Œå®¢æˆ·ç«¯åœ¨è®¢é˜…æˆ–å‘å¸ƒæ¶ˆæ¯åˆ°ç›®çš„åœ°å€å‰ï¼Œè¦è¿æ¥è¯¥ç«¯ç‚¹ï¼Œå³ç”¨æˆ·å‘é€è¯·æ±‚ ï¼šURL=â€™/127.0.0.1:8080/endpointChatâ€™ ä¸ STOMP server è¿›è¡Œè¿æ¥ï¼Œä¹‹åå†è½¬å‘åˆ°è®¢é˜…URLï¼› å®ƒå¤å†™äº† configureMessageBroker() æ–¹æ³•ï¼šé…ç½®äº†ä¸€ä¸ª ç®€å•çš„æ¶ˆæ¯ä»£ç†ï¼Œé€šä¿—ä¸€ç‚¹è®²å°±æ˜¯è®¾ç½®æ¶ˆæ¯è¿æ¥è¯·æ±‚çš„å„ç§è§„èŒƒä¿¡æ¯ã€‚ 12345678910111213141516171819202122232425262728293031import org.springframework.messaging.handler.annotation.MessageMapping;import org.springframework.messaging.simp.SimpMessagingTemplate;import org.springframework.stereotype.Controller;import java.util.concurrent.LinkedBlockingQueue;import java.util.concurrent.ThreadPoolExecutor;import java.util.concurrent.TimeUnit;import org.springframework.beans.factory.annotation.Autowired;import com.thinkgem.jeesite.modules.sys.utils.UserUtils;@Controller@RequestMapping(\"/websocket\")public class WebsocketController &#123; @Autowired private SimpMessagingTemplate template; @MessageMapping(\"/sendMsg\") public void roomMessage() &#123; // å¤šçº¿ç¨‹é…ç½®æ¨é€æ¶ˆæ¯ ThreadPoolExecutor executor = new ThreadPoolExecutor(1, 1, 0, TimeUnit.MILLISECONDS,new LinkedBlockingQueue&lt;Runnable&gt;()); executor.execute(new Runnable() &#123; @Override public void run() &#123; template.convertAndSendToUser(userId, \"/queue/notifications\",\"æ–°æ¶ˆæ¯ï¼šè¿™æ˜¯websockedæµ‹è¯•æ¶ˆæ¯\");// ä¸€å¯¹ä¸€å‘é€ï¼Œå‘é€ç‰¹å®šçš„å®¢æˆ·ç«¯ //template.convertAndSend(\"/topic/getResponse\",\"æ–°æ¶ˆæ¯ï¼šè¿™æ˜¯websockedæµ‹è¯•æ¶ˆæ¯\");//å¹¿æ’­æ¶ˆæ¯ &#125; &#125;); executor.shutdown(); &#125;&#125; template.convertAndSendToUser(user, dest, message) è¿™ä¸ªæ–¹æ³•å®˜æ–¹ç»™å‡ºçš„è§£é‡Šæ˜¯ Convert the given Object to serialized form, possibly using a MessageConverter, wrap it as a message and send it to the given destination. æ„æ€å°±æ˜¯â€œå°†ç»™å®šçš„å¯¹è±¡è¿›è¡Œåºåˆ—åŒ–ï¼Œä½¿ç”¨ â€˜MessageConverterâ€™ è¿›è¡ŒåŒ…è£…è½¬åŒ–æˆä¸€æ¡æ¶ˆæ¯ï¼Œå‘é€åˆ°æŒ‡å®šçš„ç›®æ ‡â€ï¼Œé€šä¿—ç‚¹è®²å°±æ˜¯æˆ‘ä»¬ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿›è¡Œæ¶ˆæ¯çš„è½¬å‘å‘é€ã€‚ å®¢æˆ·ç«¯å®ç°é¦–å…ˆå¼•ç”¨ sockjs.js å’Œ stomp.js 12345678910111213141516171819202122232425262728&lt;script src=\"/js/common/sockjs.min.js\"&gt;&lt;script src=\"/js/common/stomp.min.js\"&gt;&lt;script type=\"text/javascript\"&gt; $(function() &#123; connect(); &#125;); function connect() &#123; // TOMPå®¢æˆ·ç«¯è¦æƒ³æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨æ¨é€çš„æ¶ˆæ¯ï¼Œå¿…é¡»å…ˆè®¢é˜…ç›¸åº”çš„URLï¼Œå³å‘é€ä¸€ä¸ªSUBSCRIBEå¸§ï¼Œç„¶åæ‰èƒ½ä¸æ–­æ¥æ”¶æ¥è‡ªæœåŠ¡å™¨çš„æ¨é€æ¶ˆæ¯ï¼› var sock = new SockJS(\"http://localhost:8080/endpointChat\"); var stomp = Stomp.over(sock); stomp.connect('guest', 'guest', function(frame) &#123; /**è®¢é˜…äº†/user/queue/notifications å‘é€çš„æ¶ˆæ¯,è¿™é‡Œä¸åœ¨æ§åˆ¶å™¨convertAndSendToUser å®šä¹‰çš„åœ°å€ä¿æŒä¸€è‡´ * è¿™é‡Œå¤šç”¨äº†ä¸€ä¸ª/user,å¹¶ä¸”è¿™ä¸ªuser æ˜¯å¿…é¡»çš„,ä½¿ç”¨useræ‰ä¼šå‘é€æ¶ˆæ¯åˆ°æŒ‡å®šçš„ç”¨æˆ·ã€‚ * */ stomp.subscribe(\"/user/queue/notifications\", handleNotification); stomp.subscribe('/topic/getResponse', function(response) &#123; //è®¢é˜…/topic/getResponse ç›®æ ‡å‘é€çš„æ¶ˆæ¯ã€‚è¿™ä¸ªæ˜¯åœ¨æ§åˆ¶å™¨çš„@SendToä¸­å®šä¹‰çš„ã€‚ console.info(response.body); &#125;); //å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ stomp.send(\"URL\", &#123;&#125;, JSON.stringify(message)); //è®¢é˜…æœåŠ¡å™¨å‘é€æ¥çš„æ¶ˆæ¯ function handleNotification(message) &#123; console.info(message.body); &#125; &#125;&lt;/script&gt; åˆ©ç”¨ stompçš„connect(login, passcode, connectCallback, errorCallback, vhost) æ–¹æ³•å»ºç«‹è¿æ¥ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯ä¸åŒç‰ˆæœ¬çš„ stomp.js çš„ connect() å‡½æ•°çš„å‚æ•°ä¼šæœ‰æ‰€ä¸åŒï¼› åˆ©ç”¨ stompçš„subscribe(destination, callback, headers) æ–¹æ³•å¯ä»¥è®¢é˜…æœåŠ¡å™¨å‘é€æ¥çš„æ¶ˆæ¯ï¼Œdestination è¡¨ç¤ºæœåŠ¡å™¨å‘é€æ¶ˆæ¯åœ°å€ï¼›é€šè¿‡ event çš„ body è·å–æ¶ˆæ¯å†…å®¹ï¼› åˆ©ç”¨ stompClient çš„send(destination, headers, body) æ–¹æ³•å¯ä»¥å‘æœåŠ¡ç«¯å‘é€æ¶ˆæ¯ï¼Œç¬¬ä¸€ä¸ªå‚æ•°ä¸ºå‘é€æ¶ˆæ¯åœ°å€ï¼Œæœ€åä¸€ä¸ªå‚æ•°æ˜¯å‘é€æ¶ˆæ¯çš„ json ä¸²ï¼› æµ‹è¯•åœ¨å®¢æˆ·ç«¯è¯·æ±‚/websocket/sendMsgåä¼šæœ‰å¦‚ä¸‹æ•ˆæœï¼š å‚è€ƒï¼š Spring Framework Reference Documentation websocket+spring spring websocket + stomp å®ç°å¹¿æ’­é€šä¿¡å’Œä¸€å¯¹ä¸€é€šä¿¡","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"spring","slug":"spring","permalink":"https://sunny0715.github.io/tags/spring/"}]},{"title":"è°ˆè°ˆæ•æ·å¼€å‘","slug":"è°ˆè°ˆæ•æ·å¼€å‘","date":"2018-03-15T01:34:03.000Z","updated":"2018-03-15T02:35:38.089Z","comments":true,"path":"2018/03/15/è°ˆè°ˆæ•æ·å¼€å‘/","link":"","permalink":"https://sunny0715.github.io/2018/03/15/è°ˆè°ˆæ•æ·å¼€å‘/","excerpt":"å¼•è¨€æ•æ·å¼€å‘æ˜¯ä¸€ç§ä»ä¸Šä¸ªä¸–çºªä¹åå¹´ä»£å¼€å§‹é€æ¸å¼•èµ·å¹¿æ³›å…³æ³¨çš„ä¸€äº›æ–°å‹è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œæ˜¯ä¸€ç§åº”å¯¹å¿«é€Ÿå˜åŒ–çš„éœ€æ±‚çš„ä¸€ç§è½¯ä»¶å¼€å‘èƒ½åŠ›ã€‚å¸¸è¨€é“ï¼šâ€œå¤©ä¸‹æ­¦åŠŸï¼Œå”¯å¿«ä¸ç ´â€ï¼Œæ­¤è¨€ç”¨äºå½¢å®¹â€œæ•æ·â€çš„å¨åŠ›ç›¸å½“åˆé€‚ã€‚æ•æ·æ„æ€ä¸ºå¿«ï¼Œä½†æ•æ·æ€æƒ³ä¸ä»…ä»…æ±‚å¿«ï¼Œå®ƒæ›´å¤šå¼ºè°ƒâ€œå¤šå¿«å¥½çœâ€ï¼Œäº§å‡ºå¾—å¤šï¼Œäº§å‡ºå¾—å¿«ï¼Œäº§å‡ºå¾—å¥½ï¼ŒåŒæ—¶èŠ‚çœå„ç§æˆæœ¬ï¼Œæ—¢ç»æµåˆå®ç”¨ã€‚å®ƒä»¬æ›´å¼ºè°ƒç¨‹åºå‘˜å›¢é˜Ÿä¸ä¸šåŠ¡ä¸“å®¶ä¹‹é—´çš„ç´§å¯†åä½œã€é¢å¯¹é¢çš„æ²Ÿé€šï¼ˆè®¤ä¸ºæ¯”ä¹¦é¢çš„æ–‡æ¡£æ›´æœ‰æ•ˆï¼‰ã€é¢‘ç¹äº¤ä»˜æ–°çš„è½¯ä»¶ç‰ˆæœ¬ã€ç´§å‡‘è€Œè‡ªæˆ‘ç»„ç»‡å‹çš„å›¢é˜Ÿã€èƒ½å¤Ÿå¾ˆå¥½åœ°é€‚åº”éœ€æ±‚å˜åŒ–çš„ä»£ç ç¼–å†™å’Œå›¢é˜Ÿç»„ç»‡æ–¹æ³•ï¼Œä¹Ÿæ›´æ³¨é‡è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­äººçš„ä½œç”¨ã€‚","text":"å¼•è¨€æ•æ·å¼€å‘æ˜¯ä¸€ç§ä»ä¸Šä¸ªä¸–çºªä¹åå¹´ä»£å¼€å§‹é€æ¸å¼•èµ·å¹¿æ³›å…³æ³¨çš„ä¸€äº›æ–°å‹è½¯ä»¶å¼€å‘æ–¹æ³•ï¼Œæ˜¯ä¸€ç§åº”å¯¹å¿«é€Ÿå˜åŒ–çš„éœ€æ±‚çš„ä¸€ç§è½¯ä»¶å¼€å‘èƒ½åŠ›ã€‚å¸¸è¨€é“ï¼šâ€œå¤©ä¸‹æ­¦åŠŸï¼Œå”¯å¿«ä¸ç ´â€ï¼Œæ­¤è¨€ç”¨äºå½¢å®¹â€œæ•æ·â€çš„å¨åŠ›ç›¸å½“åˆé€‚ã€‚æ•æ·æ„æ€ä¸ºå¿«ï¼Œä½†æ•æ·æ€æƒ³ä¸ä»…ä»…æ±‚å¿«ï¼Œå®ƒæ›´å¤šå¼ºè°ƒâ€œå¤šå¿«å¥½çœâ€ï¼Œäº§å‡ºå¾—å¤šï¼Œäº§å‡ºå¾—å¿«ï¼Œäº§å‡ºå¾—å¥½ï¼ŒåŒæ—¶èŠ‚çœå„ç§æˆæœ¬ï¼Œæ—¢ç»æµåˆå®ç”¨ã€‚å®ƒä»¬æ›´å¼ºè°ƒç¨‹åºå‘˜å›¢é˜Ÿä¸ä¸šåŠ¡ä¸“å®¶ä¹‹é—´çš„ç´§å¯†åä½œã€é¢å¯¹é¢çš„æ²Ÿé€šï¼ˆè®¤ä¸ºæ¯”ä¹¦é¢çš„æ–‡æ¡£æ›´æœ‰æ•ˆï¼‰ã€é¢‘ç¹äº¤ä»˜æ–°çš„è½¯ä»¶ç‰ˆæœ¬ã€ç´§å‡‘è€Œè‡ªæˆ‘ç»„ç»‡å‹çš„å›¢é˜Ÿã€èƒ½å¤Ÿå¾ˆå¥½åœ°é€‚åº”éœ€æ±‚å˜åŒ–çš„ä»£ç ç¼–å†™å’Œå›¢é˜Ÿç»„ç»‡æ–¹æ³•ï¼Œä¹Ÿæ›´æ³¨é‡è½¯ä»¶å¼€å‘è¿‡ç¨‹ä¸­äººçš„ä½œç”¨ã€‚ æ•æ·å¼€å‘å®£è¨€å’ŒåŸåˆ™æ•æ·å®£è¨€çš„ä»·å€¼è§‚ ä¸ªä½“å’Œäº’åŠ¨ é«˜äº æµç¨‹å’Œå·¥å…· å·¥ä½œçš„è½¯ä»¶ é«˜äº è¯¦å°½çš„æ–‡æ¡£ å®¢æˆ·åˆä½œ é«˜äº åˆåŒè°ˆåˆ¤ å“åº”å˜åŒ– é«˜äº éµå¾ªè®¡åˆ’ ä¹Ÿå°±æ˜¯è¯´ï¼Œå°½ç®¡å³é¡¹æœ‰å…¶ä»·å€¼ï¼Œæˆ‘ä»¬æ›´é‡è§†å·¦é¡¹çš„ä»·å€¼ã€‚ æ•æ·å®£è¨€çš„åŸåˆ™ æˆ‘ä»¬æœ€é‡è¦çš„ç›®æ ‡ï¼Œæ˜¯é€šè¿‡æŒç»­ä¸æ–­åœ°åŠæ—©äº¤ä»˜æœ‰ä»·å€¼çš„è½¯ä»¶ä½¿å®¢æˆ·æ»¡æ„ã€‚ æ¬£ç„¶é¢å¯¹éœ€æ±‚å˜åŒ–ï¼Œå³ä½¿åœ¨å¼€å‘åæœŸä¹Ÿä¸€æ ·ã€‚ä¸ºäº†å®¢æˆ·çš„ç«äº‰ä¼˜åŠ¿ï¼Œæ•æ·è¿‡ç¨‹æŒæ§å˜åŒ–ã€‚ ç»å¸¸åœ°äº¤ä»˜å¯å·¥ä½œçš„è½¯ä»¶ï¼Œç›¸éš”å‡ æ˜ŸæœŸæˆ–ä¸€ä¸¤ä¸ªæœˆï¼Œå€¾å‘äºé‡‡å–è¾ƒçŸ­çš„å‘¨æœŸã€‚ ä¸šåŠ¡äººå‘˜å’Œå¼€å‘äººå‘˜å¿…é¡»ç›¸äº’åˆä½œï¼Œé¡¹ç›®ä¸­çš„æ¯ä¸€å¤©éƒ½ä¸ä¾‹å¤–ã€‚ æ¿€å‘ä¸ªä½“çš„æ–—å¿—ï¼Œä»¥ä»–ä»¬ä¸ºæ ¸å¿ƒæ­å»ºé¡¹ç›®ã€‚æä¾›æ‰€éœ€çš„ç¯å¢ƒå’Œæ”¯æ´ï¼Œè¾…ä»¥ä¿¡ä»»ï¼Œä»è€Œè¾¾æˆç›®æ ‡ã€‚ ä¸è®ºå›¢é˜Ÿå†…å¤–ï¼Œä¼ é€’ä¿¡æ¯æ•ˆæœæœ€å¥½æ•ˆç‡ä¹Ÿæœ€é«˜çš„æ–¹å¼æ˜¯é¢å¯¹é¢çš„äº¤è°ˆã€‚ å¯å·¥ä½œçš„è½¯ä»¶æ˜¯è¿›åº¦çš„é¦–è¦åº¦é‡æ ‡å‡†ã€‚ æ•æ·è¿‡ç¨‹å€¡å¯¼å¯æŒç»­å¼€å‘ã€‚è´£ä»»äººã€å¼€å‘äººå‘˜å’Œç”¨æˆ·è¦èƒ½å¤Ÿå…±åŒç»´æŒå…¶æ­¥è°ƒç¨³å®šå»¶ç»­ã€‚ åšæŒä¸æ‡ˆåœ°è¿½æ±‚æŠ€æœ¯å“è¶Šå’Œè‰¯å¥½è®¾è®¡ï¼Œæ•æ·èƒ½åŠ›ç”±æ­¤å¢å¼ºã€‚ ä»¥ç®€æ´ä¸ºæœ¬ï¼Œå®ƒæ˜¯æåŠ›å‡å°‘ä¸å¿…è¦å·¥ä½œé‡çš„è‰ºæœ¯ã€‚ æœ€å¥½çš„æ¶æ„ã€éœ€æ±‚å’Œè®¾è®¡å‡ºè‡ªè‡ªç»„ç»‡å›¢é˜Ÿã€‚ å›¢é˜Ÿå®šæœŸåœ°åæ€å¦‚ä½•èƒ½æé«˜æˆæ•ˆï¼Œå¹¶ä¾æ­¤è°ƒæ•´è‡ªèº«çš„ä¸¾æ­¢è¡¨ç°ã€‚ æ•æ·å®£è¨€ä¸­è¿™äº›ä»·å€¼è§‚å’ŒåŸåˆ™ï¼Œæ‰€è°“å…¥é—¨å®¹æ˜“ç²¾é€šéš¾ï¼Œåœ¨æ—äººæˆ–è€…å…¥é—¨è€…çœ‹æ¥ä¹Ÿè®¸ç•¥æ˜¾ç©ºæ´ï¼Œæ‰€è¨€æ— ç‰©ï¼›ç„¶è€Œï¼Œæ•æ·ç²¾é«“çš„å®è·µè€…ä»¬ä¸€ç›´åšä¿¡ç€è¿™äº›ç†å¿µï¼Œè§‰å¾—å®ƒä»¬å­—å­—ç ç‘ï¼Œæ‰€è¨€ææ˜¯ã€‚ä¸ç®¡æˆ‘ä»¬æ˜¯èµ°æ•æ·çš„å“ªä¸ªæµæ´¾ï¼Œéƒ½ä¸å¦¨åœ¨å®è·µæ•æ·çš„è¿‡ç¨‹ä¸­ï¼Œå›è¿‡å¤´æ¥çœ‹çœ‹è¿™äº›ä»·å€¼è§‚å’ŒåŸåˆ™ï¼Œæƒ³å¿…ä¼šå¸¸çœ‹å¸¸æ–°ï¼Œå¤§æœ‰è£¨ç›Šã€‚ Scrumæ ¸å¿ƒ å›¢é˜Ÿå¯†åˆ‡åä½œæ•æ·å¼€å‘ä¸­ï¼Œæœ€æ ¸å¿ƒçš„å°±æ˜¯äººã€‚ ä¸æ˜¯è¯´æ¯ä¸ªäººååœ¨è‡ªå·±çš„æ ¼å­é—´é‡Œï¼Œå„è‡ªç‹¬ç«‹å¼€å‘ï¼Œå®šæœŸå‘é¢†å¯¼æ±‡æŠ¥å·¥ä½œå°±å®Œäº‹äº†ï¼Œæ•æ·å¼€å‘éœ€è¦åšåˆ°å‡ ä¸ªå…³é”®ç‚¹ï¼š å®šæœŸä¼šé¢ã€‚é€šè¿‡å®šæœŸé«˜æ•ˆä¼šè®®è®©å¼€å‘äººå‘˜ä¿æŒç´§å¼ æœ‰åºçš„å·¥ä½œçŠ¶æ€ã€‚ åŠæ—¶å‘ŠçŸ¥é¡¹ç›®è¿›å±•ã€‚é¼“åŠ±é‡åˆ°é—®é¢˜ä¸€å®šè¦åŠæ—¶å‘ŠçŸ¥ï¼Œè®©æ‰€æœ‰åˆ©ç›Šç›¸å…³è€…éƒ½èƒ½å¤ŸåŠæ—¶äº†è§£é¡¹ç›®çš„æœ€æ–°è¿›å±•ã€‚ çŸ¥è¯†å…±äº«ã€‚æŠŠçŸ¥è¯†åˆ†äº«å‡ºæ¥ï¼Œå¯ä»¥æå‡æ•´ä¸ªå›¢é˜Ÿçš„å¼€å‘èƒ½åŠ›ï¼Œæ˜¯å¯¹å›¢é˜Ÿçš„ä¸€ç§æŠ•èµ„ã€‚ ä»£ç å…±äº«ã€‚æŠŠä»£ç é›†ä¸­åœ¨ç‰ˆæœ¬ç®¡ç†å·¥å…·ä¹‹ä¸­ï¼Œå›¢é˜Ÿä»»ä½•äººéƒ½æœ‰è®¿é—®æƒé™ã€‚ ä»£ç å®¡æŸ¥ã€‚é’ˆå¯¹ä»£ç çš„æ¯ä¸ªæ”¹åŠ¨ï¼Œéƒ½éœ€è¦ç›¸å…³äººå‘˜åšä»£ç å®¡æŸ¥ã€‚ ä¸æ–­åé¦ˆå’Œè°ƒæ•´æ•æ·å¼€å‘ä¸ä¼ ç»Ÿç€‘å¸ƒå¼å¼€å‘ä¸€ä¸ªæœ€å¤§çš„ä¸åŒå°±æ˜¯ï¼Œå¹¶éä¸€æ¬¡å®šç»ˆèº«ã€‚ è½¯ä»¶å¼€å‘ä¸æ˜¯çº¿æ€§è¿‡ç¨‹ï¼Œå®ƒå­˜åœ¨å¾ˆå¤šçš„ä¸ç¡®å®šæ€§ï¼Œæœ‰ä¸€å®šçš„åŠ¨æ€æ³¢åŠ¨ï¼Œæ‰€ä»¥éœ€è¦ä¸æ–­çš„åé¦ˆã€è°ƒæ•´ï¼Œå¿«é€Ÿå“åº”å˜åŒ–ã€‚ éœ€æ±‚è°ƒæ•´ã€‚åœ¨äº§å“è½åœ°å‰ï¼Œä½ æ˜¯ä¸å¯èƒ½åˆ¶å®šå‡ºå®Œç¾éœ€æ±‚æ–¹æ¡ˆçš„ï¼Œå®¢æˆ·ä¹Ÿå¹¶ä¸ä¸€å®šèƒ½å¤Ÿæ¸…æ™°çš„çŸ¥é“ä»–æƒ³è¦çš„è½¯ä»¶äº§å“åˆ°åº•æ˜¯ä»€ä¹ˆæ ·å­ã€‚æ‰€ä»¥ï¼Œè¦åšå¥½éœ€æ±‚ä¸æ–­å˜åŒ–çš„å¿ƒç†å‡†å¤‡ï¼Œä¹Ÿè¦æœ‰å¿«é€Ÿå“åº”éœ€æ±‚å˜åŒ–çš„èƒ½åŠ›ã€‚ åŠŸèƒ½è°ƒæ•´ã€‚æ”¶é›†å®¢æˆ·åé¦ˆã€ç”¨æˆ·åå“ï¼Œæ¥ä¸æ–­è°ƒæ•´å’Œä¼˜åŒ–è½¯ä»¶åŠŸèƒ½ã€‚ ä»£ç é‡æ„ã€‚åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œéœ€è¦ä¸æ–­çš„é‡æ„ä»£ç ï¼Œä¿æŒä»£ç æ¸…æ™°ã€å†…èšã€æ•´æ´ã€‚ ä¿æŒè½¯ä»¶å¯ç”¨ä¼ ç»Ÿè½¯ä»¶å¼€å‘çš„æ–¹å¼æ˜¯ï¼Œç­‰ä»£ç ç¼–å†™å®Œæ¯•ï¼Œæ‰€æœ‰åŠŸèƒ½éƒ½å®Œæˆä¹‹åï¼Œå†é›†ä¸­æµ‹è¯•å’Œä¸Šçº¿ï¼Œåœ¨è¿™ä¹‹å‰ï¼Œè½¯ä»¶éƒ½æ˜¯ç”¨æˆ·ä¸å¯ç”¨çš„ã€‚ åœ¨ä¿¡æ¯å¿«é€Ÿå‘å±•çš„ä»Šå¤©ï¼Œè¿™æ˜¾ç„¶å¤ªè½ä¼äº†ï¼Œå¯èƒ½ç­‰ä½ è½¯ä»¶å¼€å‘ä¸ªä¸€å¹´åŠè½½ï¼Œå¤–é¢éƒ½å˜å¤©äº†ã€‚ æ•æ·å¼€å‘ï¼Œå¦ä¸€å¤§ç‰¹è‰²ï¼Œå°±æ˜¯ä¿æŒè½¯ä»¶ä¸€ç›´å¯ç”¨ï¼Œåœ¨æœ€å°å¯ç”¨ç‰ˆæœ¬åŸºç¡€ä¹‹ä¸Šï¼Œä¸æ–­åšåŠŸèƒ½è¿­ä»£ï¼Œä¸æ–­å‘å¸ƒæ–°çš„ç‰ˆæœ¬ã€‚ é€šä¿—ç‚¹è®²å°±æ˜¯ï¼Œå…ˆåšä¸€ä¸ªç®€åŒ–ç‰ˆæœ¬å‡ºæ¥ï¼Œè®©ç”¨æˆ·ä¸€ç›´æœ‰è½¯ä»¶å¯ç”¨ï¼Œè€Œåå†é€æ­¥æ·»åŠ æ›´å¤šçš„åŠŸèƒ½ï¼Œã€Œå°æ­¥å¿«è·‘ã€å¼çš„åšå¼€å‘ï¼Œè€Œéä¸€æ­¥åˆ°ä½ã€‚ è¿™æ ·åšçš„å¥½å¤„ï¼Œä¹Ÿæ˜¯ä¸ºäº†èƒ½å¤Ÿä¸æ–­æ”¶é›†ç”¨æˆ·åé¦ˆä¸éœ€æ±‚ï¼ŒåŠæ—¶è°ƒæ•´å¼€å‘æ–¹å‘ã€‚ çŸ­è¿­ä»£ å¢é‡å‘å¸ƒè¿™ä¸€æ¡æ˜¯ä¸Šä¸€æ¡çš„å»¶ä¼¸ã€‚ æ‰€è°“ã€Œè¿­ä»£ã€å°±æ˜¯ï¼Œé‡å¤ä¸‹ä¸€ä¸ªå¼€å‘å‘¨æœŸï¼Œæ­¤åˆ»ä½ å¯ä»¥æƒ³è±¡ä¸€ä¸‹ while loopã€‚ ç”¨è¿­ä»£çš„æ–¹æ³•åœ¨å‰ä¸€ç‰ˆæœ¬ä¹‹ä¸Šé€æ­¥å¼€å‘æ–°çš„åŠŸèƒ½ï¼Œå‘å¸ƒæ–°çš„ç‰ˆæœ¬ï¼Œå³ï¼šå¢é‡å‘å¸ƒã€‚ è¿­ä»£å‘¨æœŸä¸å®œè¿‡é•¿ï¼Œä¸€å¹´åŠå¹´æ˜¾ç„¶å°±å¤ªä¹…äº†ï¼Œå°½é‡è¦ç¼©çŸ­è¿­ä»£å‘¨æœŸï¼Œä¿æŒå¼€å‘è¿‡ç¨‹ç¨³æ­¥å‰è¿›ã€‚ ä½†çŸ­è¿­ä»£å¹¶ä¸æ„å‘³ç€å¤ªè¿‡é¢‘ç¹ï¼Œæ¯å¤©æˆ–è€…æ¯å‘¨è¿­ä»£ä¸€æ¬¡çš„è¯ï¼Œå¾ˆå¯èƒ½ä¼šè¿‡çŠ¹ä¸åŠï¼ŒåŠä¸ªæœˆåˆ°ä¸€ä¸ªæœˆåº”è¯¥æ˜¯ä¸€ä¸ªä¸é”™çš„æ—¶é—´èŠ‚ç‚¹ã€‚å½“ç„¶è¿™åªæ˜¯å‚è€ƒå»ºè®®ï¼Œå…·ä½“çš„è¿­ä»£å‘¨æœŸè¿˜åº”æ ¹æ®çœŸå®æƒ…å†µé‡åŠ›è€Œè¡Œã€‚ ææ—©é›†æˆ ä¸æ–­é›†æˆã€Œé›†æˆã€çš„å«ä¹‰å°±æ˜¯ï¼ŒæŠŠè½¯ä»¶çš„å„ä¸ªæ¨¡å—ï¼Œæ–°æ—§ä»£ç ç»Ÿä¸€æ•´åˆåœ¨ä¸€èµ·ï¼Œèƒ½å¤Ÿæ­£ç¡®ç¼–è¯‘ã€è¿è¡Œï¼Œå¹¶ä¸”èƒ½å¤Ÿé€šè¿‡ä¸€ç³»åˆ—çš„å•å…ƒæµ‹è¯•ã€‚ æ•æ·å¼€å‘è¦æ±‚å¼€å‘äººå‘˜ï¼Œä¸è¦ä¸´åˆ°è½¯ä»¶å‘å¸ƒæˆ–è€…äº¤ä»˜çš„å½“å¤©æ‰å¼€å§‹é›†æˆï¼Œä¹Ÿä¸è¦å¾ˆä¹…æ‰é›†æˆä¸€æ¬¡ï¼Œå°½å¯èƒ½çš„åšåˆ°ææ—©ç»§æ‰¿ã€é¢‘ç¹é›†æˆã€‚ç†è®ºä¸Šè®²ï¼Œæ¯æ·»åŠ è¿›ä¸€äº›æ–°çš„ä»£ç ï¼Œæœ€å¥½éƒ½è¦åšä¸€æ¬¡é›†æˆã€‚ é€šè¿‡ææ—©é›†æˆã€ä¸æ–­é›†æˆï¼Œèƒ½å¤Ÿå°½æ—©å‘ç°ä»£ç ä¸­çš„é—®é¢˜ï¼Œä¿æŒè½¯ä»¶çš„çŠ¶æ€ä¸€ç›´æ˜¯å¯ç”¨çš„ã€‚ è‡ªåŠ¨åŒ–é›†æˆã€æµ‹è¯•ä¸éƒ¨ç½²æ•æ·çš„å¦ä¸€ä¸ªå…³é”®ç‚¹æ˜¯ï¼Œé€šè¿‡æŠ€æœ¯æ‰‹æ®µæŠŠé›†æˆã€æµ‹è¯•ä¸éƒ¨ç½²è¿™äº›éå¸¸è€—æ—¶çš„æ“ä½œè‡ªåŠ¨åŒ–ã€‚ è‡³äºä¸ºä»€ä¹ˆè¦è‡ªåŠ¨åŒ–ï¼Œå¦‚æœä½ æ˜¯ä¸€ä¸ªäººå¼€å‘ä¸€ä¸ªå‡ åƒè¡Œçš„ç¨‹åºï¼Œé‚£ç¡®å®æ²¡å¿…è¦è‡ªåŠ¨åŒ–ï¼Œç¡®åˆ‡çš„è¯´ï¼Œä¹Ÿæ²¡å¿…è¦åº”ç”¨ä»€ä¹ˆæ•æ·å¼€å‘ã€‚ é’ˆå¯¹å¼€å‘å¤§å‹è½¯ä»¶çš„å›¢é˜Ÿè€Œè¨€ï¼Œç¼–è¯‘ã€æµ‹è¯•è¿‡ç¨‹æœ‰å¯èƒ½éƒ½éå¸¸çš„è€—æ—¶ï¼Œç¼–è¯‘æœ‰æ—¶ä¼šèŠ±ä¸ŠåŠå¤©çš„æ—¶é—´ï¼Œæµ‹è¯•å¯èƒ½ä¼šæŒç»­å¥½å‡ å¤©ã€‚è€Œä¸”æ˜¯å¤šäººåä½œå…±åŒå¼€å‘ï¼Œå¦‚æœçº¯æ‰‹åŠ¨çš„è¯ï¼Œä½ æƒ³è±¡ä¸€ä¸‹å¦‚æœä¸¤ä¸ªäººæƒ³å‰åè„šæäº¤ä»£ç ï¼Œå²‚ä¸æ˜¯è¦ç­‰ä¸Šå¥½å‡ å¤©çš„æ—¶é—´ï¼Œç­‰å‰é¢é‚£ä¸ªäººé›†æˆç»“æŸä¹‹åï¼Œåé¢é‚£ä¸ªäººæ‰å¯ä»¥å¼€å§‹é›†æˆï¼Ÿ æŠŠé›†æˆã€æµ‹è¯•ä¸éƒ¨ç½²è‡ªåŠ¨åŒ–çš„å¥½å¤„å°±æ˜¯ï¼ŒæŠŠè¿™äº›è€—æ—¶çš„çº¯ä½“åŠ›åŠ³åŠ¨æ‰”ç»™æœºå™¨å»åšï¼Œå®ƒåšå®Œäº†ï¼Œåªè¦è¿”å›ä½ ä¸€ä¸ªæœ€ç»ˆç»“æœå°±å¥½äº†ï¼Œè€Œä¸”ä¸¤ä¸ªäººåŒæ—¶ Check In æ—¶ä¹Ÿä¸ä¼šå—åˆ°å½±å“ã€‚ è¿™å‰¯å›¾æ¶µç›–äº†è‡ªåŠ¨åŒ–é›†æˆã€æµ‹è¯•ä»¥åŠéƒ¨ç½²çš„æµç¨‹ã€‚ å¼€å‘è€… Check In ä¹‹åçš„æ‰€æœ‰å·¥ä½œå°†éƒ½äº¤ç»™æœºå™¨å»åšï¼Œå®ƒä»¬éƒ½æœ‰ä¸“é—¨çš„å·¥å…· ï¼ŒåŒ…æ‹¬é›†æˆå·¥å…·ã€æµ‹è¯•å·¥å…·ï¼Œå½“ç„¶è¿™äº›å·¥å…·å¯ä»¥ä½¿ç”¨ç¬¬ä¸‰æ–¹çš„ï¼Œä¹Ÿå¯ä»¥è‡ªå·±å¼€å‘ã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¿™ä¸€ç³»åˆ—çš„å·¥ä½œéƒ½è·Ÿç‰ˆæœ¬ç®¡ç†å·¥å…·ç»‘å®šåœ¨ä¸€èµ·ï¼Œä½ åªè¦ Check In å°±ä¼šè§¦å‘é›†æˆã€æµ‹è¯•ï¼Œç”šè‡³è¿˜æœ‰éƒ¨ç½²ã€‚è€Œä½ ï¼Œåªè¦ä¸“å¿ƒçš„ç­‰å¾…ç»“æœå°±å¥½ã€‚ æ€»ç»“åœ¨æµç¨‹ä¸Šï¼Œæ•æ·æœ€å¤§çš„ç‰¹è‰²æ˜¯è¿­ä»£å¼å¼€å‘ã€‚æ•æ·å¼€å‘å¯ä»¥ç”¨ä¸€å¥è¯æ¦‚æ‹¬ï¼šæ‹¥æŠ±å˜åŒ–ï¼Œè½»é‡æ–‡æ¡£ï¼Œå›¢é˜Ÿåˆä½œï¼Œå¤šä¸ªçŸ­çš„å†²åˆºå‘¨æœŸ å‚è€ƒæ–‡ç« ï¼š https://www.zybuluo.com/yishuailuo/note/672154?hmsr=toutiao.io&amp;utm_medium=toutiao.io&amp;utm_source=toutiao.io","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"https://sunny0715.github.io/tags/éšç¬”/"}]},{"title":"Spingå®šæ—¶ä»»åŠ¡","slug":"Spingå®šæ—¶ä»»åŠ¡","date":"2018-03-07T09:09:22.000Z","updated":"2018-03-13T05:46:53.196Z","comments":true,"path":"2018/03/07/Spingå®šæ—¶ä»»åŠ¡/","link":"","permalink":"https://sunny0715.github.io/2018/03/07/Spingå®šæ—¶ä»»åŠ¡/","excerpt":"å¼•è¨€åœ¨ä¼ä¸šå¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°æ—¶é—´ä»»åŠ¡è°ƒåº¦çš„éœ€æ±‚ï¼Œæ¯”å¦‚æ¯å¤©å‡Œæ™¨ç”Ÿæˆå‰å¤©æŠ¥è¡¨ã€æ•°æ®æ±‡æ€»ç­‰åŠ¨æ€é…ç½®æ˜¯å¦å¼€å¯å®šæ—¶çš„ä»»åŠ¡ã€‚åœ¨Javaé¢†åŸŸä¸­ï¼Œå®šæ—¶ä»»åŠ¡çš„å¼€æºå·¥å…·ä¹Ÿéå¸¸å¤šï¼Œå°åˆ°ä¸€ä¸ªTimerç±»ï¼Œå¤§åˆ°Quartzæ¡†æ¶ã€‚åœ¨Springä¸­æœ€å¸¸è§çš„å®šæ—¶ä»»åŠ¡æ–¹å¼å±Spring scheduleæ³¨è§£çš„æ–¹å¼å’Œåˆ©ç”¨QuartzåŠ¨æ€ç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚æ€»ä½“æ¥è¯´ï¼Œä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„è¿˜æ˜¯Quartzï¼ŒåŠŸèƒ½å¼ºå¤§è€Œä¸”ä½¿ç”¨æ–¹ä¾¿ã€‚","text":"å¼•è¨€åœ¨ä¼ä¸šå¼€å‘ä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°æ—¶é—´ä»»åŠ¡è°ƒåº¦çš„éœ€æ±‚ï¼Œæ¯”å¦‚æ¯å¤©å‡Œæ™¨ç”Ÿæˆå‰å¤©æŠ¥è¡¨ã€æ•°æ®æ±‡æ€»ç­‰åŠ¨æ€é…ç½®æ˜¯å¦å¼€å¯å®šæ—¶çš„ä»»åŠ¡ã€‚åœ¨Javaé¢†åŸŸä¸­ï¼Œå®šæ—¶ä»»åŠ¡çš„å¼€æºå·¥å…·ä¹Ÿéå¸¸å¤šï¼Œå°åˆ°ä¸€ä¸ªTimerç±»ï¼Œå¤§åˆ°Quartzæ¡†æ¶ã€‚åœ¨Springä¸­æœ€å¸¸è§çš„å®šæ—¶ä»»åŠ¡æ–¹å¼å±Spring scheduleæ³¨è§£çš„æ–¹å¼å’Œåˆ©ç”¨QuartzåŠ¨æ€ç®¡ç†å®šæ—¶ä»»åŠ¡ã€‚æ€»ä½“æ¥è¯´ï¼Œä¸ªäººæ¯”è¾ƒå–œæ¬¢çš„è¿˜æ˜¯Quartzï¼ŒåŠŸèƒ½å¼ºå¤§è€Œä¸”ä½¿ç”¨æ–¹ä¾¿ã€‚ Spring-@scheduledå¯¹äºè¾ƒç®€å•çš„ä»»åŠ¡å¯ä»¥ä½¿ç”¨Springå†…ç½®çš„å®šæ—¶ä»»åŠ¡æ–¹æ³•@scheduledæ³¨è§£è¿›è¡Œé…ç½®è¾¾åˆ°è‡ªå·±çš„éœ€æ±‚ã€‚ springé…ç½®æ–‡ä»¶é…ç½®springé¡¹ç›®çš„åŸºç¡€æ–‡ä»¶spring.xml 123456789101112131415161718&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt; &lt;beans xmlns:task=\"http://www.springframework.org/schema/task\" xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xsi:schemaLocation=\" http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.0.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd http://www.springframework.org/schema/task http://www.springframework.org/schema/task/spring-task-3.1.xsd\"&gt; &lt;!-- å¼€å¯å®šæ—¶ä»»åŠ¡ springçš„å®šæ—¶ä»»åŠ¡é»˜è®¤æ˜¯å•çº¿ç¨‹ï¼Œå¤šä¸ªä»»åŠ¡æ‰§è¡Œèµ·æ¥æ—¶é—´ä¼šæœ‰é—®é¢˜ï¼Œæ‰€ä»¥è¿™é‡Œé…ç½®äº†çº¿ç¨‹æ± --&gt; &lt;task:executor id=\"executor\" pool-size=\"5\" /&gt; &lt;task:scheduler id=\"scheduler\" pool-size=\"10\" /&gt; &lt;task:annotation-driven executor=\"executor\" scheduler=\"scheduler\" /&gt; &lt;/beans&gt; Taskä»»åŠ¡ç±»å®šä¹‰äº†ä¸€ä¸ªä»»åŠ¡ç±»ATaskï¼Œé‡Œé¢æœ‰ä¸¤ä¸ªå®šæ—¶ä»»åŠ¡aTaskå’ŒbTaskã€‚ç¼–å†™javaä¸šåŠ¡ä»£ç ï¼Œéœ€è¦åœ¨ç±»å£°æ˜ä¸Šè¾¹æ·»åŠ @Componentæ³¨è§£ï¼Œå¹¶åœ¨éœ€è¦å®šæ—¶ä»»åŠ¡æ‰§è¡Œçš„æ–¹æ³•å£°æ˜ä¸Šæ·»åŠ @Scheduledæ³¨è§£ä»¥åŠcronè¡¨è¾¾å¼å’Œç›¸å…³çš„å‚æ•°ã€‚ 12345678910111213141516// å®šæ—¶å™¨çš„ä»»åŠ¡æ–¹æ³•ä¸èƒ½æœ‰è¿”å›å€¼@Componentpublic class ATask &#123; @Scheduled(cron = \"0/10 * * * * ? \") // æ¯10ç§’æ‰§è¡Œä¸€æ¬¡ public void aTask() &#123; DateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\"); System.out.println(sdf.format(DateTime.now().toDate()) + \"*********Aä»»åŠ¡æ¯10ç§’æ‰§è¡Œä¸€æ¬¡è¿›å…¥æµ‹è¯•\"); &#125; @Scheduled(cron = \"0/5 * * * * ? \") // æ¯5ç§’æ‰§è¡Œä¸€æ¬¡ public void bTask() &#123; DateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\"); System.out.println(sdf.format(DateTime.now().toDate()) + \"*********Bä»»åŠ¡æ¯5ç§’æ‰§è¡Œä¸€æ¬¡è¿›å…¥æµ‹è¯•\"); &#125;&#125; è¿è¡Œç»“æœå¯åŠ¨é¡¹ç›®ä¼šå‘ç°å®šæ—¶ä»»åŠ¡å·²ç»å¼€å¯ã€‚ Spring-Quartz@scheduledå›ºç„¶å¯ä»¥å®ç°å®šæ—¶ä»»åŠ¡ï¼Œä½†æ˜¯ä»”ç»†æƒ³æƒ³å¹¶ä¸çµæ´»ï¼Œä»»åŠ¡éšç€åº”ç”¨çš„å¯åŠ¨è€Œæ‰§è¡Œï¼Œå¹¶ä¸èƒ½åŠ¨æ€çš„è¿›è¡Œç®¡ç†ï¼Œå¾ˆæ˜¯ä¸æ–¹ä¾¿ï¼Œç„¶è€ŒQuartzå¾ˆå¥½çš„è§£å†³äº†è¿™ä¸€é—®é¢˜ã€‚ å¼•å…¥ä¾èµ–12345&lt;dependency&gt; &lt;groupId&gt;org.quartz-scheduler&lt;/groupId&gt; &lt;artifactId&gt;quartz&lt;/artifactId&gt; &lt;version&gt;2.2.1&lt;/version&gt;&lt;/dependency&gt; ä»»åŠ¡ç®¡ç†ç±»QuartzManager123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151public class QuartzManager &#123; private static SchedulerFactory schedulerFactory = new StdSchedulerFactory(); /** * @Description: æ·»åŠ ä¸€ä¸ªå®šæ—¶ä»»åŠ¡ * * @param jobName * ä»»åŠ¡å * @param jobGroupName * ä»»åŠ¡ç»„å * @param triggerName * è§¦å‘å™¨å * @param triggerGroupName * è§¦å‘å™¨ç»„å * @param jobClass * ä»»åŠ¡ * @param cron * æ—¶é—´è®¾ç½®ï¼Œå‚è€ƒquartzè¯´æ˜æ–‡æ¡£ */ @SuppressWarnings(&#123; \"unchecked\", \"rawtypes\" &#125;) public static void addJob(String jobName, String jobGroupName, String triggerName, String triggerGroupName, Class jobClass, String cron) &#123; try &#123; Scheduler sched = schedulerFactory.getScheduler(); // ä»»åŠ¡åï¼Œä»»åŠ¡ç»„ï¼Œä»»åŠ¡æ‰§è¡Œç±» JobDetail jobDetail = JobBuilder.newJob(jobClass).withIdentity(jobName, jobGroupName).build(); // è§¦å‘å™¨ TriggerBuilder&lt;Trigger&gt; triggerBuilder = TriggerBuilder.newTrigger(); // è§¦å‘å™¨å,è§¦å‘å™¨ç»„ triggerBuilder.withIdentity(triggerName, triggerGroupName); triggerBuilder.startNow(); // è§¦å‘å™¨æ—¶é—´è®¾å®š triggerBuilder.withSchedule(CronScheduleBuilder.cronSchedule(cron)); // åˆ›å»ºTriggerå¯¹è±¡ CronTrigger trigger = (CronTrigger) triggerBuilder.build(); // è°ƒåº¦å®¹å™¨è®¾ç½®JobDetailå’ŒTrigger sched.scheduleJob(jobDetail, trigger); // å¯åŠ¨ if (!sched.isShutdown()) &#123; sched.start(); &#125; &#125; catch (Exception e) &#123; throw new RuntimeException(e); &#125; &#125; /** * @Description: ä¿®æ”¹ä¸€ä¸ªä»»åŠ¡çš„è§¦å‘æ—¶é—´ * * @param jobName * @param jobGroupName * @param triggerName * è§¦å‘å™¨å * @param triggerGroupName * è§¦å‘å™¨ç»„å * @param cron * æ—¶é—´è®¾ç½®ï¼Œå‚è€ƒquartzè¯´æ˜æ–‡æ¡£ */ public static void modifyJobTime(String jobName, String jobGroupName, String triggerName, String triggerGroupName, String cron) &#123; try &#123; Scheduler sched = schedulerFactory.getScheduler(); TriggerKey triggerKey = TriggerKey.triggerKey(triggerName, triggerGroupName); CronTrigger trigger = (CronTrigger) sched.getTrigger(triggerKey); if (trigger == null) &#123; return; &#125; String oldTime = trigger.getCronExpression(); if (!oldTime.equalsIgnoreCase(cron)) &#123; /** æ–¹å¼ä¸€ ï¼šè°ƒç”¨ rescheduleJob å¼€å§‹ */ // è§¦å‘å™¨ TriggerBuilder&lt;Trigger&gt; triggerBuilder = TriggerBuilder.newTrigger(); // è§¦å‘å™¨å,è§¦å‘å™¨ç»„ triggerBuilder.withIdentity(triggerName, triggerGroupName); triggerBuilder.startNow(); // è§¦å‘å™¨æ—¶é—´è®¾å®š triggerBuilder.withSchedule(CronScheduleBuilder.cronSchedule(cron)); // åˆ›å»ºTriggerå¯¹è±¡ trigger = (CronTrigger) triggerBuilder.build(); // æ–¹å¼ä¸€ ï¼šä¿®æ”¹ä¸€ä¸ªä»»åŠ¡çš„è§¦å‘æ—¶é—´ sched.rescheduleJob(triggerKey, trigger); /** æ–¹å¼ä¸€ ï¼šè°ƒç”¨ rescheduleJob ç»“æŸ */ /** æ–¹å¼äºŒï¼šå…ˆåˆ é™¤ï¼Œç„¶ååœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„Job */ // JobDetail jobDetail = // sched.getJobDetail(JobKey.jobKey(jobName, jobGroupName)); // Class&lt;? extends Job&gt; jobClass = jobDetail.getJobClass(); // removeJob(jobName, jobGroupName, triggerName, // triggerGroupName); // addJob(jobName, jobGroupName, triggerName, triggerGroupName, // jobClass, cron); /** æ–¹å¼äºŒ ï¼šå…ˆåˆ é™¤ï¼Œç„¶ååœ¨åˆ›å»ºä¸€ä¸ªæ–°çš„Job */ &#125; &#125; catch (Exception e) &#123; throw new RuntimeException(e); &#125; &#125; /** * @Description: ç§»é™¤ä¸€ä¸ªä»»åŠ¡ * * @param jobName * @param jobGroupName * @param triggerName * @param triggerGroupName */ public static void removeJob(String jobName, String jobGroupName, String triggerName, String triggerGroupName) &#123; try &#123; Scheduler sched = schedulerFactory.getScheduler(); TriggerKey triggerKey = TriggerKey.triggerKey(triggerName, triggerGroupName); sched.pauseTrigger(triggerKey);// åœæ­¢è§¦å‘å™¨ sched.unscheduleJob(triggerKey);// ç§»é™¤è§¦å‘å™¨ sched.deleteJob(JobKey.jobKey(jobName, jobGroupName));// åˆ é™¤ä»»åŠ¡ &#125; catch (Exception e) &#123; throw new RuntimeException(e); &#125; &#125; /** * @Description:å¯åŠ¨æ‰€æœ‰å®šæ—¶ä»»åŠ¡ */ public static void startJobs() &#123; try &#123; Scheduler sched = schedulerFactory.getScheduler(); sched.start(); &#125; catch (Exception e) &#123; throw new RuntimeException(e); &#125; &#125; /** * @Description:å…³é—­æ‰€æœ‰å®šæ—¶ä»»åŠ¡ */ public static void shutdownJobs() &#123; try &#123; Scheduler sched = schedulerFactory.getScheduler(); if (!sched.isShutdown()) &#123; sched.shutdown(); &#125; &#125; catch (Exception e) &#123; throw new RuntimeException(e); &#125; &#125;&#125; ä»»åŠ¡æ‰§è¡Œä¸šåŠ¡è¿™é‡Œåšä¸€ä¸ªç®€å•çš„æ¼”ç¤ºï¼Œåªå®ç°Jobæ¥å£æ‰“å°å½“å‰æ—¶é—´ã€‚ 1234567public class MyJob implements Job&#123; public void execute(JobExecutionContext jobExecutionContext) throws JobExecutionException &#123; DateFormat sdf = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\"); System.out.println(sdf.format(DateTime.now().toDate())); &#125;&#125; æµ‹è¯•åŠ¨æ€å®šæ—¶ä»»åŠ¡æ–°å»ºQuartzTest.Java æµ‹è¯•ç±» 123456789101112131415161718192021222324public class QuartzTest &#123; public static String JOB_NAME = \"åŠ¨æ€ä»»åŠ¡è°ƒåº¦\"; public static String TRIGGER_NAME = \"åŠ¨æ€ä»»åŠ¡è§¦å‘å™¨\"; public static String JOB_GROUP_NAME = \"XLXXCC_JOB_GROUP\"; public static String TRIGGER_GROUP_NAME = \"XLXXCC_JOB_GROUP\"; public static void main(String[] args) &#123; try &#123; System.out.println(\"ã€ç³»ç»Ÿå¯åŠ¨ã€‘å¼€å§‹(æ¯1ç§’è¾“å‡ºä¸€æ¬¡)...\"); QuartzManager.addJob(JOB_NAME, JOB_GROUP_NAME, TRIGGER_NAME, TRIGGER_GROUP_NAME, MyJob.class,\"0/1 * * * * ?\"); Thread.sleep(5000); System.out.println(\"ã€ä¿®æ”¹æ—¶é—´ã€‘å¼€å§‹(æ¯5ç§’è¾“å‡ºä¸€æ¬¡)...\"); QuartzManager.modifyJobTime(JOB_NAME, JOB_GROUP_NAME, TRIGGER_NAME, TRIGGER_GROUP_NAME, \"0/5 * * * * ?\"); Thread.sleep(15000); System.out.println(\"ã€ç§»é™¤å®šæ—¶ã€‘å¼€å§‹...\"); QuartzManager.removeJob(JOB_NAME, JOB_GROUP_NAME, TRIGGER_NAME, TRIGGER_GROUP_NAME); System.out.println(\"ã€ç§»é™¤å®šæ—¶ã€‘æˆåŠŸ\"); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; &#125;&#125; è¾“å‡ºå¦‚ä¸‹ï¼š æ€»ç»“é€šè¿‡ä»¥ä¸Šæµ‹è¯•å¯ä»¥æ˜æ˜¾çš„çœ‹å‡ºä¸¤è€…çš„ä¼˜åŠ£ï¼ŒQuartzè¶³å¤Ÿçµæ´»å¼ºå¤§ï¼Œå•Spring scheduled åœ¨ç®€å•ä»»åŠ¡ä¸‹ä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://sunny0715.github.io/tags/spring/"}]},{"title":"å¤§è¯æ•°æ®åº“è¿æ¥æ± ","slug":"å¤§è¯æ•°æ®åº“è¿æ¥æ± ","date":"2018-02-06T09:50:49.000Z","updated":"2018-03-20T06:22:26.399Z","comments":true,"path":"2018/02/06/å¤§è¯æ•°æ®åº“è¿æ¥æ± /","link":"","permalink":"https://sunny0715.github.io/2018/02/06/å¤§è¯æ•°æ®åº“è¿æ¥æ± /","excerpt":"å¼•è¨€æ•°æ®åº“è¿æ¥æ± åœ¨Javaæ•°æ®åº“ç›¸å…³ä¸­é—´ä»¶äº§å“ç¾¤ä¸­ï¼Œåº”è¯¥ç®—æ˜¯æœ€åº•å±‚æœ€åŸºç¡€çš„ä¸€ç±»äº§å“ï¼Œä½œä¸ºä¼ä¸šåº”ç”¨å¼€å‘å¿…ä¸å¯å°‘çš„ç»„ä»¶ï¼Œæ— æ•°å¼€å‘è€…ä»¬è´¡çŒ®äº†ä¸€ä¸ªåˆä¸€ä¸ªçš„ä¼˜ç§€äº§å“ï¼Œå®ƒä»¬æœ‰çš„éšç€æ—¶ä»£å‘å±•ï¼ŒåŠŸæˆèº«é€€ï¼Œæœ‰çš„è¿˜åœ¨ä¸æ–­è¿­ä»£ï¼Œè€è€Œå¼¥åšï¼Œæ›´æœ‰æ–°ç”Ÿä»£äº§å“ï¼Œæˆ–æ€§èƒ½æ— æ•Œã€æˆ–åŠŸèƒ½å…¨é¢ã€‚æ¥ä¸‹æ¥å°±èŠä¸€èŠ â€œé‚£äº›å¹´ï¼Œæˆ‘ä»¬ç”¨è¿‡çš„æ•°æ®åº“è¿æ¥æ± ã€‚â€","text":"å¼•è¨€æ•°æ®åº“è¿æ¥æ± åœ¨Javaæ•°æ®åº“ç›¸å…³ä¸­é—´ä»¶äº§å“ç¾¤ä¸­ï¼Œåº”è¯¥ç®—æ˜¯æœ€åº•å±‚æœ€åŸºç¡€çš„ä¸€ç±»äº§å“ï¼Œä½œä¸ºä¼ä¸šåº”ç”¨å¼€å‘å¿…ä¸å¯å°‘çš„ç»„ä»¶ï¼Œæ— æ•°å¼€å‘è€…ä»¬è´¡çŒ®äº†ä¸€ä¸ªåˆä¸€ä¸ªçš„ä¼˜ç§€äº§å“ï¼Œå®ƒä»¬æœ‰çš„éšç€æ—¶ä»£å‘å±•ï¼ŒåŠŸæˆèº«é€€ï¼Œæœ‰çš„è¿˜åœ¨ä¸æ–­è¿­ä»£ï¼Œè€è€Œå¼¥åšï¼Œæ›´æœ‰æ–°ç”Ÿä»£äº§å“ï¼Œæˆ–æ€§èƒ½æ— æ•Œã€æˆ–åŠŸèƒ½å…¨é¢ã€‚æ¥ä¸‹æ¥å°±èŠä¸€èŠ â€œé‚£äº›å¹´ï¼Œæˆ‘ä»¬ç”¨è¿‡çš„æ•°æ®åº“è¿æ¥æ± ã€‚â€ ç¬¬ä¸€ã€äºŒä»£è¿æ¥æ± åŒºåˆ†ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± æ˜¯å±äºç¬¬ä¸€ä»£äº§å“è¿˜æ˜¯ä»£äºŒä»£äº§å“æœ‰ä¸€ä¸ªæœ€é‡è¦çš„ç‰¹å¾å°±æ˜¯çœ‹å®ƒåœ¨æ¶æ„å’Œè®¾è®¡æ—¶é‡‡ç”¨çš„çº¿ç¨‹æ¨¡å‹ï¼Œå› ä¸ºè¿™ç›´æ¥å½±å“çš„æ˜¯å¹¶å‘ç¯å¢ƒä¸‹å­˜å–æ•°æ®åº“è¿æ¥çš„æ€§èƒ½ã€‚ ä¸€èˆ¬æ¥è®²é‡‡ç”¨å•çº¿ç¨‹åŒæ­¥çš„æ¶æ„è®¾è®¡éƒ½å±äºç¬¬ä¸€ä»£è¿æ¥æ± ï¼ŒäºŒé‡‡ç”¨å¤šçº¿ç¨‹å¼‚æ­¥æ¶æ„çš„åˆ™å±äºç¬¬äºŒä»£ã€‚æ¯”è¾ƒæœ‰ä»£è¡¨æ€§çš„å°±æ˜¯Apache Commons DBCPï¼Œåœ¨1.xç‰ˆæœ¬ä¸­ï¼Œä¸€ç›´å»¶ç»­ç€å•çº¿ç¨‹è®¾è®¡æ¨¡å¼ï¼Œåˆ°2.xæ‰é‡‡ç”¨å¤šçº¿ç¨‹æ¨¡å‹ã€‚ ç”¨ç‰ˆæœ¬å‘å¸ƒæ—¶é—´æ¥è¾¨åˆ«åŒºåˆ†ä¸¤ä»£äº§å“ï¼Œåˆ™ä¸€ä¸ªå·æ‡’çš„å¥½æ–¹æ³•ã€‚ä»¥ä¸‹æ˜¯è¿™äº›å¸¸è§æ•°æ®åº“è¿æ¥æ± æœ€æ–°ç‰ˆæœ¬çš„å‘å¸ƒæ—¶é—´ï¼š æ•°æ®åº“è¿æ¥æ±  æœ€æ–°ç‰ˆæœ¬ å‘å¸ƒæ—¶é—´ C3P0 c3p0-0.9.5.2 on 9 Dec 2015 DBCP 2.2.0 27 December 2017 Druid 0.11.0 Dec 4 2017 HikariCP 2.7.6 2018-01-14 ä»è¡¨ä¸­å¯ä»¥çœ‹å‡ºï¼ŒC3P0å·²ç»å¾ˆä¹…æ²¡æœ‰æ›´æ–°äº†ã€‚DBCPæ›´æ–°é€Ÿåº¦å¾ˆæ…¢ï¼ŒåŸºæœ¬å¤„äºä¸æ´»è·ƒçŠ¶æ€ï¼Œè€ŒDruidå’ŒHikariCPå¤„äºæ´»è·ƒçŠ¶æ€çš„æ›´æ–°ä¸­ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬è¯´çš„äºŒä»£äº§å“äº†ã€‚ äºŒä»£äº§å“å¯¹ä¸€ä»£äº§å“çš„è¶…è¶Šæ˜¯é¢ è¦†æ€§çš„ï¼Œé™¤äº†ä¸€äº›â€œå†å²åŸå› â€ï¼Œä½ å¾ˆéš¾å†æ‰¾åˆ°ç¬¬äºŒæ¡ç†ç”±è¯´æœè‡ªå·±ä¸é€‰æ‹©äºŒä»£äº§å“ï¼Œä½†ä»»ä½•æˆåŠŸéƒ½ä¸æ˜¯å¶ç„¶çš„ï¼ŒäºŒä»£äº§å“çš„æˆåŠŸå¾ˆå¤§ç¨‹åº¦ä¸Šå¾—ç›Šäºå‰ä»£äº§å“ä»¬æ‰“ä¸‹çš„åŸºç¡€ï¼Œç«™åœ¨å·¨äººçš„è‚©è†€ä¸Šï¼Œæ–°ä¸€ä»£çš„è¿æ¥æ± çš„è®¾è®¡å¸ˆä»¬å°†è¿™ä¸€é¡¹â€œå·¥å…·åŒ–â€çš„äº§å“ï¼Œæ¨å‘äº†æè‡´ã€‚å…¶ä¸­ï¼Œæœ€å…·ä»£è¡¨æ€§çš„ä¸¤æ¬¾äº§å“æ˜¯ï¼š HikariCP Druid å½»åº•æ­»æ‰çš„C3P0C3P0æ˜¯æˆ‘ä½¿ç”¨çš„ç¬¬ä¸€æ¬¾æ•°æ®åº“è¿æ¥æ± ï¼Œåœ¨å¾ˆé•¿ä¸€æ®µæ—¶é—´å†…ï¼Œå®ƒä¸€ç›´æ˜¯Javaé¢†åŸŸå†…æ•°æ®åº“è¿æ¥æ± çš„ä»£åè¯ï¼Œå½“å¹´ç››æä¸€æ—¶çš„Hibernateéƒ½å°†å…¶ä½œä¸ºå†…ç½®çš„æ•°æ®åº“è¿æ¥æ± ï¼Œå¯ä»¥ä¸šå†…å¯¹å®ƒçš„ç¨³å®šæ€§è¿˜æ˜¯è®¤å¯çš„ã€‚C3P0åŠŸèƒ½ç®€å•æ˜“ç”¨ï¼Œç¨³å®šæ€§å¥½è¿™æ˜¯å®ƒçš„ä¼˜ç‚¹ï¼Œä½†æ˜¯æ€§èƒ½ä¸Šçš„ç¼ºç‚¹å´è®©å®ƒå½»åº•è¢«æ‰“å…¥å†·å®«ã€‚C3P0çš„æ€§èƒ½å¾ˆå·®ï¼Œå·®åˆ°å³ä¾¿æ˜¯åŒæ—¶ä»£çš„äº§å“ç›¸æ¯”å®ƒä¹Ÿæ˜¯å«åº•çš„ï¼Œæ›´ä¸ç”¨å’ŒDruidã€HikariCPç­‰ç›¸æ¯”äº†ã€‚æ­£å¸¸æ¥è®²ï¼Œæœ‰é—®é¢˜å¾ˆæ­£å¸¸ï¼Œæ”¹å°±æ˜¯äº†ï¼Œä½†c3p0æœ€è‡´å‘½çš„é—®é¢˜å°±æ˜¯æ¶æ„è®¾è®¡è¿‡äºå¤æ‚ï¼Œè®©é‡æ„å˜æˆäº†ä¸€é¡¹ä¸å¯èƒ½å®Œæˆçš„ä»»åŠ¡ã€‚éšç€å›½å†…äº’è”ç½‘å¤§æ½®çš„æ¶Œèµ·ï¼Œæ€§èƒ½æœ‰ç¡¬ä¼¤çš„c3p0å½»åº•çš„é€€å‡ºäº†å†å²èˆå°ã€‚ å’¸é±¼ç¿»èº«çš„DBCPDBCPï¼ˆDataBase Connection Poolï¼‰å±äºApacheé¡¶çº§é¡¹ç›®Commonsä¸­çš„æ ¸å¿ƒå­é¡¹ç›®ï¼ˆæœ€æ—©åœ¨Jakarta Commonsé‡Œå°±æœ‰ï¼‰,åœ¨Apacheçš„ç”Ÿæ€åœˆä¸­çš„å½±å“é‡Œååˆ†å¹¿æ³›ï¼Œæ¯”å¦‚æœ€ä¸ºå¤§å®¶æ‰€ç†ŸçŸ¥çš„Tomcatå°±åœ¨å†…éƒ¨é›†æˆäº†DBCPï¼Œå®ç°JPAè§„èŒƒçš„OpenJPAï¼Œä¹Ÿæ˜¯é»˜è®¤é›†æˆDBCPçš„ã€‚ä½†DBCPå¹¶ä¸æ˜¯ç‹¬ç«‹å®ç°è¿æ¥æ± åŠŸèƒ½çš„ï¼Œå®ƒå†…éƒ¨ä¾èµ–äºCommonsä¸­çš„å¦ä¸€ä¸ªå­é¡¹ç›®Poolï¼Œè¿æ¥æ± æœ€æ ¸å¿ƒçš„â€œæ± â€ï¼Œå°±æ˜¯ç”±Poolç»„ä»¶æä¾›çš„ï¼Œå› æ­¤ï¼ŒDBCPçš„æ€§èƒ½å®é™…ä¸Šå°±æ˜¯Poolçš„æ€§èƒ½ï¼ŒDBCPå’ŒPoolçš„ä¾èµ–å…³ç³»å¦‚ä¸‹è¡¨ï¼š Apache Commons DBCP Apache Commons Pool v1.2.2 v1.3 v1.3 v1.5.4 v1.4 v1.5.4 v2.0.x v2.2 v2.1.x v2.4.2 v2.2.x v2.5.0 å¯ä»¥çœ‹åˆ°ï¼Œå› ä¸ºæ ¸å¿ƒåŠŸèƒ½ä¾èµ–äºPoolï¼Œæ‰€ä»¥DBCPæœ¬èº«åªèƒ½åšå°ç‰ˆæœ¬çš„æ›´æ–°ï¼ŒçœŸæ­£å¤§ç‰ˆæœ¬çš„æ›´è¿­åˆ™å®Œå…¨ä¾æ‰˜äºpoolã€‚æœ‰å¾ˆé•¿ä¸€æ®µæ—¶é—´ï¼Œpooléƒ½è¿˜æ˜¯åœç•™åœ¨1.xç‰ˆæœ¬ï¼Œè¿™ç›´æ¥å¯¼è‡´DBCPä¹Ÿæ›´æ–°ä¹åŠ›ã€‚å¾ˆå¤šä¾èµ–DBCPçš„åº”ç”¨åœ¨é‡åˆ°æ€§èƒ½ç“¶é¢ˆä¹‹åï¼Œåˆ«æ— é€‰æ‹©ï¼Œåªèƒ½å°†å…¶æ›¿æ¢æ‰ï¼ŒDBCPå¿ å®çš„æ‹¥è¶¸tomcatå°±åœ¨å…¶tomcat 7.0ç‰ˆæœ¬ä¸­ï¼Œè‡ªå·±é‡æ–°è®¾è®¡å¼€å‘å‡ºäº†ä¸€å¥—è¿æ¥æ± ï¼ˆTomcat JDBC Poolï¼‰ã€‚å¥½åœ¨ï¼Œåœ¨2013å¹´äº‹æƒ…ç»ˆäºè¿æ¥è½¬æœºï¼Œ13å¹´9æœˆCommons-Pool 2.0ç‰ˆæœ¬å‘å¸ƒï¼Œ14å¹´2æœˆä»½ï¼ŒDBCPä¹Ÿç»ˆäºè¿æ¥äº†è‡ªå·±çš„2.0ç‰ˆæœ¬ï¼ŒåŸºäºæ–°çš„çº¿ç¨‹æ¨¡å‹å…¨æ–°è®¾è®¡çš„â€œæ± â€è®©DBCPé‡ç„•é’æ˜¥ï¼Œè™½ç„¶å’Œæ–°ä¸€ä»£çš„è¿æ¥æ± ç›¸æ¯”ä»æœ‰ä¸€å®šå·®è·ï¼Œä½†å·®è·å¹¶ä¸å¤§ï¼ŒDBCP2.xç‰ˆæœ¬å·²ç»ç¨³ç¨³è¾¾åˆ°äº†å’Œæ–°ä¸€ä»£äº§å“åŒçº§åˆ«çš„æ€§èƒ½æŒ‡æ ‡ï¼ˆè§ä¸‹å›¾ï¼‰ã€‚ DBCPç»ˆäºé Poolå’¸é±¼ç¿»èº«ï¼Œæ‰“äº†ä¸€ä¸ªæ¼‚äº®çš„ç¿»èº«ä»—ï¼Œä½†é•¿æ—¶é—´çš„ç­‰å¾…å·²ç»å®Œå…¨æ¶ˆç£¨äº†ç”¨æˆ·çš„è€å¿ƒï¼Œä¸æ–°ä¸€ä»£çš„äº§å“é¡¹ç›®ç›¸æ¯”ï¼ŒDBCPæ²¡æœ‰ä»»ä½•ä¼˜åŠ¿ï¼Œè¯•é—®ï¼Œè°ä¼šåœ¨æœ‰é€‰æ‹©çš„å‰æä¸‹ï¼Œå»é€‰æ‹©é‚£ä¸ªå¹¶ä¸ä¼˜ç§€çš„å‘¢ï¼Ÿä¹Ÿè®¸ï¼Œç°åœ¨è¿˜é€‰æ‹©DBCP2çš„å”¯ä¸€ç†ç”±ï¼Œå°±æ˜¯æƒ…æ€€å§ã€‚ æ€§èƒ½æ— æ•Œçš„HikariCPHikariCPå·ç§°â€œæ€§èƒ½æ€æ‰‹â€ï¼ˆItâ€™s Fasterï¼‰ï¼Œå®ƒçš„è¡¨ç°ç©¶ç«Ÿå¦‚ä½•å‘¢ï¼Œå…ˆæ¥çœ‹ä¸‹å®˜ç½‘æä¾›çš„æ•°æ®ï¼š ä¸å…‰æ€§èƒ½å¼ºåŠ²ï¼Œç¨³å®šæ€§ä¹Ÿä¸å·®ï¼š é‚£å®ƒæ˜¯æ€ä¹ˆåšåˆ°å¦‚æ­¤å¼ºåŠ²çš„å‘¢ï¼Ÿå®˜ç½‘ç»™å‡ºçš„è¯´æ˜å¦‚ä¸‹ï¼š å­—èŠ‚ç ç²¾ç®€ï¼šä¼˜åŒ–ä»£ç ï¼Œç›´åˆ°ç¼–è¯‘åçš„å­—èŠ‚ç æœ€å°‘ï¼Œè¿™æ ·ï¼ŒCPUç¼“å­˜å¯ä»¥åŠ è½½æ›´å¤šçš„ç¨‹åºä»£ç ï¼› ä¼˜åŒ–ä»£ç†å’Œæ‹¦æˆªå™¨ï¼šå‡å°‘ä»£ç ï¼Œä¾‹å¦‚HikariCPçš„Statement proxyåªæœ‰100è¡Œä»£ç ï¼› è‡ªå®šä¹‰æ•°ç»„ç±»å‹ï¼ˆFastStatementListï¼‰ä»£æ›¿ArrayListï¼šé¿å…æ¯æ¬¡get()è°ƒç”¨éƒ½è¦è¿›è¡Œrange checkï¼Œé¿å…è°ƒç”¨remove()æ—¶çš„ä»å¤´åˆ°å°¾çš„æ‰«æï¼› è‡ªå®šä¹‰é›†åˆç±»å‹ï¼ˆConcurrentBagï¼‰ï¼šæé«˜å¹¶å‘è¯»å†™çš„æ•ˆç‡ï¼› å…¶ä»–ç¼ºé™·çš„ä¼˜åŒ–ï¼Œæ¯”å¦‚å¯¹äºè€—æ—¶è¶…è¿‡ä¸€ä¸ªCPUæ—¶é—´ç‰‡çš„æ–¹æ³•è°ƒç”¨çš„ç ”ç©¶ï¼ˆä½†æ²¡è¯´å…·ä½“æ€ä¹ˆä¼˜åŒ–ï¼‰ã€‚ å¯ä»¥çœ‹åˆ°ï¼Œä¸Šè¿°è¿™å‡ ç‚¹ä¼˜åŒ–ï¼Œå’Œç°åœ¨èƒ½æ‰¾åˆ°çš„èµ„æ–™æ¥çœ‹ï¼ŒHakariCPåœ¨æ€§èƒ½ä¸Šçš„ä¼˜åŠ¿åº”è¯¥æ˜¯å¾—åˆ°å…±è¯†çš„ï¼Œå†åŠ ä¸Šå®ƒè‡ªèº«å°å·§çš„èº«å½¢ï¼Œåœ¨å½“å‰çš„â€œäº‘æ—¶ä»£ã€å¾®æœåŠ¡â€çš„èƒŒæ™¯ä¸‹ï¼ŒHakariCPä¸€å®šä¼šå¾—åˆ°æ›´å¤šäººçš„é’çã€‚ åŠŸèƒ½å…¨é¢çš„Druidè¿‘å‡ å¹´ï¼Œé˜¿é‡Œåœ¨å¼€æºé¡¹ç›®ä¸ŠåŠ¨ä½œé¢‘é¢‘ï¼Œé™¤äº†æœ‰åƒfastJsonã€dubboè¿™ç±»é¡¹ç›®ï¼Œæ›´æœ‰åƒAliSQLè¿™ç±»çš„å¤§å‹è½¯ä»¶ï¼Œä»Šå¤©è¯´çš„Druidï¼Œå°±æ˜¯é˜¿é‡Œä¼—å¤šä¼˜ç§€å¼€æºé¡¹ç›®ä¸­çš„ä¸€ä¸ªã€‚å®ƒé™¤äº†æä¾›æ€§èƒ½å“è¶Šçš„è¿æ¥æ± åŠŸèƒ½å¤–ï¼Œè¿˜é›†æˆäº†SQLç›‘æ§ï¼Œé»‘åå•æ‹¦æˆªç­‰åŠŸèƒ½ï¼Œç”¨å®ƒè‡ªå·±çš„è¯è¯´ï¼ŒDruidæ˜¯â€œä¸ºç›‘æ§è€Œç”Ÿâ€ã€‚å€ŸåŠ©äºé˜¿é‡Œè¿™ä¸ªå¹³å°çš„å·å¬åŠ›ï¼Œäº§å“ä¸€ç»å‘å¸ƒå°±èµ¢å¾—äº†å¤§æ‰¹ç”¨æˆ·çš„æ‹¥è¶¸ï¼Œä»ç”¨æˆ·ä½¿ç”¨çš„åé¦ˆæ¥çœ‹ï¼ŒDruidä¹Ÿç¡®å®æ²¡è®©ç”¨æˆ·å¤±æœ›ã€‚ ç›¸è¾ƒäºå…¶ä»–äº§å“ï¼ŒDruidå¦ä¸€ä¸ªæ¯”è¾ƒå¤§çš„ä¼˜åŠ¿ï¼Œå°±æ˜¯ä¸­æ–‡æ–‡æ¡£æ¯”è¾ƒå…¨é¢ï¼ˆæ¯•ç«Ÿæ˜¯å›½äººçš„é¡¹ç›®ä¹ˆï¼‰ï¼Œåœ¨githubçš„wikié¡µé¢ï¼Œåˆ—ä¸¾äº†æ—¥å¸¸ä½¿ç”¨ä¸­å¯èƒ½é‡åˆ°çš„é—®é¢˜ï¼Œå¯¹ä¸€ä¸ªæ–°ç”¨æˆ·æ¥è®²ï¼Œä¸Šé¢æä¾›çš„å†…å®¹å·²ç»è¶³å¤ŸæŒ‡å¯¼å®ƒå®Œæˆäº§å“çš„é…ç½®å’Œä½¿ç”¨äº†ã€‚ ä¸‹å›¾ä¸ºDruidè‡ªå·±æä¾›çš„æ€§èƒ½æµ‹è¯•æ•°æ®ï¼š ç°åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘è¿˜æ˜¯æ¯”è¾ƒå€¾å‘äºä½¿ç”¨Duridï¼Œå®ƒä¸ä»…ä»…æ˜¯ä¸€ä¸ªæ•°æ®åº“è¿æ¥æ± ï¼Œå®ƒè¿˜åŒ…å«ä¸€ä¸ªProxyDriverï¼Œä¸€ç³»åˆ—å†…ç½®çš„JDBCç»„ä»¶åº“ï¼Œä¸€ä¸ªSQL Parserã€‚ Druid ç›¸å¯¹äºå…¶ä»–æ•°æ®åº“è¿æ¥æ± çš„ä¼˜ç‚¹ å¼ºå¤§çš„ç›‘æ§ç‰¹æ€§ï¼Œé€šè¿‡Druidæä¾›çš„ç›‘æ§åŠŸèƒ½ï¼Œå¯ä»¥æ¸…æ¥šçŸ¥é“è¿æ¥æ± å’ŒSQLçš„å·¥ä½œæƒ…å†µã€‚ a. ç›‘æ§SQLçš„æ‰§è¡Œæ—¶é—´ã€ResultSetæŒæœ‰æ—¶é—´ã€è¿”å›è¡Œæ•°ã€æ›´æ–°è¡Œæ•°ã€é”™è¯¯æ¬¡æ•°ã€é”™è¯¯å †æ ˆä¿¡æ¯ï¼› b. SQLæ‰§è¡Œçš„è€—æ—¶åŒºé—´åˆ†å¸ƒã€‚ä»€ä¹ˆæ˜¯è€—æ—¶åŒºé—´åˆ†å¸ƒå‘¢ï¼Ÿæ¯”å¦‚è¯´ï¼ŒæŸä¸ªSQLæ‰§è¡Œäº†1000æ¬¡ï¼Œå…¶ä¸­0~1æ¯«ç§’åŒºé—´50æ¬¡ï¼Œ1~10æ¯«ç§’800æ¬¡ï¼Œ10~100æ¯«ç§’100æ¬¡ï¼Œ100~1000æ¯«ç§’30æ¬¡ï¼Œ1~10ç§’15æ¬¡ï¼Œ10ç§’ä»¥ä¸Š5æ¬¡ã€‚é€šè¿‡è€—æ—¶åŒºé—´åˆ†å¸ƒï¼Œèƒ½å¤Ÿéå¸¸æ¸…æ¥šçŸ¥é“SQLçš„æ‰§è¡Œè€—æ—¶æƒ…å†µï¼› c. ç›‘æ§è¿æ¥æ± çš„ç‰©ç†è¿æ¥åˆ›å»ºå’Œé”€æ¯æ¬¡æ•°ã€é€»è¾‘è¿æ¥çš„ç”³è¯·å’Œå…³é—­æ¬¡æ•°ã€éç©ºç­‰å¾…æ¬¡æ•°ã€PSCacheå‘½ä¸­ç‡ç­‰ã€‚ æ–¹ä¾¿æ‰©å±•ã€‚Druidæä¾›äº†Filter-Chainæ¨¡å¼çš„æ‰©å±•APIï¼Œå¯ä»¥è‡ªå·±ç¼–å†™Filteræ‹¦æˆªJDBCä¸­çš„ä»»ä½•æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä¸Šé¢åšä»»ä½•äº‹æƒ…ï¼Œæ¯”å¦‚è¯´æ€§èƒ½ç›‘æ§ã€SQLå®¡è®¡ã€ç”¨æˆ·åå¯†ç åŠ å¯†ã€æ—¥å¿—ç­‰ç­‰ã€‚ Druidé›†åˆäº†å¼€æºå’Œå•†ä¸šæ•°æ®åº“è¿æ¥æ± çš„ä¼˜ç§€ç‰¹æ€§ï¼Œå¹¶ç»“åˆé˜¿é‡Œå·´å·´å¤§è§„æ¨¡è‹›åˆ»ç”Ÿäº§ç¯å¢ƒçš„ä½¿ç”¨ç»éªŒè¿›è¡Œä¼˜åŒ–ã€‚ æ€»ç»“æ—¶è‡³ä»Šæ—¥ï¼Œè™½ç„¶æ¯ä¸ªåº”ç”¨ï¼ˆéœ€è¦RDBMSçš„ï¼‰éƒ½ç¦»ä¸å¼€è¿æ¥æ± ï¼Œä½†åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œè¿æ¥æ± å·²ç»å¯ä»¥åšåˆ°â€œéšå½¢â€äº†ã€‚ä¹Ÿå°±æ˜¯è¯´åœ¨é€šå¸¸æƒ…å†µä¸‹ï¼Œè¿æ¥æ± å®Œæˆé¡¹ç›®åˆå§‹åŒ–é…ç½®ä¹‹åï¼Œå°±å†ä¸éœ€è¦å†åšä»»ä½•æ”¹åŠ¨äº†ã€‚ä¸è®ºä½ æ˜¯é€‰æ‹©Druidæˆ–æ˜¯HikariCPï¼Œç”šè‡³æ˜¯DBCPï¼Œå®ƒä»¬éƒ½è¶³å¤Ÿç¨³å®šä¸”é«˜æ•ˆï¼ä¹‹å‰è®¨è®ºäº†å¾ˆå¤šå…³äºè¿æ¥æ± çš„æ€§èƒ½çš„é—®é¢˜ï¼Œä½†è¿™äº›æ€§èƒ½ä¸Šçš„å·®å¼‚ï¼Œæ˜¯ç›¸è¾ƒäºå…¶ä»–è¿æ¥æ± è€Œè¨€çš„ï¼Œå¯¹æ•´ä¸ªç³»ç»Ÿåº”ç”¨æ¥è¯´ï¼Œç¬¬äºŒä»£è¿æ¥æ± åœ¨ä½¿ç”¨è¿‡ç¨‹ä¸­ä½“ä¼šåˆ°çš„å·®åˆ«æ˜¯å¾®ä¹å…¶å¾®çš„ï¼ŒåŸºæœ¬ä¸Šä¸å­˜åœ¨å› ä¸ºè¿æ¥æ± çš„è‡ªèº«çš„é…é¥°å’Œä½¿ç”¨å¯¼è‡´ç³»ç»Ÿæ€§èƒ½ä¸‹é™çš„æƒ…å†µï¼Œé™¤éæ˜¯åœ¨å•ç‚¹åº”ç”¨çš„æ•°æ®åº“è´Ÿè½½è¶³å¤Ÿé«˜çš„æ—¶å€™ï¼ˆå‹åŠ›æµ‹è¯•çš„æ—¶å€™ï¼‰ï¼Œä½†å³ä¾¿æ˜¯å¦‚æ­¤ï¼Œé€šç”¨çš„ä¼˜åŒ–çš„æ–¹å¼ä¹Ÿæ˜¯å•ç‚¹æ”¹é›†ç¾¤ï¼Œè€Œä¸æ˜¯åœ¨å•ç‚¹çš„è¿æ¥æ± ä¸Šæ­»æ‰£ã€‚ å‚è€ƒ æ•°æ®åº“è¿æ¥æ± æ€§èƒ½æ¯”å¯¹ å¤§è¯æ•°æ®åº“è¿æ¥æ±  c3p0,Druid,Tomcat Jdbc Pool,dbcp2,proxoolæ•°æ®æºæ€§èƒ½æ¯”è¾ƒ","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"tool","slug":"tool","permalink":"https://sunny0715.github.io/tags/tool/"}]},{"title":"Nginxé…ç½®æ–‡ä»¶è¯¦è§£","slug":"Nginxé…ç½®æ–‡ä»¶è¯¦è§£","date":"2018-01-24T06:12:52.000Z","updated":"2018-03-13T05:48:20.900Z","comments":true,"path":"2018/01/24/Nginxé…ç½®æ–‡ä»¶è¯¦è§£/","link":"","permalink":"https://sunny0715.github.io/2018/01/24/Nginxé…ç½®æ–‡ä»¶è¯¦è§£/","excerpt":"å¼•è¨€ä¹‹å‰ä»‹ç»äº†Linuxä¸‹å®‰è£…Nginxï¼ŒNginx ä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–è€Œå¼€å‘ï¼Œæ€§èƒ½æ˜¯å…¶æœ€é‡è¦çš„è€ƒé‡,å®ç°ä¸Šéå¸¸æ³¨é‡æ•ˆç‡ ã€‚å®ƒæ”¯æŒå†…æ ¸ Poll æ¨¡å‹ï¼Œèƒ½ç»å—é«˜è´Ÿè½½çš„è€ƒéªŒ,æœ‰æŠ¥å‘Šè¡¨æ˜èƒ½æ”¯æŒé«˜è¾¾ 50,000 ä¸ªå¹¶å‘è¿æ¥æ•°ã€‚","text":"å¼•è¨€ä¹‹å‰ä»‹ç»äº†Linuxä¸‹å®‰è£…Nginxï¼ŒNginx ä¸“ä¸ºæ€§èƒ½ä¼˜åŒ–è€Œå¼€å‘ï¼Œæ€§èƒ½æ˜¯å…¶æœ€é‡è¦çš„è€ƒé‡,å®ç°ä¸Šéå¸¸æ³¨é‡æ•ˆç‡ ã€‚å®ƒæ”¯æŒå†…æ ¸ Poll æ¨¡å‹ï¼Œèƒ½ç»å—é«˜è´Ÿè½½çš„è€ƒéªŒ,æœ‰æŠ¥å‘Šè¡¨æ˜èƒ½æ”¯æŒé«˜è¾¾ 50,000 ä¸ªå¹¶å‘è¿æ¥æ•°ã€‚ Nginxç‰¹ç‚¹Nginx å…·æœ‰å¾ˆé«˜çš„ç¨³å®šæ€§ã€‚å…¶å®ƒ HTTP æœåŠ¡å™¨ï¼Œå½“é‡åˆ°è®¿é—®çš„å³°å€¼ï¼Œæˆ–è€…æœ‰äººæ¶æ„å‘èµ·æ…¢é€Ÿè¿æ¥æ—¶ï¼Œä¹Ÿå¾ˆå¯èƒ½ä¼šå¯¼è‡´æœåŠ¡å™¨ç‰©ç†å†…å­˜è€—å°½é¢‘ç¹äº¤æ¢ï¼Œå¤±å»å“åº”ï¼Œåªèƒ½é‡å¯æœåŠ¡å™¨ã€‚ä¾‹å¦‚å½“å‰ apache ä¸€æ—¦ä¸Šåˆ° 200 ä¸ªä»¥ä¸Šè¿›ç¨‹ï¼Œwebå“åº”é€Ÿåº¦å°±æ˜æ˜¾éå¸¸ç¼“æ…¢äº†ã€‚è€Œ Nginx é‡‡å–äº†åˆ†é˜¶æ®µèµ„æºåˆ†é…æŠ€æœ¯ï¼Œä½¿å¾—å®ƒçš„ CPU ä¸å†…å­˜å ç”¨ç‡éå¸¸ä½ã€‚Nginx å®˜æ–¹è¡¨ç¤ºä¿æŒ 10,000 ä¸ªæ²¡æœ‰æ´»åŠ¨çš„è¿æ¥ï¼Œå®ƒåªå  2.5M å†…å­˜ï¼Œæ‰€ä»¥ç±»ä¼¼ DOS è¿™æ ·çš„æ”»å‡»å¯¹ Nginx æ¥è¯´åŸºæœ¬ä¸Šæ˜¯æ¯«æ— ç”¨å¤„çš„ã€‚å°±ç¨³å®šæ€§è€Œè¨€,Nginx æ¯” lighthttpd æ›´èƒœä¸€ç­¹ã€‚ Nginx æ”¯æŒçƒ­éƒ¨ç½²ã€‚å®ƒçš„å¯åŠ¨ç‰¹åˆ«å®¹æ˜“, å¹¶ä¸”å‡ ä¹å¯ä»¥åšåˆ° 7*24 ä¸é—´æ–­è¿è¡Œï¼Œå³ä½¿è¿è¡Œæ•°ä¸ªæœˆä¹Ÿä¸éœ€è¦é‡æ–°å¯åŠ¨ã€‚ä½ è¿˜èƒ½å¤Ÿåœ¨ä¸é—´æ–­æœåŠ¡çš„æƒ…å†µä¸‹ï¼Œå¯¹è½¯ä»¶ç‰ˆæœ¬è¿›è¡Œè¿›è¡Œå‡çº§ã€‚ Nginxçš„ç”¨å¤„è¯´äº†è¿™ä¹ˆå¤šNginxçš„ä¼˜ç‚¹ï¼ŒNginxåœ¨å¼€å‘ä¸­æœ€å¸¸ç”¨ä½œåå‘ä»£ç†æœåŠ¡å™¨ï¼Œä½†æ˜¯Nginxçš„ç”¨å¤„å¯ä¸æ­¢è¿™ä¸€ç‚¹ã€‚ Nginxé…ç½®è™šæ‹Ÿä¸»æœºè™šæ‹Ÿä¸»æœºæ˜¯ä¸€ç§ç‰¹æ®Šçš„è½¯ç¡¬ä»¶æŠ€æœ¯ï¼Œå®ƒå¯ä»¥å°†ç½‘ç»œä¸Šçš„æ¯ä¸€å°è®¡ç®—æœºåˆ†æˆå¤šä¸ªè™šæ‹Ÿä¸»æœºï¼Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºå¯ä»¥ç‹¬ç«‹å¯¹å¤–æä¾›wwwæœåŠ¡ï¼Œè¿™æ ·å°±å¯ä»¥å®ç°ä¸€å°ä¸»æœºå¯¹å¤–æä¾›å¤šä¸ªwebæœåŠ¡ï¼Œæ¯ä¸ªè™šæ‹Ÿä¸»æœºä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œäº’ä¸å½±å“çš„ã€‚ 1ã€ åŸºäºipçš„è™šæ‹Ÿä¸»æœº 2ã€åŸºäºç«¯å£çš„è™šæ‹Ÿä¸»æœº 3ã€åŸºäºåŸŸåçš„è™šæ‹Ÿä¸»æœº Nginxåå‘ä»£ç†é€šå¸¸çš„ä»£ç†æœåŠ¡å™¨ï¼Œåªç”¨äºä»£ç†å†…éƒ¨ç½‘ç»œå¯¹Internetçš„è¿æ¥è¯·æ±‚ï¼Œå®¢æˆ·æœºå¿…é¡»æŒ‡å®šä»£ç†æœåŠ¡å™¨,å¹¶å°†æœ¬æ¥è¦ç›´æ¥å‘é€åˆ°WebæœåŠ¡å™¨ä¸Šçš„httpè¯·æ±‚å‘é€åˆ°ä»£ç†æœåŠ¡å™¨ä¸­ç”±ä»£ç†æœåŠ¡å™¨å‘Internetä¸Šçš„webæœåŠ¡å™¨å‘èµ·è¯·æ±‚ï¼Œæœ€ç»ˆè¾¾åˆ°å®¢æˆ·æœºä¸Šç½‘çš„ç›®çš„ã€‚ â€‹ è€Œåå‘ä»£ç†ï¼ˆReverse Proxyï¼‰æ–¹å¼æ˜¯æŒ‡ä»¥ä»£ç†æœåŠ¡å™¨æ¥æ¥å—internetä¸Šçš„è¿æ¥è¯·æ±‚ï¼Œç„¶åå°†è¯·æ±‚è½¬å‘ç»™å†…éƒ¨ç½‘ç»œä¸Šçš„æœåŠ¡å™¨ï¼Œå¹¶å°†ä»æœåŠ¡å™¨ä¸Šå¾—åˆ°çš„ç»“æœè¿”å›ç»™internetä¸Šè¯·æ±‚è¿æ¥çš„å®¢æˆ·ç«¯ï¼Œæ­¤æ—¶ä»£ç†æœåŠ¡å™¨å¯¹å¤–å°±è¡¨ç°ä¸ºä¸€ä¸ªåå‘ä»£ç†æœåŠ¡å™¨ã€‚ Nginxé…ç½®è¯¦è§£123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265#ç”¨æˆ·user nginx ;#å·¥ä½œè¿›ç¨‹ï¼Œæ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œå¤§äºç­‰äºcpuæ ¸æ•°worker_processes 8;#é”™è¯¯æ—¥å¿—error_log logs/nginx_error.log crit;#pidæ”¾ç½®çš„ä½ç½®pid logs/nginx.pid;#æŒ‡å®šè¿›ç¨‹å¯ä»¥æ‰“å¼€çš„æœ€å¤§æè¿°ç¬¦worker_rlimit_nofile 204800;è¿™ä¸ªæŒ‡ä»¤æ˜¯æŒ‡å½“ä¸€ä¸ªnginxè¿›ç¨‹æ‰“å¼€çš„æœ€å¤šæ–‡ä»¶æè¿°ç¬¦æ•°ç›®ï¼Œç†è®ºå€¼åº”è¯¥æ˜¯æœ€å¤šæ‰“å¼€æ–‡ä»¶æ•°ï¼ˆulimit -nï¼‰ä¸nginxè¿›ç¨‹æ•°ç›¸é™¤ï¼Œä½†æ˜¯nginxåˆ†é…è¯·æ±‚å¹¶ä¸æ˜¯é‚£ä¹ˆå‡åŒ€ï¼Œæ‰€ä»¥æœ€å¥½ä¸ulimit -n çš„å€¼ä¿æŒä¸€è‡´ã€‚ç°åœ¨åœ¨linux 2.6å†…æ ¸ä¸‹å¼€å¯æ–‡ä»¶æ‰“å¼€æ•°ä¸º65535ï¼Œworker_rlimit_nofileå°±ç›¸åº”åº”è¯¥å¡«å†™65535ã€‚è¿™æ˜¯å› ä¸ºnginxè°ƒåº¦æ—¶åˆ†é…è¯·æ±‚åˆ°è¿›ç¨‹å¹¶ä¸æ˜¯é‚£ä¹ˆçš„å‡è¡¡ï¼Œæ‰€ä»¥å‡å¦‚å¡«å†™10240ï¼Œæ€»å¹¶å‘é‡è¾¾åˆ°3-4ä¸‡æ—¶å°±æœ‰è¿›ç¨‹å¯èƒ½è¶…è¿‡10240äº†ï¼Œè¿™æ—¶ä¼šè¿”å›502é”™è¯¯ã€‚events&#123; #ä½¿ç”¨epollçš„I/O æ¨¡å‹ use epoll; è¡¥å……è¯´æ˜: ä¸apacheç›¸ç±»ï¼Œnginxé’ˆå¯¹ä¸åŒçš„æ“ä½œç³»ç»Ÿï¼Œæœ‰ä¸åŒçš„äº‹ä»¶æ¨¡å‹ Aï¼‰æ ‡å‡†äº‹ä»¶æ¨¡å‹ Selectã€pollå±äºæ ‡å‡†äº‹ä»¶æ¨¡å‹ï¼Œå¦‚æœå½“å‰ç³»ç»Ÿä¸å­˜åœ¨æ›´æœ‰æ•ˆçš„æ–¹æ³•ï¼Œnginxä¼šé€‰æ‹©selectæˆ–poll Bï¼‰é«˜æ•ˆäº‹ä»¶æ¨¡å‹ Kqueueï¼šä½¿ç”¨äºFreeBSD 4.1+, OpenBSD 2.9+, NetBSD 2.0 å’Œ MacOS X.ä½¿ç”¨åŒå¤„ç†å™¨çš„MacOS Xç³»ç»Ÿä½¿ç”¨kqueueå¯èƒ½ä¼šé€ æˆå†…æ ¸å´©æºƒã€‚ Epoll:ä½¿ç”¨äºLinuxå†…æ ¸2.6ç‰ˆæœ¬åŠä»¥åçš„ç³»ç»Ÿã€‚ /dev/pollï¼šä½¿ç”¨äºSolaris 7 11/99+, HP/UX 11.22+ (eventport), IRIX 6.5.15+ å’Œ Tru64 UNIX 5.1A+ã€‚ Eventportï¼šä½¿ç”¨äºSolaris 10. ä¸ºäº†é˜²æ­¢å‡ºç°å†…æ ¸å´©æºƒçš„é—®é¢˜ï¼Œ æœ‰å¿…è¦å®‰è£…å®‰å…¨è¡¥ä¸ #å·¥ä½œè¿›ç¨‹çš„æœ€å¤§è¿æ¥æ•°é‡ï¼Œæ ¹æ®ç¡¬ä»¶è°ƒæ•´ï¼Œå’Œå‰é¢å·¥ä½œè¿›ç¨‹é…åˆèµ·æ¥ç”¨ï¼Œå°½é‡å¤§ï¼Œä½†æ˜¯åˆ«æŠŠcpuè·‘åˆ°100%å°±è¡Œ worker_connections 204800; æ¯ä¸ªè¿›ç¨‹å…è®¸çš„æœ€å¤šè¿æ¥æ•°ï¼Œ ç†è®ºä¸Šæ¯å°nginxæœåŠ¡å™¨çš„æœ€å¤§è¿æ¥æ•°ä¸ºworker_processes*worker_connections #keepaliveè¶…æ—¶æ—¶é—´ã€‚ keepalive_timeout 60; #è¿™ä¸ªå°†ä¸ºæ‰“å¼€æ–‡ä»¶æŒ‡å®šç¼“å­˜ï¼Œé»˜è®¤æ˜¯æ²¡æœ‰å¯ç”¨çš„ï¼ŒmaxæŒ‡å®šç¼“å­˜æ•°é‡ï¼Œå»ºè®®å’Œæ‰“å¼€æ–‡ä»¶æ•°ä¸€è‡´ï¼Œinactiveæ˜¯æŒ‡ç»è¿‡å¤šé•¿æ—¶é—´æ–‡ä»¶æ²¡è¢«è¯·æ±‚ååˆ é™¤ç¼“å­˜ã€‚ open_file_cache max=65535 inactive=60s; #è¿™ä¸ªæ˜¯æŒ‡å¤šé•¿æ—¶é—´æ£€æŸ¥ä¸€æ¬¡ç¼“å­˜çš„æœ‰æ•ˆä¿¡æ¯ã€‚ open_file_cache_valid 80s; #open_file_cacheæŒ‡ä»¤ä¸­çš„inactiveå‚æ•°æ—¶é—´å†…æ–‡ä»¶çš„æœ€å°‘ä½¿ç”¨æ¬¡æ•°ï¼Œå¦‚æœè¶…è¿‡è¿™ä¸ªæ•°å­—ï¼Œæ–‡ä»¶æè¿°ç¬¦ä¸€ç›´æ˜¯åœ¨ç¼“å­˜ä¸­æ‰“å¼€çš„ï¼Œå¦‚ä¸Šä¾‹ï¼Œå¦‚æœæœ‰ä¸€ä¸ªæ–‡ä»¶åœ¨inactiveæ—¶é—´å†…ä¸€æ¬¡æ²¡è¢«ä½¿ç”¨ï¼Œå®ƒå°†è¢«ç§»é™¤ã€‚ open_file_cache_min_uses 1;&#125;#è®¾å®šhttpæœåŠ¡å™¨ï¼Œåˆ©ç”¨å®ƒçš„åå‘ä»£ç†åŠŸèƒ½æä¾›è´Ÿè½½å‡è¡¡æ”¯æŒhttp&#123; #è®¾å®šmimeç±»å‹,ç±»å‹ç”±mime.typeæ–‡ä»¶å®šä¹‰ include mime.types; default_type application/octet-stream; log_format main '$host $status [$time_local] $remote_addr [$time_local] $request_uri ''\"$http_referer\" \"$http_user_agent\" \"$http_x_forwarded_for\" ''$bytes_sent $request_time $sent_http_x_cache_hit';log_format log404 '$status [$time_local] $remote_addr $host$request_uri $sent_http_location';$remote_addrä¸$http_x_forwarded_forç”¨ä»¥è®°å½•å®¢æˆ·ç«¯çš„ipåœ°å€ï¼›$remote_userï¼šç”¨æ¥è®°å½•å®¢æˆ·ç«¯ç”¨æˆ·åç§°ï¼›$time_localï¼š ç”¨æ¥è®°å½•è®¿é—®æ—¶é—´ä¸æ—¶åŒºï¼›$requestï¼š ç”¨æ¥è®°å½•è¯·æ±‚çš„urlä¸httpåè®®ï¼›$statusï¼š ç”¨æ¥è®°å½•è¯·æ±‚çŠ¶æ€ï¼›æˆåŠŸæ˜¯200ï¼Œ$body_bytes_s ent ï¼šè®°å½•å‘é€ç»™å®¢æˆ·ç«¯æ–‡ä»¶ä¸»ä½“å†…å®¹å¤§å°ï¼›$http_refererï¼šç”¨æ¥è®°å½•ä»é‚£ä¸ªé¡µé¢é“¾æ¥è®¿é—®è¿‡æ¥çš„ï¼›$http_user_agentï¼šè®°å½•å®¢æˆ·æ¯’å•Šæµè§ˆå™¨çš„ç›¸å…³ä¿¡æ¯ï¼›é€šå¸¸webæœåŠ¡å™¨æ”¾åœ¨åå‘ä»£ç†çš„åé¢ï¼Œè¿™æ ·å°±ä¸èƒ½è·å–åˆ°å®¢æˆ·çš„IPåœ°å€äº†ï¼Œé€šè¿‡$remote_addæ‹¿åˆ°çš„IPåœ°å€æ˜¯åå‘ä»£ç†æœåŠ¡å™¨çš„iPåœ°å€ã€‚åå‘ä»£ç†æœåŠ¡å™¨åœ¨è½¬å‘è¯·æ±‚çš„httpå¤´ä¿¡æ¯ä¸­ï¼Œå¯ä»¥å¢åŠ x_forwarded_forä¿¡æ¯ï¼Œç”¨ä»¥è®°å½•åŸæœ‰å®¢æˆ·ç«¯çš„IPåœ°å€å’ŒåŸæ¥å®¢æˆ·ç«¯çš„è¯·æ±‚çš„æœåŠ¡å™¨åœ°å€ï¼› #ç”¨äº†log_formatæŒ‡ä»¤è®¾ç½®äº†æ—¥å¿—æ ¼å¼ä¹‹åï¼Œéœ€è¦ç”¨access_logæŒ‡ä»¤æŒ‡å®šæ—¥å¿—æ–‡ä»¶çš„å­˜æ”¾è·¯å¾„ï¼› # access_log /usr/local/nginx/logs/access_log main; access_log /dev/null; #ä¿å­˜æœåŠ¡å™¨åå­—çš„hashè¡¨æ˜¯ç”±æŒ‡ä»¤server_names_hash_max_size å’Œserver_names_hash_bucket_sizeæ‰€æ§åˆ¶çš„ã€‚å‚æ•°hash bucket sizeæ€»æ˜¯ç­‰äºhashè¡¨çš„å¤§å°ï¼Œå¹¶ä¸”æ˜¯ä¸€è·¯å¤„ç†å™¨ç¼“å­˜å¤§å°çš„å€æ•°ã€‚åœ¨å‡å°‘äº†åœ¨å†…å­˜ä¸­çš„å­˜å–æ¬¡æ•°åï¼Œä½¿åœ¨å¤„ç†å™¨ä¸­åŠ é€ŸæŸ¥æ‰¾hashè¡¨é”®å€¼æˆä¸ºå¯èƒ½ã€‚å¦‚æœhash bucket sizeç­‰äºä¸€è·¯å¤„ç†å™¨ç¼“å­˜çš„å¤§å°ï¼Œé‚£ä¹ˆåœ¨æŸ¥æ‰¾é”®çš„æ—¶å€™ï¼Œæœ€åçš„æƒ…å†µä¸‹åœ¨å†…å­˜ä¸­æŸ¥æ‰¾çš„æ¬¡æ•°ä¸º2ã€‚ç¬¬ä¸€æ¬¡æ˜¯ç¡®å®šå­˜å‚¨å•å…ƒçš„åœ°å€ï¼Œç¬¬äºŒæ¬¡æ˜¯åœ¨å­˜å‚¨å•å…ƒä¸­æŸ¥æ‰¾é”® å€¼ã€‚å› æ­¤ï¼Œå¦‚æœNginxç»™å‡ºéœ€è¦å¢å¤§hash max size æˆ– hash bucket sizeçš„æç¤ºï¼Œé‚£ä¹ˆé¦–è¦çš„æ˜¯å¢å¤§å‰ä¸€ä¸ªå‚æ•°çš„å¤§å°. server_names_hash_bucket_size 128; #å®¢æˆ·ç«¯è¯·æ±‚å¤´éƒ¨çš„ç¼“å†²åŒºå¤§å°ï¼Œè¿™ä¸ªå¯ä»¥æ ¹æ®ä½ çš„ç³»ç»Ÿåˆ†é¡µå¤§å°æ¥è®¾ç½®ï¼Œä¸€èˆ¬ä¸€ä¸ªè¯·æ±‚çš„å¤´éƒ¨å¤§å°ä¸ä¼šè¶…è¿‡1kï¼Œä¸è¿‡ç”±äºä¸€èˆ¬ç³»ç»Ÿåˆ†é¡µéƒ½è¦å¤§äº1kï¼Œæ‰€ä»¥è¿™é‡Œè®¾ç½®ä¸ºåˆ†é¡µå¤§å°ã€‚åˆ†é¡µå¤§å°å¯ä»¥ç”¨å‘½ä»¤getconf PAGESIZEå–å¾—ã€‚ client_header_buffer_size 128k; #å®¢æˆ·è¯·æ±‚å¤´ç¼“å†²å¤§å° n#ginxé»˜è®¤ä¼šç”¨client_header_buffer_sizeè¿™ä¸ªbufferæ¥è¯»å–headerå€¼ï¼Œå¦‚æœheaderè¿‡å¤§ï¼Œå®ƒä¼šä½¿ç”¨large_client_header_buffersæ¥è¯»å–å¦‚æœè®¾ç½®è¿‡å°HTTPå¤´/Cookieè¿‡å¤§ ä¼šæŠ¥400 é”™è¯¯nginx 400 bad requestæ±‚è¡Œå¦‚æœè¶…è¿‡bufferï¼Œå°±ä¼šæŠ¥HTTP 414é”™è¯¯(URI Too Long)nginxæ¥å—æœ€é•¿çš„HTTPå¤´éƒ¨å¤§å°å¿…é¡»æ¯”å…¶ä¸­ä¸€ä¸ªbufferå¤§ï¼Œå¦åˆ™å°±ä¼šæŠ¥400çš„ large_client_header_buffers 8 128k;HTTPé”™è¯¯(Bad Request)ã€‚#ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šç¼“å­˜æ˜¯å¦å¯ç”¨,å¦‚æœå¯ç”¨,å°†è®°å½•æ–‡ä»¶ä»¥ä¸‹ä¿¡æ¯: Â·æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦,å¤§å°ä¿¡æ¯å’Œä¿®æ”¹æ—¶é—´. Â·å­˜åœ¨çš„ç›®å½•ä¿¡æ¯. Â·åœ¨æœç´¢æ–‡ä»¶è¿‡ç¨‹ä¸­çš„é”™è¯¯ä¿¡æ¯ --æ²¡æœ‰è¿™ä¸ªæ–‡ä»¶,æ— æ³•æ­£ç¡®è¯»å–,å‚è€ƒopen_file_cache_errorsæŒ‡ä»¤é€‰é¡¹:Â·max -æŒ‡å®šç¼“å­˜çš„æœ€å¤§æ•°ç›®,å¦‚æœç¼“å­˜æº¢å‡º,æœ€é•¿ä½¿ç”¨è¿‡çš„æ–‡ä»¶(LRU)å°†è¢«ç§»é™¤#ä¾‹: open_file_cache max=1000 inactive=20s; open_file_cache_valid 30s; open_file_cache_min_uses 2; open_file_cache_errors on; open_file_cache max 102400 #è¯­æ³•:open_file_cache_errors on | off é»˜è®¤å€¼:open_file_cache_errors off ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šæ˜¯å¦åœ¨æœç´¢ä¸€ä¸ªæ–‡ä»¶æ˜¯è®°å½•cacheé”™è¯¯. open_file_cache_errors #è¯­æ³•:open_file_cache_min_uses number é»˜è®¤å€¼:open_file_cache_min_uses 1 ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†åœ¨open_file_cacheæŒ‡ä»¤æ— æ•ˆçš„å‚æ•°ä¸­ä¸€å®šçš„æ—¶é—´èŒƒå›´å†…å¯ä»¥ä½¿ç”¨çš„æœ€å°æ–‡ä»¶æ•°,å¦‚ æœä½¿ç”¨æ›´å¤§çš„å€¼,æ–‡ä»¶æè¿°ç¬¦åœ¨cacheä¸­æ€»æ˜¯æ‰“å¼€çŠ¶æ€. open_file_cache_min_uses #è¯­æ³•:open_file_cache_valid time é»˜è®¤å€¼:open_file_cache_valid 60 ä½¿ç”¨å­—æ®µ:http, server, location è¿™ä¸ªæŒ‡ä»¤æŒ‡å®šäº†ä½•æ—¶éœ€è¦æ£€æŸ¥open_file_cacheä¸­ç¼“å­˜é¡¹ç›®çš„æœ‰æ•ˆä¿¡æ¯. open_file_cache_valid #è®¾å®šé€šè¿‡nginxä¸Šä¼ æ–‡ä»¶çš„å¤§å° client_max_body_size 300m; #sendfileæŒ‡ä»¤æŒ‡å®š nginx æ˜¯å¦è°ƒç”¨sendfile å‡½æ•°ï¼ˆzero copy æ–¹å¼ï¼‰æ¥è¾“å‡ºæ–‡ä»¶ï¼Œ#å¯¹äºæ™®é€šåº”ç”¨ï¼Œå¿…é¡»è®¾ä¸ºonã€‚#å¦‚æœç”¨æ¥è¿›è¡Œä¸‹è½½ç­‰åº”ç”¨ç£ç›˜IOé‡è´Ÿè½½åº”ç”¨ï¼Œå¯è®¾ç½®ä¸ºoffï¼Œä»¥å¹³è¡¡ç£ç›˜ä¸ç½‘ç»œIOå¤„ç†é€Ÿåº¦ï¼Œé™ä½ç³»ç»Ÿuptimeã€‚ sendfile on; #æ­¤é€‰é¡¹å…è®¸æˆ–ç¦æ­¢ä½¿ç”¨sockeçš„TCP_CORKçš„é€‰é¡¹ï¼Œæ­¤é€‰é¡¹ä»…åœ¨ä½¿ç”¨sendfileçš„æ—¶å€™ä½¿ç”¨ tcp_nopush on; tcp_nodelay on; #åç«¯æœåŠ¡å™¨è¿æ¥çš„è¶…æ—¶æ—¶é—´_å‘èµ·æ¡æ‰‹ç­‰å€™å“åº”è¶…æ—¶æ—¶é—´ proxy_connect_timeout 90; #è¿æ¥æˆåŠŸå_ç­‰å€™åç«¯æœåŠ¡å™¨å“åº”æ—¶é—´_å…¶å®å·²ç»è¿›å…¥åç«¯çš„æ’é˜Ÿä¹‹ä¸­ç­‰å€™å¤„ç†ï¼ˆä¹Ÿå¯ä»¥è¯´æ˜¯åç«¯æœåŠ¡å™¨å¤„ç†è¯·æ±‚çš„æ—¶é—´ï¼‰ proxy_read_timeout 180; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´_å°±æ˜¯åœ¨è§„å®šæ—¶é—´ä¹‹å†…åç«¯æœåŠ¡å™¨å¿…é¡»ä¼ å®Œæ‰€æœ‰çš„æ•°æ® proxy_send_timeout 180; #è®¾ç½®ä»è¢«ä»£ç†æœåŠ¡å™¨è¯»å–çš„ç¬¬ä¸€éƒ¨åˆ†åº”ç­”çš„ç¼“å†²åŒºå¤§å°ï¼Œé€šå¸¸æƒ…å†µä¸‹è¿™éƒ¨åˆ†åº”ç­”ä¸­åŒ…å«ä¸€ä¸ªå°çš„åº”ç­”å¤´ï¼Œé»˜è®¤æƒ…å†µä¸‹è¿™ä¸ªå€¼çš„å¤§å°ä¸ºæŒ‡ä»¤proxy_buffersä¸­æŒ‡å®šçš„ä¸€ä¸ªç¼“å†²åŒºçš„å¤§å°ï¼Œä¸è¿‡å¯ä»¥å°†å…¶è®¾ç½®ä¸ºæ›´å° proxy_buffer_size 256k; #è®¾ç½®ç”¨äºè¯»å–åº”ç­”ï¼ˆæ¥è‡ªè¢«ä»£ç†æœåŠ¡å™¨ï¼‰çš„ç¼“å†²åŒºæ•°ç›®å’Œå¤§å°ï¼Œé»˜è®¤æƒ…å†µä¹Ÿä¸ºåˆ†é¡µå¤§å°ï¼Œæ ¹æ®æ“ä½œç³»ç»Ÿçš„ä¸åŒå¯èƒ½æ˜¯4kæˆ–è€…8k proxy_buffers 8 256k; proxy_busy_buffers_size 256k; #è®¾ç½®åœ¨å†™å…¥proxy_temp_pathæ—¶æ•°æ®çš„å¤§å°ï¼Œé¢„é˜²ä¸€ä¸ªå·¥ä½œè¿›ç¨‹åœ¨ä¼ é€’æ–‡ä»¶æ—¶é˜»å¡å¤ªé•¿ proxy_temp_file_write_size 256k; #proxy_temp_pathå’Œproxy_cache_pathæŒ‡å®šçš„è·¯å¾„å¿…é¡»åœ¨åŒä¸€åˆ†åŒº proxy_temp_path /data0/proxy_temp_dir; #è®¾ç½®å†…å­˜ç¼“å­˜ç©ºé—´å¤§å°ä¸º200MBï¼Œ1å¤©æ²¡æœ‰è¢«è®¿é—®çš„å†…å®¹è‡ªåŠ¨æ¸…é™¤ï¼Œç¡¬ç›˜ç¼“å­˜ç©ºé—´å¤§å°ä¸º30GBã€‚ proxy_cache_path /data0/proxy_cache_dir levels=1:2 keys_zone=cache_one:200m inactive=1d max_size=30g; client_header_timeout 5; client_body_timeout 5; send_timeout 5; #keepaliveè¶…æ—¶æ—¶é—´ã€‚ keepalive_timeout 120; #å¦‚æœæŠŠå®ƒè®¾ç½®ä¸ºæ¯”è¾ƒå¤§çš„æ•°å€¼ï¼Œä¾‹å¦‚256kï¼Œé‚£ä¹ˆï¼Œæ— è®ºä½¿ç”¨firefoxè¿˜æ˜¯IEæµè§ˆå™¨ï¼Œæ¥æäº¤ä»»æ„å°äº256kçš„å›¾ç‰‡ï¼Œéƒ½å¾ˆæ­£å¸¸ã€‚å¦‚æœæ³¨é‡Šè¯¥æŒ‡ä»¤ï¼Œä½¿ç”¨é»˜è®¤çš„client_body_buffer_sizeè®¾ç½®ï¼Œä¹Ÿå°±æ˜¯æ“ä½œç³»ç»Ÿé¡µé¢å¤§å°çš„ä¸¤å€ï¼Œ8kæˆ–è€…16kï¼Œé—®é¢˜å°±å‡ºç°äº†ã€‚#æ— è®ºä½¿ç”¨firefox4.0è¿˜æ˜¯IE8.0ï¼Œæäº¤ä¸€ä¸ªæ¯”è¾ƒå¤§ï¼Œ200kå·¦å³çš„å›¾ç‰‡ï¼Œéƒ½è¿”å›500 Internal Server Erroré”™è¯¯ client_body_buffer_size 512k; #è¡¨ç¤ºä½¿nginxé˜»æ­¢HTTPåº”ç­”ä»£ç ä¸º400æˆ–è€…æ›´é«˜çš„åº”ç­”ã€‚ proxy_intercept_errors on; #FastCGIç›¸å…³å‚æ•°æ˜¯ä¸ºäº†æ”¹å–„ç½‘ç«™çš„æ€§èƒ½ï¼šå‡å°‘èµ„æºå ç”¨ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€‚ä¸‹é¢å‚æ•°çœ‹å­—é¢æ„æ€éƒ½èƒ½ç†è§£ã€‚ fastcgi_connect_timeout 300; fastcgi_send_timeout 300; fastcgi_read_timeout 300; fastcgi_buffer_size 64k; fastcgi_buffers 4 64k; fastcgi_busy_buffers_size 128k; fastcgi_temp_file_write_size 128k; #gzipæ¨¡å—è®¾ç½® gzip on; #å¼€å¯gzipå‹ç¼©è¾“å‡º gzip_min_length 1k; #æœ€å°å‹ç¼©æ–‡ä»¶å¤§å° gzip_buffers 4 16k; #å‹ç¼©ç¼“å†²åŒº gzip_http_version 1.0; #å‹ç¼©ç‰ˆæœ¬ï¼ˆé»˜è®¤1.1ï¼Œå‰ç«¯å¦‚æœæ˜¯squid2.5è¯·ä½¿ç”¨1.0ï¼‰ gzip_comp_level 2; #å‹ç¼©ç­‰çº§ gzip_types text/plain application/x-javascript text/css application/xml; #å‹ç¼©ç±»å‹ï¼Œé»˜è®¤å°±å·²ç»åŒ…å«textmlï¼Œæ‰€ä»¥ä¸‹é¢å°±ä¸ç”¨å†å†™äº†ï¼Œå†™ä¸Šå»ä¹Ÿä¸ä¼šæœ‰é—®é¢˜ï¼Œä½†æ˜¯ä¼šæœ‰ä¸€ä¸ªwarnã€‚ gzip_vary on; #å¼€å¯é™åˆ¶IPè¿æ¥æ•°çš„æ—¶å€™éœ€è¦ä½¿ç”¨ #limit_zone crawler $binary_remote_addr 10m; upstream img_relay &#123; server 127.0.0.1:8027; server 127.0.0.1:8028; server 127.0.0.1:8029; hash $request_uri; &#125; #å¦‚æœè¯·æ±‚ä¸ºimg_relay:80,åˆ™äº¤ç»™åç§°ä¸ºimg_relayçš„Nginxé›†ç¾¤æ¥å¤„ç† server&#123; listen 80; server_name img_relay;# limit_req zone=req_one burst=5 nodelay; location ~ .*.jsp$ &#123; proxy_ignore_client_abort on; proxy_pass http://img_relay; #http:// + upstreamåç§° proxy_set_header Host $host; proxy_set_header X-Real-IP $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_connect_timeout 60; #nginxè·Ÿåç«¯æœåŠ¡å™¨è¿æ¥è¶…æ—¶æ—¶é—´(ä»£ç†è¿æ¥è¶…æ—¶) proxy_read_timeout 600; #è¿æ¥æˆåŠŸåï¼Œåç«¯æœåŠ¡å™¨å“åº”æ—¶é—´(ä»£ç†æ¥æ”¶è¶…æ—¶) proxy_send_timeout 60; #åç«¯æœåŠ¡å™¨æ•°æ®å›ä¼ æ—¶é—´(ä»£ç†å‘é€è¶…æ—¶) proxy_buffer_size 128k; #è®¾ç½®ä»£ç†æœåŠ¡å™¨ï¼ˆnginxï¼‰ä¿å­˜ç”¨æˆ·å¤´ä¿¡æ¯çš„ç¼“å†²åŒºå¤§å° proxy_buffers 32 128k; #proxy_buffersç¼“å†²åŒºï¼Œç½‘é¡µå¹³å‡åœ¨32kä»¥ä¸‹çš„è¯ï¼Œè¿™æ ·è®¾ç½® proxy_busy_buffers_size 128k; #é«˜è´Ÿè·ä¸‹ç¼“å†²å¤§å°ï¼ˆproxy_buffers*2ï¼‰ &#125; &#125;nginxçš„upstreamç›®å‰æ”¯æŒ4ç§æ–¹å¼çš„åˆ†é…1ã€è½®è¯¢ï¼ˆé»˜è®¤ï¼‰æ¯ä¸ªè¯·æ±‚æŒ‰æ—¶é—´é¡ºåºé€ä¸€åˆ†é…åˆ°ä¸åŒçš„åç«¯æœåŠ¡å™¨ï¼Œå¦‚æœåç«¯æœåŠ¡å™¨downæ‰ï¼Œèƒ½è‡ªåŠ¨å‰”é™¤ã€‚ 2ã€weightæŒ‡å®šè½®è¯¢å‡ ç‡ï¼Œweightå’Œè®¿é—®æ¯”ç‡æˆæ­£æ¯”ï¼Œç”¨äºåç«¯æœåŠ¡å™¨æ€§èƒ½ä¸å‡çš„æƒ…å†µã€‚ä¾‹å¦‚ï¼šupstream bakend &#123;server 192.168.0.14 weight=10;server 192.168.0.15 weight=10;&#125;3ã€ip_hashæ¯ä¸ªè¯·æ±‚æŒ‰è®¿é—®ipçš„hashç»“æœåˆ†é…ï¼Œè¿™æ ·æ¯ä¸ªè®¿å®¢å›ºå®šè®¿é—®ä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œå¯ä»¥è§£å†³sessionçš„é—®é¢˜ã€‚ä¾‹å¦‚ï¼šupstream bakend &#123;ip_hash;server 192.168.0.14:88;server 192.168.0.15:80;&#125;4ã€fairï¼ˆç¬¬ä¸‰æ–¹ï¼‰æŒ‰åç«¯æœåŠ¡å™¨çš„å“åº”æ—¶é—´æ¥åˆ†é…è¯·æ±‚ï¼Œå“åº”æ—¶é—´çŸ­çš„ä¼˜å…ˆåˆ†é…ã€‚upstream backend &#123;server server1;server server2;fair;&#125;5ã€url_hashï¼ˆç¬¬ä¸‰æ–¹ï¼‰æŒ‰è®¿é—®urlçš„hashç»“æœæ¥åˆ†é…è¯·æ±‚ï¼Œä½¿æ¯ä¸ªurlå®šå‘åˆ°åŒä¸€ä¸ªåç«¯æœåŠ¡å™¨ï¼Œåç«¯æœåŠ¡å™¨ä¸ºç¼“å­˜æ—¶æ¯”è¾ƒæœ‰æ•ˆã€‚ä¾‹ï¼šåœ¨upstreamä¸­åŠ å…¥hashè¯­å¥ï¼Œserverè¯­å¥ä¸­ä¸èƒ½å†™å…¥weightç­‰å…¶ä»–çš„å‚æ•°ï¼Œhash_methodæ˜¯ä½¿ç”¨çš„hashç®—æ³•upstream backend &#123; server squid1:3128; server squid2:3128; hash $request_uri; hash_method crc32;&#125;tips:upstream bakend&#123;#å®šä¹‰è´Ÿè½½å‡è¡¡è®¾å¤‡çš„IpåŠè®¾å¤‡çŠ¶æ€ ip_hash; server 127.0.0.1:9090 down; server 127.0.0.1:8080 weight=2; server 127.0.0.1:6060; server 127.0.0.1:7070 backup;&#125;åœ¨éœ€è¦ä½¿ç”¨è´Ÿè½½å‡è¡¡çš„serverä¸­å¢åŠ proxy_pass http://bakend/;æ¯ä¸ªè®¾å¤‡çš„çŠ¶æ€è®¾ç½®ä¸º:1.downè¡¨ç¤ºå•å‰çš„serveræš‚æ—¶ä¸å‚ä¸è´Ÿè½½2.weighté»˜è®¤ä¸º1.weightè¶Šå¤§ï¼Œè´Ÿè½½çš„æƒé‡å°±è¶Šå¤§ã€‚3.max_failsï¼šå…è®¸è¯·æ±‚å¤±è´¥çš„æ¬¡æ•°é»˜è®¤ä¸º1.å½“è¶…è¿‡æœ€å¤§æ¬¡æ•°æ—¶ï¼Œè¿”å›proxy_next_upstreamæ¨¡å—å®šä¹‰çš„é”™è¯¯4.fail_timeout:max_failsæ¬¡å¤±è´¥åï¼Œæš‚åœçš„æ—¶é—´ã€‚5.backupï¼š å…¶å®ƒæ‰€æœ‰çš„ébackupæœºå™¨downæˆ–è€…å¿™çš„æ—¶å€™ï¼Œè¯·æ±‚backupæœºå™¨ã€‚æ‰€ä»¥è¿™å°æœºå™¨å‹åŠ›ä¼šæœ€è½»ã€‚nginxæ”¯æŒåŒæ—¶è®¾ç½®å¤šç»„çš„è´Ÿè½½å‡è¡¡ï¼Œç”¨æ¥ç»™ä¸ç”¨çš„serveræ¥ä½¿ç”¨ã€‚client_body_in_file_onlyè®¾ç½®ä¸ºOn å¯ä»¥è®²client postè¿‡æ¥çš„æ•°æ®è®°å½•åˆ°æ–‡ä»¶ä¸­ç”¨æ¥åšdebugclient_body_temp_pathè®¾ç½®è®°å½•æ–‡ä»¶çš„ç›®å½• å¯ä»¥è®¾ç½®æœ€å¤š3å±‚ç›®å½•locationå¯¹URLè¿›è¡ŒåŒ¹é….å¯ä»¥è¿›è¡Œé‡å®šå‘æˆ–è€…è¿›è¡Œæ–°çš„ä»£ç† è´Ÿè½½å‡è¡¡","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"nginx","slug":"nginx","permalink":"https://sunny0715.github.io/tags/nginx/"}]},{"title":"HttpClientåå°è·¨åŸŸ","slug":"HttpClientåå°è·¨åŸŸ","date":"2018-01-20T01:48:24.000Z","updated":"2018-03-13T05:56:22.588Z","comments":true,"path":"2018/01/20/HttpClientåå°è·¨åŸŸ/","link":"","permalink":"https://sunny0715.github.io/2018/01/20/HttpClientåå°è·¨åŸŸ/","excerpt":"å¼•è¨€è·¨åŸŸå¯ä»¥è¯´æ˜¯ä¸€ä¸ªç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œæœ€è¿‘åœ¨è”è°ƒä¸€ä¸ªèº«ä»½è¯è¯†åˆ«æ¥å£ï¼Œè¯¥æ¥å£ç”±pythonè¯­è¨€ç¼–å†™ï¼ŒJavaè¯­è¨€è°ƒç”¨ï¼Œåˆšå¼€å§‹é‡‡ç”¨äº†CORSï¼ˆCross-Origin Resource Sharingï¼‰è·¨åŸŸï¼Œåœ¨IE8ä¸Šä¸€ç›´å‡ºç°å…¼å®¹æ€§é—®é¢˜ï¼Œå›ºå®šçš„æ€ç»´å®¹æ˜“å‡ºç°é”™è¯¯ï¼Œè‡ªå·±ä¸€ç›´æƒ³ç€å‰ç«¯Ajaxè·¨åŸŸè€Œå¿½ç•¥äº†åå°HttpClientçš„è·¨åŸŸï¼Œæœ€åè¿˜æ˜¯ç”¨HttpClienté¡ºåˆ©è§£å†³é—®é¢˜ï¼Œé¿å…äº†æµè§ˆå™¨è·¨åŸŸå¸¦æ¥çš„å…¼å®¹æ€§é—®é¢˜ã€‚","text":"å¼•è¨€è·¨åŸŸå¯ä»¥è¯´æ˜¯ä¸€ä¸ªç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œæœ€è¿‘åœ¨è”è°ƒä¸€ä¸ªèº«ä»½è¯è¯†åˆ«æ¥å£ï¼Œè¯¥æ¥å£ç”±pythonè¯­è¨€ç¼–å†™ï¼ŒJavaè¯­è¨€è°ƒç”¨ï¼Œåˆšå¼€å§‹é‡‡ç”¨äº†CORSï¼ˆCross-Origin Resource Sharingï¼‰è·¨åŸŸï¼Œåœ¨IE8ä¸Šä¸€ç›´å‡ºç°å…¼å®¹æ€§é—®é¢˜ï¼Œå›ºå®šçš„æ€ç»´å®¹æ˜“å‡ºç°é”™è¯¯ï¼Œè‡ªå·±ä¸€ç›´æƒ³ç€å‰ç«¯Ajaxè·¨åŸŸè€Œå¿½ç•¥äº†åå°HttpClientçš„è·¨åŸŸï¼Œæœ€åè¿˜æ˜¯ç”¨HttpClienté¡ºåˆ©è§£å†³é—®é¢˜ï¼Œé¿å…äº†æµè§ˆå™¨è·¨åŸŸå¸¦æ¥çš„å…¼å®¹æ€§é—®é¢˜ã€‚ HttpClient VS Jsonpä¹‹å‰çš„åšå®¢æœ‰è¯´è¿‡Jsonpçš„è·¨åŸŸæ–¹å¼ï¼Œjsonpçš„æ ¸å¿ƒåˆ™æ˜¯åŠ¨æ€æ·»åŠ &lt;script&gt;æ ‡ç­¾æ¥è°ƒç”¨æœåŠ¡å™¨æä¾›çš„jsè„šæœ¬ã€‚ç›¸æ¯”äºHttpClientï¼ŒJsonpæœ‰ä¸¤ä¸ªå¾ˆå¤§çš„ç¼ºç‚¹ï¼š 1ã€å®ƒåªèƒ½å‘é€getè¯·æ±‚ï¼Œå¦‚æœå‘é€postè¯·æ±‚ä¼šé€ æˆæ— æ³•è§£æè·å–ä¸åˆ°æ•°æ®çš„é—®é¢˜ã€‚ 2ã€å¦‚æœè¿”å›çš„æ•°æ®æ²¡æœ‰ç»è¿‡é…ç½®ç›¸åº”çš„ç¼–ç æ–‡ä»¶æ¥å¤„ç†ï¼Œæ‹¿åˆ°çš„æ•°æ®å¯èƒ½ä¼šæ˜¯ä¸€å †ä¹±ç ã€‚ é—®é¢˜æ€»æ˜¯èƒ½è§£å†³ï¼ŒHttpClientåˆ™æ²¡é‚£ä¹ˆå¤šçº¦æŸï¼ŒHttpClientå°è£…äº†httpåè®®çš„jaråŒ…ï¼ŒåŸºæœ¬çš„è¯·æ±‚æ–¹æ³•getã€postã€putã€ deleteéƒ½èƒ½å®ç°ï¼Œå½“ç„¶å¾—åœ¨web.xmlæ–‡ä»¶ä¸­é…ç½®ç›¸åº”çš„filteræ‹¦æˆªå™¨æ‹¦æˆªè¯·æ±‚åå†è®¾å¥½ç¼–ç ï¼Œä¸€èˆ¬è¿”å›çš„å‚æ•°éƒ½æ˜¯Jsonå­—ç¬¦ä¸²ï¼Œè€Œæˆ‘ä»¬åªéœ€è¦å¯¼å…¥Jacksonæˆ–è€…fastJsonæˆ–è€…åˆ«çš„jaråŒ…æ¥è§£æè¿™å¯¹è±¡æŠŠä»–è½¬æ¢æˆä½ æ‰€éœ€è¦çš„æ•°æ®å³å¯ã€‚ æ•´åˆSpringæ·»åŠ ä¾èµ–12345&lt;dependency&gt; &lt;groupId&gt;org.apache.httpcomponents&lt;/groupId&gt; &lt;artifactId&gt;httpclient&lt;/artifactId&gt; &lt;version&gt;4.5.2&lt;/version&gt;&lt;/dependency&gt; å°è£…æ–¹æ³•æ–°å»ºHttpClientUtilå·¥å…·ç±» 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114public class HttpClientUtil &#123; public static String doGet(String url, Map&lt;String, String&gt; param) &#123; // åˆ›å»ºHttpclientå¯¹è±¡ CloseableHttpClient httpclient = HttpClients.createDefault(); String resultString = \"\"; CloseableHttpResponse response = null; try &#123; // åˆ›å»ºuri URIBuilder builder = new URIBuilder(url); if (param != null) &#123; for (String key : param.keySet()) &#123; builder.addParameter(key, param.get(key)); &#125; &#125; URI uri = builder.build(); // åˆ›å»ºhttp GETè¯·æ±‚ HttpGet httpGet = new HttpGet(uri); // æ‰§è¡Œè¯·æ±‚ response = httpclient.execute(httpGet); // åˆ¤æ–­è¿”å›çŠ¶æ€æ˜¯å¦ä¸º200 if (response.getStatusLine().getStatusCode() == 200) &#123; resultString = EntityUtils.toString(response.getEntity(), \"UTF-8\"); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if (response != null) &#123; response.close(); &#125; httpclient.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; return resultString; &#125; public static String doGet(String url) &#123; return doGet(url, null); &#125; public static String doPost(String url, Map&lt;String, String&gt; param) &#123; // åˆ›å»ºHttpclientå¯¹è±¡ CloseableHttpClient httpClient = HttpClients.createDefault(); CloseableHttpResponse response = null; String resultString = \"\"; try &#123; // åˆ›å»ºHttp Postè¯·æ±‚ HttpPost httpPost = new HttpPost(url); // åˆ›å»ºå‚æ•°åˆ—è¡¨ if (param != null) &#123; List&lt;NameValuePair&gt; paramList = new ArrayList&lt;&gt;(); for (String key : param.keySet()) &#123; paramList.add(new BasicNameValuePair(key, param.get(key))); &#125; // æ¨¡æ‹Ÿè¡¨å• UrlEncodedFormEntity entity = new UrlEncodedFormEntity(paramList); httpPost.setEntity(entity); &#125; // æ‰§è¡Œhttpè¯·æ±‚ response = httpClient.execute(httpPost); resultString = EntityUtils.toString(response.getEntity(), \"utf-8\"); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; response.close(); &#125; catch (IOException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; return resultString; &#125; public static String doPost(String url) &#123; return doPost(url, null); &#125; public static String doPostJson(String url, String json) &#123; // åˆ›å»ºHttpclientå¯¹è±¡ CloseableHttpClient httpClient = HttpClients.createDefault(); CloseableHttpResponse response = null; String resultString = \"\"; try &#123; // åˆ›å»ºHttp Postè¯·æ±‚ HttpPost httpPost = new HttpPost(url); // åˆ›å»ºè¯·æ±‚å†…å®¹ StringEntity entity = new StringEntity(json, ContentType.APPLICATION_JSON); httpPost.setEntity(entity); // æ‰§è¡Œhttpè¯·æ±‚ response = httpClient.execute(httpPost); resultString = EntityUtils.toString(response.getEntity(), \"utf-8\"); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; response.close(); &#125; catch (IOException e) &#123; // TODO Auto-generated catch block e.printStackTrace(); &#125; &#125; return resultString; &#125;&#125; å•å…ƒæµ‹è¯•123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081public class HttpClientTest &#123; @Test public void doGet() throws Exception &#123; //åˆ›å»ºä¸€ä¸ªhttpclientå¯¹è±¡ CloseableHttpClient httpClient = HttpClients.createDefault(); //åˆ›å»ºä¸€ä¸ªGETå¯¹è±¡ HttpGet get = new HttpGet(\"http://www.sogou.com\"); //æ‰§è¡Œè¯·æ±‚ CloseableHttpResponse response = httpClient.execute(get); //å–å“åº”çš„ç»“æœ int statusCode = response.getStatusLine().getStatusCode(); System.out.println(statusCode); HttpEntity entity = response.getEntity(); String string = EntityUtils.toString(entity, \"utf-8\"); System.out.println(string); //å…³é—­httpclient response.close(); httpClient.close(); &#125; @Test public void doGetWithParam() throws Exception&#123; //åˆ›å»ºä¸€ä¸ªhttpclientå¯¹è±¡ CloseableHttpClient httpClient = HttpClients.createDefault(); //åˆ›å»ºä¸€ä¸ªuriå¯¹è±¡ URIBuilder uriBuilder = new URIBuilder(\"http://www.sogou.com/web\"); uriBuilder.addParameter(\"query\", \"èŠ±åƒéª¨\"); HttpGet get = new HttpGet(uriBuilder.build()); //æ‰§è¡Œè¯·æ±‚ CloseableHttpResponse response = httpClient.execute(get); //å–å“åº”çš„ç»“æœ int statusCode = response.getStatusLine().getStatusCode(); System.out.println(statusCode); HttpEntity entity = response.getEntity(); String string = EntityUtils.toString(entity, \"utf-8\"); System.out.println(string); //å…³é—­httpclient response.close(); httpClient.close(); &#125; @Test public void doPost() throws Exception &#123; CloseableHttpClient httpClient = HttpClients.createDefault(); //åˆ›å»ºä¸€ä¸ªpostå¯¹è±¡ HttpPost post = new HttpPost(\"http://localhost:8082/httpclient/post.action\"); //æ‰§è¡Œpostè¯·æ±‚ CloseableHttpResponse response = httpClient.execute(post); String string = EntityUtils.toString(response.getEntity()); System.out.println(string); response.close(); httpClient.close(); &#125; @Test public void doPostWithParam() throws Exception&#123; CloseableHttpClient httpClient = HttpClients.createDefault(); //åˆ›å»ºä¸€ä¸ªpostå¯¹è±¡ HttpPost post = new HttpPost(\"http://localhost:8082/httpclient/post.action\"); //åˆ›å»ºä¸€ä¸ªEntityã€‚æ¨¡æ‹Ÿä¸€ä¸ªè¡¨å• List&lt;NameValuePair&gt; kvList = new ArrayList&lt;&gt;(); kvList.add(new BasicNameValuePair(\"username\", \"å¼ ä¸‰\")); kvList.add(new BasicNameValuePair(\"password\", \"123\")); //åŒ…è£…æˆä¸€ä¸ªEntityå¯¹è±¡ StringEntity entity = new UrlEncodedFormEntity(kvList, \"utf-8\"); //è®¾ç½®è¯·æ±‚çš„å†…å®¹ post.setEntity(entity); //æ‰§è¡Œpostè¯·æ±‚ CloseableHttpResponse response = httpClient.execute(post); String string = EntityUtils.toString(response.getEntity()); System.out.println(string); response.close(); httpClient.close(); &#125;&#125; é¡¹ç›®å®ä¾‹123456789101112131415161718192021222324252627/** * è®¢å•å¤„ç†Service * &lt;p&gt;Title: OrderServiceImpl&lt;/p&gt; * &lt;p&gt;Description: &lt;/p&gt; * @version 1.0 */@Servicepublic class OrderServiceImpl implements OrderService &#123; @Value(\"$&#123;ORDER_BASE_URL&#125;\") private String ORDER_BASE_URL; @Value(\"$&#123;ORDER_CREATE_URL&#125;\") private String ORDER_CREATE_URL; @Override public String createOrder(Order order) &#123; //è°ƒç”¨orderçš„æœåŠ¡æäº¤è®¢å•ã€‚ String json = HttpClientUtil.doPostJson(ORDER_BASE_URL + ORDER_CREATE_URL, JsonUtils.objectToJson(order)); //æŠŠjsonè½¬æ¢æˆtaotaoResult TaotaoResult taotaoResult = TaotaoResult.format(json); if (taotaoResult.getStatus() == 200) &#123; Object orderId = taotaoResult.getData(); return orderId.toString(); &#125; return \"\"; &#125;&#125; æ€»ç»“HttpClientä¸Jsonpèƒ½å¤Ÿè½»æ˜“çš„è§£å†³è·¨åŸŸé—®é¢˜ï¼Œä»è€Œå¾—åˆ°è‡ªå·±æƒ³è¦çš„æ•°æ®(æ¥è‡ªä¸åŒIPï¼Œåè®®ï¼Œç«¯å£)ï¼Œå”¯ä¸€çš„ä¸åŒç‚¹æ˜¯ï¼ŒHttpClientæ˜¯åœ¨åå°Javaä»£ç ä¸­è¿›è¡Œè·¨åŸŸè®¿é—®ï¼Œè€ŒJsonpæ˜¯åœ¨å‰å°jsä¸­è¿›è¡Œè·¨åŸŸè®¿é—®ã€‚è·¨åŸŸè¿˜æœ‰ä¸€çº§è·¨åŸŸï¼ŒäºŒçº§è·¨åŸŸï¼Œæ›´å¤šå†…å®¹å€¼å¾—ç ”ç©¶ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"}]},{"title":"è¯´è¯´JSONå’ŒJSONP","slug":"è¯´è¯´JSONå’ŒJSONP","date":"2018-01-16T06:41:09.000Z","updated":"2018-03-13T05:54:27.615Z","comments":true,"path":"2018/01/16/è¯´è¯´JSONå’ŒJSONP/","link":"","permalink":"https://sunny0715.github.io/2018/01/16/è¯´è¯´JSONå’ŒJSONP/","excerpt":"å‰è¨€è¯´åˆ°AJAXå°±ä¼šä¸å¯é¿å…çš„é¢ä¸´ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªæ˜¯AJAXä»¥ä½•ç§æ ¼å¼æ¥äº¤æ¢æ•°æ®ï¼Ÿç¬¬äºŒä¸ªæ˜¯è·¨åŸŸçš„éœ€æ±‚å¦‚ä½•è§£å†³ï¼Ÿè¿™ä¸¤ä¸ªé—®é¢˜ç›®å‰éƒ½æœ‰ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚æ•°æ®å¯ä»¥ç”¨è‡ªå®šä¹‰å­—ç¬¦ä¸²æˆ–è€…ç”¨XMLæ¥æè¿°ï¼Œè·¨åŸŸå¯ä»¥é€šè¿‡æœåŠ¡å™¨ç«¯ä»£ç†æ¥è§£å†³ã€‚ JSONå’ŒJSONPè™½ç„¶åªæœ‰ä¸€ä¸ªå­—æ¯çš„å·®åˆ«ï¼Œä½†å…¶å®ä»–ä»¬æ ¹æœ¬ä¸æ˜¯ä¸€å›äº‹ï¼šJSONæ˜¯ä¸€ç§æ•°æ®äº¤æ¢æ ¼å¼ï¼Œè€ŒJSONPæ˜¯ä¸€ç§ä¾é å¼€å‘äººå‘˜çš„èªæ˜æ‰æ™ºåˆ›é€ å‡ºçš„ä¸€ç§éå®˜æ–¹è·¨åŸŸæ•°æ®äº¤äº’åè®®ã€‚æˆ‘ä»¬æ‹¿æœ€è¿‘æ¯”è¾ƒç«çš„è°æˆ˜ç‰‡æ¥æ‰“ä¸ªæ¯”æ–¹ï¼ŒJSONæ˜¯åœ°ä¸‹å…šä»¬ç”¨æ¥ä¹¦å†™å’Œäº¤æ¢æƒ…æŠ¥çš„â€œæš—å·â€ï¼Œè€ŒJSONPåˆ™æ˜¯æŠŠç”¨æš—å·ä¹¦å†™çš„æƒ…æŠ¥ä¼ é€’ç»™è‡ªå·±åŒå¿—æ—¶ä½¿ç”¨çš„æ¥å¤´æ–¹å¼ã€‚çœ‹åˆ°æ²¡ï¼Ÿä¸€ä¸ªæ˜¯æè¿°ä¿¡æ¯çš„æ ¼å¼ï¼Œä¸€ä¸ªæ˜¯ä¿¡æ¯ä¼ é€’åŒæ–¹çº¦å®šçš„æ–¹æ³•ã€‚","text":"å‰è¨€è¯´åˆ°AJAXå°±ä¼šä¸å¯é¿å…çš„é¢ä¸´ä¸¤ä¸ªé—®é¢˜ï¼Œç¬¬ä¸€ä¸ªæ˜¯AJAXä»¥ä½•ç§æ ¼å¼æ¥äº¤æ¢æ•°æ®ï¼Ÿç¬¬äºŒä¸ªæ˜¯è·¨åŸŸçš„éœ€æ±‚å¦‚ä½•è§£å†³ï¼Ÿè¿™ä¸¤ä¸ªé—®é¢˜ç›®å‰éƒ½æœ‰ä¸åŒçš„è§£å†³æ–¹æ¡ˆï¼Œæ¯”å¦‚æ•°æ®å¯ä»¥ç”¨è‡ªå®šä¹‰å­—ç¬¦ä¸²æˆ–è€…ç”¨XMLæ¥æè¿°ï¼Œè·¨åŸŸå¯ä»¥é€šè¿‡æœåŠ¡å™¨ç«¯ä»£ç†æ¥è§£å†³ã€‚ JSONå’ŒJSONPè™½ç„¶åªæœ‰ä¸€ä¸ªå­—æ¯çš„å·®åˆ«ï¼Œä½†å…¶å®ä»–ä»¬æ ¹æœ¬ä¸æ˜¯ä¸€å›äº‹ï¼šJSONæ˜¯ä¸€ç§æ•°æ®äº¤æ¢æ ¼å¼ï¼Œè€ŒJSONPæ˜¯ä¸€ç§ä¾é å¼€å‘äººå‘˜çš„èªæ˜æ‰æ™ºåˆ›é€ å‡ºçš„ä¸€ç§éå®˜æ–¹è·¨åŸŸæ•°æ®äº¤äº’åè®®ã€‚æˆ‘ä»¬æ‹¿æœ€è¿‘æ¯”è¾ƒç«çš„è°æˆ˜ç‰‡æ¥æ‰“ä¸ªæ¯”æ–¹ï¼ŒJSONæ˜¯åœ°ä¸‹å…šä»¬ç”¨æ¥ä¹¦å†™å’Œäº¤æ¢æƒ…æŠ¥çš„â€œæš—å·â€ï¼Œè€ŒJSONPåˆ™æ˜¯æŠŠç”¨æš—å·ä¹¦å†™çš„æƒ…æŠ¥ä¼ é€’ç»™è‡ªå·±åŒå¿—æ—¶ä½¿ç”¨çš„æ¥å¤´æ–¹å¼ã€‚çœ‹åˆ°æ²¡ï¼Ÿä¸€ä¸ªæ˜¯æè¿°ä¿¡æ¯çš„æ ¼å¼ï¼Œä¸€ä¸ªæ˜¯ä¿¡æ¯ä¼ é€’åŒæ–¹çº¦å®šçš„æ–¹æ³•ã€‚ ä»€ä¹ˆæ˜¯JSONå‰é¢ç®€å•è¯´äº†ä¸€ä¸‹ï¼ŒJSONæ˜¯ä¸€ç§åŸºäºæ–‡æœ¬çš„æ•°æ®äº¤æ¢æ–¹å¼ï¼Œæˆ–è€…å«åšæ•°æ®æè¿°æ ¼å¼ï¼Œä½ æ˜¯å¦è¯¥é€‰ç”¨ä»–é¦–å…ˆè‚¯å®šè¦å…³æ³¨å®ƒæ‰€æ‹¥æœ‰çš„ä¼˜ç‚¹ã€‚ JSONçš„ä¼˜ç‚¹ åŸºäºçº¯æ–‡æœ¬ï¼Œè·¨å¹³å°ä¼ é€’æå…¶ç®€å•ï¼› JavaScriptåŸç”Ÿæ”¯æŒï¼Œåå°è¯­è¨€å‡ ä¹å…¨éƒ¨æ”¯æŒï¼› è½»é‡çº§æ•°æ®æ ¼å¼ï¼Œå ç”¨å­—ç¬¦æ•°é‡æå°‘ï¼Œç‰¹åˆ«é€‚åˆäº’è”ç½‘ä¼ é€’ï¼› å¯è¯»æ€§è¾ƒå¼ºï¼Œè™½ç„¶æ¯”ä¸ä¸ŠXMLé‚£ä¹ˆä¸€ç›®äº†ç„¶ï¼Œä½†åœ¨åˆç†çš„ä¾æ¬¡ç¼©è¿›ä¹‹åè¿˜æ˜¯å¾ˆå®¹æ˜“è¯†åˆ«çš„ï¼› å®¹æ˜“ç¼–å†™å’Œè§£æï¼Œå½“ç„¶å‰ææ˜¯ä½ è¦çŸ¥é“æ•°æ®ç»“æ„ï¼› JSONçš„ç¼ºç‚¹å½“ç„¶ä¹Ÿæœ‰ï¼Œä½†åœ¨ä½œè€…çœ‹æ¥å®åœ¨æ˜¯æ— å…³ç´§è¦çš„ä¸œè¥¿ï¼Œæ‰€ä»¥ä¸å†å•ç‹¬è¯´æ˜ã€‚ JSONçš„æ ¼å¼æˆ–è€…å«è§„åˆ™JSONèƒ½å¤Ÿä»¥éå¸¸ç®€å•çš„æ–¹å¼æ¥æè¿°æ•°æ®ç»“æ„ï¼ŒXMLèƒ½åšçš„å®ƒéƒ½èƒ½åšï¼Œå› æ­¤åœ¨è·¨å¹³å°æ–¹é¢ä¸¤è€…å®Œå…¨ä¸åˆ†ä¼¯ä»²ã€‚ JSONåªæœ‰ä¸¤ç§æ•°æ®ç±»å‹æè¿°ç¬¦ï¼Œå¤§æ‹¬å·{}å’Œæ–¹æ‹¬å·[]ï¼Œå…¶ä½™è‹±æ–‡å†’å·:æ˜¯æ˜ å°„ç¬¦ï¼Œè‹±æ–‡é€—å·,æ˜¯åˆ†éš”ç¬¦ï¼Œè‹±æ–‡åŒå¼•å·â€â€æ˜¯å®šä¹‰ç¬¦ã€‚ å¤§æ‹¬å·{}ç”¨æ¥æè¿°ä¸€ç»„â€œä¸åŒç±»å‹çš„æ— åºé”®å€¼å¯¹é›†åˆâ€ï¼ˆæ¯ä¸ªé”®å€¼å¯¹å¯ä»¥ç†è§£ä¸ºOOPçš„å±æ€§æè¿°ï¼‰ï¼Œæ–¹æ‹¬å·[]ç”¨æ¥æè¿°ä¸€ç»„â€œç›¸åŒç±»å‹çš„æœ‰åºæ•°æ®é›†åˆâ€ï¼ˆå¯å¯¹åº”OOPçš„æ•°ç»„ï¼‰ã€‚ ä¸Šè¿°ä¸¤ç§é›†åˆä¸­è‹¥æœ‰å¤šä¸ªå­é¡¹ï¼Œåˆ™é€šè¿‡è‹±æ–‡é€—å·,è¿›è¡Œåˆ†éš”ã€‚ é”®å€¼å¯¹ä»¥è‹±æ–‡å†’å·:è¿›è¡Œåˆ†éš”ï¼Œå¹¶ä¸”å»ºè®®é”®åéƒ½åŠ ä¸Šè‹±æ–‡åŒå¼•å·â€â€ï¼Œä»¥ä¾¿äºä¸åŒè¯­è¨€çš„è§£æã€‚ JSONå†…éƒ¨å¸¸ç”¨æ•°æ®ç±»å‹æ— éå°±æ˜¯å­—ç¬¦ä¸²ã€æ•°å­—ã€å¸ƒå°”ã€æ—¥æœŸã€null è¿™ä¹ˆå‡ ä¸ªï¼Œå­—ç¬¦ä¸²å¿…é¡»ç”¨åŒå¼•å·å¼•èµ·æ¥ï¼Œå…¶ä½™çš„éƒ½ä¸ç”¨ï¼Œæ—¥æœŸç±»å‹æ¯”è¾ƒç‰¹æ®Šï¼Œè¿™é‡Œå°±ä¸å±•å¼€è®²è¿°äº†ï¼Œåªæ˜¯å»ºè®®å¦‚æœå®¢æˆ·ç«¯æ²¡æœ‰æŒ‰æ—¥æœŸæ’åºåŠŸèƒ½éœ€æ±‚çš„è¯ï¼Œé‚£ä¹ˆæŠŠæ—¥æœŸæ—¶é—´ç›´æ¥ä½œä¸ºå­—ç¬¦ä¸²ä¼ é€’å°±å¥½ï¼Œå¯ä»¥çœå»å¾ˆå¤šéº»çƒ¦ã€‚ JSONçš„å®ä¾‹123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566// æè¿°ä¸€ä¸ªäººvar person = &#123; \"Name\": \"Bob\", \"Age\": 32, \"Company\": \"IBM\", \"Engineer\": true&#125;// è·å–è¿™ä¸ªäººçš„ä¿¡æ¯var personAge = person.Age;// æè¿°å‡ ä¸ªäººvar members = [ &#123; \"Name\": \"Bob\", \"Age\": 32, \"Company\": \"IBM\", \"Engineer\": true &#125;, &#123; \"Name\": \"John\", \"Age\": 20, \"Company\": \"Oracle\", \"Engineer\": false &#125;, &#123; \"Name\": \"Henry\", \"Age\": 45, \"Company\": \"Microsoft\", \"Engineer\": false &#125;]// è¯»å–å…¶ä¸­Johnçš„å…¬å¸åç§°var johnsCompany = members[1].Company;// æè¿°ä¸€æ¬¡ä¼šè®®var conference = &#123; \"Conference\": \"Future Marketing\", \"Date\": \"2012-6-1\", \"Address\": \"Beijing\", \"Members\": [ &#123; \"Name\": \"Bob\", \"Age\": 32, \"Company\": \"IBM\", \"Engineer\": true &#125;, &#123; \"Name\": \"John\", \"Age\": 20, \"Company\": \"Oracle\", \"Engineer\": false &#125;, &#123; \"Name\": \"Henry\", \"Age\": 45, \"Company\": \"Microsoft\", \"Engineer\": false &#125; ]&#125;// è¯»å–å‚ä¼šè€…Henryæ˜¯å¦å·¥ç¨‹å¸ˆvar henryIsAnEngineer = conference.Members[2].Engineer; å…³äºJSONï¼Œå°±è¯´è¿™ä¹ˆå¤šï¼Œæ›´å¤šç»†èŠ‚è¯·åœ¨å¼€å‘è¿‡ç¨‹ä¸­æŸ¥é˜…èµ„æ–™æ·±å…¥å­¦ä¹ ã€‚ ä»€ä¹ˆæ˜¯JSONPJSONPçš„äº§ç”Ÿå…¶å®ç½‘ä¸Šå…³äºJSONPçš„è®²è§£æœ‰å¾ˆå¤šï¼Œä½†å´åƒç¯‡ä¸€å¾‹ï¼Œè€Œä¸”äº‘é‡Œé›¾é‡Œï¼Œå¯¹äºå¾ˆå¤šåˆšæ¥è§¦çš„äººæ¥è®²ç†è§£èµ·æ¥æœ‰äº›å›°éš¾ï¼Œè¯•ç€ç”¨è‡ªå·±çš„æ–¹å¼æ¥é˜é‡Šä¸€ä¸‹è¿™ä¸ªé—®é¢˜ã€‚ 1ã€ä¸€ä¸ªä¼—æ‰€å‘¨çŸ¥çš„é—®é¢˜ï¼ŒAjaxç›´æ¥è¯·æ±‚æ™®é€šæ–‡ä»¶å­˜åœ¨è·¨åŸŸæ— æƒé™è®¿é—®çš„é—®é¢˜ï¼Œç”­ç®¡ä½ æ˜¯é™æ€é¡µé¢ã€åŠ¨æ€ç½‘é¡µã€webæœåŠ¡ã€WCFï¼Œåªè¦æ˜¯è·¨åŸŸè¯·æ±‚ï¼Œä¸€å¾‹ä¸å‡†ï¼› 2ã€ä¸è¿‡æˆ‘ä»¬åˆå‘ç°ï¼ŒWebé¡µé¢ä¸Šè°ƒç”¨jsæ–‡ä»¶æ—¶åˆ™ä¸å—æ˜¯å¦è·¨åŸŸçš„å½±å“ï¼ˆä¸ä»…å¦‚æ­¤ï¼Œæˆ‘ä»¬è¿˜å‘ç°å‡¡æ˜¯æ‹¥æœ‰â€srcâ€è¿™ä¸ªå±æ€§çš„æ ‡ç­¾éƒ½æ‹¥æœ‰è·¨åŸŸçš„èƒ½åŠ›ï¼Œæ¯”å¦‚&lt;script&gt;ã€&lt;img&gt;ã€&lt;iframe&gt;ï¼‰ï¼› 3ã€äºæ˜¯å¯ä»¥åˆ¤æ–­ï¼Œå½“å‰é˜¶æ®µå¦‚æœæƒ³é€šè¿‡çº¯webç«¯ï¼ˆActiveXæ§ä»¶ã€æœåŠ¡ç«¯ä»£ç†ã€å±äºæœªæ¥çš„HTML5ä¹‹Websocketç­‰æ–¹å¼ä¸ç®—ï¼‰è·¨åŸŸè®¿é—®æ•°æ®å°±åªæœ‰ä¸€ç§å¯èƒ½ï¼Œé‚£å°±æ˜¯åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šè®¾æ³•æŠŠæ•°æ®è£…è¿›jsæ ¼å¼çš„æ–‡ä»¶é‡Œï¼Œä¾›å®¢æˆ·ç«¯è°ƒç”¨å’Œè¿›ä¸€æ­¥å¤„ç†ï¼› 4ã€æ°å·§æˆ‘ä»¬å·²ç»çŸ¥é“æœ‰ä¸€ç§å«åšJSONçš„çº¯å­—ç¬¦æ•°æ®æ ¼å¼å¯ä»¥ç®€æ´çš„æè¿°å¤æ‚æ•°æ®ï¼Œæ›´å¦™çš„æ˜¯JSONè¿˜è¢«jsåŸç”Ÿæ”¯æŒï¼Œæ‰€ä»¥åœ¨å®¢æˆ·ç«¯å‡ ä¹å¯ä»¥éšå¿ƒæ‰€æ¬²çš„å¤„ç†è¿™ç§æ ¼å¼çš„æ•°æ®ï¼› 5ã€è¿™æ ·å­è§£å†³æ–¹æ¡ˆå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼Œwebå®¢æˆ·ç«¯é€šè¿‡ä¸è°ƒç”¨è„šæœ¬ä¸€æ¨¡ä¸€æ ·çš„æ–¹å¼ï¼Œæ¥è°ƒç”¨è·¨åŸŸæœåŠ¡å™¨ä¸ŠåŠ¨æ€ç”Ÿæˆçš„jsæ ¼å¼æ–‡ä»¶ï¼ˆä¸€èˆ¬ä»¥JSONä¸ºåç¼€ï¼‰ï¼Œæ˜¾è€Œæ˜“è§ï¼ŒæœåŠ¡å™¨ä¹‹æ‰€ä»¥è¦åŠ¨æ€ç”ŸæˆJSONæ–‡ä»¶ï¼Œç›®çš„å°±åœ¨äºæŠŠå®¢æˆ·ç«¯éœ€è¦çš„æ•°æ®è£…å…¥è¿›å»ã€‚ 6ã€å®¢æˆ·ç«¯åœ¨å¯¹JSONæ–‡ä»¶è°ƒç”¨æˆåŠŸä¹‹åï¼Œä¹Ÿå°±è·å¾—äº†è‡ªå·±æ‰€éœ€çš„æ•°æ®ï¼Œå‰©ä¸‹çš„å°±æ˜¯æŒ‰ç…§è‡ªå·±éœ€æ±‚è¿›è¡Œå¤„ç†å’Œå±•ç°äº†ï¼Œè¿™ç§è·å–è¿œç¨‹æ•°æ®çš„æ–¹å¼çœ‹èµ·æ¥éå¸¸åƒAJAXï¼Œä½†å…¶å®å¹¶ä¸ä¸€æ ·ã€‚ 7ã€ä¸ºäº†ä¾¿äºå®¢æˆ·ç«¯ä½¿ç”¨æ•°æ®ï¼Œé€æ¸å½¢æˆäº†ä¸€ç§éæ­£å¼ä¼ è¾“åè®®ï¼Œäººä»¬æŠŠå®ƒç§°ä½œJSONPï¼Œè¯¥åè®®çš„ä¸€ä¸ªè¦ç‚¹å°±æ˜¯å…è®¸ç”¨æˆ·ä¼ é€’ä¸€ä¸ªcallbackå‚æ•°ç»™æœåŠ¡ç«¯ï¼Œç„¶åæœåŠ¡ç«¯è¿”å›æ•°æ®æ—¶ä¼šå°†è¿™ä¸ªcallbackå‚æ•°ä½œä¸ºå‡½æ•°åæ¥åŒ…è£¹ä½JSONæ•°æ®ï¼Œè¿™æ ·å®¢æˆ·ç«¯å°±å¯ä»¥éšæ„å®šåˆ¶è‡ªå·±çš„å‡½æ•°æ¥è‡ªåŠ¨å¤„ç†è¿”å›æ•°æ®äº†ã€‚ JSONPçš„å®¢æˆ·ç«¯å…·ä½“å®ç°ä¸ç®¡jQueryä¹Ÿå¥½ï¼Œextjsä¹Ÿç½¢ï¼Œåˆæˆ–è€…æ˜¯å…¶ä»–æ”¯æŒjsonpçš„æ¡†æ¶ï¼Œä»–ä»¬å¹•åæ‰€åšçš„å·¥ä½œéƒ½æ˜¯ä¸€æ ·çš„ï¼Œä¸‹é¢æˆ‘æ¥å¾ªåºæ¸è¿›çš„è¯´æ˜ä¸€ä¸‹jsonpåœ¨å®¢æˆ·ç«¯çš„å®ç°ï¼š 1ã€æˆ‘ä»¬çŸ¥é“ï¼Œå“ªæ€•è·¨åŸŸjsæ–‡ä»¶ä¸­çš„ä»£ç ï¼ˆå½“ç„¶æŒ‡ç¬¦åˆwebè„šæœ¬å®‰å…¨ç­–ç•¥çš„ï¼‰ï¼Œwebé¡µé¢ä¹Ÿæ˜¯å¯ä»¥æ— æ¡ä»¶æ‰§è¡Œçš„ã€‚ è¿œç¨‹æœåŠ¡å™¨remoteserver.comæ ¹ç›®å½•ä¸‹æœ‰ä¸ªremote.jsæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š 1alert('æˆ‘æ˜¯è¿œç¨‹æ–‡ä»¶'); æœ¬åœ°æœåŠ¡å™¨localserver.comä¸‹æœ‰ä¸ªjsonp.htmlé¡µé¢ä»£ç å¦‚ä¸‹ï¼š 123456789&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;head&gt; &lt;title&gt;&lt;/title&gt; &lt;script type=\"text/javascript\" src=\"http://remoteserver.com/remote.js\"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; æ¯«æ— ç–‘é—®ï¼Œé¡µé¢å°†ä¼šå¼¹å‡ºä¸€ä¸ªæç¤ºçª—ä½“ï¼Œæ˜¾ç¤ºè·¨åŸŸè°ƒç”¨æˆåŠŸã€‚ 2ã€ç°åœ¨æˆ‘ä»¬åœ¨jsonp.htmlé¡µé¢å®šä¹‰ä¸€ä¸ªå‡½æ•°ï¼Œç„¶ååœ¨è¿œç¨‹remote.jsä¸­ä¼ å…¥æ•°æ®è¿›è¡Œè°ƒç”¨ã€‚ jsonp.htmlé¡µé¢ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;head&gt; &lt;title&gt;&lt;/title&gt; &lt;script type=\"text/javascript\"&gt; var localHandler = function(data)&#123; alert('æˆ‘æ˜¯æœ¬åœ°å‡½æ•°ï¼Œå¯ä»¥è¢«è·¨åŸŸçš„remote.jsæ–‡ä»¶è°ƒç”¨ï¼Œè¿œç¨‹jså¸¦æ¥çš„æ•°æ®æ˜¯ï¼š' + data.result); &#125;; &lt;/script&gt; &lt;script type=\"text/javascript\" src=\"http://remoteserver.com/remote.js\"&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; remote.jsæ–‡ä»¶ä»£ç å¦‚ä¸‹ï¼š 1localHandler(&#123;\"result\":\"æˆ‘æ˜¯è¿œç¨‹jså¸¦æ¥çš„æ•°æ®\"&#125;); è¿è¡Œä¹‹åæŸ¥çœ‹ç»“æœï¼Œé¡µé¢æˆåŠŸå¼¹å‡ºæç¤ºçª—å£ï¼Œæ˜¾ç¤ºæœ¬åœ°å‡½æ•°è¢«è·¨åŸŸçš„è¿œç¨‹jsè°ƒç”¨æˆåŠŸï¼Œå¹¶ä¸”è¿˜æ¥æ”¶åˆ°äº†è¿œç¨‹jså¸¦æ¥çš„æ•°æ®ã€‚å¾ˆæ¬£å–œï¼Œè·¨åŸŸè¿œç¨‹è·å–æ•°æ®çš„ç›®çš„åŸºæœ¬å®ç°äº†ï¼Œä½†æ˜¯åˆä¸€ä¸ªé—®é¢˜å‡ºç°äº†ï¼Œæˆ‘æ€ä¹ˆè®©è¿œç¨‹jsçŸ¥é“å®ƒåº”è¯¥è°ƒç”¨çš„æœ¬åœ°å‡½æ•°å«ä»€ä¹ˆåå­—å‘¢ï¼Ÿæ¯•ç«Ÿæ˜¯jsonpçš„æœåŠ¡è€…éƒ½è¦é¢å¯¹å¾ˆå¤šæœåŠ¡å¯¹è±¡ï¼Œè€Œè¿™äº›æœåŠ¡å¯¹è±¡å„è‡ªçš„æœ¬åœ°å‡½æ•°éƒ½ä¸ç›¸åŒå•Šï¼Ÿæˆ‘ä»¬æ¥ç€å¾€ä¸‹çœ‹ã€‚ 3ã€èªæ˜çš„å¼€å‘è€…å¾ˆå®¹æ˜“æƒ³åˆ°ï¼Œåªè¦æœåŠ¡ç«¯æä¾›çš„jsè„šæœ¬æ˜¯åŠ¨æ€ç”Ÿæˆçš„å°±è¡Œäº†å‘—ï¼Œè¿™æ ·è°ƒç”¨è€…å¯ä»¥ä¼ ä¸€ä¸ªå‚æ•°è¿‡å»å‘Šè¯‰æœåŠ¡ç«¯â€œæˆ‘æƒ³è¦ä¸€æ®µè°ƒç”¨XXXå‡½æ•°çš„jsä»£ç ï¼Œè¯·ä½ è¿”å›ç»™æˆ‘â€ï¼Œäºæ˜¯æœåŠ¡å™¨å°±å¯ä»¥æŒ‰ç…§å®¢æˆ·ç«¯çš„éœ€æ±‚æ¥ç”Ÿæˆjsè„šæœ¬å¹¶å“åº”äº†ã€‚ çœ‹jsonp.htmlé¡µé¢çš„ä»£ç ï¼š 123456789101112131415161718192021&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt;&lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt;&lt;head&gt; &lt;title&gt;&lt;/title&gt; &lt;script type=\"text/javascript\"&gt; // å¾—åˆ°èˆªç­ä¿¡æ¯æŸ¥è¯¢ç»“æœåçš„å›è°ƒå‡½æ•° var flightHandler = function(data)&#123; alert('ä½ æŸ¥è¯¢çš„èˆªç­ç»“æœæ˜¯ï¼šç¥¨ä»· ' + data.price + ' å…ƒï¼Œ' + 'ä½™ç¥¨ ' + data.tickets + ' å¼ ã€‚'); &#125;; // æä¾›jsonpæœåŠ¡çš„urlåœ°å€ï¼ˆä¸ç®¡æ˜¯ä»€ä¹ˆç±»å‹çš„åœ°å€ï¼Œæœ€ç»ˆç”Ÿæˆçš„è¿”å›å€¼éƒ½æ˜¯ä¸€æ®µjavascriptä»£ç ï¼‰ var url = \"http://flightQuery.com/jsonp/flightResult.aspx?code=CA1998&amp;callback=flightHandler\"; // åˆ›å»ºscriptæ ‡ç­¾ï¼Œè®¾ç½®å…¶å±æ€§ var script = document.createElement('script'); script.setAttribute('src', url); // æŠŠscriptæ ‡ç­¾åŠ å…¥headï¼Œæ­¤æ—¶è°ƒç”¨å¼€å§‹ document.getElementsByTagName('head')[0].appendChild(script); &lt;/script&gt;&lt;/head&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt; è¿™æ¬¡çš„ä»£ç å˜åŒ–æ¯”è¾ƒå¤§ï¼Œä¸å†ç›´æ¥æŠŠè¿œç¨‹jsæ–‡ä»¶å†™æ­»ï¼Œè€Œæ˜¯ç¼–ç å®ç°åŠ¨æ€æŸ¥è¯¢ï¼Œè€Œè¿™ä¹Ÿæ­£æ˜¯jsonpå®¢æˆ·ç«¯å®ç°çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæœ¬ä¾‹ä¸­çš„é‡ç‚¹ä¹Ÿå°±åœ¨äºå¦‚ä½•å®Œæˆjsonpè°ƒç”¨çš„å…¨è¿‡ç¨‹ã€‚ æˆ‘ä»¬çœ‹åˆ°è°ƒç”¨çš„urlä¸­ä¼ é€’äº†ä¸€ä¸ªcodeå‚æ•°ï¼Œå‘Šè¯‰æœåŠ¡å™¨æˆ‘è¦æŸ¥çš„æ˜¯CA1998æ¬¡èˆªç­çš„ä¿¡æ¯ï¼Œè€Œcallbackå‚æ•°åˆ™å‘Šè¯‰æœåŠ¡å™¨ï¼Œæˆ‘çš„æœ¬åœ°å›è°ƒå‡½æ•°å«åšflightHandlerï¼Œæ‰€ä»¥è¯·æŠŠæŸ¥è¯¢ç»“æœä¼ å…¥è¿™ä¸ªå‡½æ•°ä¸­è¿›è¡Œè°ƒç”¨ã€‚ OKï¼ŒæœåŠ¡å™¨å¾ˆèªæ˜ï¼Œè¿™ä¸ªå«åšflightResult.aspxçš„é¡µé¢ç”Ÿæˆäº†ä¸€æ®µè¿™æ ·çš„ä»£ç æä¾›ç»™jsonp.htmlï¼ˆæœåŠ¡ç«¯çš„å®ç°è¿™é‡Œå°±ä¸æ¼”ç¤ºäº†ï¼Œä¸ä½ é€‰ç”¨çš„è¯­è¨€æ— å…³ï¼Œè¯´åˆ°åº•å°±æ˜¯æ‹¼æ¥å­—ç¬¦ä¸²ï¼‰ï¼š 12345flightHandler(&#123; \"code\": \"CA1998\", \"price\": 1780, \"tickets\": 5&#125;); æˆ‘ä»¬çœ‹åˆ°ï¼Œä¼ é€’ç»™flightHandlerå‡½æ•°çš„æ˜¯ä¸€ä¸ªjsonï¼Œå®ƒæè¿°äº†èˆªç­çš„åŸºæœ¬ä¿¡æ¯ã€‚è¿è¡Œä¸€ä¸‹é¡µé¢ï¼ŒæˆåŠŸå¼¹å‡ºæç¤ºçª—å£ï¼Œjsonpçš„æ‰§è¡Œå…¨è¿‡ç¨‹é¡ºåˆ©å®Œæˆï¼ 4ã€åˆ°è¿™é‡Œä¸ºæ­¢çš„è¯ï¼Œç›¸ä¿¡ä½ å·²ç»èƒ½å¤Ÿç†è§£jsonpçš„å®¢æˆ·ç«¯å®ç°åŸç†äº†å§ï¼Ÿå‰©ä¸‹çš„å°±æ˜¯å¦‚ä½•æŠŠä»£ç å°è£…ä¸€ä¸‹ï¼Œä»¥ä¾¿äºä¸ç”¨æˆ·ç•Œé¢äº¤äº’ï¼Œä»è€Œå®ç°å¤šæ¬¡å’Œé‡å¤è°ƒç”¨ã€‚ ä»€ä¹ˆï¼Ÿä½ ç”¨çš„æ˜¯jQueryï¼Œæƒ³çŸ¥é“jQueryå¦‚ä½•å®ç°jsonpè°ƒç”¨ï¼Ÿå¥½å§ï¼Œé‚£æˆ‘å°±å¥½äººåšåˆ°åº•ï¼Œå†ç»™ä½ ä¸€æ®µjQueryä½¿ç”¨jsonpçš„ä»£ç ï¼ˆæˆ‘ä»¬ä¾ç„¶æ²¿ç”¨ä¸Šé¢é‚£ä¸ªèˆªç­ä¿¡æ¯æŸ¥è¯¢çš„ä¾‹å­ï¼Œå‡å®šè¿”å›jsonpç»“æœä¸å˜ï¼‰ï¼š 123456789101112131415161718192021222324252627&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt; &lt;html xmlns=\"http://www.w3.org/1999/xhtml\" &gt; &lt;head&gt; &lt;title&gt;Untitled Page&lt;/title&gt; &lt;script type=\"text/javascript\" src=jquery.min.js\"&gt;&lt;/script&gt; &lt;script type=\"text/javascript\"&gt; jQuery(document).ready(function()&#123; $.ajax(&#123; type: \"get\", async: false, url: \"http://flightQuery.com/jsonp/flightResult.aspx?code=CA1998\", dataType: \"jsonp\", jsonp: \"callback\",//ä¼ é€’ç»™è¯·æ±‚å¤„ç†ç¨‹åºæˆ–é¡µé¢çš„ï¼Œç”¨ä»¥è·å¾—jsonpå›è°ƒå‡½æ•°åçš„å‚æ•°å(ä¸€èˆ¬é»˜è®¤ä¸º:callback) jsonpCallback:\"flightHandler\",//è‡ªå®šä¹‰çš„jsonpå›è°ƒå‡½æ•°åç§°ï¼Œé»˜è®¤ä¸ºjQueryè‡ªåŠ¨ç”Ÿæˆçš„éšæœºå‡½æ•°åï¼Œä¹Ÿå¯ä»¥å†™\"?\"ï¼ŒjQueryä¼šè‡ªåŠ¨ä¸ºä½ å¤„ç†æ•°æ® success: function(json)&#123; alert('æ‚¨æŸ¥è¯¢åˆ°èˆªç­ä¿¡æ¯ï¼šç¥¨ä»·ï¼š ' + json.price + ' å…ƒï¼Œä½™ç¥¨ï¼š ' + json.tickets + ' å¼ ã€‚'); &#125;, error: function()&#123; alert('fail'); &#125; &#125;); &#125;); &lt;/script&gt; &lt;/head&gt; &lt;body&gt; &lt;/body&gt; &lt;/html&gt; æ˜¯ä¸æ˜¯æœ‰ç‚¹å¥‡æ€ªï¼Ÿä¸ºä»€ä¹ˆæˆ‘è¿™æ¬¡æ²¡æœ‰å†™flightHandlerè¿™ä¸ªå‡½æ•°å‘¢ï¼Ÿè€Œä¸”ç«Ÿç„¶ä¹Ÿè¿è¡ŒæˆåŠŸäº†ï¼å“ˆå“ˆï¼Œè¿™å°±æ˜¯jQueryçš„åŠŸåŠ³äº†ï¼Œjqueryåœ¨å¤„ç†jsonpç±»å‹çš„ajaxæ—¶ï¼ˆè¿˜æ˜¯å¿ä¸ä½åæ§½ï¼Œè™½ç„¶jqueryä¹ŸæŠŠjsonpå½’å…¥äº†ajaxï¼Œä½†å…¶å®å®ƒä»¬çœŸçš„ä¸æ˜¯ä¸€å›äº‹å„¿ï¼‰ï¼Œè‡ªåŠ¨å¸®ä½ ç”Ÿæˆå›è°ƒå‡½æ•°å¹¶æŠŠæ•°æ®å–å‡ºæ¥ä¾›successå±æ€§æ–¹æ³•æ¥è°ƒç”¨ï¼Œæ˜¯ä¸æ˜¯å¾ˆçˆ½å‘€ï¼Ÿ æ€»ç»“1ã€ajaxå’Œjsonpè¿™ä¸¤ç§æŠ€æœ¯åœ¨è°ƒç”¨æ–¹å¼ä¸Šâ€œçœ‹èµ·æ¥â€å¾ˆåƒï¼Œç›®çš„ä¹Ÿä¸€æ ·ï¼Œéƒ½æ˜¯è¯·æ±‚ä¸€ä¸ªurlï¼Œç„¶åæŠŠæœåŠ¡å™¨è¿”å›çš„æ•°æ®è¿›è¡Œå¤„ç†ï¼Œå› æ­¤jqueryå’Œextç­‰æ¡†æ¶éƒ½æŠŠjsonpä½œä¸ºajaxçš„ä¸€ç§å½¢å¼è¿›è¡Œäº†å°è£…ï¼› 2ã€ä½†ajaxå’Œjsonpå…¶å®æœ¬è´¨ä¸Šæ˜¯ä¸åŒçš„ä¸œè¥¿ã€‚ajaxçš„æ ¸å¿ƒæ˜¯é€šè¿‡XmlHttpRequestè·å–éæœ¬é¡µå†…å®¹ï¼Œè€Œjsonpçš„æ ¸å¿ƒåˆ™æ˜¯åŠ¨æ€æ·»åŠ &lt;script&gt;æ ‡ç­¾æ¥è°ƒç”¨æœåŠ¡å™¨æä¾›çš„jsè„šæœ¬ã€‚ 3ã€æ‰€ä»¥è¯´ï¼Œå…¶å®ajaxä¸jsonpçš„åŒºåˆ«ä¸åœ¨äºæ˜¯å¦è·¨åŸŸï¼Œajaxé€šè¿‡æœåŠ¡ç«¯ä»£ç†ä¸€æ ·å¯ä»¥å®ç°è·¨åŸŸï¼Œjsonpæœ¬èº«ä¹Ÿä¸æ’æ–¥åŒåŸŸçš„æ•°æ®çš„è·å–ã€‚ 4ã€è¿˜æœ‰å°±æ˜¯ï¼Œjsonpæ˜¯ä¸€ç§æ–¹å¼æˆ–è€…è¯´éå¼ºåˆ¶æ€§åè®®ï¼Œå¦‚åŒajaxä¸€æ ·ï¼Œå®ƒä¹Ÿä¸ä¸€å®šéè¦ç”¨jsonæ ¼å¼æ¥ä¼ é€’æ•°æ®ï¼Œå¦‚æœä½ æ„¿æ„ï¼Œå­—ç¬¦ä¸²éƒ½è¡Œï¼Œåªä¸è¿‡è¿™æ ·ä¸åˆ©äºç”¨jsonpæä¾›å…¬å¼€æœåŠ¡ã€‚ æ€»è€Œè¨€ä¹‹ï¼Œjsonpä¸æ˜¯ajaxçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå“ªæ€•jqueryç­‰å·¨å¤´æŠŠjsonpå°è£…è¿›äº†ajaxï¼Œä¹Ÿä¸èƒ½æ”¹å˜ç€ä¸€ç‚¹ï¼ è½¬è‡ªï¼šè¯´è¯´JSONå’ŒJSONPï¼Œä¹Ÿè®¸ä½ ä¼šè±ç„¶å¼€æœ—ï¼Œå«jQueryç”¨ä¾‹","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://sunny0715.github.io/tags/å‰ç«¯/"}]},{"title":"Linuxä¸‹å®‰è£…Nginx","slug":"Linuxä¸‹å®‰è£…Nginx","date":"2018-01-11T07:16:49.000Z","updated":"2018-03-13T05:51:21.886Z","comments":true,"path":"2018/01/11/Linuxä¸‹å®‰è£…Nginx/","link":"","permalink":"https://sunny0715.github.io/2018/01/11/Linuxä¸‹å®‰è£…Nginx/","excerpt":"","text":"# Nginxå®‰è£…ç¯å¢ƒNginxæ˜¯Cè¯­è¨€å¼€å‘ï¼Œå»ºè®®åœ¨Linxuä¸Šè¿è¡Œï¼Œä¸‹é¢æ“ä½œå®åœ¨Centos6.5ä¸Šçš„å®‰è£…ç¯å¢ƒã€‚1. gccå®‰è£…nginxéœ€è¦å…ˆå°†å®˜ç½‘ä¸‹è½½çš„æºç è¿›è¡Œç¼–è¯‘ï¼Œç¼–è¯‘ä¾èµ–gccç¯å¢ƒï¼Œå¦‚æœæ²¡æœ‰gccç¯å¢ƒï¼Œéœ€è¦å®‰è£…gccã€‚å®‰è£…å‘½ä»¤ï¼šyum install gcc-c++2. PCREPCRE(Perl Compatible Regular Expressions)æ˜¯ä¸€ä¸ªPerlåº“ï¼ŒåŒ…æ‹¬ perl å…¼å®¹çš„æ­£åˆ™è¡¨è¾¾å¼åº“ã€‚nginxçš„httpæ¨¡å—ä½¿ç”¨pcreæ¥è§£ææ­£åˆ™è¡¨è¾¾å¼ï¼Œæ‰€ä»¥éœ€è¦åœ¨linuxä¸Šå®‰è£…pcreåº“ã€‚å®‰è£…å‘½ä»¤ï¼šyum install -y pcre pcre-devel3. zlibzlibåº“æä¾›äº†å¾ˆå¤šç§å‹ç¼©å’Œè§£å‹ç¼©çš„æ–¹å¼ï¼Œnginxä½¿ç”¨zlibå¯¹httpåŒ…çš„å†…å®¹è¿›è¡Œgzipï¼Œæ‰€ä»¥éœ€è¦åœ¨linuxä¸Šå®‰è£…zlibåº“ã€‚å®‰è£…å‘½ä»¤ï¼šyum install -y zlib zlib-devel4. opensslOpenSSL æ˜¯ä¸€ä¸ªå¼ºå¤§çš„å®‰å…¨å¥—æ¥å­—å±‚å¯†ç åº“ï¼Œå›Šæ‹¬ä¸»è¦çš„å¯†ç ç®—æ³•ã€å¸¸ç”¨çš„å¯†é’¥å’Œè¯ä¹¦å°è£…ç®¡ç†åŠŸèƒ½åŠSSLåè®®ï¼Œå¹¶æä¾›ä¸°å¯Œçš„åº”ç”¨ç¨‹åºä¾›æµ‹è¯•æˆ–å…¶å®ƒç›®çš„ä½¿ç”¨ã€‚nginxä¸ä»…æ”¯æŒhttpåè®®ï¼Œè¿˜æ”¯æŒhttpsï¼ˆå³åœ¨sslåè®®ä¸Šä¼ è¾“httpï¼‰ï¼Œæ‰€ä»¥éœ€è¦åœ¨linuxå®‰è£…opensslåº“ã€‚å®‰è£…å‘½ä»¤ï¼šyum install -y openssl openssl-devel# ç¼–è¯‘å®‰è£…å°†nginx-1.8.0.tar.gzæ‹·è´è‡³LinuxæœåŠ¡å™¨åè§£å‹ã€‚12tar -zxvf nginx-1.8.0.tar.gzcd nginx-1.8.01. configure./configure â€“helpæŸ¥è¯¢è¯¦ç»†å‚æ•°ã€‚å‚æ•°è®¾ç½®å¦‚ä¸‹ï¼šæ³¨æ„ï¼šä¸‹è¾¹å°†ä¸´æ—¶æ–‡ä»¶ç›®å½•æŒ‡å®šä¸º/var/temp/nginxï¼Œéœ€è¦åœ¨/varä¸‹åˆ›å»ºtempåŠnginxç›®å½•123456789101112./configure \\--prefix=/usr/local/nginx \\--pid-path=/var/run/nginx/nginx.pid \\--lock-path=/var/lock/nginx.lock \\--error-log-path=/var/log/nginx/error.log \\--http-log-path=/var/log/nginx/access.log \\--with-http_gzip_static_module \\--http-client-body-temp-path=/var/temp/nginx/client \\--http-proxy-temp-path=/var/temp/nginx/proxy \\--http-fastcgi-temp-path=/var/temp/nginx/fastcgi \\--http-uwsgi-temp-path=/var/temp/nginx/uwsgi \\--http-scgi-temp-path=/var/temp/nginx/scgi2. ç¼–è¯‘å®‰è£…12makemake install å¯åŠ¨Nginx1234cd /usr/local/nginx/sbin/./nginx// æŸ¥è¯¢nginxè¿›ç¨‹å‘½ä»¤ps aux|grep nginx æ³¨æ„ï¼šæ‰§è¡Œ./nginxå¯åŠ¨nginxï¼Œè¿™é‡Œå¯ä»¥-cæŒ‡å®šåŠ è½½çš„nginxé…ç½®æ–‡ä»¶ï¼Œå¦‚ä¸‹ï¼š 1./nginx -c /usr/soft/nginx-1.8.0/conf/nginx.conf å¦‚æœä¸æŒ‡å®š-cï¼Œnginxåœ¨å¯åŠ¨æ—¶é»˜è®¤åŠ è½½/usr/local/nginx/conf/nginx.confæ–‡ä»¶ï¼Œæ­¤æ–‡ä»¶çš„åœ°å€ä¹Ÿå¯ä»¥åœ¨ç¼–è¯‘å®‰è£…nginxæ—¶æŒ‡å®š./configureçš„å‚æ•°ï¼ˆâ€“conf-path= æŒ‡å‘é…ç½®æ–‡ä»¶ï¼ˆnginx.confï¼‰ï¼‰ é‡å¯Nginx å…ˆåœæ­¢å†å¯åŠ¨ï¼ˆå»ºè®®ä½¿ç”¨ï¼‰ å¯¹nginxè¿›è¡Œé‡å¯ç›¸å½“äºå…ˆåœæ­¢nginxå†å¯åŠ¨nginxï¼Œå³å…ˆæ‰§è¡Œåœæ­¢å‘½ä»¤å†æ‰§è¡Œå¯åŠ¨å‘½ä»¤ã€‚ 12./nginx -s quit./nginx é‡æ–°åŠ è½½é…ç½®æ–‡ä»¶ å½“nginxçš„é…ç½®æ–‡ä»¶nginx.confä¿®æ”¹åï¼Œè¦æƒ³è®©é…ç½®ç”Ÿæ•ˆéœ€è¦é‡å¯nginxï¼Œä½¿ç”¨-s reloadä¸ç”¨å…ˆåœæ­¢nginxå†å¯åŠ¨nginxå³å¯å°†é…ç½®ä¿¡æ¯åœ¨nginxä¸­ç”Ÿæ•ˆã€‚ 1./nginx -s reload æµ‹è¯•nginxå®‰è£…æˆåŠŸï¼Œå¯åŠ¨nginxï¼Œå³å¯è®¿é—®è™šæ‹Ÿæœºä¸Šçš„nginx åˆ°è¿™è¯´æ˜nginxä¸Šå®‰è£…æˆåŠŸã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"linux","slug":"linux","permalink":"https://sunny0715.github.io/tags/linux/"},{"name":"nginx","slug":"nginx","permalink":"https://sunny0715.github.io/tags/nginx/"}]},{"title":"Linuxä¸‹å®‰è£…JDKä¸MySQL","slug":"Linuxä¸‹å®‰è£…JDKä¸MySQL","date":"2018-01-09T11:53:24.000Z","updated":"2018-03-20T06:18:45.762Z","comments":true,"path":"2018/01/09/Linuxä¸‹å®‰è£…JDKä¸MySQL/","link":"","permalink":"https://sunny0715.github.io/2018/01/09/Linuxä¸‹å®‰è£…JDKä¸MySQL/","excerpt":"å¼•è¨€é‡æ¸©è®°å½•ä¸‹Linuxç¯å¢ƒä¸‹JDKå’ŒMySQLçš„å®‰è£…ã€‚","text":"å¼•è¨€é‡æ¸©è®°å½•ä¸‹Linuxç¯å¢ƒä¸‹JDKå’ŒMySQLçš„å®‰è£…ã€‚ JDKçš„å®‰è£…ä¸‹è½½è§£å‹ä¸‹è½½JDKå‹ç¼©åŒ…ï¼Œä¸‹è½½ç›®å½•ï¼šhttp://www.oracle.com/technetwork/java/javase/downloads/index.html è§£å‹ 1tar -xvzf jdk-8u152-linux-x64.tar.gz é…ç½®ç¯å¢ƒå˜é‡ä»¥rootç”¨æˆ·ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤è¿›å…¥é…ç½®ç¯å¢ƒå˜é‡çš„profileæ–‡ä»¶ã€‚ 1vim /etc/profile åœ¨æ–‡ä»¶æœ«å°¾åŠ å…¥ä»¥ä¸‹å†…å®¹å¹¶ä¿å­˜ï¼ˆæ³¨æ„ä¿®æ”¹JDKè·¯å¾„ï¼‰ã€‚ 1234# set java environment export JAVA_HOME=/usr/soft/jdk1.8.0_152export PATH=$PATH:$JAVA_HOME/binexport CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar åœ¨å‘½ä»¤è¡Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ä½¿ç¯å¢ƒå˜é‡ç”Ÿæ•ˆã€‚ 1source /etc/profile åˆ‡æ¢JDKç‰ˆæœ¬å½“Linuxä¸­å®‰è£…å¤šä¸ªJDKæ—¶åˆ‡æ¢è¿›è¡Œç‰ˆæœ¬åˆ‡æ¢ã€‚ æŸ¥çœ‹é€‰æ‹©æ‰€æœ‰JDKã€‚ 1alternatives --config java ç»™jdk1.8.0_152è®¾ç½®åºåˆ—å·ï¼Œè¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼ˆæ³¨æ„ä¿®æ”¹JDKç›®å½•ï¼‰ã€‚ 1alternatives --install /usr/bin/java java /usr/soft/jdk1.8.0_152 4 è¾“å…¥ä»¥ä¸‹å‘½ä»¤ï¼Œé€‰æ‹©JDKå¯¹åº”çš„æ•°å­—ï¼Œåˆ‡æ¢JDKç‰ˆæœ¬ã€‚ 1alternatives --config java MySQLçš„å®‰è£…ä¸å¸è½½yumå®‰è£…ä»Oracleå®˜æ–¹ç½‘ç«™ä¸‹è½½Linuxç³»ç»Ÿå¯¹åº”çš„MySQLçš„yumæºåŒ…ã€‚åœ°å€ï¼šhttps://dev.mysql.com/downloads/repo/yum/ æŠŠyumæºåŒ…ä¸Šä¼ åˆ°linuxï¼Œä¾æ¬¡æ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œå®‰è£…ã€‚ 12yum localinstall mysql-community-release-el6-5.noarch.rpmyum install mysql-server å®‰è£…å®Œæˆåå¯åŠ¨MySQL 1service mysqld start ç»™rootç”¨æˆ·è®¾ç½®å¯†ç  1/usr/bin/mysqladmin -u root password &apos;root&apos; è¿›å…¥MySQLåè¿›è¡Œè¿œç¨‹è¿æ¥æˆæƒ 1GRANT ALL PRIVILEGES ON *.* TO &apos;root&apos;@&apos;%&apos; IDENTIFIED BY &apos;root&apos; WITH GRANT OPTION; å¸è½½æŸ¥çœ‹MySQLçš„å®‰è£…è·¯å¾„ 1whereis mysql æŸ¥çœ‹mysqlçš„å®‰è£…åŒ… 1rpm -qa|grep mysql å¸è½½ 1yum remove mysql è‹¥å¸è½½ä¸å®Œå…¨ï¼Œåˆ™è¦é€ä¸ªå¸è½½ 1234rpm -qa|grep mysqlyum remove mysql-community-release-el6-5.noarchyum remove mysql-community-common-5.6.38-2.el6.x86_64yum remove mysql-community-libs-5.6.38-2.el6.x86_64 åˆ é™¤mysqlçš„æ•°æ®åº“æ–‡ä»¶ 1rm -rf /var/lib/mysql/ å®‰è£…åŒ…ç¦»çº¿å®‰è£…ä¸‹è½½MySQLç¦»çº¿å®‰è£…åŒ…ï¼šhttps://dev.mysql.com/downloads/mysql/ 123456mv mysql-5.6.38-linux-glibc2.12-x86_64.tar.gz /usr/local/cd /usr/local/// è§£å‹MySQLå®‰è£…åŒ…tar -zxvf mysql-5.6.38-linux-glibc2.12-x86_64.tar.gz// é‡å‘½åmv mysql-5.6.38-linux-glibc2.12-x86_64 mysql æ£€æŸ¥MySQLç»„å’Œç”¨æˆ·æ˜¯å¦å­˜åœ¨ï¼Œå¦‚æ— åˆ›å»º 12345cat /etc/group | grep mysqlcat /etc/passwd | grep mysql// å¦‚æœæ²¡æœ‰åˆ™åˆ›å»ºã€‚useradd -rå‚æ•°è¡¨ç¤ºmysqlç”¨æˆ·æ˜¯ç³»ç»Ÿç”¨æˆ·ï¼Œä¸å¯ç”¨äºç™»å½•ç³»ç»Ÿgroupadd mysqluseradd -r -g mysql mysql åˆ†é…ç”¨æˆ·å’Œç»„ 123456cd mysql// æ›´æ”¹mysqlç›®å½•æ‰€å±çš„ç”¨æˆ·(ç”¨æˆ·ä¸ºmysql)chown -R mysql ../mysql/// -Ræ˜¯é€’å½’çš„æ„æ€ï¼Œå°±æ˜¯æŠŠmysqlç›®å½•ä¸‹çš„å…¨éƒ¨æ–‡ä»¶å’Œå­ç›®å½•éƒ½è®¾ç½®ä¸ºmysqlç”¨æˆ·å’Œmysqlç»„ã€‚chgrp -R mysql ../mysql/// ä¸Šé¢çš„åšæ³•æ˜¯ä¸ºäº†æŠŠmysqlé™æƒï¼Œä»¥é™å®šåªèƒ½è®¿é—®å±äºmysqlç”¨æˆ·çš„æ–‡ä»¶ã€‚ å®‰è£…åŠåˆå§‹åŒ–æ•°æ®åº“ï¼ˆåˆ›å»ºç³»ç»Ÿæ•°æ®åº“çš„è¡¨ï¼‰ 1./scripts/mysql_install_db --user=mysql --basedir=/usr/local/mysql/ --datadir=/usr/local/mysql/data/ é…ç½®MySQLæ•°æ®åº“ 12345678// å¤åˆ¶é…ç½®æ–‡ä»¶cp -a ./support-files/my-default.cnf /etc/my.cnf// æ›´æ”¹é…ç½®æ–‡ä»¶ä¿¡æ¯vi /etc/my.cnf// åŠ å…¥ä»¥ä¸‹å†…å®¹# These are commonly set, remove the # and set as required.basedir = /usr/local/mysqldatadir = /usr/local/mysql/data ä¿®æ”¹MySQLå¯†ç  123456// å¯åŠ¨MySQL./support-files/mysql.server start// ä¿®æ”¹å¯†ç ./bin/mysqladmin -u root -h localhost.localdomain password 'root'// è¿›å…¥MySQL./bin/mysql -h127.0.0.1 -uroot -proot å¢åŠ è¿œç¨‹ç™»å½•æƒé™ 12grant all privileges on *.* to root@&apos;%&apos; identified by &apos;root&apos;;flush privileges; å°†MySQLåŠ å…¥Serviceç³»ç»ŸæœåŠ¡ 123456// å…ˆé€€å‡ºMySQLcp support-files/mysql.server /etc/init.d/mysqldchkconfig --add mysqldchkconfig mysqld onservice mysqld restartservice mysqld status åˆ°è¿™é‡ŒMySQLå°±é…ç½®å®Œæˆäº†ï¼Œå‰©ä¸‹çš„å°±æ˜¯ä¼˜åŒ–MySQLï¼Œé…ç½®/etc/my.cnfå•¦ï¼","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://sunny0715.github.io/tags/mysql/"},{"name":"linux","slug":"linux","permalink":"https://sunny0715.github.io/tags/linux/"}]},{"title":"Linuxä¸‹Tomcatçš„å®‰è£…ä¸ä¼˜åŒ–","slug":"Linuxä¸‹Tomcatçš„å®‰è£…ä¸ä¼˜åŒ–","date":"2018-01-05T11:04:11.000Z","updated":"2018-03-13T05:50:48.918Z","comments":true,"path":"2018/01/05/Linuxä¸‹Tomcatçš„å®‰è£…ä¸ä¼˜åŒ–/","link":"","permalink":"https://sunny0715.github.io/2018/01/05/Linuxä¸‹Tomcatçš„å®‰è£…ä¸ä¼˜åŒ–/","excerpt":"å¼•è¨€Linuxç³»ç»Ÿå·²ç»æç½®å¾ˆä¹…äº†ï¼Œä¹‹å‰æœ‰åœ¨Ubuntuç³»ç»Ÿä¸Šå¼€å‘è¿‡ï¼Œä½†æ˜¯Linuxå·²ç»å¾ˆä¹…æ²¡æœ‰ç”¨äº†ã€‚ç°åœ¨å…¬å¸æŠŠé¡¹ç›®éƒ¨ç½²åœ¨Linuxç³»ç»Ÿä¸Šï¼Œåˆè¦æŠŠLinuxç›¸å…³çŸ¥è¯†æ¸©ä¹ ä¸€ä¸‹ã€‚è¿™ç¯‡åšå®¢æ¸©ä¹ ä¸€ä¸‹Linuxä¸‹Tomcatçš„éƒ¨ç½²ä¸ä¼˜åŒ–ï¼Œå¤§éƒ¨åˆ†çš„æ“ä½œä¸åœ¨windowsä¸Šç›¸åŒã€‚","text":"å¼•è¨€Linuxç³»ç»Ÿå·²ç»æç½®å¾ˆä¹…äº†ï¼Œä¹‹å‰æœ‰åœ¨Ubuntuç³»ç»Ÿä¸Šå¼€å‘è¿‡ï¼Œä½†æ˜¯Linuxå·²ç»å¾ˆä¹…æ²¡æœ‰ç”¨äº†ã€‚ç°åœ¨å…¬å¸æŠŠé¡¹ç›®éƒ¨ç½²åœ¨Linuxç³»ç»Ÿä¸Šï¼Œåˆè¦æŠŠLinuxç›¸å…³çŸ¥è¯†æ¸©ä¹ ä¸€ä¸‹ã€‚è¿™ç¯‡åšå®¢æ¸©ä¹ ä¸€ä¸‹Linuxä¸‹Tomcatçš„éƒ¨ç½²ä¸ä¼˜åŒ–ï¼Œå¤§éƒ¨åˆ†çš„æ“ä½œä¸åœ¨windowsä¸Šç›¸åŒã€‚ Tomcatçš„å®‰è£…é¦–å…ˆä¸‹è½½Tomcatçš„å‹ç¼©åŒ…ï¼ˆapache-tomcat-7.0.82.tar.gzï¼‰ï¼Œä¸‹è½½åœ°å€ä¸ºï¼šhttps://tomcat.apache.org/download-70.cgi å°†å‹ç¼©åŒ…æ”¾åˆ°Linuxé¢„å®šç›®å½•ä¸‹ï¼Œæ‰§è¡Œtarçš„è§£å‹ç¼©å‘½ä»¤ 12cd /usr/soft/tar -zxvf apache-tomcat-7.0.82.tar.gz è¿›å…¥åˆ°apache-tomcat-7.0.82.tar.gzçš„binç›®å½•ä¸‹æ‰§è¡Œ./startup.sh å‘½ä»¤å³å¯å¯åŠ¨Tomcatã€‚ Tomcatçš„ä¼˜åŒ–é»˜è®¤æƒ…å†µä¸‹Tomcatçš„é…ç½®é€‚åˆå¼€å‘æ¨¡å¼æˆ–è€…æ¯”è¾ƒå°çš„ç³»ç»Ÿåº”ç”¨ï¼Œå½“è®¿é—®é‡ç¨å¾®å¤šçš„æ—¶å€™æ¯”å¦‚1000äººåŒæ—¶åœ¨çº¿åšä¸€äº›é¢‘ç¹çš„ä¸šåŠ¡æ“ä½œçš„æ—¶å€™ï¼Œå¯èƒ½æ€§èƒ½æ–¹é¢å°±ä¼šå­˜åœ¨é—®é¢˜ï¼Œæ‰€ä»¥æœ‰å¿…è¦åœ¨ç”Ÿäº§ç¯å¢ƒä¸‹å¯¹Tomcatåšä¸€äº›ä¼˜åŒ–ã€‚ ä¹‹å‰å‡ ç¯‡æ–‡ç« ä¹Ÿæåˆ°äº†Tomcatç›¸å…³å‚æ•°çš„è®¾ç½®ä¸ä¼˜åŒ–ï¼ŒWindowsæ“ä½œç³»ç»Ÿä¸Linuxæ“ä½œç³»ç»Ÿå¤§åŒå°å¼‚ã€‚ APRæ¨¡å¼Tomcat å¸¸ç”¨è¿è¡Œæ¨¡å¼æœ‰3ç§ï¼Œåˆ†åˆ«ä¸º BIOï¼ŒNIOï¼ŒAPRã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®ç”¨APRï¼Œä»æ“ä½œç³»ç»Ÿçº§åˆ«æ¥è§£å†³å¼‚æ­¥çš„IOé—®é¢˜ï¼Œå¤§å¹…åº¦çš„æé«˜æ€§èƒ½ã€‚Linuxä¸‹éœ€è¦å¦å®‰è£…é…ç½®APRã€‚ ä¸‹è½½APRæ¨¡å¼éœ€è¦ä¸‹è½½apr-1.6.3.tar.gzå’Œapr-util-1.6.1.tar.gzä¸¤ä¸ªæ–‡ä»¶ï¼Œä¸‹è½½åœ°å€ä¸ºï¼šhttp://apr.apache.org/download.cgi å®‰è£…å°†è¿ä¸ªæ–‡ä»¶æ”¾åˆ°åˆé€‚çš„ä½ç½®ç„¶åè¿›è¡Œå®‰è£…æ“ä½œã€‚ aprçš„å®‰è£…ä¾æ¬¡æ‰§è¡Œï¼Œå°†å®‰è£…è·¯å¾„è®¾ä¸º/usr/local/apr 12345tar -zxvf apr-1.6.3.tar.gzcd apr-1.6.3.tar.gz./configure --prefix=/usr/local/aprmakemake install apr-utilçš„å®‰è£…12345tar -zxvf apr-util-1.6.1.tar.gzcd apr-util-1.6.1.tar.gz./configure --with-apr=/usr/local/apr/bin/apr-1-configmakemake install å®‰è£…tomcat-nativetomcat-native.tar.gzæ˜¯Tomcatè‡ªå¸¦çš„å‹ç¼©åŒ…ï¼Œè¯¥æ–‡ä»¶åœ¨tomcatçš„binç›®å½•ä¸‹ã€‚ ç³»ç»Ÿè¦å…ˆå®‰è£…å¥½JDKï¼Œæˆ‘çš„JDKçš„å®‰è£…ç›®å½•ä¸ºï¼š/usr/soft/jdk1.8.0_152 123456cd /usr/soft/apache-tomcat-7.0.82/bin/tar -zxvf tomcat-native.tar.gzcd tomcat-native-1.2.14-src/java/org/apache/tomcat/jni/./configure --with-apr=/usr/local/apr/bin/apr-1-config --with-java-home=/usr/soft/jdk1.8.0_152makemake install é…ç½® ç¼–è¾‘tomcatç›®å½•ä¸‹æ–‡ä»¶bin/catalina.shåŠ è½½aprï¼Œåœ¨ä»»æ„åœ°æ–¹åŠ å…¥ä¸‹é¢ä¸€è¡Œ 1CATALINA_OPTS=\"$CATALINA_OPTS -Djava.library.path=/usr/local/apr/lib\" ç¼–è¾‘bin/catalina.shé…ç½®JVMè¿è¡Œå‚æ•°ï¼Œæ³¨æ„å¼•å·ä¸è¦å¿˜è®°ã€‚ 1JAVA_OPTS=&quot;-server -Xmx4g -Xms4g -Xmn1g -XX:PermSize=512M -XX:MaxPermSize=521M -XX:+DisableExplicitGC -XX:SurvivorRatio=3 -XX:+HeapDumpOnOutOfMemoryError -XX:HeapDumpPath=/usr/soft/apache-tomcat-7.0.82 -XX:+UseConcMarkSweepGC -XX:+UseParNewGC -XX:CMSInitiatingOccupancyFraction=65 -XX:+UseCMSInitiatingOccupancyOnly -XX:SoftRefLRUPolicyMSPerMB=0 -XX:+UseCMSCompactAtFullCollection -XX:+PrintGCDetails -XX:+PrintGCTimeStamps -XX:+PrintHeapAtGC -Xloggc:/usr/soft/jdk1.8.0_152/log/gc.log -Djava.awt.headless=true&quot; ç¼–è¾‘conf/server.xmlä½¿ç”¨aprè¿è¡Œæ¨¡å¼ 12345&lt;Connector port=&quot;8080&quot; protocol=&quot;org.apache.coyote.http11.Http11AprProtocol&quot; connectionTimeout=&quot;20000&quot; maxThreads=&quot;1000&quot; minSpareThreads=&quot;100&quot; maxSpareThreads=&quot;200&quot; acceptCount=&quot;900&quot; enableLookups=&quot;false&quot; compression=&quot;on&quot; compressionMinSize=&quot;1024&quot; compressableMimeType=&quot;text/html,text/xml,text/css,text/javascript&quot; redirectPort=&quot;8443&quot; URIEncoding=&quot;UTF-8&quot; maxHttpHeaderSize=&quot;8192&quot;/&gt; å¯åŠ¨Tomcat å¯åŠ¨tomcatï¼ŒæŸ¥çœ‹tomcatæ—¥å¿—æ–‡ä»¶ï¼Œè‹¥å‡ºç°å¦‚ä¸‹ä¿¡æ¯åˆ™è¡¨æ˜å®‰è£…é…ç½®æˆåŠŸã€‚ 123456ä¸€æœˆ 05, 2018 2:03:09 ä¸‹åˆ org.apache.coyote.AbstractProtocol initä¿¡æ¯: Initializing ProtocolHandler [&quot;http-apr-8080&quot;]ä¸€æœˆ 05, 2018 2:03:09 ä¸‹åˆ org.apache.coyote.AbstractProtocol initä¿¡æ¯:: Initializing ProtocolHandler [&quot;ajp-apr-8009&quot;]ä¸€æœˆ 05, 2018 2:03:09 ä¸‹åˆ org.apache.catalina.startup.Catalina loadä¿¡æ¯:: Initialization processed in 1471 ms ç»“è¯­æ€§èƒ½çš„å½±å“å› ç´ æ˜¯å¤šæ–¹é¢çš„ï¼Œäº’ç›¸å½±å“ï¼Œé¦–å…ˆæ˜¯ç³»ç»Ÿæœ¬èº«æ²¡é—®é¢˜ï¼Œæ•°æ®åº“çš„å“åº”æ²¡é—®é¢˜ï¼Œwebå®¹å™¨é¡ºç•…ï¼Œç¡¬ä»¶é¡ºç•…ï¼Œç½‘ç»œå¸¦å®½è¶³å¤Ÿï¼Œå†ä½¿ç”¨ä¸€äº›å°å·¥å…·è¿›è¡Œæ£€æµ‹ï¼Œåªæœ‰åœ¨å¤§é‡ç”¨æˆ·åœ¨å®é™…çš„ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ç³»ç»Ÿï¼Œæ‰èƒ½å‘ç°é—®é¢˜ï¼Œæ‰¾åˆ°é—®é¢˜çš„æ ¹æºåˆ°åº•æ˜¯å“ªä¸€å—å¼•å‘çš„æ€§èƒ½ç“¶é¢ˆï¼Œè°ƒæ•´ä¸€ä¸‹è‡ªç„¶ä¸€åˆ‡éƒ½å˜å¾—é¡ºç•…ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"tomcat","slug":"tomcat","permalink":"https://sunny0715.github.io/tags/tomcat/"},{"name":"linux","slug":"linux","permalink":"https://sunny0715.github.io/tags/linux/"}]},{"title":"å›é¡¾è¿‡å» å±•æœ›æœªæ¥","slug":"å›é¡¾è¿‡å»-å±•æœ›æœªæ¥","date":"2018-01-02T01:53:54.000Z","updated":"2018-03-13T05:53:51.648Z","comments":true,"path":"2018/01/02/å›é¡¾è¿‡å»-å±•æœ›æœªæ¥/","link":"","permalink":"https://sunny0715.github.io/2018/01/02/å›é¡¾è¿‡å»-å±•æœ›æœªæ¥/","excerpt":"æ—¶é—´è¿‡çš„å¯çœŸçš„æ˜¯å¿«ï¼Œè½¬çœ¼é—´åˆ°äº†2018å¹´ï¼Œä»Šå¹´çš„å…ƒæ—¦æ²¡æœ‰å‡ºå»è·¨å¹´ï¼Œè€Œæ˜¯åœ¨å®¶é‡Œé™é™çš„ç­‰å¾…ç€2018å¹´çš„åˆ°æ¥ï¼Œä¸çŸ¥é“æ˜¯æ¬£å–œè¿˜æ˜¯å¿§éƒã€‚2017å¹´æˆ‘çš„å¹´åº¦ç›®æ ‡åªå®ç°äº†90%ï¼Œå¹¶æ²¡æœ‰å®Œå…¨è¾¾åˆ°æœŸæœ›ã€‚","text":"æ—¶é—´è¿‡çš„å¯çœŸçš„æ˜¯å¿«ï¼Œè½¬çœ¼é—´åˆ°äº†2018å¹´ï¼Œä»Šå¹´çš„å…ƒæ—¦æ²¡æœ‰å‡ºå»è·¨å¹´ï¼Œè€Œæ˜¯åœ¨å®¶é‡Œé™é™çš„ç­‰å¾…ç€2018å¹´çš„åˆ°æ¥ï¼Œä¸çŸ¥é“æ˜¯æ¬£å–œè¿˜æ˜¯å¿§éƒã€‚2017å¹´æˆ‘çš„å¹´åº¦ç›®æ ‡åªå®ç°äº†90%ï¼Œå¹¶æ²¡æœ‰å®Œå…¨è¾¾åˆ°æœŸæœ›ã€‚ è‡ªå·±æœ€è¿‘ä¸€å¹´æ¥ç‰¹åˆ«ä¸æƒ³ç†¬å¤œï¼Œä¸€ç†¬å¤œç¬¬äºŒå¤©å°±æ„Ÿè§‰ç‰¹åˆ«çš„ç´¯ã€‚è¿™ä¸€å¹´è‡ªå·±ä¹Ÿå­¦åˆ°äº†å¾ˆå¤šçš„ä¸œè¥¿ï¼Œè™½ç„¶æ„Ÿè§‰å¾ˆç´¯ï¼Œä½†æ˜¯è§‰å¾—å¾ˆå¼€å¿ƒã€‚å…¬å¸æ”¾å‡çš„å®‰æ’ä¹Ÿå‡ºæ¥äº†ï¼Œè…ŠæœˆäºŒåå››ï¼Œæ”¾å‡ç«‹é©¬å°±å›å®¶ï¼Œåˆåˆ°äº†ä¸€å¹´æŠ¢ç¥¨çš„æ—¶é—´ã€‚å‡ å¤šæ¬¢å–œå‡ å¤šæ„å•Šã€‚2018ä¹Ÿæ˜¯è‡ªå·±çš„æœ¬å‘½å¹´ï¼ŒåŠ æ²¹ï¼åŠ æ²¹ï¼","categories":[{"name":"life","slug":"life","permalink":"https://sunny0715.github.io/categories/life/"}],"tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"https://sunny0715.github.io/tags/éšç¬”/"}]},{"title":"è¯¦è§£Tomcatè¿æ¥æ± ä¸è¿æ¥æ•°","slug":"è¯¦è§£Tomcatè¿æ¥æ± ä¸è¿æ¥æ•°","date":"2017-12-28T06:56:06.000Z","updated":"2018-03-13T05:55:18.252Z","comments":true,"path":"2017/12/28/è¯¦è§£Tomcatè¿æ¥æ± ä¸è¿æ¥æ•°/","link":"","permalink":"https://sunny0715.github.io/2017/12/28/è¯¦è§£Tomcatè¿æ¥æ± ä¸è¿æ¥æ•°/","excerpt":"å¼•è¨€åœ¨ä½¿ç”¨Tomcatæ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°è¿æ¥æ•°ã€çº¿ç¨‹æ•°ä¹‹ç±»çš„é…ç½®ï¼Œç„¶åè‡ªå·±å°±å»è°·æ­Œã€ç™¾åº¦ï¼Œæ²¡æœ‰çœŸæ­£ç†è§£Tomcaté…ç½®çš„ä½œç”¨åŠå½“å‰ä¸šåŠ¡ç¯å¢ƒã€æœåŠ¡å™¨é…ç½®ç­‰æƒ…å†µä¸‹Tomcatæœ€ä¼˜é…ç½®ã€‚ 12345&lt;Connector port=\"8080\" protocol=\"org.apache.coyote.http11.Http11AprProtocol\" connectionTimeout=\"20000\" maxThreads=\"1000\" minSpareThreads=\"100\" maxSpareThreads=\"200\" acceptCount=\"900\" enableLookups=\"false\" compression=\"on\" compressionMinSize=\"1024\" compressableMimeType=\"text/html,text/xml,text/css,text/javascript\" redirectPort=\"8443\" URIEncoding=\"UTF-8\" maxHttpHeaderSize=\"8192\"/&gt;","text":"å¼•è¨€åœ¨ä½¿ç”¨Tomcatæ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°è¿æ¥æ•°ã€çº¿ç¨‹æ•°ä¹‹ç±»çš„é…ç½®ï¼Œç„¶åè‡ªå·±å°±å»è°·æ­Œã€ç™¾åº¦ï¼Œæ²¡æœ‰çœŸæ­£ç†è§£Tomcaté…ç½®çš„ä½œç”¨åŠå½“å‰ä¸šåŠ¡ç¯å¢ƒã€æœåŠ¡å™¨é…ç½®ç­‰æƒ…å†µä¸‹Tomcatæœ€ä¼˜é…ç½®ã€‚ 12345&lt;Connector port=\"8080\" protocol=\"org.apache.coyote.http11.Http11AprProtocol\" connectionTimeout=\"20000\" maxThreads=\"1000\" minSpareThreads=\"100\" maxSpareThreads=\"200\" acceptCount=\"900\" enableLookups=\"false\" compression=\"on\" compressionMinSize=\"1024\" compressableMimeType=\"text/html,text/xml,text/css,text/javascript\" redirectPort=\"8443\" URIEncoding=\"UTF-8\" maxHttpHeaderSize=\"8192\"/&gt; Tomcatè¿æ¥å™¨ï¼ˆConnectorï¼‰ä¸Šä¸€ç¯‡æ–‡ç« è¯´åˆ°è¿‡Tomcatçš„é…ç½®æ–‡ä»¶server.xml ï¼šConnectorçš„ä¸»è¦åŠŸèƒ½ï¼Œæ˜¯æ¥æ”¶è¿æ¥è¯·æ±‚ï¼Œåˆ›å»ºRequestå’ŒResponseå¯¹è±¡ç”¨äºå’Œè¯·æ±‚ç«¯äº¤æ¢æ•°æ®ï¼›ç„¶ååˆ†é…çº¿ç¨‹è®©Engineï¼ˆä¹Ÿå°±æ˜¯Servletå®¹å™¨ï¼‰æ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶æŠŠäº§ç”Ÿçš„Requestå’ŒResponseå¯¹è±¡ä¼ ç»™Engineã€‚å½“Engineå¤„ç†å®Œè¯·æ±‚åï¼Œä¹Ÿä¼šé€šè¿‡Connectorå°†å“åº”è¿”å›ç»™å®¢æˆ·ç«¯ã€‚ å¯ä»¥è¯´ï¼ŒServletå®¹å™¨å¤„ç†è¯·æ±‚ï¼Œæ˜¯éœ€è¦Connectorè¿›è¡Œè°ƒåº¦å’Œæ§åˆ¶çš„ï¼ŒConnectoræ˜¯Tomcatå¤„ç†è¯·æ±‚çš„ä¸»å¹²ï¼Œå› æ­¤Connectorçš„é…ç½®å’Œä½¿ç”¨å¯¹Tomcatçš„æ€§èƒ½æœ‰ç€é‡è¦çš„å½±å“ã€‚è¿™ç¯‡æ–‡å°†ä»Connectorå…¥æ‰‹ï¼Œè®¨è®ºä¸€äº›ä¸Connectoræœ‰å…³çš„é‡è¦é—®é¢˜ï¼ŒåŒ…æ‹¬NIO/BIOæ¨¡å¼ã€çº¿ç¨‹æ± ã€è¿æ¥æ•°ç­‰ã€‚ æ ¹æ®åè®®çš„ä¸åŒï¼ŒConnectorå¯ä»¥åˆ†ä¸ºHTTP Connectorã€AJP Connectorç­‰ï¼Œåœ¨è¿™ç¯‡æ–‡ç« æˆ‘ä»¬åªè®¨è®ºHTTP Connectorã€‚ BIOã€NIOã€APRConnectorçš„protocalConnectoråœ¨å¤„ç†HTTPè¯·æ±‚æ—¶ï¼Œä¼šä½¿ç”¨ä¸åŒçš„protocalã€‚ä¸åŒçš„Tomcatç‰ˆæœ¬æ”¯æŒçš„protocalä¸åŒï¼Œå…¶ä¸­æœ€å…¸å‹çš„protocolåŒ…æ‹¬BIOã€NIOå’ŒAPRï¼ˆTomcat7ä¸­æ”¯æŒè¿™3ç§ï¼ŒTomcat8å¢åŠ äº†å¯¹NIO2çš„æ”¯æŒï¼Œè€Œåˆ°äº†Tomcat8.5å’ŒTomcat9.0ï¼Œåˆ™å»æ‰äº†å¯¹BIOçš„æ”¯æŒï¼‰ã€‚ BIOæ˜¯Blocking IOï¼Œé¡¾åæ€ä¹‰æ˜¯é˜»å¡çš„IOï¼›NIOæ˜¯Non-blocking IOï¼Œåˆ™æ˜¯éé˜»å¡çš„IOã€‚è€ŒAPRæ˜¯Apache Portable Runtimeï¼Œæ˜¯Apacheå¯ç§»æ¤è¿è¡Œåº“ï¼Œåˆ©ç”¨æœ¬åœ°åº“å¯ä»¥å®ç°é«˜å¯æ‰©å±•æ€§ã€é«˜æ€§èƒ½ï¼›Apræ˜¯åœ¨Tomcatä¸Šè¿è¡Œé«˜å¹¶å‘åº”ç”¨çš„é¦–é€‰æ¨¡å¼ï¼Œä½†æ˜¯éœ€è¦å®‰è£…aprã€apr-utilsã€tomcat-nativeç­‰åŒ…ã€‚ æŒ‡å®šprotocalConnectorä½¿ç”¨å“ªç§protocolï¼Œå¯ä»¥é€šè¿‡&lt;connector&gt;å…ƒç´ ä¸­çš„protocolå±æ€§è¿›è¡ŒæŒ‡å®šï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨é»˜è®¤å€¼ã€‚ æŒ‡å®šçš„protocolå–å€¼åŠå¯¹åº”çš„åè®®å¦‚ä¸‹ï¼š HTTP/1.1ï¼šé»˜è®¤å€¼ï¼Œä½¿ç”¨çš„åè®®ä¸Tomcatç‰ˆæœ¬æœ‰å…³ org.apache.coyote.http11.Http11Protocolï¼šBIO org.apache.coyote.http11.Http11NioProtocolï¼šNIO org.apache.coyote.http11.Http11Nio2Protocolï¼šNIO2 org.apache.coyote.http11.Http11AprProtocolï¼šAPR å¦‚æœæ²¡æœ‰æŒ‡å®šprotocolï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼HTTP/1.1ï¼Œå…¶å«ä¹‰å¦‚ä¸‹ï¼šåœ¨Tomcat7ä¸­ï¼Œè‡ªåŠ¨é€‰å–ä½¿ç”¨BIOæˆ–APRï¼ˆå¦‚æœæ‰¾åˆ°APRéœ€è¦çš„æœ¬åœ°åº“ï¼Œåˆ™ä½¿ç”¨APRï¼Œå¦åˆ™ä½¿ç”¨BIOï¼‰ï¼›åœ¨Tomcat8ä¸­ï¼Œè‡ªåŠ¨é€‰å–ä½¿ç”¨NIOæˆ–APRï¼ˆå¦‚æœæ‰¾åˆ°APRéœ€è¦çš„æœ¬åœ°åº“ï¼Œåˆ™ä½¿ç”¨APRï¼Œå¦åˆ™ä½¿ç”¨NIOï¼‰ã€‚ BIOå’ŒNIOçš„ä¸åŒæ— è®ºæ˜¯BIOï¼Œè¿˜æ˜¯NIOï¼ŒConnectorå¤„ç†è¯·æ±‚çš„å¤§è‡´æµç¨‹æ˜¯ä¸€æ ·çš„ï¼š åœ¨accepté˜Ÿåˆ—ä¸­æ¥æ”¶è¿æ¥ï¼ˆå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸OSå®Œæˆä¸‰æ¬¡æ¡æ‰‹å»ºç«‹äº†è¿æ¥ï¼Œåˆ™OSå°†è¯¥è¿æ¥æ”¾å…¥accepté˜Ÿåˆ—ï¼‰ï¼›åœ¨è¿æ¥ä¸­è·å–è¯·æ±‚çš„æ•°æ®ï¼Œç”Ÿæˆrequestï¼›è°ƒç”¨servletå®¹å™¨å¤„ç†è¯·æ±‚ï¼›è¿”å›responseã€‚ä¸ºäº†ä¾¿äºåé¢çš„è¯´æ˜ï¼Œé¦–å…ˆæ˜ç¡®ä¸€ä¸‹è¿æ¥ä¸è¯·æ±‚çš„å…³ç³»ï¼šè¿æ¥æ˜¯TCPå±‚é¢çš„ï¼ˆä¼ è¾“å±‚ï¼‰ï¼Œå¯¹åº”socketï¼›è¯·æ±‚æ˜¯HTTPå±‚é¢çš„ï¼ˆåº”ç”¨å±‚ï¼‰ï¼Œå¿…é¡»ä¾èµ–äºTCPçš„è¿æ¥å®ç°ï¼›ä¸€ä¸ªTCPè¿æ¥ä¸­å¯èƒ½ä¼ è¾“å¤šä¸ªHTTPè¯·æ±‚ã€‚ åœ¨BIOå®ç°çš„Connectorä¸­ï¼Œå¤„ç†è¯·æ±‚çš„ä¸»è¦å®ä½“æ˜¯JIoEndpointå¯¹è±¡ã€‚JIoEndpointç»´æŠ¤äº†Acceptorå’ŒWorkerï¼šAcceptoræ¥æ”¶socketï¼Œç„¶åä»Workerçº¿ç¨‹æ± ä¸­æ‰¾å‡ºç©ºé—²çš„çº¿ç¨‹å¤„ç†socketï¼Œå¦‚æœworkerçº¿ç¨‹æ± æ²¡æœ‰ç©ºé—²çº¿ç¨‹ï¼Œåˆ™Acceptorå°†é˜»å¡ã€‚å…¶ä¸­Workeræ˜¯Tomcatè‡ªå¸¦çš„çº¿ç¨‹æ± ï¼Œå¦‚æœé€šè¿‡é…ç½®äº†å…¶ä»–çº¿ç¨‹æ± ï¼ŒåŸç†ä¸Workerç±»ä¼¼ã€‚ åœ¨NIOå®ç°çš„Connectorä¸­ï¼Œå¤„ç†è¯·æ±‚çš„ä¸»è¦å®ä½“æ˜¯NIoEndpointå¯¹è±¡ã€‚NIoEndpointä¸­é™¤äº†åŒ…å«Acceptorå’ŒWorkerå¤–ï¼Œè¿˜æ˜¯ç”¨äº†Pollerï¼Œå¤„ç†æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤º Acceptoræ¥æ”¶socketåï¼Œä¸æ˜¯ç›´æ¥ä½¿ç”¨Workerä¸­çš„çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œè€Œæ˜¯å…ˆå°†è¯·æ±‚å‘é€ç»™äº†Pollerï¼Œè€ŒPolleræ˜¯å®ç°NIOçš„å…³é”®ã€‚Acceptorå‘Pollerå‘é€è¯·æ±‚é€šè¿‡é˜Ÿåˆ—å®ç°ï¼Œä½¿ç”¨äº†å…¸å‹çš„ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å¼ã€‚åœ¨Pollerä¸­ï¼Œç»´æŠ¤äº†ä¸€ä¸ªSelectorå¯¹è±¡ï¼›å½“Pollerä»é˜Ÿåˆ—ä¸­å–å‡ºsocketåï¼Œæ³¨å†Œåˆ°è¯¥Selectorä¸­ï¼›ç„¶åé€šè¿‡éå†Selectorï¼Œæ‰¾å‡ºå…¶ä¸­å¯è¯»çš„socketï¼Œå¹¶ä½¿ç”¨Workerä¸­çš„çº¿ç¨‹å¤„ç†ç›¸åº”è¯·æ±‚ã€‚ä¸BIOç±»ä¼¼ï¼ŒWorkerä¹Ÿå¯ä»¥è¢«è‡ªå®šä¹‰çš„çº¿ç¨‹æ± ä»£æ›¿ã€‚ é€šè¿‡ä¸Šè¿°è¿‡ç¨‹å¯ä»¥çœ‹å‡ºï¼Œåœ¨NIoEndpointå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­ï¼Œæ— è®ºæ˜¯Acceptoræ¥æ”¶socketï¼Œè¿˜æ˜¯çº¿ç¨‹å¤„ç†è¯·æ±‚ï¼Œä½¿ç”¨çš„ä»ç„¶æ˜¯é˜»å¡æ–¹å¼ï¼›ä½†åœ¨â€œè¯»å–socketå¹¶äº¤ç»™Workerä¸­çš„çº¿ç¨‹â€çš„è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä½¿ç”¨éé˜»å¡çš„NIOå®ç°ï¼Œè¿™æ˜¯NIOæ¨¡å¼ä¸BIOæ¨¡å¼çš„æœ€ä¸»è¦åŒºåˆ«ï¼ˆå…¶ä»–åŒºåˆ«å¯¹æ€§èƒ½å½±å“è¾ƒå°ï¼Œæš‚æ—¶ç•¥å»ä¸æï¼‰ã€‚è€Œè¿™ä¸ªåŒºåˆ«ï¼Œåœ¨å¹¶å‘é‡è¾ƒå¤§çš„æƒ…å½¢ä¸‹å¯ä»¥å¸¦æ¥Tomcatæ•ˆç‡çš„æ˜¾è‘—æå‡ï¼š ç›®å‰å¤§å¤šæ•°HTTPè¯·æ±‚ä½¿ç”¨çš„æ˜¯é•¿è¿æ¥ï¼ˆHTTP/1.1é»˜è®¤keep-aliveä¸ºtrueï¼‰ï¼Œè€Œé•¿è¿æ¥æ„å‘³ç€ï¼Œä¸€ä¸ªTCPçš„socketåœ¨å½“å‰è¯·æ±‚ç»“æŸåï¼Œå¦‚æœæ²¡æœ‰æ–°çš„è¯·æ±‚åˆ°æ¥ï¼Œsocketä¸ä¼šç«‹é©¬é‡Šæ”¾ï¼Œè€Œæ˜¯ç­‰timeoutåå†é‡Šæ”¾ã€‚å¦‚æœä½¿ç”¨BIOï¼Œâ€œè¯»å–socketå¹¶äº¤ç»™Workerä¸­çš„çº¿ç¨‹â€è¿™ä¸ªè¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ„å‘³ç€åœ¨socketç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚æˆ–ç­‰å¾…é‡Šæ”¾çš„è¿‡ç¨‹ä¸­ï¼Œå¤„ç†è¿™ä¸ªsocketçš„å·¥ä½œçº¿ç¨‹ä¼šä¸€ç›´è¢«å ç”¨ï¼Œæ— æ³•é‡Šæ”¾ï¼›å› æ­¤Tomcatå¯ä»¥åŒæ—¶å¤„ç†çš„socketæ•°ç›®ä¸èƒ½è¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ï¼Œæ€§èƒ½å—åˆ°äº†æå¤§é™åˆ¶ã€‚è€Œä½¿ç”¨NIOï¼Œâ€œè¯»å–socketå¹¶äº¤ç»™Workerä¸­çš„çº¿ç¨‹â€è¿™ä¸ªè¿‡ç¨‹æ˜¯éé˜»å¡çš„ï¼Œå½“socketåœ¨ç­‰å¾…ä¸‹ä¸€ä¸ªè¯·æ±‚æˆ–ç­‰å¾…é‡Šæ”¾æ—¶ï¼Œå¹¶ä¸ä¼šå ç”¨å·¥ä½œçº¿ç¨‹ï¼Œå› æ­¤Tomcatå¯ä»¥åŒæ—¶å¤„ç†çš„socketæ•°ç›®è¿œå¤§äºæœ€å¤§çº¿ç¨‹æ•°ï¼Œå¹¶å‘æ€§èƒ½å¤§å¤§æé«˜ã€‚ acceptCountã€maxConnectionsã€maxThreadså‚æ•°Tomcatå¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ï¼šåœ¨accepté˜Ÿåˆ—ä¸­æ¥æ”¶è¿æ¥ï¼ˆå½“å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚æ—¶ï¼Œå¦‚æœå®¢æˆ·ç«¯ä¸OSå®Œæˆä¸‰æ¬¡æ¡æ‰‹å»ºç«‹äº†è¿æ¥ï¼Œåˆ™OSå°†è¯¥è¿æ¥æ”¾å…¥accepté˜Ÿåˆ—ï¼‰ï¼›åœ¨è¿æ¥ä¸­è·å–è¯·æ±‚çš„æ•°æ®ï¼Œç”Ÿæˆrequestï¼›è°ƒç”¨servletå®¹å™¨å¤„ç†è¯·æ±‚ï¼›è¿”å›responseã€‚ ç›¸å¯¹åº”çš„ï¼ŒConnectorä¸­çš„å‡ ä¸ªå‚æ•°åŠŸèƒ½å¦‚ä¸‹ï¼š acceptCountaccepté˜Ÿåˆ—çš„é•¿åº¦ï¼›å½“accepté˜Ÿåˆ—ä¸­è¿æ¥çš„ä¸ªæ•°è¾¾åˆ°acceptCountæ—¶ï¼Œé˜Ÿåˆ—æ»¡ï¼Œè¿›æ¥çš„è¯·æ±‚ä¸€å¾‹è¢«æ‹’ç»ã€‚é»˜è®¤å€¼æ˜¯100ã€‚ maxConnectionsTomcatåœ¨ä»»æ„æ—¶åˆ»æ¥æ”¶å’Œå¤„ç†çš„æœ€å¤§è¿æ¥æ•°ã€‚å½“Tomcatæ¥æ”¶çš„è¿æ¥æ•°è¾¾åˆ°maxConnectionsæ—¶ï¼ŒAcceptorçº¿ç¨‹ä¸ä¼šè¯»å–accepté˜Ÿåˆ—ä¸­çš„è¿æ¥ï¼›è¿™æ—¶accepté˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ä¼šä¸€ç›´é˜»å¡ç€ï¼Œç›´åˆ°Tomcatæ¥æ”¶çš„è¿æ¥æ•°å°äºmaxConnectionsã€‚å¦‚æœè®¾ç½®ä¸º-1ï¼Œåˆ™è¿æ¥æ•°ä¸å—é™åˆ¶ã€‚ é»˜è®¤å€¼ä¸è¿æ¥å™¨ä½¿ç”¨çš„åè®®æœ‰å…³ï¼šNIOçš„é»˜è®¤å€¼æ˜¯10000ï¼ŒAPR/nativeçš„é»˜è®¤å€¼æ˜¯8192ï¼Œè€ŒBIOçš„é»˜è®¤å€¼ä¸ºmaxThreadsï¼ˆå¦‚æœé…ç½®äº†Executorï¼Œåˆ™é»˜è®¤å€¼æ˜¯Executorçš„maxThreadsï¼‰ã€‚ åœ¨windowsä¸‹ï¼ŒAPR/nativeçš„maxConnectionså€¼ä¼šè‡ªåŠ¨è°ƒæ•´ä¸ºè®¾ç½®å€¼ä»¥ä¸‹æœ€å¤§çš„1024çš„æ•´æ•°å€ï¼›å¦‚è®¾ç½®ä¸º2000ï¼Œåˆ™æœ€å¤§å€¼å®é™…æ˜¯1024ã€‚ maxThreadsè¯·æ±‚å¤„ç†çº¿ç¨‹çš„æœ€å¤§æ•°é‡ã€‚é»˜è®¤å€¼æ˜¯200ï¼ˆTomcat7å’Œ8éƒ½æ˜¯çš„ï¼‰ã€‚å¦‚æœè¯¥Connectorç»‘å®šäº†Executorï¼Œè¿™ä¸ªå€¼ä¼šè¢«å¿½ç•¥ï¼Œå› ä¸ºè¯¥Connectorå°†ä½¿ç”¨ç»‘å®šçš„Executorï¼Œè€Œä¸æ˜¯å†…ç½®çš„çº¿ç¨‹æ± æ¥æ‰§è¡Œä»»åŠ¡ã€‚ maxThreadsè§„å®šçš„æ˜¯æœ€å¤§çš„çº¿ç¨‹æ•°ç›®ï¼Œå¹¶ä¸æ˜¯å®é™…runningçš„CPUæ•°é‡ï¼›å®é™…ä¸Šï¼ŒmaxThreadsçš„å¤§å°æ¯”CPUæ ¸å¿ƒæ•°é‡è¦å¤§å¾—å¤šã€‚è¿™æ˜¯å› ä¸ºï¼Œå¤„ç†è¯·æ±‚çš„çº¿ç¨‹çœŸæ­£ç”¨äºè®¡ç®—çš„æ—¶é—´å¯èƒ½å¾ˆå°‘ï¼Œå¤§å¤šæ•°æ—¶é—´å¯èƒ½åœ¨é˜»å¡ï¼Œå¦‚ç­‰å¾…æ•°æ®åº“è¿”å›æ•°æ®ã€ç­‰å¾…ç¡¬ç›˜è¯»å†™æ•°æ®ç­‰ã€‚å› æ­¤ï¼Œåœ¨æŸä¸€æ—¶åˆ»ï¼Œåªæœ‰å°‘æ•°çš„çº¿ç¨‹çœŸæ­£çš„åœ¨ä½¿ç”¨ç‰©ç†CPUï¼Œå¤§å¤šæ•°çº¿ç¨‹éƒ½åœ¨ç­‰å¾…ï¼›å› æ­¤çº¿ç¨‹æ•°è¿œå¤§äºç‰©ç†æ ¸å¿ƒæ•°æ‰æ˜¯åˆç†çš„ã€‚ æ¢å¥è¯è¯´ï¼ŒTomcaté€šè¿‡ä½¿ç”¨æ¯”CPUæ ¸å¿ƒæ•°é‡å¤šå¾—å¤šçš„çº¿ç¨‹æ•°ï¼Œå¯ä»¥ä½¿CPUå¿™ç¢Œèµ·æ¥ï¼Œå¤§å¤§æé«˜CPUçš„åˆ©ç”¨ç‡ã€‚ å‚æ•°è®¾ç½® maxThreadsçš„è®¾ç½®æ—¢ä¸åº”ç”¨çš„ç‰¹ç‚¹æœ‰å…³ï¼Œä¹Ÿä¸æœåŠ¡å™¨çš„CPUæ ¸å¿ƒæ•°é‡æœ‰å…³ã€‚é€šè¿‡å‰é¢ä»‹ç»å¯ä»¥çŸ¥é“ï¼ŒmaxThreadsæ•°é‡åº”è¯¥è¿œå¤§äºCPUæ ¸å¿ƒæ•°é‡ï¼›è€Œä¸”CPUæ ¸å¿ƒæ•°è¶Šå¤§ï¼ŒmaxThreadsåº”è¯¥è¶Šå¤§ï¼›åº”ç”¨ä¸­CPUè¶Šä¸å¯†é›†ï¼ˆIOè¶Šå¯†é›†ï¼‰ï¼ŒmaxThreadsåº”è¯¥è¶Šå¤§ï¼Œä»¥ä¾¿èƒ½å¤Ÿå……åˆ†åˆ©ç”¨CPUã€‚å½“ç„¶ï¼ŒmaxThreadsçš„å€¼å¹¶ä¸æ˜¯è¶Šå¤§è¶Šå¥½ï¼Œå¦‚æœmaxThreadsè¿‡å¤§ï¼Œé‚£ä¹ˆCPUä¼šèŠ±è´¹å¤§é‡çš„æ—¶é—´ç”¨äºçº¿ç¨‹çš„åˆ‡æ¢ï¼Œæ•´ä½“æ•ˆç‡ä¼šé™ä½ã€‚ maxConnectionsçš„è®¾ç½®ä¸Tomcatçš„è¿è¡Œæ¨¡å¼æœ‰å…³ã€‚å¦‚æœtomcatä½¿ç”¨çš„æ˜¯BIOï¼Œé‚£ä¹ˆmaxConnectionsçš„å€¼åº”è¯¥ä¸maxThreadsä¸€è‡´ï¼›å¦‚æœtomcatä½¿ç”¨çš„æ˜¯NIOï¼Œé‚£ä¹ˆç±»ä¼¼äºTomcatçš„é»˜è®¤å€¼ï¼ŒmaxConnectionså€¼åº”è¯¥è¿œå¤§äºmaxThreadsã€‚ é€šè¿‡å‰é¢çš„ä»‹ç»å¯ä»¥çŸ¥é“ï¼Œè™½ç„¶tomcatåŒæ—¶å¯ä»¥å¤„ç†çš„è¿æ¥æ•°ç›®æ˜¯maxConnectionsï¼Œä½†æœåŠ¡å™¨ä¸­å¯ä»¥åŒæ—¶æ¥æ”¶çš„è¿æ¥æ•°ä¸ºmaxConnections+acceptCount ã€‚acceptCountçš„è®¾ç½®ï¼Œä¸åº”ç”¨åœ¨è¿æ¥è¿‡é«˜æƒ…å†µä¸‹å¸Œæœ›åšå‡ºä»€ä¹ˆååº”æœ‰å…³ç³»ã€‚å¦‚æœè®¾ç½®è¿‡å¤§ï¼Œåé¢è¿›å…¥çš„è¯·æ±‚ç­‰å¾…æ—¶é—´ä¼šå¾ˆé•¿ï¼›å¦‚æœè®¾ç½®è¿‡å°ï¼Œåé¢è¿›å…¥çš„è¯·æ±‚ç«‹é©¬è¿”å›connection refusedã€‚ çº¿ç¨‹æ± ExecutorExecutorå…ƒç´ ä»£è¡¨Tomcatä¸­çš„çº¿ç¨‹æ± ï¼Œå¯ä»¥ç”±å…¶ä»–ç»„ä»¶å…±äº«ä½¿ç”¨ï¼›è¦ä½¿ç”¨è¯¥çº¿ç¨‹æ± ï¼Œç»„ä»¶éœ€è¦é€šè¿‡Executorå±æ€§æŒ‡å®šè¯¥çº¿ç¨‹æ± ã€‚ Executoræ˜¯Serviceå…ƒç´ çš„å†…åµŒå…ƒç´ ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä½¿ç”¨çº¿ç¨‹æ± çš„æ˜¯Connectorç»„ä»¶ï¼›ä¸ºäº†ä½¿Connectorèƒ½ä½¿ç”¨çº¿ç¨‹æ± ï¼ŒExecutorå…ƒç´ åº”è¯¥æ”¾åœ¨Connectorå‰é¢ã€‚Executorä¸Connectorçš„é…ç½®ä¸¾ä¾‹å¦‚ä¸‹ï¼š 123&lt;Executor name=\"tomcatThreadPool\" namePrefix =\"catalina-exec-\" maxThreads=\"150\" minSpareThreads=\"4\" /&gt;&lt;Connector executor=\"tomcatThreadPool\" port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" acceptCount=\"1000\" /&gt; Executorçš„ä¸»è¦å±æ€§åŒ…æ‹¬ï¼š nameï¼šè¯¥çº¿ç¨‹æ± çš„æ ‡è®° maxThreadsï¼šçº¿ç¨‹æ± ä¸­æœ€å¤§æ´»è·ƒçº¿ç¨‹æ•°ï¼Œé»˜è®¤å€¼200ï¼ˆTomcat7å’Œ8éƒ½æ˜¯ï¼‰ minSpareThreadsï¼šçº¿ç¨‹æ± ä¸­ä¿æŒçš„æœ€å°çº¿ç¨‹æ•°ï¼Œæœ€å°å€¼æ˜¯25 maxIdleTimeï¼šçº¿ç¨‹ç©ºé—²çš„æœ€å¤§æ—¶é—´ï¼Œå½“ç©ºé—²è¶…è¿‡è¯¥å€¼æ—¶å…³é—­çº¿ç¨‹ï¼ˆé™¤éçº¿ç¨‹æ•°å°äºminSpareThreadsï¼‰ï¼Œå•ä½æ˜¯msï¼Œé»˜è®¤å€¼60000ï¼ˆ1åˆ†é’Ÿï¼‰ daemonï¼šæ˜¯å¦åå°çº¿ç¨‹ï¼Œé»˜è®¤å€¼true threadPriorityï¼šçº¿ç¨‹ä¼˜å…ˆçº§ï¼Œé»˜è®¤å€¼5 namePrefixï¼šçº¿ç¨‹åå­—çš„å‰ç¼€ï¼Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹åå­—ä¸ºï¼šnamePrefix+çº¿ç¨‹ç¼–å· æŸ¥çœ‹å½“å‰çŠ¶æ€ä¸Šé¢ä»‹ç»äº†Tomcatè¿æ¥æ•°ã€çº¿ç¨‹æ•°çš„æ¦‚å¿µä»¥åŠå¦‚ä½•è®¾ç½®ï¼Œä¸‹é¢è¯´æ˜å¦‚ä½•æŸ¥çœ‹æœåŠ¡å™¨ä¸­çš„è¿æ¥æ•°å’Œçº¿ç¨‹æ•°ã€‚ æŸ¥çœ‹æœåŠ¡å™¨çš„çŠ¶æ€ï¼Œå¤§è‡´åˆ†ä¸ºä¸¤ç§æ–¹æ¡ˆï¼š jconsoleå·¥å…·ç°æˆçš„å·¥å…·ï¼Œå¦‚JDKè‡ªå¸¦çš„jconsoleå·¥å…·å¯ä»¥æ–¹ä¾¿çš„æŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯ï¼ˆæ­¤å¤–è¿˜å¯ä»¥æŸ¥çœ‹CPUã€å†…å­˜ã€ç±»ã€JVMåŸºæœ¬ä¿¡æ¯ç­‰ï¼‰ï¼ŒTomcatè‡ªå¸¦çš„managerï¼Œæ”¶è´¹å·¥å…·New Relicç­‰ã€‚ä¸‹å›¾æ˜¯jconsoleæŸ¥çœ‹çº¿ç¨‹ä¿¡æ¯çš„ç•Œé¢ï¼š Linuxå‘½ä»¤æŸ¥çœ‹å‡è®¾Tomcatæ¥æ”¶httpè¯·æ±‚çš„ç«¯å£æ˜¯8083ï¼Œåˆ™å¯ä»¥ä½¿ç”¨å¦‚ä¸‹è¯­å¥æŸ¥çœ‹è¿æ¥æƒ…å†µï¼š 1netstat â€“nat|grep 8080 ç»“æœå¦‚ä¸‹æ‰€ç¤ºï¼š å¯ä»¥çœ‹å‡ºï¼Œæœ‰ä¸€ä¸ªè¿æ¥å¤„äºlistençŠ¶æ€ï¼Œç›‘å¬è¯·æ±‚ï¼›é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰6ä¸ªå·²ç»å»ºç«‹çš„è¿æ¥ï¼ˆESTABLISHEDï¼‰å’Œ0ä¸ªç­‰å¾…å…³é—­çš„è¿æ¥ï¼ˆCLOSE_WAITï¼‰ã€‚ åŸæ–‡ï¼š https://mp.weixin.qq.com/s?__biz=MjM5NzMyMjAwMA==&amp;mid=2651479428&amp;idx=1&amp;sn=791fed1205da057aba77655aaac9d841&amp;chksm=bd2531fb8a52b8ed0066a8efc76d031ffb6e0d2099fb342129c307f78b4bf0581cbf3bbcb058&amp;mpshare=1&amp;scene=1&amp;srcid=1114Osu1mhmfSobleuByFbEC#rd","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"tomcat","slug":"tomcat","permalink":"https://sunny0715.github.io/tags/tomcat/"}]},{"title":"Tomcatå…¥é—¨","slug":"tomcatå…¥é—¨","date":"2017-12-20T06:35:32.000Z","updated":"2018-03-13T05:52:58.071Z","comments":true,"path":"2017/12/20/tomcatå…¥é—¨/","link":"","permalink":"https://sunny0715.github.io/2017/12/20/tomcatå…¥é—¨/","excerpt":"å¼•è¨€Tomcat æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾æºä»£ç çš„Web åº”ç”¨æœåŠ¡å™¨ï¼Œå±äºè½»é‡çº§åº”ç”¨æœåŠ¡å™¨ã€‚è¯´æ˜¯ç»å¸¸ç”¨åˆ°ï¼Œä¹Ÿåªæ˜¯ç†Ÿæ‚‰ï¼Œè¿˜æ²¡æ²¡æœ‰çœŸæ­£è¾¾åˆ°äº†è§£å…¶ä¸­çš„åŸç†å’Œå…¶ä¸­é…ç½®çš„æ„ä¹‰ï¼Œæœ€è¿‘ä¹Ÿæ‰¾äº†ä¸€äº›ä¹¦ç±æ¥çœ‹ï¼Œå…ˆå…¥é—¨ã€‚","text":"å¼•è¨€Tomcat æœåŠ¡å™¨æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æ”¾æºä»£ç çš„Web åº”ç”¨æœåŠ¡å™¨ï¼Œå±äºè½»é‡çº§åº”ç”¨æœåŠ¡å™¨ã€‚è¯´æ˜¯ç»å¸¸ç”¨åˆ°ï¼Œä¹Ÿåªæ˜¯ç†Ÿæ‚‰ï¼Œè¿˜æ²¡æ²¡æœ‰çœŸæ­£è¾¾åˆ°äº†è§£å…¶ä¸­çš„åŸç†å’Œå…¶ä¸­é…ç½®çš„æ„ä¹‰ï¼Œæœ€è¿‘ä¹Ÿæ‰¾äº†ä¸€äº›ä¹¦ç±æ¥çœ‹ï¼Œå…ˆå…¥é—¨ã€‚ Tomcatç®€ä»‹Tomcatçš„ä¸‹è½½åŒ…è§£å‹ä¹‹åçš„ç›®å½• Tomcatæ ¹ç›®å½•åœ¨Tomcatä¸­å«&lt;CATALINA_HOME&gt; &lt;CATALINA_HOME&gt;/binï¼šå­˜æ”¾å„ç§å¹³å°ä¸‹å¯åŠ¨å’Œå…³é—­Tomcatçš„è„šæœ¬æ–‡ä»¶ã€‚å…¶ä¸­æœ‰ä¸ªæ˜¯catalina.batï¼Œæ‰“å¼€è¿™ä¸ªwindowsé…ç½®æ–‡ä»¶ï¼Œåœ¨éæ³¨é‡Šè¡ŒåŠ å…¥JDKè·¯å¾„,ä¾‹å¦‚ : SET JAVA_HOME=C:\\Program Files\\Java\\jdk1.8.0_141ï¼Œå…¶ä¸­å¯¹JDKçš„ä¼˜åŒ–ä¹Ÿåœ¨catalina.batä¸­é…ç½®ï¼Œä¿å­˜åå°±é…ç½®å¥½Tomcatç¯å¢ƒäº†ã€‚ startup.batæ˜¯windowsä¸‹å¯åŠ¨Tomcatçš„è„šæœ¬æ–‡ä»¶ï¼Œshutdown.batæ˜¯å…³é—­Tomcatçš„è„šæœ¬æ–‡ä»¶ã€‚ &lt;CATALINA_HOME&gt;/confï¼šå­˜æ”¾ä¸åŒçš„é…ç½®æ–‡ä»¶ï¼ˆå¦‚ï¼šserver.xmlå’Œweb.xmlï¼‰ server.xmlæ–‡ä»¶ï¼šè¯¥æ–‡ä»¶ç”¨äºé…ç½®å’Œserverç›¸å…³çš„ä¿¡æ¯ï¼Œæ¯”å¦‚tomcatå¯åŠ¨çš„ç«¯å£å·ã€é…ç½®hostä¸»æœºã€é…ç½®Contextï¼Œæ¥ä¸‹æ¥ä¼šé‡ç‚¹è®²è¿°ã€‚ web.xmlæ–‡ä»¶ï¼šéƒ¨ç½²æè¿°æ–‡ä»¶ï¼Œè¿™ä¸ªweb.xmlä¸­æè¿°äº†ä¸€äº›é»˜è®¤çš„servletï¼Œéƒ¨ç½²æ¯ä¸ªwebappæ—¶ï¼Œéƒ½ä¼šè°ƒç”¨è¿™ä¸ªæ–‡ä»¶ï¼Œé…ç½®è¯¥webåº”ç”¨çš„é»˜è®¤servletã€‚ tomcat-users.xmlæ–‡ä»¶ï¼šé…ç½®tomcatçš„ç”¨æˆ·å¯†ç ä¸æƒé™ã€‚ context.xmlï¼šå®šä¹‰webåº”ç”¨çš„é»˜è®¤è¡Œä¸ºã€‚&lt;CATALINA_HOME&gt;/libï¼šå­˜æ”¾Tomcatè¿è¡Œéœ€è¦çš„åº“æ–‡ä»¶ï¼ˆJarsï¼‰ï¼›&lt;CATALINA_HOME&gt;/logsï¼šå­˜æ”¾Tomcatæ‰§è¡Œæ—¶çš„logæ–‡ä»¶ï¼›&lt;CATALINA_HOME&gt;/tempï¼š å­˜æ”¾Tomcatè¿è¡Œæ—¶äº§ç”Ÿçš„æ–‡ä»¶ï¼Œå¦‚ç¼“å­˜ç­‰ï¼›&lt;CATALINA_HOME&gt;/webappsï¼šTomcatçš„ä¸»è¦Webå‘å¸ƒç›®å½•ï¼ˆåŒ…æ‹¬åº”ç”¨ç¨‹åºç¤ºä¾‹ï¼‰ï¼› &lt;CATALINA_HOME&gt;/workï¼šå­˜æ”¾jspç¼–è¯‘åäº§ç”Ÿçš„classæ–‡ä»¶ï¼› ã€Tomcatçš„å¯åŠ¨è¿‡ç¨‹ã€‘Tomcat å…ˆæ ¹æ®/conf/server.xml ä¸‹çš„é…ç½®å¯åŠ¨Serverï¼Œå†åŠ è½½Serviceï¼Œå¯¹äºä¸Engineç›¸åŒ¹é…çš„Hostï¼Œæ¯ä¸ªHost ä¸‹é¢éƒ½æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªContextã€‚ æ³¨æ„ï¼šContext æ—¢å¯é…ç½®åœ¨server.xml ä¸‹ï¼Œä¹Ÿå¯é…ç½®æˆä¸€å•ç‹¬çš„æ–‡ä»¶ï¼Œæ”¾åœ¨conf\\Catalina\\localhost ä¸‹ï¼Œç®€ç§°åº”ç”¨é…ç½®æ–‡ä»¶ã€‚ Web Application å¯¹åº”ä¸€ä¸ªContextï¼Œæ¯ä¸ªWeb Application ç”±ä¸€ä¸ªæˆ–å¤šä¸ªServlet ç»„æˆã€‚å½“ä¸€ä¸ªWeb Application è¢«åˆå§‹åŒ–çš„æ—¶å€™ï¼Œå®ƒå°†ç”¨è‡ªå·±çš„ClassLoader å¯¹è±¡è½½å…¥éƒ¨ç½²é…ç½®æ–‡ä»¶web.xml ä¸­å®šä¹‰çš„æ¯ä¸ªServlet ç±»ï¼šå®ƒé¦–å…ˆè½½å…¥åœ¨$CATALINA_HOME/conf/web.xmlä¸­éƒ¨ç½²çš„Servlet ç±»ï¼Œç„¶åè½½å…¥åœ¨è‡ªå·±çš„Web Application æ ¹ç›®å½•ä¸‹WEB-INF/web.xml ä¸­éƒ¨ç½²çš„Servlet ç±»ã€‚ web.xml æ–‡ä»¶æœ‰ä¸¤éƒ¨åˆ†ï¼šServlet ç±»å®šä¹‰å’ŒServlet æ˜ å°„å®šä¹‰ã€‚æ¯ä¸ªè¢«è½½å…¥çš„Servlet ç±»éƒ½æœ‰ä¸€ä¸ªåå­—ï¼Œä¸”è¢«å¡«å…¥è¯¥Context çš„æ˜ å°„è¡¨(mapping table)ä¸­ï¼Œå’ŒæŸç§URL è·¯å¾„å¯¹åº”ã€‚å½“è¯¥Context è·å¾—è¯·æ±‚æ—¶ï¼Œå°†æŸ¥è¯¢mapping tableï¼Œæ‰¾åˆ°è¢«è¯·æ±‚çš„Servletï¼Œå¹¶æ‰§è¡Œä»¥è·å¾—è¯·æ±‚å“åº”ã€‚ Tomcatä¸€ä¸ªserverå®ä¾‹12345678910111213141516171819202122232425262728293031&lt;Server port=\"8005\" shutdown=\"SHUTDOWN\"&gt; &lt;Listener className=\"org.apache.catalina.startup.VersionLoggerListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.AprLifecycleListener\" SSLEngine=\"on\" /&gt; &lt;Listener className=\"org.apache.catalina.core.JasperListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.JreMemoryLeakPreventionListener\" /&gt; &lt;Listener className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.ThreadLocalLeakPreventionListener\" /&gt; &lt;GlobalNamingResources&gt; &lt;Resource name=\"UserDatabase\" auth=\"Container\" type=\"org.apache.catalina.UserDatabase\" description=\"User database that can be updated and saved\" factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\" pathname=\"conf/tomcat-users.xml\" /&gt; &lt;/GlobalNamingResources&gt; &lt;Service name=\"Catalina\"&gt; &lt;Connector port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" /&gt; &lt;Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /&gt; &lt;Engine name=\"Catalina\" defaultHost=\"localhost\"&gt; &lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt; &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" resourceName=\"UserDatabase\"/&gt; &lt;/Realm&gt; &lt;Host name=\"localhost\" appBase=\"webapps\" unpackWARs=\"true\" autoDeploy=\"true\"&gt; &lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\" prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt; &lt;/Host&gt; &lt;/Engine&gt; &lt;/Service&gt;&lt;/Server&gt; server.xmlæ–‡æ¡£çš„å…ƒç´ åˆ†ç±»å’Œæ•´ä½“ç»“æ„æ•´ä½“ç»“æ„server.xmlçš„æ•´ä½“ç»“æ„å¦‚ä¸‹ï¼š 1234567891011&lt;Server&gt; &lt;Service&gt; &lt;Connector/&gt; &lt;Connector/&gt; &lt;Engine&gt; &lt;Host&gt; &lt;Context/&gt;&lt;!-- ç°åœ¨å¸¸å¸¸ä½¿ç”¨è‡ªåŠ¨éƒ¨ç½²ï¼Œä¸æ¨èé…ç½®Contextå…ƒç´ ï¼ŒContextå°èŠ‚æœ‰è¯¦ç»†è¯´æ˜ --&gt; &lt;/Host&gt; &lt;/Engine&gt; &lt;/Service&gt;&lt;/Server&gt; è¯¥ç»“æ„ä¸­åªç»™å‡ºäº†Tomcatçš„æ ¸å¿ƒç»„ä»¶ï¼Œé™¤äº†æ ¸å¿ƒç»„ä»¶å¤–ï¼ŒTomcatè¿˜æœ‰ä¸€äº›å…¶ä»–ç»„ä»¶ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹ç»„ä»¶çš„åˆ†ç±»ã€‚ å…ƒç´ åˆ†ç±»server.xmlæ–‡ä»¶ä¸­çš„å…ƒç´ å¯ä»¥åˆ†ä¸ºä»¥ä¸‹4ç±»ï¼š ï¼ˆ1ï¼‰é¡¶å±‚å…ƒç´ ï¼š&lt;Server&gt;å’Œ&lt;Service&gt; &lt;Server&gt;å…ƒç´ æ˜¯æ•´ä¸ªé…ç½®æ–‡ä»¶çš„æ ¹å…ƒç´ ï¼Œ&lt;Service&gt;å…ƒç´ åˆ™ä»£è¡¨ä¸€ä¸ªEngineå…ƒç´ ä»¥åŠä¸€ç»„ä¸ä¹‹ç›¸è¿çš„Connectorå…ƒç´ ã€‚ ï¼ˆ2ï¼‰è¿æ¥å™¨ï¼š&lt;Connector&gt; &lt;Connector&gt;ä»£è¡¨äº†å¤–éƒ¨å®¢æˆ·ç«¯å‘é€è¯·æ±‚åˆ°ç‰¹å®šServiceçš„æ¥å£ï¼›åŒæ—¶ä¹Ÿæ˜¯å¤–éƒ¨å®¢æˆ·ç«¯ä»ç‰¹å®šServiceæ¥æ”¶å“åº”çš„æ¥å£ã€‚ ï¼ˆ3ï¼‰å®¹å™¨ï¼š&lt;Engine&gt;&lt;Host&gt;&lt;Context&gt; å®¹å™¨çš„åŠŸèƒ½æ˜¯å¤„ç†Connectoræ¥æ”¶è¿›æ¥çš„è¯·æ±‚ï¼Œå¹¶äº§ç”Ÿç›¸åº”çš„å“åº”ã€‚Engineã€Hostå’ŒContextéƒ½æ˜¯å®¹å™¨ï¼Œä½†å®ƒä»¬ä¸æ˜¯å¹³è¡Œçš„å…³ç³»ï¼Œè€Œæ˜¯çˆ¶å­å…³ç³»ï¼šEngineåŒ…å«Hostï¼ŒHoståŒ…å«Contextã€‚ä¸€ä¸ªEngineç»„ä»¶å¯ä»¥å¤„ç†Serviceä¸­çš„æ‰€æœ‰è¯·æ±‚ï¼Œä¸€ä¸ªHostç»„ä»¶å¯ä»¥å¤„ç†å‘å‘ä¸€ä¸ªç‰¹å®šè™šæ‹Ÿä¸»æœºçš„æ‰€æœ‰è¯·æ±‚ï¼Œä¸€ä¸ªContextç»„ä»¶å¯ä»¥å¤„ç†ä¸€ä¸ªç‰¹å®šWebåº”ç”¨çš„æ‰€æœ‰è¯·æ±‚ã€‚ ï¼ˆ4ï¼‰å†…åµŒç»„ä»¶ï¼šå¯ä»¥å†…åµŒåˆ°å®¹å™¨ä¸­çš„ç»„ä»¶ã€‚å®é™…ä¸Šï¼ŒServerã€Serviceã€Connectorã€Engineã€Hostå’ŒContextæ˜¯æœ€é‡è¦çš„æœ€æ ¸å¿ƒçš„Tomcatç»„ä»¶ï¼Œå…¶ä»–ç»„ä»¶éƒ½å¯ä»¥å½’ä¸ºå†…åµŒç»„ä»¶ã€‚ æ ¸å¿ƒç»„ä»¶1ã€Server Serverå…ƒç´ åœ¨æœ€é¡¶å±‚ï¼Œä»£è¡¨æ•´ä¸ªTomcatå®¹å™¨ï¼Œå› æ­¤å®ƒå¿…é¡»æ˜¯server.xmlä¸­å”¯ä¸€ä¸€ä¸ªæœ€å¤–å±‚çš„å…ƒç´ ã€‚ä¸€ä¸ªServerå…ƒç´ ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªServiceå…ƒç´ ã€‚ åœ¨ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼Œåœ¨æœ€å¤–å±‚æœ‰ä¸€ä¸ª&lt;Server&gt;å…ƒç´ ï¼Œshutdownå±æ€§è¡¨ç¤ºå…³é—­Serverçš„æŒ‡ä»¤ï¼›portå±æ€§è¡¨ç¤ºServeræ¥æ”¶shutdownæŒ‡ä»¤çš„ç«¯å£å·ï¼Œè®¾ä¸º-1å¯ä»¥ç¦æ‰è¯¥ç«¯å£ã€‚ Serverçš„ä¸»è¦ä»»åŠ¡ï¼Œå°±æ˜¯æä¾›ä¸€ä¸ªæ¥å£è®©å®¢æˆ·ç«¯èƒ½å¤Ÿè®¿é—®åˆ°è¿™ä¸ªServiceé›†åˆï¼ŒåŒæ—¶ç»´æŠ¤å®ƒæ‰€åŒ…å«çš„æ‰€æœ‰çš„Serviceçš„å£°æ˜å‘¨æœŸï¼ŒåŒ…æ‹¬å¦‚ä½•åˆå§‹åŒ–ã€å¦‚ä½•ç»“æŸæœåŠ¡ã€å¦‚ä½•æ‰¾åˆ°å®¢æˆ·ç«¯è¦è®¿é—®çš„Serviceã€‚ 2ã€Service Serviceçš„ä½œç”¨ï¼Œæ˜¯åœ¨Connectorå’ŒEngineå¤–é¢åŒ…äº†ä¸€å±‚ï¼ŒæŠŠå®ƒä»¬ç»„è£…åœ¨ä¸€èµ·ï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚ä¸€ä¸ªServiceå¯ä»¥åŒ…å«å¤šä¸ªConnectorï¼Œä½†æ˜¯åªèƒ½åŒ…å«ä¸€ä¸ªEngineï¼›å…¶ä¸­Connectorçš„ä½œç”¨æ˜¯ä»å®¢æˆ·ç«¯æ¥æ”¶è¯·æ±‚ï¼ŒEngineçš„ä½œç”¨æ˜¯å¤„ç†æ¥æ”¶è¿›æ¥çš„è¯·æ±‚ã€‚ åœ¨ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼ŒServerä¸­åŒ…å«ä¸€ä¸ªåç§°ä¸ºâ€œCatalinaâ€çš„Serviceã€‚å®é™…ä¸Šï¼ŒTomcatå¯ä»¥æä¾›å¤šä¸ªServiceï¼Œä¸åŒçš„Serviceç›‘å¬ä¸åŒçš„ç«¯å£ã€‚ 3ã€Connector Connectorçš„ä¸»è¦åŠŸèƒ½ï¼Œæ˜¯æ¥æ”¶è¿æ¥è¯·æ±‚ï¼Œåˆ›å»ºRequestå’ŒResponseå¯¹è±¡ç”¨äºå’Œè¯·æ±‚ç«¯äº¤æ¢æ•°æ®ï¼›ç„¶ååˆ†é…çº¿ç¨‹è®©Engineæ¥å¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œå¹¶æŠŠäº§ç”Ÿçš„Requestå’ŒResponseå¯¹è±¡ä¼ ç»™Engineã€‚ é€šè¿‡é…ç½®Connectorï¼Œå¯ä»¥æ§åˆ¶è¯·æ±‚Serviceçš„åè®®åŠç«¯å£å·ã€‚åœ¨ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼ŒServiceåŒ…å«ä¸¤ä¸ªConnectorï¼š &lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot; connectionTimeout=&quot;20000&quot; redirectPort=&quot;8443&quot; /&gt; &lt;Connector port=&quot;8009&quot; protocol=&quot;AJP/1.3&quot; redirectPort=&quot;8443&quot; /&gt; ï¼ˆ1ï¼‰é€šè¿‡é…ç½®ç¬¬1ä¸ªConnectorï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡8080ç«¯å£å·ä½¿ç”¨httpåè®®è®¿é—®Tomcatã€‚å…¶ä¸­ï¼Œprotocolå±æ€§è§„å®šäº†è¯·æ±‚çš„åè®®ï¼Œportè§„å®šäº†è¯·æ±‚çš„ç«¯å£å·ï¼ŒredirectPortè¡¨ç¤ºå½“å¼ºåˆ¶è¦æ±‚httpsè€Œè¯·æ±‚æ˜¯httpæ—¶ï¼Œé‡å®šå‘è‡³ç«¯å£å·ä¸º8443çš„Connectorï¼ŒconnectionTimeoutè¡¨ç¤ºè¿æ¥çš„è¶…æ—¶æ—¶é—´ã€‚ åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼ŒTomcatç›‘å¬HTTPè¯·æ±‚ï¼Œä½¿ç”¨çš„æ˜¯8080ç«¯å£ï¼Œè€Œä¸æ˜¯æ­£å¼çš„80ç«¯å£ï¼›å®é™…ä¸Šï¼Œåœ¨æ­£å¼çš„ç”Ÿäº§ç¯å¢ƒä¸­ï¼ŒTomcatä¹Ÿå¸¸å¸¸ç›‘å¬8080ç«¯å£ï¼Œè€Œä¸æ˜¯80ç«¯å£ã€‚è¿™æ˜¯å› ä¸ºåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œå¾ˆå°‘å°†Tomcatç›´æ¥å¯¹å¤–å¼€æ”¾æ¥æ”¶è¯·æ±‚ï¼Œè€Œæ˜¯åœ¨Tomcatå’Œå®¢æˆ·ç«¯ä¹‹é—´åŠ ä¸€å±‚ä»£ç†æœåŠ¡å™¨(å¦‚nginx)ï¼Œç”¨äºè¯·æ±‚çš„è½¬å‘ã€è´Ÿè½½å‡è¡¡ã€å¤„ç†é™æ€æ–‡ä»¶ç­‰ï¼›é€šè¿‡ä»£ç†æœåŠ¡å™¨è®¿é—®Tomcatæ—¶ï¼Œæ˜¯åœ¨å±€åŸŸç½‘ä¸­ï¼Œå› æ­¤ä¸€èˆ¬ä»ä½¿ç”¨8080ç«¯å£ã€‚ ï¼ˆ2ï¼‰é€šè¿‡é…ç½®ç¬¬2ä¸ªConnectorï¼Œå®¢æˆ·ç«¯å¯ä»¥é€šè¿‡8009ç«¯å£å·ä½¿ç”¨AJPåè®®è®¿é—®Tomcatã€‚AJPåè®®è´Ÿè´£å’Œå…¶ä»–çš„HTTPæœåŠ¡å™¨(å¦‚Apache)å»ºç«‹è¿æ¥ï¼›åœ¨æŠŠTomcatä¸å…¶ä»–HTTPæœåŠ¡å™¨é›†æˆæ—¶ï¼Œå°±éœ€è¦ç”¨åˆ°è¿™ä¸ªè¿æ¥å™¨ã€‚ä¹‹æ‰€ä»¥ä½¿ç”¨Tomcatå’Œå…¶ä»–æœåŠ¡å™¨é›†æˆï¼Œæ˜¯å› ä¸ºTomcatå¯ä»¥ç”¨ä½œServlet/JSPå®¹å™¨ï¼Œä½†æ˜¯å¯¹é™æ€èµ„æºçš„å¤„ç†é€Ÿåº¦è¾ƒæ…¢ï¼Œä¸å¦‚Apacheå’ŒIISç­‰HTTPæœåŠ¡å™¨ï¼›å› æ­¤å¸¸å¸¸å°†Tomcatä¸Apacheç­‰é›†æˆï¼Œå‰è€…ä½œServletå®¹å™¨ï¼Œåè€…å¤„ç†é™æ€èµ„æºï¼Œè€ŒAJPåè®®ä¾¿è´Ÿè´£Tomcatå’ŒApacheçš„è¿æ¥ã€‚Tomcatä¸Apacheç­‰é›†æˆçš„åŸç†å¦‚ä¸‹å›¾ï¼š 4ã€Engine Engineç»„ä»¶åœ¨Serviceç»„ä»¶ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªï¼›Engineæ˜¯Serviceç»„ä»¶ä¸­çš„è¯·æ±‚å¤„ç†ç»„ä»¶ã€‚Engineç»„ä»¶ä»ä¸€ä¸ªæˆ–å¤šä¸ªConnectorä¸­æ¥æ”¶è¯·æ±‚å¹¶å¤„ç†ï¼Œå¹¶å°†å®Œæˆçš„å“åº”è¿”å›ç»™Connectorï¼Œæœ€ç»ˆä¼ é€’ç»™å®¢æˆ·ç«¯ã€‚ å‰é¢å·²ç»æåˆ°è¿‡ï¼ŒEngineã€Hostå’ŒContextéƒ½æ˜¯å®¹å™¨ï¼Œä½†å®ƒä»¬ä¸æ˜¯å¹³è¡Œçš„å…³ç³»ï¼Œè€Œæ˜¯çˆ¶å­å…³ç³»ï¼šEngineåŒ…å«Hostï¼ŒHoståŒ…å«Contextã€‚ åœ¨ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼ŒEngineçš„é…ç½®è¯­å¥å¦‚ä¸‹ï¼š &lt;Engine name=&quot;Catalina&quot; defaultHost=&quot;localhost&quot;&gt; å…¶ä¸­ï¼Œnameå±æ€§ç”¨äºæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯ï¼Œåœ¨æ•´ä¸ªServerä¸­åº”è¯¥å”¯ä¸€ã€‚defaultHostå±æ€§æŒ‡å®šäº†é»˜è®¤çš„hoståç§°ï¼Œå½“å‘å¾€æœ¬æœºçš„è¯·æ±‚æŒ‡å®šçš„hoståç§°ä¸å­˜åœ¨æ—¶ï¼Œä¸€å¾‹ä½¿ç”¨defaultHostæŒ‡å®šçš„hostè¿›è¡Œå¤„ç†ï¼›å› æ­¤ï¼ŒdefaultHostçš„å€¼ï¼Œå¿…é¡»ä¸Engineä¸­çš„ä¸€ä¸ªHostç»„ä»¶çš„nameå±æ€§å€¼åŒ¹é…ã€‚ 5ã€Host ï¼ˆ1ï¼‰Engineä¸Host Hostæ˜¯Engineçš„å­å®¹å™¨ã€‚Engineç»„ä»¶ä¸­å¯ä»¥å†…åµŒ1ä¸ªæˆ–å¤šä¸ªHostç»„ä»¶ï¼Œæ¯ä¸ªHostç»„ä»¶ä»£è¡¨Engineä¸­çš„ä¸€ä¸ªè™šæ‹Ÿä¸»æœºã€‚Hostç»„ä»¶è‡³å°‘æœ‰ä¸€ä¸ªï¼Œä¸”å…¶ä¸­ä¸€ä¸ªçš„nameå¿…é¡»ä¸Engineç»„ä»¶çš„defaultHostå±æ€§ç›¸åŒ¹é…ã€‚ ï¼ˆ2ï¼‰Hostçš„ä½œç”¨ Hostè™šæ‹Ÿä¸»æœºçš„ä½œç”¨ï¼Œæ˜¯è¿è¡Œå¤šä¸ªWebåº”ç”¨ï¼ˆä¸€ä¸ªContextä»£è¡¨ä¸€ä¸ªWebåº”ç”¨ï¼‰ï¼Œå¹¶è´Ÿè´£å®‰è£…ã€å±•å¼€ã€å¯åŠ¨å’Œç»“æŸæ¯ä¸ªWebåº”ç”¨ã€‚ Hostç»„ä»¶ä»£è¡¨çš„è™šæ‹Ÿä¸»æœºï¼Œå¯¹åº”äº†æœåŠ¡å™¨ä¸­ä¸€ä¸ªç½‘ç»œåå®ä½“(å¦‚â€www.test.comâ€ï¼Œæˆ–IPåœ°å€â€116.25.25.25â€)ï¼›ä¸ºäº†ä½¿ç”¨æˆ·å¯ä»¥é€šè¿‡ç½‘ç»œåè¿æ¥TomcatæœåŠ¡å™¨ï¼Œè¿™ä¸ªåå­—åº”è¯¥åœ¨DNSæœåŠ¡å™¨ä¸Šæ³¨å†Œã€‚ å®¢æˆ·ç«¯é€šå¸¸ä½¿ç”¨ä¸»æœºåæ¥æ ‡è¯†å®ƒä»¬å¸Œæœ›è¿æ¥çš„æœåŠ¡å™¨ï¼›è¯¥ä¸»æœºåä¹Ÿä¼šåŒ…å«åœ¨HTTPè¯·æ±‚å¤´ä¸­ã€‚Tomcatä»HTTPå¤´ä¸­æå–å‡ºä¸»æœºåï¼Œå¯»æ‰¾åç§°åŒ¹é…çš„ä¸»æœºã€‚å¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œè¯·æ±‚å°†å‘é€è‡³é»˜è®¤ä¸»æœºã€‚å› æ­¤é»˜è®¤ä¸»æœºä¸éœ€è¦æ˜¯åœ¨DNSæœåŠ¡å™¨ä¸­æ³¨å†Œçš„ç½‘ç»œåï¼Œå› ä¸ºä»»ä½•ä¸æ‰€æœ‰Hoståç§°ä¸åŒ¹é…çš„è¯·æ±‚ï¼Œéƒ½ä¼šè·¯ç”±è‡³é»˜è®¤ä¸»æœºã€‚ ï¼ˆ3ï¼‰Hostçš„é…ç½® åœ¨ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼ŒHostçš„é…ç½®å¦‚ä¸‹ï¼š &lt;Host name=&quot;localhost&quot; appBase=&quot;webapps&quot; unpackWARs=&quot;true&quot; autoDeploy=&quot;true&quot;&gt; ä¸‹é¢å¯¹å…¶ä¸­é…ç½®çš„å±æ€§è¿›è¡Œè¯´æ˜ï¼š nameå±æ€§æŒ‡å®šè™šæ‹Ÿä¸»æœºçš„ä¸»æœºåï¼Œä¸€ä¸ªEngineä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªHostç»„ä»¶çš„nameå±æ€§ä¸Engineç»„ä»¶çš„defaultHostå±æ€§ç›¸åŒ¹é…ï¼›ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸»æœºåéœ€è¦æ˜¯åœ¨DNSæœåŠ¡å™¨ä¸­æ³¨å†Œçš„ç½‘ç»œåï¼Œä½†æ˜¯EngineæŒ‡å®šçš„defaultHostä¸éœ€è¦ï¼ŒåŸå› åœ¨å‰é¢å·²ç»è¯´æ˜ã€‚ unpackWARsæŒ‡å®šäº†æ˜¯å¦å°†ä»£è¡¨Webåº”ç”¨çš„WARæ–‡ä»¶è§£å‹ï¼›å¦‚æœä¸ºtrueï¼Œé€šè¿‡è§£å‹åçš„æ–‡ä»¶ç»“æ„è¿è¡Œè¯¥Webåº”ç”¨ï¼Œå¦‚æœä¸ºfalseï¼Œç›´æ¥ä½¿ç”¨WARæ–‡ä»¶è¿è¡ŒWebåº”ç”¨ã€‚ Hostçš„autoDeployå’ŒappBaseå±æ€§ï¼Œä¸Hostå†…Webåº”ç”¨çš„è‡ªåŠ¨éƒ¨ç½²æœ‰å…³ï¼›æ­¤å¤–ï¼Œæœ¬ä¾‹ä¸­æ²¡æœ‰å‡ºç°çš„xmlBaseå’ŒdeployOnStartupå±æ€§ï¼Œä¹Ÿä¸Webåº”ç”¨çš„è‡ªåŠ¨éƒ¨ç½²æœ‰å…³ã€‚ 6ã€Context ï¼ˆ1ï¼‰Contextçš„ä½œç”¨ Contextå…ƒç´ ä»£è¡¨åœ¨ç‰¹å®šè™šæ‹Ÿä¸»æœºä¸Šè¿è¡Œçš„ä¸€ä¸ªWebåº”ç”¨ã€‚åœ¨åæ–‡ä¸­ï¼Œæåˆ°Contextã€åº”ç”¨æˆ–Webåº”ç”¨ï¼Œå®ƒä»¬æŒ‡ä»£çš„éƒ½æ˜¯Webåº”ç”¨ã€‚æ¯ä¸ªWebåº”ç”¨åŸºäºWARæ–‡ä»¶ï¼Œæˆ–WARæ–‡ä»¶è§£å‹åå¯¹åº”çš„ç›®å½•ï¼ˆè¿™é‡Œç§°ä¸ºåº”ç”¨ç›®å½•ï¼‰ã€‚ Contextæ˜¯Hostçš„å­å®¹å™¨ï¼Œæ¯ä¸ªHostä¸­å¯ä»¥å®šä¹‰ä»»æ„å¤šçš„Contextå…ƒç´ ã€‚ åœ¨ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼Œå¯ä»¥çœ‹åˆ°server.xmlé…ç½®æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰å‡ºç°Contextå…ƒç´ çš„é…ç½®ã€‚è¿™æ˜¯å› ä¸ºï¼ŒTomcatå¼€å¯äº†è‡ªåŠ¨éƒ¨ç½²ï¼ŒWebåº”ç”¨æ²¡æœ‰åœ¨server.xmlä¸­é…ç½®é™æ€éƒ¨ç½²ï¼Œè€Œæ˜¯ç”±Tomcaté€šè¿‡ç‰¹å®šçš„è§„åˆ™è‡ªåŠ¨éƒ¨ç½²ã€‚ä¸‹é¢ä»‹ç»ä¸€ä¸‹Tomcatè‡ªåŠ¨éƒ¨ç½²Webåº”ç”¨çš„æœºåˆ¶ã€‚ ï¼ˆ2ï¼‰Webåº”ç”¨è‡ªåŠ¨éƒ¨ç½² Hostçš„é…ç½® è¦å¼€å¯Webåº”ç”¨çš„è‡ªåŠ¨éƒ¨ç½²ï¼Œéœ€è¦é…ç½®æ‰€åœ¨çš„è™šæ‹Ÿä¸»æœºï¼›é…ç½®çš„æ–¹å¼å°±æ˜¯å‰é¢æåˆ°çš„Hostå…ƒç´ çš„deployOnStartupå’ŒautoDeployå±æ€§ã€‚å¦‚æœdeployOnStartupå’ŒautoDeployè®¾ç½®ä¸ºtrueï¼Œåˆ™tomcatå¯åŠ¨è‡ªåŠ¨éƒ¨ç½²ï¼šå½“æ£€æµ‹åˆ°æ–°çš„Webåº”ç”¨æˆ–Webåº”ç”¨çš„æ›´æ–°æ—¶ï¼Œä¼šè§¦å‘åº”ç”¨çš„éƒ¨ç½²(æˆ–é‡æ–°éƒ¨ç½²)ã€‚äºŒè€…çš„ä¸»è¦åŒºåˆ«åœ¨äºï¼ŒdeployOnStartupä¸ºtrueæ—¶ï¼ŒTomcatåœ¨å¯åŠ¨æ—¶æ£€æŸ¥Webåº”ç”¨ï¼Œä¸”æ£€æµ‹åˆ°çš„æ‰€æœ‰Webåº”ç”¨è§†ä½œæ–°åº”ç”¨ï¼›autoDeployä¸ºtrueæ—¶ï¼ŒTomcatåœ¨è¿è¡Œæ—¶å®šæœŸæ£€æŸ¥æ–°çš„Webåº”ç”¨æˆ–Webåº”ç”¨çš„æ›´æ–°ã€‚é™¤æ­¤ä¹‹å¤–ï¼ŒäºŒè€…çš„å¤„ç†ç›¸ä¼¼ã€‚ é€šè¿‡é…ç½®deployOnStartupå’ŒautoDeployå¯ä»¥å¼€å¯è™šæ‹Ÿä¸»æœºè‡ªåŠ¨éƒ¨ç½²Webåº”ç”¨ï¼›å®é™…ä¸Šï¼Œè‡ªåŠ¨éƒ¨ç½²ä¾èµ–äºæ£€æŸ¥æ˜¯å¦æœ‰æ–°çš„æˆ–æ›´æ”¹è¿‡çš„Webåº”ç”¨ï¼Œè€ŒHostå…ƒç´ çš„appBaseå’ŒxmlBaseè®¾ç½®äº†æ£€æŸ¥Webåº”ç”¨æ›´æ–°çš„ç›®å½•ã€‚ å…¶ä¸­ï¼ŒappBaseå±æ€§æŒ‡å®šWebåº”ç”¨æ‰€åœ¨çš„ç›®å½•ï¼Œé»˜è®¤å€¼æ˜¯webappsï¼Œè¿™æ˜¯ä¸€ä¸ªç›¸å¯¹è·¯å¾„ï¼Œä»£è¡¨Tomcatæ ¹ç›®å½•ä¸‹webappsæ–‡ä»¶å¤¹ã€‚ xmlBaseå±æ€§æŒ‡å®šWebåº”ç”¨çš„XMLé…ç½®æ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ï¼Œé»˜è®¤å€¼ä¸ºconf/&lt;engine_name&gt;/&lt;host_name&gt;ï¼Œä¾‹å¦‚ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼Œä¸»æœºlocalhostçš„xmlBaseçš„é»˜è®¤å€¼æ˜¯$TOMCAT_HOME/conf/Catalina/localhostã€‚ æ£€æŸ¥Webåº”ç”¨æ›´æ–° ä¸€ä¸ªWebåº”ç”¨å¯èƒ½åŒ…æ‹¬ä»¥ä¸‹æ–‡ä»¶ï¼šXMLé…ç½®æ–‡ä»¶ï¼ŒWARåŒ…ï¼Œä»¥åŠä¸€ä¸ªåº”ç”¨ç›®å½•(è¯¥ç›®å½•åŒ…å«Webåº”ç”¨çš„æ–‡ä»¶ç»“æ„)ï¼›å…¶ä¸­XMLé…ç½®æ–‡ä»¶ä½äºxmlBaseæŒ‡å®šçš„ç›®å½•ï¼ŒWARåŒ…å’Œåº”ç”¨ç›®å½•ä½äºappBaseæŒ‡å®šçš„ç›®å½•ã€‚ TomcatæŒ‰ç…§å¦‚ä¸‹çš„é¡ºåºè¿›è¡Œæ‰«æï¼Œæ¥æ£€æŸ¥åº”ç”¨æ›´æ–°ï¼š Aã€æ‰«æè™šæ‹Ÿä¸»æœºæŒ‡å®šçš„xmlBaseä¸‹çš„XMLé…ç½®æ–‡ä»¶ Bã€æ‰«æè™šæ‹Ÿä¸»æœºæŒ‡å®šçš„appBaseä¸‹çš„WARæ–‡ä»¶ Cã€æ‰«æè™šæ‹Ÿä¸»æœºæŒ‡å®šçš„appBaseä¸‹çš„åº”ç”¨ç›®å½• &lt;Context&gt;å…ƒç´ çš„é…ç½® Contextå…ƒç´ æœ€é‡è¦çš„å±æ€§æ˜¯docBaseå’Œpathï¼Œæ­¤å¤–reloadableå±æ€§ä¹Ÿæ¯”è¾ƒå¸¸ç”¨ã€‚ docBaseæŒ‡å®šäº†è¯¥Webåº”ç”¨ä½¿ç”¨çš„WARåŒ…è·¯å¾„ï¼Œæˆ–åº”ç”¨ç›®å½•ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è‡ªåŠ¨éƒ¨ç½²åœºæ™¯ä¸‹(é…ç½®æ–‡ä»¶ä½äºxmlBaseä¸­)ï¼ŒdocBaseä¸åœ¨appBaseç›®å½•ä¸­ï¼Œæ‰éœ€è¦æŒ‡å®šï¼›å¦‚æœdocBaseæŒ‡å®šçš„WARåŒ…æˆ–åº”ç”¨ç›®å½•å°±åœ¨docBaseä¸­ï¼Œåˆ™ä¸éœ€è¦æŒ‡å®šï¼Œå› ä¸ºTomcatä¼šè‡ªåŠ¨æ‰«æappBaseä¸­çš„WARåŒ…å’Œåº”ç”¨ç›®å½•ï¼ŒæŒ‡å®šäº†åè€Œä¼šé€ æˆé—®é¢˜ã€‚ pathæŒ‡å®šäº†è®¿é—®è¯¥Webåº”ç”¨çš„ä¸Šä¸‹æ–‡è·¯å¾„ï¼Œå½“è¯·æ±‚åˆ°æ¥æ—¶ï¼ŒTomcatæ ¹æ®Webåº”ç”¨çš„ pathå±æ€§ä¸URIçš„åŒ¹é…ç¨‹åº¦æ¥é€‰æ‹©Webåº”ç”¨å¤„ç†ç›¸åº”è¯·æ±‚ã€‚ä¾‹å¦‚ï¼ŒWebåº”ç”¨app1çš„pathå±æ€§æ˜¯â€/app1â€ï¼ŒWebåº”ç”¨app2çš„pathå±æ€§æ˜¯â€/app2â€ï¼Œé‚£ä¹ˆè¯·æ±‚/app1/index.htmlä¼šäº¤ç”±app1æ¥å¤„ç†ï¼›è€Œè¯·æ±‚/app2/index.htmlä¼šäº¤ç”±app2æ¥å¤„ç†ã€‚å¦‚æœä¸€ä¸ªContextå…ƒç´ çš„pathå±æ€§ä¸ºâ€â€ï¼Œé‚£ä¹ˆè¿™ä¸ªContextæ˜¯è™šæ‹Ÿä¸»æœºçš„é»˜è®¤Webåº”ç”¨ï¼›å½“è¯·æ±‚çš„uriä¸æ‰€æœ‰çš„pathéƒ½ä¸åŒ¹é…æ—¶ï¼Œä½¿ç”¨è¯¥é»˜è®¤Webåº”ç”¨æ¥å¤„ç†ã€‚ ä½†æ˜¯ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨è‡ªåŠ¨éƒ¨ç½²åœºæ™¯ä¸‹(é…ç½®æ–‡ä»¶ä½äºxmlBaseä¸­)ï¼Œä¸èƒ½æŒ‡å®špathå±æ€§ï¼Œpathå±æ€§ç”±é…ç½®æ–‡ä»¶çš„æ–‡ä»¶åã€WARæ–‡ä»¶çš„æ–‡ä»¶åæˆ–åº”ç”¨ç›®å½•çš„åç§°è‡ªåŠ¨æ¨å¯¼å‡ºæ¥ã€‚å¦‚æ‰«æWebåº”ç”¨æ—¶ï¼Œå‘ç°äº†xmlBaseç›®å½•ä¸‹çš„app1.xmlï¼Œæˆ–appBaseç›®å½•ä¸‹çš„app1.WARæˆ–app1åº”ç”¨ç›®å½•ï¼Œåˆ™è¯¥Webåº”ç”¨çš„pathå±æ€§æ˜¯â€app1â€ã€‚å¦‚æœåç§°ä¸æ˜¯app1è€Œæ˜¯ROOTï¼Œåˆ™è¯¥Webåº”ç”¨æ˜¯è™šæ‹Ÿä¸»æœºé»˜è®¤çš„Webåº”ç”¨ï¼Œæ­¤æ—¶pathå±æ€§æ¨å¯¼ä¸ºâ€â€ã€‚ reloadableå±æ€§æŒ‡ç¤ºtomcatæ˜¯å¦åœ¨è¿è¡Œæ—¶ç›‘æ§åœ¨WEB-INF/classeså’ŒWEB-INF/libç›®å½•ä¸‹classæ–‡ä»¶çš„æ”¹åŠ¨ã€‚å¦‚æœå€¼ä¸ºtrueï¼Œé‚£ä¹ˆå½“classæ–‡ä»¶æ”¹åŠ¨æ—¶ï¼Œä¼šè§¦å‘Webåº”ç”¨çš„é‡æ–°åŠ è½½ã€‚åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œreloadableè®¾ç½®ä¸ºtrueä¾¿äºè°ƒè¯•ï¼›ä½†æ˜¯åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è®¾ç½®ä¸ºtrueä¼šç»™æœåŠ¡å™¨å¸¦æ¥æ€§èƒ½å‹åŠ›ï¼Œå› æ­¤reloadableå‚æ•°çš„é»˜è®¤å€¼ä¸ºfalseã€‚ ä¸‹é¢æ¥çœ‹è‡ªåŠ¨éƒ¨ç½²æ—¶ï¼ŒxmlBaseä¸‹çš„XMLé…ç½®æ–‡ä»¶app1.xmlçš„ä¾‹å­ï¼š &lt;Context docBase=&quot;D:\\Program Files\\app1.war&quot; reloadable=&quot;true&quot;/&gt; åœ¨è¯¥ä¾‹å­ä¸­ï¼ŒdocBaseä½äºHostçš„appBaseç›®å½•ä¹‹å¤–ï¼›pathå±æ€§æ²¡æœ‰æŒ‡å®šï¼Œè€Œæ˜¯æ ¹æ®app1.xmlè‡ªåŠ¨æ¨å¯¼ä¸ºâ€app1â€ï¼›ç”±äºæ˜¯åœ¨å¼€å‘ç¯å¢ƒä¸‹ï¼Œå› æ­¤reloadableè®¾ç½®ä¸ºtrueï¼Œä¾¿äºå¼€å‘è°ƒè¯•ã€‚ è‡ªåŠ¨éƒ¨ç½²ä¸¾ä¾‹ æœ€å…¸å‹çš„è‡ªåŠ¨éƒ¨ç½²ï¼Œå°±æ˜¯å½“æˆ‘ä»¬å®‰è£…å®ŒTomcatåï¼Œ$TOMCAT_HOME/webappsç›®å½•ä¸‹æœ‰å¦‚ä¸‹æ–‡ä»¶å¤¹ï¼š å½“æˆ‘ä»¬å¯åŠ¨Tomcatåï¼Œå¯ä»¥ä½¿ç”¨http://localhost:8080/æ¥è®¿é—®Tomcatï¼Œå…¶å®è®¿é—®çš„å°±æ˜¯ROOTå¯¹åº”çš„Webåº”ç”¨ï¼›æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡http://localhost:8080/docsæ¥è®¿é—®docsåº”ç”¨ï¼ŒåŒç†æˆ‘ä»¬å¯ä»¥è®¿é—®examples/host-manager/managerè¿™å‡ ä¸ªWebåº”ç”¨ã€‚ ï¼ˆ3ï¼‰server.xmlä¸­é™æ€éƒ¨ç½²Webåº”ç”¨ é™¤äº†è‡ªåŠ¨éƒ¨ç½²ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨server.xmlä¸­é€šè¿‡&lt;context&gt;å…ƒç´ é™æ€éƒ¨ç½²Webåº”ç”¨ã€‚é™æ€éƒ¨ç½²ä¸è‡ªåŠ¨éƒ¨ç½²æ˜¯å¯ä»¥å…±å­˜çš„ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œå¹¶ä¸æ¨èä½¿ç”¨é™æ€éƒ¨ç½²ï¼Œå› ä¸ºserver.xml æ˜¯ä¸å¯åŠ¨æ€é‡åŠ è½½çš„èµ„æºï¼ŒæœåŠ¡å™¨ä¸€æ—¦å¯åŠ¨äº†ä»¥åï¼Œè¦ä¿®æ”¹è¿™ä¸ªæ–‡ä»¶ï¼Œå°±å¾—é‡å¯æœåŠ¡å™¨æ‰èƒ½é‡æ–°åŠ è½½ã€‚è€Œè‡ªåŠ¨éƒ¨ç½²å¯ä»¥åœ¨Tomcatè¿è¡Œæ—¶é€šè¿‡å®šæœŸçš„æ‰«ææ¥å®ç°ï¼Œä¸éœ€è¦é‡å¯æœåŠ¡å™¨ã€‚ server.xmlä¸­ä½¿ç”¨Contextå…ƒç´ é…ç½®Webåº”ç”¨ï¼ŒContextå…ƒç´ åº”è¯¥ä½äºHostå…ƒç´ ä¸­ã€‚ä¸¾ä¾‹å¦‚ä¸‹ï¼š &lt;Context path=&quot;/&quot; docBase=&quot;D:\\Program Files \\app1.war&quot; reloadable=&quot;true&quot;/&gt; docBaseï¼šé™æ€éƒ¨ç½²æ—¶ï¼ŒdocBaseå¯ä»¥åœ¨appBaseç›®å½•ä¸‹ï¼Œä¹Ÿå¯ä»¥ä¸åœ¨ï¼›æœ¬ä¾‹ä¸­ï¼ŒdocBaseä¸åœ¨appBaseç›®å½•ä¸‹ã€‚ pathï¼šé™æ€éƒ¨ç½²æ—¶ï¼Œå¯ä»¥æ˜¾å¼æŒ‡å®špathå±æ€§ï¼Œä½†æ˜¯ä»ç„¶å—åˆ°äº†ä¸¥æ ¼çš„é™åˆ¶ï¼šåªæœ‰å½“è‡ªåŠ¨éƒ¨ç½²å®Œå…¨å…³é—­(deployOnStartupå’ŒautoDeployéƒ½ä¸ºfalse)æˆ–docBaseä¸åœ¨appBaseä¸­æ—¶ï¼Œæ‰å¯ä»¥è®¾ç½®pathå±æ€§ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒdocBaseä¸åœ¨appBaseä¸­ï¼Œå› æ­¤pathå±æ€§å¯ä»¥è®¾ç½®ã€‚ reloadableå±æ€§çš„ç”¨æ³•ä¸è‡ªåŠ¨éƒ¨ç½²æ—¶ç›¸åŒã€‚ æ ¸å¿ƒç»„ä»¶çš„å…³è”1ã€æ•´ä½“å…³ç³» æ ¸å¿ƒç»„ä»¶ä¹‹é—´çš„æ•´ä½“å…³ç³»ï¼Œåœ¨ä¸Šä¸€éƒ¨åˆ†æœ‰æ‰€ä»‹ç»ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹ï¼š Serverå…ƒç´ åœ¨æœ€é¡¶å±‚ï¼Œä»£è¡¨æ•´ä¸ªTomcatå®¹å™¨ï¼›ä¸€ä¸ªServerå…ƒç´ ä¸­å¯ä»¥æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªServiceå…ƒç´ ã€‚ Serviceåœ¨Connectorå’ŒEngineå¤–é¢åŒ…äº†ä¸€å±‚ï¼ŒæŠŠå®ƒä»¬ç»„è£…åœ¨ä¸€èµ·ï¼Œå¯¹å¤–æä¾›æœåŠ¡ã€‚ä¸€ä¸ªServiceå¯ä»¥åŒ…å«å¤šä¸ªConnectorï¼Œä½†æ˜¯åªèƒ½åŒ…å«ä¸€ä¸ªEngineï¼›Connectoræ¥æ”¶è¯·æ±‚ï¼ŒEngineå¤„ç†è¯·æ±‚ã€‚ Engineã€Hostå’ŒContextéƒ½æ˜¯å®¹å™¨ï¼Œä¸” EngineåŒ…å«Hostï¼ŒHoståŒ…å«Contextã€‚æ¯ä¸ªHostç»„ä»¶ä»£è¡¨Engineä¸­çš„ä¸€ä¸ªè™šæ‹Ÿä¸»æœºï¼›æ¯ä¸ªContextç»„ä»¶ä»£è¡¨åœ¨ç‰¹å®šHostä¸Šè¿è¡Œçš„ä¸€ä¸ªWebåº”ç”¨ã€‚ 2ã€å¦‚ä½•ç¡®å®šè¯·æ±‚ç”±è°å¤„ç†ï¼Ÿ å½“è¯·æ±‚è¢«å‘é€åˆ°Tomcatæ‰€åœ¨çš„ä¸»æœºæ—¶ï¼Œå¦‚ä½•ç¡®å®šæœ€ç»ˆå“ªä¸ªWebåº”ç”¨æ¥å¤„ç†è¯¥è¯·æ±‚å‘¢ï¼Ÿ ï¼ˆ1ï¼‰æ ¹æ®åè®®å’Œç«¯å£å·é€‰å®šServiceå’ŒEngine Serviceä¸­çš„Connectorç»„ä»¶å¯ä»¥æ¥æ”¶ç‰¹å®šç«¯å£çš„è¯·æ±‚ï¼Œå› æ­¤ï¼Œå½“Tomcatå¯åŠ¨æ—¶ï¼ŒServiceç»„ä»¶å°±ä¼šç›‘å¬ç‰¹å®šçš„ç«¯å£ã€‚åœ¨ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼ŒCatalinaè¿™ä¸ªServiceç›‘å¬äº†8080ç«¯å£ï¼ˆåŸºäºHTTPåè®®ï¼‰å’Œ8009ç«¯å£ï¼ˆåŸºäºAJPåè®®ï¼‰ã€‚å½“è¯·æ±‚è¿›æ¥æ—¶ï¼ŒTomcatä¾¿å¯ä»¥æ ¹æ®åè®®å’Œç«¯å£å·é€‰å®šå¤„ç†è¯·æ±‚çš„Serviceï¼›Serviceä¸€æ—¦é€‰å®šï¼ŒEngineä¹Ÿå°±ç¡®å®šã€‚ é€šè¿‡åœ¨Serverä¸­é…ç½®å¤šä¸ªServiceï¼Œå¯ä»¥å®ç°é€šè¿‡ä¸åŒçš„ç«¯å£å·æ¥è®¿é—®åŒä¸€å°æœºå™¨ä¸Šéƒ¨ç½²çš„ä¸åŒåº”ç”¨ã€‚ ï¼ˆ2ï¼‰æ ¹æ®åŸŸåæˆ–IPåœ°å€é€‰å®šHost Serviceç¡®å®šåï¼ŒTomcatåœ¨Serviceä¸­å¯»æ‰¾åç§°ä¸åŸŸå/IPåœ°å€åŒ¹é…çš„Hostå¤„ç†è¯¥è¯·æ±‚ã€‚å¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œåˆ™ä½¿ç”¨Engineä¸­æŒ‡å®šçš„defaultHostæ¥å¤„ç†è¯¥è¯·æ±‚ã€‚åœ¨ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼Œç”±äºåªæœ‰ä¸€ä¸ªHostï¼ˆnameå±æ€§ä¸ºlocalhostï¼‰ï¼Œå› æ­¤è¯¥Service/Engineçš„æ‰€æœ‰è¯·æ±‚éƒ½äº¤ç»™è¯¥Hostå¤„ç†ã€‚ ï¼ˆ3ï¼‰æ ¹æ®URIé€‰å®šContext/Webåº”ç”¨ è¿™ä¸€ç‚¹åœ¨Contextä¸€èŠ‚æœ‰è¯¦ç»†çš„è¯´æ˜ï¼šTomcatæ ¹æ®åº”ç”¨çš„ pathå±æ€§ä¸URIçš„åŒ¹é…ç¨‹åº¦æ¥é€‰æ‹©Webåº”ç”¨å¤„ç†ç›¸åº”è¯·æ±‚ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ ï¼ˆ4ï¼‰ä¸¾ä¾‹ ä»¥è¯·æ±‚http://localhost:8080/app1/index.htmlä¸ºä¾‹ï¼Œé¦–å…ˆé€šè¿‡åè®®å’Œç«¯å£å·ï¼ˆhttpå’Œ8080ï¼‰é€‰å®šServiceï¼›ç„¶åé€šè¿‡ä¸»æœºåï¼ˆlocalhostï¼‰é€‰å®šHostï¼›ç„¶åé€šè¿‡uriï¼ˆ/app1/index.htmlï¼‰é€‰å®šWebåº”ç”¨ã€‚ 3ã€å¦‚ä½•é…ç½®å¤šä¸ªæœåŠ¡ é€šè¿‡åœ¨Serverä¸­é…ç½®å¤šä¸ªServiceæœåŠ¡ï¼Œå¯ä»¥å®ç°é€šè¿‡ä¸åŒçš„ç«¯å£å·æ¥è®¿é—®åŒä¸€å°æœºå™¨ä¸Šéƒ¨ç½²çš„ä¸åŒWebåº”ç”¨ã€‚ åœ¨server.xmlä¸­é…ç½®å¤šæœåŠ¡çš„æ–¹æ³•éå¸¸ç®€å•ï¼Œåˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š ï¼ˆ1ï¼‰å¤åˆ¶&lt;Service&gt;å…ƒç´ ï¼Œæ”¾åœ¨å½“å‰&lt;Service&gt;åé¢ã€‚ ï¼ˆ2ï¼‰ä¿®æ”¹ç«¯å£å·ï¼šæ ¹æ®éœ€è¦ç›‘å¬çš„ç«¯å£å·ä¿®æ”¹&lt;Connector&gt;å…ƒç´ çš„portå±æ€§ï¼›å¿…é¡»ç¡®ä¿è¯¥ç«¯å£æ²¡æœ‰è¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼Œå¦åˆ™Tomcatå¯åŠ¨æ—¶ä¼šæŠ¥é”™ï¼Œè€Œæ— æ³•é€šè¿‡è¯¥ç«¯å£è®¿é—®Webåº”ç”¨ã€‚ ä»¥Win7ä¸ºä¾‹ï¼Œå¯ä»¥ç”¨å¦‚ä¸‹æ–¹æ³•æ‰¾å‡ºæŸä¸ªç«¯å£æ˜¯å¦è¢«å…¶ä»–è¿›ç¨‹å ç”¨ï¼šnetstat -aon|findstr â€œ8081â€³å‘ç°8081ç«¯å£è¢«PIDä¸º2064çš„è¿›ç¨‹å ç”¨ï¼Œtasklist |findstr â€œ2064â€³å‘ç°è¯¥è¿›ç¨‹ä¸ºFrameworkService.exe(è¿™æ˜¯McAfeeæ€æ¯’è½¯ä»¶çš„è¿›ç¨‹)ã€‚ ï¼ˆ3ï¼‰ä¿®æ”¹Serviceå’ŒEngineçš„nameå±æ€§ ï¼ˆ4ï¼‰ä¿®æ”¹Hostçš„appBaseå±æ€§ï¼ˆå¦‚webapps2ï¼‰ ï¼ˆ5ï¼‰Webåº”ç”¨ä»ç„¶ä½¿ç”¨è‡ªåŠ¨éƒ¨ç½² ï¼ˆ6ï¼‰å°†è¦éƒ¨ç½²çš„Webåº”ç”¨(WARåŒ…æˆ–åº”ç”¨ç›®å½•)æ‹·è´åˆ°æ–°çš„appBaseä¸‹ã€‚ ä»¥ç¬¬ä¸€éƒ¨åˆ†çš„server.xmlä¸ºä¾‹ï¼Œå¤šä¸ªServiceçš„é…ç½®å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738&lt;?xml version='1.0' encoding='utf-8'?&gt;&lt;Server port=\"8005\" shutdown=\"SHUTDOWN\"&gt; &lt;Listener className=\"org.apache.catalina.startup.VersionLoggerListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.AprLifecycleListener\" SSLEngine=\"on\" /&gt; &lt;Listener className=\"org.apache.catalina.core.JasperListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.JreMemoryLeakPreventionListener\" /&gt; &lt;Listener className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" /&gt; &lt;Listener className=\"org.apache.catalina.core.ThreadLocalLeakPreventionListener\" /&gt; &lt;GlobalNamingResources&gt; &lt;Resource name=\"UserDatabase\" auth=\"Container\" type=\"org.apache.catalina.UserDatabase\" description=\"User database that can be updated and saved\" factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\" pathname=\"conf/tomcat-users.xml\" /&gt; &lt;/GlobalNamingResources&gt; &lt;Service name=\"Catalina\"&gt; &lt;Connector port=\"8080\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" /&gt; &lt;Connector port=\"8009\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /&gt; &lt;Engine name=\"Catalina\" defaultHost=\"localhost\"&gt; &lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt; &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" resourceName=\"UserDatabase\"/&gt; &lt;/Realm&gt; &lt;Host name=\"localhost\" appBase=\"/opt/project/webapps\" unpackWARs=\"true\" autoDeploy=\"true\"&gt; &lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\" prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt; &lt;/Host&gt; &lt;/Engine&gt; &lt;/Service&gt; &lt;Service name=\"Catalina2\"&gt; &lt;Connector port=\"8084\" protocol=\"HTTP/1.1\" connectionTimeout=\"20000\" redirectPort=\"8443\" /&gt; &lt;Connector port=\"8010\" protocol=\"AJP/1.3\" redirectPort=\"8443\" /&gt; &lt;Engine name=\"Catalina2\" defaultHost=\"localhost\"&gt; &lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt; &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" resourceName=\"UserDatabase\"/&gt; &lt;/Realm&gt; &lt;Host name=\"localhost\" appBase=\"/opt/project/webapps2\" unpackWARs=\"true\" autoDeploy=\"true\"&gt; &lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\" prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt; &lt;/Host&gt; &lt;/Engine&gt; &lt;/Service&gt;&lt;/Server&gt; å†å°†åŸwebappsä¸‹çš„docsç›®å½•æ‹·è´åˆ°webapps2ä¸­ï¼Œåˆ™é€šè¿‡å¦‚ä¸‹ä¸¤ä¸ªæ¥å£éƒ½å¯ä»¥è®¿é—®docsåº”ç”¨ï¼š http://localhost:8080/docs/ http://localhost:8084/docs/ å…¶ä»–ç»„ä»¶é™¤æ ¸å¿ƒç»„ä»¶å¤–ï¼Œserver.xmlä¸­è¿˜å¯ä»¥é…ç½®å¾ˆå¤šå…¶ä»–ç»„ä»¶ã€‚ä¸‹é¢åªä»‹ç»ç¬¬ä¸€éƒ¨åˆ†ä¾‹å­ä¸­å‡ºç°çš„ç»„ä»¶ï¼Œå¦‚æœè¦äº†è§£æ›´å¤šå†…å®¹ï¼Œå¯ä»¥æŸ¥çœ‹Tomcatå®˜æ–¹æ–‡æ¡£ã€‚ 1ã€Listener 123456&lt;Listener className=\"org.apache.catalina.startup.VersionLoggerListener\" /&gt;&lt;Listener className=\"org.apache.catalina.core.AprLifecycleListener\" SSLEngine=\"on\" /&gt;&lt;Listener className=\"org.apache.catalina.core.JasperListener\" /&gt;&lt;Listener className=\"org.apache.catalina.core.JreMemoryLeakPreventionListener\" /&gt;&lt;Listener className=\"org.apache.catalina.mbeans.GlobalResourcesLifecycleListener\" /&gt;&lt;Listener className=\"org.apache.catalina.core.ThreadLocalLeakPreventionListener\" /&gt; Listener(å³ç›‘å¬å™¨)å®šä¹‰çš„ç»„ä»¶ï¼Œå¯ä»¥åœ¨ç‰¹å®šäº‹ä»¶å‘ç”Ÿæ—¶æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼›è¢«ç›‘å¬çš„äº‹ä»¶é€šå¸¸æ˜¯Tomcatçš„å¯åŠ¨å’Œåœæ­¢ã€‚ ç›‘å¬å™¨å¯ä»¥åœ¨Serverã€Engineã€Hostæˆ–Contextä¸­ï¼Œæœ¬ä¾‹ä¸­çš„ç›‘å¬å™¨éƒ½æ˜¯åœ¨Serverä¸­ã€‚å®é™…ä¸Šï¼Œæœ¬ä¾‹ä¸­å®šä¹‰çš„6ä¸ªç›‘å¬å™¨ï¼Œéƒ½åªèƒ½å­˜åœ¨äºServerç»„ä»¶ä¸­ã€‚ç›‘å¬å™¨ä¸å…è®¸å†…åµŒå…¶ä»–ç»„ä»¶ã€‚ ç›‘å¬å™¨éœ€è¦é…ç½®çš„æœ€é‡è¦çš„å±æ€§æ˜¯classNameï¼Œè¯¥å±æ€§è§„å®šäº†ç›‘å¬å™¨çš„å…·ä½“å®ç°ç±»ï¼Œè¯¥ç±»å¿…é¡»å®ç°äº†org.apache.catalina.LifecycleListeneræ¥å£ã€‚ ä¸‹é¢ä¾æ¬¡ä»‹ç»ä¾‹å­ä¸­é…ç½®çš„ç›‘å¬å™¨ï¼š VersionLoggerListenerï¼šå½“Tomcatå¯åŠ¨æ—¶ï¼Œè¯¥ç›‘å¬å™¨è®°å½•Tomcatã€Javaå’Œæ“ä½œç³»ç»Ÿçš„ä¿¡æ¯ã€‚è¯¥ç›‘å¬å™¨å¿…é¡»æ˜¯é…ç½®çš„ç¬¬ä¸€ä¸ªç›‘å¬å™¨ã€‚ AprLifecycleListenerï¼šTomcatå¯åŠ¨æ—¶ï¼Œæ£€æŸ¥APRåº“ï¼Œå¦‚æœå­˜åœ¨åˆ™åŠ è½½ã€‚APRï¼Œå³Apache Portable Runtimeï¼Œæ˜¯Apacheå¯ç§»æ¤è¿è¡Œåº“ï¼Œå¯ä»¥å®ç°é«˜å¯æ‰©å±•æ€§ã€é«˜æ€§èƒ½ï¼Œä»¥åŠä¸æœ¬åœ°æœåŠ¡å™¨æŠ€æœ¯æ›´å¥½çš„é›†æˆã€‚ JasperListenerï¼šåœ¨Webåº”ç”¨å¯åŠ¨ä¹‹å‰åˆå§‹åŒ–Jasperï¼ŒJasperæ˜¯JSPå¼•æ“ï¼ŒæŠŠJVMä¸è®¤è¯†çš„JSPæ–‡ä»¶è§£ææˆjavaæ–‡ä»¶ï¼Œç„¶åç¼–è¯‘æˆclassæ–‡ä»¶ä¾›JVMä½¿ç”¨ã€‚ JreMemoryLeakPreventionListenerï¼šä¸ç±»åŠ è½½å™¨å¯¼è‡´çš„å†…å­˜æ³„éœ²æœ‰å…³ã€‚ GlobalResourcesLifecycleListenerï¼šé€šè¿‡è¯¥ç›‘å¬å™¨ï¼Œåˆå§‹åŒ–&lt; GlobalNamingResources&gt;æ ‡ç­¾ä¸­å®šä¹‰çš„å…¨å±€JNDIèµ„æºï¼›å¦‚æœæ²¡æœ‰è¯¥ç›‘å¬å™¨ï¼Œä»»ä½•å…¨å±€èµ„æºéƒ½ä¸èƒ½ä½¿ç”¨ã€‚&lt; GlobalNamingResources&gt;å°†åœ¨åæ–‡ä»‹ç»ã€‚ ThreadLocalLeakPreventionListenerï¼šå½“Webåº”ç”¨å› thread-localå¯¼è‡´çš„å†…å­˜æ³„éœ²è€Œè¦åœæ­¢æ—¶ï¼Œè¯¥ç›‘å¬å™¨ä¼šè§¦å‘çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ›´æ–°ã€‚å½“çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡è¢«æ”¶å›çº¿ç¨‹æ± æ—¶ï¼Œæ´»è·ƒçº¿ç¨‹ä¼šä¸€ä¸ªä¸€ä¸ªçš„æ›´æ–°ã€‚åªæœ‰å½“Webåº”ç”¨(å³Contextå…ƒç´ )çš„renewThreadsWhenStoppingContextå±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œè¯¥ç›‘å¬å™¨æ‰æœ‰æ•ˆã€‚ 2ã€GlobalNamingResourcesä¸Realm ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼ŒEngineç»„ä»¶ä¸‹å®šä¹‰äº†Realmç»„ä»¶ï¼š 1234&lt;Realm className=\"org.apache.catalina.realm.LockOutRealm\"&gt; &lt;Realm className=\"org.apache.catalina.realm.UserDatabaseRealm\" resourceName=\"UserDatabase\"/&gt;&lt;/Realm&gt; Realmï¼Œå¯ä»¥æŠŠå®ƒç†è§£æˆâ€œåŸŸâ€ï¼›Realmæä¾›äº†ä¸€ç§ç”¨æˆ·å¯†ç ä¸webåº”ç”¨çš„æ˜ å°„å…³ç³»ï¼Œä»è€Œè¾¾åˆ°è§’è‰²å®‰å…¨ç®¡ç†çš„ä½œç”¨ã€‚åœ¨æœ¬ä¾‹ä¸­ï¼ŒRealmçš„é…ç½®ä½¿ç”¨nameä¸ºUserDatabaseçš„èµ„æºå®ç°ã€‚è€Œè¯¥èµ„æºåœ¨Serverå…ƒç´ ä¸­ä½¿ç”¨GlobalNamingResourcesé…ç½®ï¼š 123&lt;GlobalNamingResources&gt; &lt;Resource name=\"UserDatabase\" auth=\"Container\" type=\"org.apache.catalina.UserDatabase\" description=\"User database that can be updated and saved\" factory=\"org.apache.catalina.users.MemoryUserDatabaseFactory\" pathname=\"conf/tomcat-users.xml\" /&gt;&lt;/GlobalNamingResources&gt; 3ã€Valve åœ¨ç¬¬ä¸€éƒ¨åˆ†çš„ä¾‹å­ä¸­ï¼ŒHostå…ƒç´ å†…å®šä¹‰äº†Valveç»„ä»¶ï¼š 1&lt;Valve className=\"org.apache.catalina.valves.AccessLogValve\" directory=\"logs\" prefix=\"localhost_access_log.\" suffix=\".txt\" pattern=\"%h %l %u %t &amp;quot;%r&amp;quot; %s %b\" /&gt; å•è¯Valveçš„æ„æ€æ˜¯â€œé˜€é—¨â€ï¼Œåœ¨Tomcatä¸­ä»£è¡¨äº†è¯·æ±‚å¤„ç†æµæ°´çº¿ä¸Šçš„ä¸€ä¸ªç»„ä»¶ï¼›Valveå¯ä»¥ä¸Tomcatçš„å®¹å™¨(Engineã€Hostæˆ–Context)å…³è”ã€‚ ä¸åŒçš„Valveæœ‰ä¸åŒçš„ç‰¹æ€§ï¼Œä¸‹é¢ä»‹ç»ä¸€ä¸‹æœ¬ä¾‹ä¸­å‡ºç°çš„AccessLogValveã€‚ AccessLogValveçš„ä½œç”¨æ˜¯é€šè¿‡æ—¥å¿—è®°å½•å…¶æ‰€åœ¨çš„å®¹å™¨ä¸­å¤„ç†çš„æ‰€æœ‰è¯·æ±‚ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼ŒValveæ”¾åœ¨Hostä¸‹ï¼Œä¾¿å¯ä»¥è®°å½•è¯¥Hostå¤„ç†çš„æ‰€æœ‰è¯·æ±‚ã€‚AccessLogValveè®°å½•çš„æ—¥å¿—å°±æ˜¯è®¿é—®æ—¥å¿—ï¼Œæ¯å¤©çš„è¯·æ±‚ä¼šå†™åˆ°ä¸€ä¸ªæ—¥å¿—æ–‡ä»¶é‡Œã€‚AccessLogValveå¯ä»¥ä¸Engineã€Hostæˆ–Contextå…³è”ï¼›åœ¨æœ¬ä¾‹ä¸­ï¼Œåªæœ‰ä¸€ä¸ªEngineï¼ŒEngineä¸‹åªæœ‰ä¸€ä¸ªHostï¼ŒHostä¸‹åªæœ‰ä¸€ä¸ªContextï¼Œå› æ­¤AccessLogValveæ”¾åœ¨ä¸‰ä¸ªå®¹å™¨ä¸‹çš„ä½œç”¨å…¶å®æ˜¯ç±»ä¼¼çš„ã€‚ æœ¬ä¾‹çš„AccessLogValveå±æ€§çš„é…ç½®ï¼Œä½¿ç”¨çš„æ˜¯é»˜è®¤çš„é…ç½®ï¼›ä¸‹é¢ä»‹ç»AccessLogValveä¸­å„ä¸ªå±æ€§çš„ä½œç”¨ï¼š ï¼ˆ1ï¼‰classNameï¼šè§„å®šäº†Valveçš„ç±»å‹ï¼Œæ˜¯æœ€é‡è¦çš„å±æ€§ï¼›æœ¬ä¾‹ä¸­ï¼Œé€šè¿‡è¯¥å±æ€§è§„å®šäº†è¿™æ˜¯ä¸€ä¸ªAccessLogValveã€‚ ï¼ˆ2ï¼‰directoryï¼šæŒ‡å®šæ—¥å¿—å­˜å‚¨çš„ä½ç½®ï¼Œæœ¬ä¾‹ä¸­ï¼Œæ—¥å¿—å­˜å‚¨åœ¨$TOMCAT_HOME/logsç›®å½•ä¸‹ã€‚ ï¼ˆ3ï¼‰prefixï¼šæŒ‡å®šäº†æ—¥å¿—æ–‡ä»¶çš„å‰ç¼€ã€‚ ï¼ˆ4ï¼‰suffixï¼šæŒ‡å®šäº†æ—¥å¿—æ–‡ä»¶çš„åç¼€ã€‚é€šè¿‡directoryã€prefixå’Œsuffixçš„é…ç½®ï¼Œåœ¨$TOMCAT_HOME/logsç›®å½•ä¸‹ï¼Œå¯ä»¥çœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„æ—¥å¿—æ–‡ä»¶ã€‚ ï¼ˆ5ï¼‰patternï¼šæŒ‡å®šè®°å½•æ—¥å¿—çš„æ ¼å¼ï¼Œæœ¬ä¾‹ä¸­å„é¡¹çš„å«ä¹‰å¦‚ä¸‹ï¼š %hï¼šè¿œç¨‹ä¸»æœºåæˆ–IPåœ°å€ï¼›å¦‚æœæœ‰nginxç­‰åå‘ä»£ç†æœåŠ¡å™¨è¿›è¡Œè¯·æ±‚åˆ†å‘ï¼Œè¯¥ä¸»æœºå/IPåœ°å€ä»£è¡¨çš„æ˜¯nginxï¼Œå¦åˆ™ä»£è¡¨çš„æ˜¯å®¢æˆ·ç«¯ã€‚åé¢è¿œç¨‹çš„å«ä¹‰ä¸ä¹‹ç±»ä¼¼ï¼Œä¸å†è§£é‡Šã€‚ %lï¼šè¿œç¨‹é€»è¾‘ç”¨æˆ·åï¼Œä¸€å¾‹æ˜¯â€-â€ï¼Œå¯ä»¥å¿½ç•¥ã€‚ %uï¼šæˆæƒçš„è¿œç¨‹ç”¨æˆ·åï¼Œå¦‚æœæ²¡æœ‰ï¼Œåˆ™æ˜¯â€-â€ã€‚ %tï¼šè®¿é—®çš„æ—¶é—´ã€‚ %rï¼šè¯·æ±‚çš„ç¬¬ä¸€è¡Œï¼Œå³è¯·æ±‚æ–¹æ³•(get/postç­‰)ã€uriã€åŠåè®®ã€‚ %sï¼šå“åº”çŠ¶æ€ï¼Œ200,404ç­‰ç­‰ã€‚ %bï¼šå“åº”çš„æ•°æ®é‡ï¼Œä¸åŒ…æ‹¬è¯·æ±‚å¤´ï¼Œå¦‚æœä¸º0ï¼Œåˆ™æ˜¯â€â€-ã€‚ ä¾‹å¦‚ï¼Œä¸‹é¢æ˜¯è®¿é—®æ—¥å¿—ä¸­çš„ä¸€æ¡è®°å½• patternçš„é…ç½®ä¸­ï¼Œé™¤äº†ä¸Šè¿°å„é¡¹ï¼Œè¿˜æœ‰ä¸€ä¸ªéå¸¸å¸¸ç”¨çš„é€‰é¡¹æ˜¯%Dï¼Œå«ä¹‰æ˜¯è¯·æ±‚å¤„ç†çš„æ—¶é—´(å•ä½æ˜¯æ¯«ç§’)ï¼Œå¯¹äºç»Ÿè®¡åˆ†æè¯·æ±‚çš„å¤„ç†é€Ÿåº¦å¸®åŠ©å¾ˆå¤§ã€‚ å¼€å‘äººå‘˜å¯ä»¥å……åˆ†åˆ©ç”¨è®¿é—®æ—¥å¿—ï¼Œæ¥åˆ†æé—®é¢˜ã€ä¼˜åŒ–åº”ç”¨ã€‚ä¾‹å¦‚ï¼Œåˆ†æè®¿é—®æ—¥å¿—ä¸­å„ä¸ªæ¥å£è¢«è®¿é—®çš„æ¯”ä¾‹ï¼Œä¸ä»…å¯ä»¥ä¸ºéœ€æ±‚å’Œè¿è¥äººå‘˜æä¾›æ•°æ®æ”¯æŒï¼Œè¿˜å¯ä»¥ä½¿è‡ªå·±çš„ä¼˜åŒ–æœ‰çš„æ”¾çŸ¢ï¼›åˆ†æè®¿é—®æ—¥å¿—ä¸­å„ä¸ªè¯·æ±‚çš„å“åº”çŠ¶æ€ç ï¼Œå¯ä»¥çŸ¥é“æœåŠ¡å™¨è¯·æ±‚çš„æˆåŠŸç‡ï¼Œå¹¶æ‰¾å‡ºæœ‰é—®é¢˜çš„è¯·æ±‚ï¼›åˆ†æè®¿é—®æ—¥å¿—ä¸­å„ä¸ªè¯·æ±‚çš„å“åº”æ—¶é—´ï¼Œå¯ä»¥æ‰¾å‡ºæ…¢è¯·æ±‚ï¼Œå¹¶æ ¹æ®éœ€è¦è¿›è¡Œå“åº”æ—¶é—´çš„ä¼˜åŒ–ã€‚ å‚è€ƒæ–‡æ¡£ Tomcatå®˜æ–¹æ–‡æ¡£ ã€ŠHow Tomcat Worksã€‹ ã€Šæ·±å…¥åˆ†æJava WebæŠ€æœ¯å†…å¹•ã€‹ è¯¦è§£ Tomcat é…ç½®æ–‡ä»¶ server.xml","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"tomcat","slug":"tomcat","permalink":"https://sunny0715.github.io/tags/tomcat/"}]},{"title":"JVMç±»åŠ è½½æœºåˆ¶","slug":"JVMç±»åŠ è½½æœºåˆ¶","date":"2017-12-13T02:03:36.000Z","updated":"2018-03-13T05:50:04.484Z","comments":true,"path":"2017/12/13/JVMç±»åŠ è½½æœºåˆ¶/","link":"","permalink":"https://sunny0715.github.io/2017/12/13/JVMç±»åŠ è½½æœºåˆ¶/","excerpt":"å¼•è¨€ä¹‹å‰çš„åšå®¢è¯´äº†Javaè™šæ‹Ÿæœºçš„è¿è¡Œæ—¶æ•°æ®åŒºåŸŸã€GCç®—æ³•ã€åƒåœ¾å›æ”¶å™¨ç­‰çŸ¥è¯†ã€‚è·ç¦»æ·±å…¥äº†è§£è¿˜æœ‰ä¸€æ®µè·ç¦»ï¼ŒåŒ…æ‹¬è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€æ€§èƒ½è°ƒä¼˜ã€çº¿ç¨‹å¹¶å‘ç­‰ç­‰è¿˜éƒ½æ²¡æœ‰æ¶‰åŠåˆ°ï¼Œä¸€ç›´åœ¨çœ‹å‘¨å¿—æ˜çš„ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼Œè¶Šæ·±å…¥å»è¯»å‘ç°è¿™æœ¬ä¹¦å†™çš„çœŸçš„æ˜¯ç»å…¸ï¼Œè§£å†³äº†è‡ªå·±å¾ˆå¤šçš„ç–‘æƒ‘ã€‚ JVMçš„ç±»åŠ è½½æœºåˆ¶ã€‚è™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä»classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„Javaç±»å‹ï¼Œè¿™å°±æ˜¯è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€‚","text":"å¼•è¨€ä¹‹å‰çš„åšå®¢è¯´äº†Javaè™šæ‹Ÿæœºçš„è¿è¡Œæ—¶æ•°æ®åŒºåŸŸã€GCç®—æ³•ã€åƒåœ¾å›æ”¶å™¨ç­‰çŸ¥è¯†ã€‚è·ç¦»æ·±å…¥äº†è§£è¿˜æœ‰ä¸€æ®µè·ç¦»ï¼ŒåŒ…æ‹¬è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€æ€§èƒ½è°ƒä¼˜ã€çº¿ç¨‹å¹¶å‘ç­‰ç­‰è¿˜éƒ½æ²¡æœ‰æ¶‰åŠåˆ°ï¼Œä¸€ç›´åœ¨çœ‹å‘¨å¿—æ˜çš„ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹ï¼Œè¶Šæ·±å…¥å»è¯»å‘ç°è¿™æœ¬ä¹¦å†™çš„çœŸçš„æ˜¯ç»å…¸ï¼Œè§£å†³äº†è‡ªå·±å¾ˆå¤šçš„ç–‘æƒ‘ã€‚ JVMçš„ç±»åŠ è½½æœºåˆ¶ã€‚è™šæ‹ŸæœºæŠŠæè¿°ç±»çš„æ•°æ®ä»classæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å¯¹æ•°æ®è¿›è¡Œæ ¡éªŒã€è½¬æ¢è§£æå’Œåˆå§‹åŒ–ï¼Œæœ€ç»ˆå½¢æˆå¯ä»¥è¢«è™šæ‹Ÿæœºç›´æ¥ä½¿ç”¨çš„Javaç±»å‹ï¼Œè¿™å°±æ˜¯è™šæ‹Ÿæœºçš„ç±»åŠ è½½æœºåˆ¶ã€‚ ç±»åŠ è½½è¿‡ç¨‹ç±»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°å¸è½½å‡ºå†…å­˜ä¸ºæ­¢ã€‚å®ƒçš„ç”Ÿå‘½å‘¨æœŸåˆ†7ä¸ªé˜¶æ®µï¼ŒåŠ è½½ï¼ˆLoadingï¼‰ã€éªŒè¯ï¼ˆVerificationï¼‰ã€å‡†å¤‡ï¼ˆPreparationï¼‰ã€è§£æï¼ˆResolutionï¼‰ã€åˆå§‹åŒ–ï¼ˆInitializationï¼‰ã€ä½¿ç”¨ï¼ˆUsingï¼‰ã€å¸è½½ï¼ˆUnloadingï¼‰ã€‚å…¶ä¸­éªŒè¯ã€å‡†å¤‡ã€è§£æä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥ï¼ˆLinkingï¼‰ã€‚ åŠ è½½ é€šè¿‡ä¸€ä¸ªç±»çš„å…¨é™å®šåæ¥è·å–å®šä¹‰æ­¤ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµã€‚ å°†è¿™ä¸ªå­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„è½¬åŒ–ä¸ºæ–¹æ³•åŒºçš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ã€‚ åœ¨Javaå †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºå¯¹æ–¹æ³•åŒºä¸­è¿™äº›æ•°æ®çš„è®¿é—®å…¥å£ã€‚ 1æ³¨æ„ï¼šJVMä¸­çš„ClassLoaderç±»åŠ è½½å™¨åŠ è½½Classå‘ç”Ÿåœ¨æ­¤é˜¶æ®µã€‚åé¢ä¼šæœ‰æè¿°ã€‚ è¿æ¥éªŒè¯éªŒè¯çš„ç›®çš„æ˜¯ä¸ºäº†ç¡®ä¿Classæ–‡ä»¶ä¸­çš„å­—èŠ‚æµåŒ…å«çš„ä¿¡æ¯ç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚ï¼Œè€Œä¸”ä¸ä¼šå±å®³è™šæ‹Ÿæœºè‡ªèº«çš„å®‰å…¨ã€‚ä¸åŒçš„è™šæ‹Ÿæœºå¯¹ç±»éªŒè¯çš„å®ç°å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†å¤§è‡´éƒ½ä¼šå®Œæˆä»¥ä¸‹å››ä¸ªé˜¶æ®µçš„éªŒè¯ï¼šæ–‡ä»¶æ ¼å¼çš„éªŒè¯ã€å…ƒæ•°æ®çš„éªŒè¯ã€å­—èŠ‚ç éªŒè¯å’Œç¬¦å·å¼•ç”¨éªŒè¯ã€‚ æ–‡ä»¶æ ¼å¼éªŒè¯ ä¸»è¦éªŒè¯å­—èŠ‚æµæ˜¯å¦ç¬¦åˆcalssæ–‡ä»¶æ ¼å¼çš„è§„èŒƒï¼Œå¦‚æœç¬¦åˆåˆ™æŠŠå­—èŠ‚æµåŠ è½½åˆ°æ–¹æ³•åŒºä¸­è¿›è¡Œå­˜å‚¨ã€‚ éªŒè¯æ–‡ä»¶å¤´ã€ä¸»æ¬¡ç‰ˆæœ¬ç­‰ç­‰ã€‚ å…ƒæ•°æ®éªŒè¯ä¸»è¦å¯¹å­—èŠ‚ç æè¿°çš„ä¿¡æ¯è¿›è¡Œè¯­ä¹‰åˆ†æï¼Œä¿è¯å…¶æè¿°ç¬¦åˆJavaè¯­è¨€çš„è¦æ±‚ã€‚ ç±»æ˜¯å¦æœ‰çˆ¶ç±»ã€‚ æ˜¯å¦ç»§æ‰¿äº†ä¸å…è®¸è¢«ç»§æ‰¿çš„ç±»ï¼ˆfinalä¿®é¥°è¿‡çš„ç±»ï¼‰ã€‚ å¦‚æœè¿™ä¸ªç±»ä¸æ˜¯æŠ½è±¡ç±»ï¼Œæ˜¯å¦å®ç°å…¶çˆ¶ç±»æˆ–æ¥å£ä¸­æ‰€æœ‰è¦æ±‚å®ç°çš„æ–¹æ³•ã€‚ ç±»ä¸­çš„å­—æ®µã€æ–¹æ³•æ˜¯å¦ä¸çˆ¶ç±»äº§ç”ŸçŸ›ç›¾ï¼ˆå¦‚ï¼šè¦†ç›–çˆ¶ç±»finalç±»å‹çš„å­—æ®µï¼Œæˆ–è€…ä¸ç¬¦åˆä¸ªåˆ™çš„æ–¹æ³•ï¼‰ã€‚ å­—èŠ‚ç éªŒè¯è¯¥é˜¶æ®µéªŒè¯çš„ä¸»è¦å·¥ä½œæ˜¯è¿›è¡Œæ•°æ®æµå’Œæ§åˆ¶æµåˆ†æï¼Œå¯¹ç±»çš„æ–¹æ³•ä½“è¿›è¡Œæ ¡éªŒåˆ†æï¼Œä»¥ä¿è¯è¢«æ ¡éªŒçš„ç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„è¡Œä¸ºã€‚ä¿è¯è¢«æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºå®‰å…¨çš„äº‹ä»¶ã€‚ ç¬¦å·å¼•ç”¨éªŒè¯ ç¬¦å·å¼•ç”¨ä¸­é€šè¿‡å­—ç¬¦ä¸²æè¿°çš„å…¨é™å®šåæ˜¯å¦èƒ½æ‰¾åˆ°å¯¹åº”çš„ç±»ã€‚ åœ¨æŒ‡å®šç±»ä¸­æ˜¯å¦å­˜åœ¨ç¬¦åˆæ–¹æ³•çš„å­—æ®µæè¿°ç¬¦ä»¥åŠç®€å•åç§°æ‰€æè¿°çš„æ–¹æ³•å’Œå­—æ®µã€‚ ç¬¦å·å¼•ç”¨ä¸­çš„ç±»ã€å­—æ®µã€æ–¹æ³•çš„è®¿é—®æ€§ï¼ˆprivateã€protectedã€publicã€defaultï¼‰æ˜¯å¦å¯è¢«å½“å‰ç±»è®¿é—®ã€‚ å‡†å¤‡å‡†å¤‡é˜¶æ®µæ˜¯æ­£å¼ä¸ºç±»å˜é‡åˆ†é…å†…å­˜å¹¶è®¾ç½®ç±»å˜é‡åˆå§‹å€¼çš„é˜¶æ®µï¼Œè¿™äº›å†…å­˜éƒ½å°†åœ¨æ–¹æ³•åŒºä¸­åˆ†é…ã€‚å¯¹äºè¯¥é˜¶æ®µæœ‰ä»¥ä¸‹å‡ ç‚¹éœ€è¦æ³¨æ„ï¼š 1ã€è¿™æ—¶å€™è¿›è¡Œå†…å­˜åˆ†é…çš„ä»…åŒ…æ‹¬ç±»å˜é‡ï¼ˆstaticï¼‰ï¼Œè€Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼Œå®ä¾‹å˜é‡ä¼šåœ¨å¯¹è±¡å®ä¾‹åŒ–æ—¶éšç€å¯¹è±¡ä¸€å—åˆ†é…åœ¨Javaå †ä¸­ã€‚ â€‹ 2ã€è¿™é‡Œæ‰€è®¾ç½®çš„åˆå§‹å€¼é€šå¸¸æƒ…å†µä¸‹æ˜¯æ•°æ®ç±»å‹é»˜è®¤çš„é›¶å€¼ï¼ˆå¦‚0ã€0Lã€nullã€falseç­‰ï¼‰ï¼Œè€Œä¸æ˜¯è¢«åœ¨Javaä»£ç ä¸­è¢«æ˜¾å¼åœ°èµ‹äºˆçš„å€¼ã€‚ å‡è®¾ä¸€ä¸ªç±»å˜é‡çš„å®šä¹‰ä¸ºï¼špublic static int value = 3ï¼› é‚£ä¹ˆå˜é‡valueåœ¨å‡†å¤‡é˜¶æ®µè¿‡åçš„åˆå§‹å€¼ä¸º0ï¼Œè€Œä¸æ˜¯3ï¼Œå› ä¸ºè¿™æ—¶å€™å°šæœªå¼€å§‹æ‰§è¡Œä»»ä½•Javaæ–¹æ³•ï¼Œè€ŒæŠŠvalueèµ‹å€¼ä¸º3çš„putstaticæŒ‡ä»¤æ˜¯åœ¨ç¨‹åºç¼–è¯‘åï¼Œå­˜æ”¾äºç±»æ„é€ å™¨ï¼ˆï¼‰æ–¹æ³•ä¹‹ä¸­çš„ï¼Œæ‰€ä»¥æŠŠvalueèµ‹å€¼ä¸º3çš„åŠ¨ä½œå°†åœ¨åˆå§‹åŒ–é˜¶æ®µæ‰ä¼šæ‰§è¡Œã€‚ ä¸‹è¡¨åˆ—å‡ºäº†Javaä¸­æ‰€æœ‰åŸºæœ¬æ•°æ®ç±»å‹ä»¥åŠreferenceç±»å‹çš„é»˜è®¤é›¶å€¼ï¼š 12æ³¨æ„ï¼šåªè®¾ç½®ç±»ä¸­çš„é™æ€å˜é‡ï¼ˆæ–¹æ³•åŒºä¸­ï¼‰ï¼Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼ˆå †å†…å­˜ä¸­ï¼‰ï¼Œå®ä¾‹å˜é‡æ˜¯åœ¨å¯¹è±¡å®ä¾‹åŒ–çš„æ—¶å€™åˆå§‹åŒ–åˆ†é…å€¼çš„ã€‚ è§£æè§£æé˜¶æ®µæ˜¯è™šæ‹Ÿæœºå°†å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹ã€‚ ç±»æˆ–æ¥å£çš„è§£æï¼šåˆ¤æ–­æ‰€è¦è½¬åŒ–æˆçš„ç›´æ¥å¼•ç”¨æ˜¯å¯¹æ•°ç»„ç±»å‹ï¼Œè¿˜æ˜¯æ™®é€šçš„å¯¹è±¡ç±»å‹çš„å¼•ç”¨ï¼Œä»è€Œè¿›è¡Œä¸åŒçš„è§£æã€‚ å­—æ®µè§£æï¼šå¯¹å­—æ®µè¿›è¡Œè§£ææ—¶ï¼Œä¼šå…ˆåœ¨æœ¬ç±»ä¸­æŸ¥æ‰¾æ˜¯å¦åŒ…å«æœ‰ç®€å•åç§°å’Œå­—æ®µæè¿°ç¬¦éƒ½ä¸ç›®æ ‡ç›¸åŒ¹é…çš„å­—æ®µï¼Œå¦‚æœæœ‰ï¼Œåˆ™æŸ¥æ‰¾ç»“æŸï¼›å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¼šæŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸Šå¾€ä¸‹é€’å½’æœç´¢è¯¥ç±»æ‰€å®ç°çš„å„ä¸ªæ¥å£å’Œå®ƒä»¬çš„çˆ¶æ¥å£ï¼Œè¿˜æ²¡æœ‰ï¼Œåˆ™æŒ‰ç…§ç»§æ‰¿å…³ç³»ä»ä¸Šå¾€ä¸‹é€’å½’æœç´¢å…¶çˆ¶ç±»ï¼Œç›´è‡³æŸ¥æ‰¾ç»“æŸã€‚ ç±»æ–¹æ³•è§£æï¼šå¯¹ç±»æ–¹æ³•çš„è§£æä¸å¯¹å­—æ®µè§£æçš„æœç´¢æ­¥éª¤å·®ä¸å¤šï¼Œåªæ˜¯å¤šäº†åˆ¤æ–­è¯¥æ–¹æ³•æ‰€å¤„çš„æ˜¯ç±»è¿˜æ˜¯æ¥å£çš„æ­¥éª¤ï¼Œè€Œä¸”å¯¹ç±»æ–¹æ³•çš„åŒ¹é…æœç´¢ï¼Œæ˜¯å…ˆæœç´¢çˆ¶ç±»ï¼Œå†æœç´¢æ¥å£ã€‚ æ¥å£æ–¹æ³•è§£æï¼šä¸ç±»æ–¹æ³•è§£ææ­¥éª¤ç±»ä¼¼ï¼Œåªæ˜¯æ¥å£ä¸ä¼šæœ‰çˆ¶ç±»ï¼Œå› æ­¤ï¼Œåªé€’å½’å‘ä¸Šæœç´¢çˆ¶æ¥å£å°±è¡Œäº†ã€‚ åˆå§‹åŒ–åˆå§‹åŒ–æ˜¯ç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€æ­¥ï¼Œåˆ°äº†æ­¤é˜¶æ®µï¼Œæ‰çœŸæ­£å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„Javaç¨‹åºä»£ç ã€‚åœ¨å‡†å¤‡é˜¶æ®µï¼Œç±»å˜é‡å·²ç»è¢«èµ‹è¿‡ä¸€æ¬¡ç³»ç»Ÿè¦æ±‚çš„åˆå§‹å€¼ï¼Œè€Œåœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œåˆ™æ˜¯æ ¹æ®ç¨‹åºå‘˜é€šè¿‡ç¨‹åºæŒ‡å®šçš„ä¸»è§‚è®¡åˆ’å»åˆå§‹åŒ–ç±»å˜é‡å’Œå…¶ä»–èµ„æºï¼Œæˆ–è€…å¯ä»¥ä»å¦ä¸€ä¸ªè§’åº¦æ¥è¡¨è¾¾ï¼šåˆå§‹åŒ–é˜¶æ®µæ˜¯æ‰§è¡Œç±»æ„é€ å™¨()æ–¹æ³•çš„è¿‡ç¨‹ã€‚ æ‰§è¡Œç±»æ„é€ å™¨ã€‚ åˆå§‹åŒ–é™æ€å˜é‡ã€é™æ€å—ä¸­çš„æ•°æ®ç­‰ï¼ˆä¸€ä¸ªç±»åŠ è½½å™¨åªä¼šåˆå§‹åŒ–ä¸€æ¬¡ï¼‰ã€‚ å­ç±»çš„è°ƒç”¨å‰ä¿è¯çˆ¶ç±»çš„è¢«è°ƒç”¨ã€‚ 12æ³¨æ„ï¼š&lt;clinit&gt;æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰§è¡Œ&lt;clinit&gt;çš„çº¿ç¨‹éœ€è¦å…ˆè·å–é”æ‰èƒ½è¿›è¡Œåˆå§‹åŒ–æ“ä½œï¼Œä¿è¯åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œ&lt;clinit&gt;(åˆ©ç”¨æ­¤ç‰¹æ€§å¯ä»¥å®ç°çº¿ç¨‹å®‰å…¨çš„æ‡’æ±‰å•ä¾‹æ¨¡å¼)ã€‚å¦‚æœåœ¨ä¸€ä¸ªç±»çš„&lt;clinit&gt;æ–¹æ³•ä¸­æœ‰è€—æ—¶å¾ˆé•¿çš„æ“ä½œï¼Œé‚£å°±å¯èƒ½é€ æˆå¤šä¸ªçº¿ç¨‹é˜»å¡ï¼Œåœ¨å®é™…åº”ç”¨ä¸­è¿™ç§é˜»å¡å¾€å¾€æ˜¯å¾ˆéšè”½çš„ã€‚ ç±»åŠ è½½å™¨ç±»è¢«åŠ è½½è¿›è™šæ‹Ÿæœºæ˜¯ç”±ç±»åŠ è½½å™¨ï¼ˆClassLoaderï¼‰æ¥å®Œæˆçš„ã€‚ç±»åŠ è½½å™¨è™½ç„¶åªç”¨äºå®ç°ç±»çš„åŠ è½½åŠ¨ä½œï¼Œä½†å®ƒåœ¨Javaç¨‹åºä¸­èµ·åˆ°çš„ä½œç”¨å´è¿œè¿œä¸é™äºç±»çš„åŠ è½½é˜¶æ®µã€‚å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½éœ€è¦ç”±å®ƒçš„ç±»åŠ è½½å™¨å’Œè¿™ä¸ªç±»æœ¬èº«ä¸€åŒç¡®å®šå…¶åœ¨å°±Javaè™šæ‹Ÿæœºä¸­çš„å”¯ä¸€æ€§ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå³ä½¿ä¸¤ä¸ªç±»æ¥æºäºåŒä¸€ä¸ªClassæ–‡ä»¶ï¼Œåªè¦åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œé‚£è¿™ä¸¤ä¸ªç±»å°±å¿…å®šä¸ç›¸ç­‰ã€‚è¿™é‡Œçš„â€œç›¸ç­‰â€åŒ…æ‹¬äº†ä»£è¡¨ç±»çš„Classå¯¹è±¡çš„equalsï¼ˆï¼‰ã€isAssignableFromï¼ˆï¼‰ã€isInstanceï¼ˆï¼‰ç­‰æ–¹æ³•çš„è¿”å›ç»“æœï¼Œä¹ŸåŒ…æ‹¬äº†ä½¿ç”¨instanceofå…³é”®å­—å¯¹å¯¹è±¡æ‰€å±å…³ç³»çš„åˆ¤å®šç»“æœã€‚åªæœ‰åœ¨ä¸¤ä¸ªç±»è¢«åŒä¸€ä¸ªç±»åŠ è½½å™¨åŠ è½½çš„å‰æä¸‹ï¼Œæ¯”è¾ƒæ‰æœ‰æ„ä¹‰ã€‚å¦åˆ™ï¼Œå³ä½¿ä¸¤ä¸ªç±»æ¥è‡ªåŒä¸€ä¸ªclassæ–‡ä»¶ï¼Œè¢«åŒä¸€ä¸ªJVMåŠ è½½ï¼Œä½†æ˜¯åŠ è½½å®ƒä»¬çš„ç±»åŠ è½½å™¨ä¸åŒï¼Œåˆ™è¿™ä¸¤ä¸ªç±»å°±ä¸ç›¸ç­‰ã€‚è¿™å°±ç›¸å½“äºä¸¤ä¸ªå‘½åç©ºé—´ä¸­çš„ç­‰ä»·ç±»LoaderA::Cå’ŒLoaderB::Cã€‚ ç±»åŠ è½½å™¨çš„ç§ç±»ä»Javaè™šæ‹Ÿæœºçš„è§’åº¦æ¥åˆ†çš„è¯ï¼ŒClassLoaderåˆ†ä¸ºå¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰å’Œå…¶å®ƒçš„åŠ è½½å™¨ã€‚å…¶ä¸­Bootstrap ClassLoaderè´Ÿè´£åŠ è½½Javaçš„æ ¸å¿ƒç±»ï¼Œè¯¥ç±»åŠ è½½å™¨ä½¿ç”¨C++è¯­è¨€å®ç°ï¼Œå±äºè™šæ‹Ÿæœºè‡ªèº«çš„ä¸€éƒ¨åˆ†ã€‚è€Œå…¶å®ƒç±»åŠ è½½å™¨ç‹¬ç«‹äºJVMå¤–éƒ¨ï¼Œå¹¶ä¸”å…¨éƒ¨ç»§æ‰¿è‡ªæŠ½è±¡ç±»java.lang.ClassLoaderã€‚ ç«™åœ¨Javaå¼€å‘äººå‘˜çš„è§’åº¦æ¥åˆ†çš„è¯ï¼ŒClassLoaderåˆ†ä¸ºï¼š å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap ClassLoaderï¼‰ è´Ÿè´£åŠ è½½JAVA_HOME\\libç›®å½•ä¸­å¹¶ä¸”èƒ½è¢«è™šæ‹Ÿæœºè¯†åˆ«çš„ç±»åº“åˆ°JVMå†…å­˜ä¸­ï¼ˆå¦‚rt.jarï¼Œæ‰€æœ‰çš„java.*å¼€å¤´çš„ç±»å‡è¢«Bootstrap ClassLoaderåŠ è½½ï¼‰ï¼Œå¦‚æœåç§°ä¸ç¬¦åˆçš„ç±»åº“å³ä½¿æ”¾åœ¨libç›®å½•ä¸­ä¹Ÿä¸ä¼šè¢«åŠ è½½ã€‚è¯¥ç±»åŠ è½½å™¨æ— æ³•è¢«Javaç¨‹åºç›´æ¥å¼•ç”¨ã€‚ æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension ClassLoaderï¼‰ è¯¥åŠ è½½å™¨ä¸»è¦æ˜¯è´Ÿè´£åŠ è½½JDK\\jre\\lib\\extç›®å½•ä¸­ï¼Œæˆ–è€…ç”±java.ext.dirsç³»ç»Ÿå˜é‡æŒ‡å®šçš„è·¯å¾„ä¸­çš„æ‰€æœ‰ç±»åº“ï¼ˆå¦‚javax.*å¼€å¤´çš„ç±»ï¼‰ã€‚è¯¥åŠ è½½å™¨å¯ä»¥è¢«å¼€å‘è€…ç›´æ¥ä½¿ç”¨ã€‚ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication ClassLoaderï¼‰ è¯¥ç±»åŠ è½½å™¨ä¹Ÿç§°ä¸ºç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆSystem ClassLoaderï¼‰ï¼Œå®ƒè´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClasspathï¼‰ä¸Šæ‰€æŒ‡å®šçš„ç±»åº“ï¼Œå¼€å‘è€…å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥ç±»åŠ è½½å™¨ï¼Œå¦‚æœåº”ç”¨ç¨‹åºä¸­æ²¡æœ‰è‡ªå®šä¹‰è¿‡è‡ªå·±çš„ç±»åŠ è½½å™¨ï¼Œä¸€èˆ¬æƒ…å†µä¸‹è¿™ä¸ªå°±æ˜¯ç¨‹åºä¸­é»˜è®¤çš„ç±»åŠ è½½å™¨ã€‚ é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰è‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨ï¼Œå®ƒä»¬ä¹‹é—´çš„å±‚æ¬¡å…³ç³»è¢«ç§°ä¸ºç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ã€‚è¯¥æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”è¯¥æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ï¼Œè€Œè¿™ç§çˆ¶å­å…³ç³»ä¸€èˆ¬é€šè¿‡ç»„åˆï¼ˆCompositionï¼‰å…³ç³»æ¥å®ç°ï¼Œè€Œä¸æ˜¯é€šè¿‡ç»§æ‰¿ï¼ˆInheritanceï¼‰ã€‚ åŒäº²å§”æ´¾æ¨¡å‹ å¦‚ä¸Šå›¾æ‰€ç¤ºçš„ç±»åŠ è½½å™¨ä¹‹é—´çš„è¿™ç§å±‚æ¬¡å…³ç³»ï¼Œå°±ç§°ä¸ºç±»åŠ è½½å™¨çš„åŒäº²å§”æ´¾æ¨¡å‹ï¼ˆParent Delegation Modelï¼‰ã€‚è¯¥æ¨¡å‹è¦æ±‚é™¤äº†é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨å¤–ï¼Œå…¶ä½™çš„ç±»åŠ è½½å™¨éƒ½åº”å½“æœ‰è‡ªå·±çš„çˆ¶ç±»åŠ è½½å™¨ã€‚å­ç±»åŠ è½½å™¨å’Œçˆ¶ç±»åŠ è½½å™¨ä¸æ˜¯ä»¥ç»§æ‰¿ï¼ˆInheritanceï¼‰çš„å…³ç³»æ¥å®ç°ï¼Œè€Œæ˜¯é€šè¿‡ç»„åˆï¼ˆCompositionï¼‰å…³ç³»æ¥å¤ç”¨çˆ¶åŠ è½½å™¨çš„ä»£ç ã€‚ åŒäº²å§”æ´¾æ¨¡å‹çš„å·¥ä½œè¿‡ç¨‹ä¸ºï¼šå¦‚æœä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°äº†ç±»åŠ è½½çš„è¯·æ±‚ï¼Œå®ƒé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œè€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€ä¸ªå±‚æ¬¡çš„åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„ç±»åŠ è½½è¯·æ±‚éƒ½ä¼šä¼ ç»™é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œåªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¯¥åŠ è½½è¯·æ±‚ï¼ˆè¯¥åŠ è½½å™¨çš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°å¯¹åº”çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½ã€‚ ä½¿ç”¨è¿™ç§æ¨¡å‹æ¥ç»„ç»‡ç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»çš„å¥½å¤„æ˜¯Javaç±»éšç€å®ƒçš„ç±»åŠ è½½å™¨ä¸€èµ·å…·å¤‡äº†ä¸€ç§å¸¦æœ‰ä¼˜å…ˆçº§çš„å±‚æ¬¡å…³ç³»ã€‚ä¾‹å¦‚java.lang.Objectç±»ï¼Œæ— è®ºå“ªä¸ªç±»åŠ è½½å™¨å»åŠ è½½è¯¥ç±»ï¼Œæœ€ç»ˆéƒ½æ˜¯ç”±å¯åŠ¨ç±»åŠ è½½å™¨è¿›è¡ŒåŠ è½½ï¼Œå› æ­¤Objectç±»åœ¨ç¨‹åºçš„å„ç§ç±»åŠ è½½å™¨ç¯å¢ƒä¸­éƒ½æ˜¯åŒä¸€ä¸ªç±»ã€‚å¦åˆ™çš„è¯ï¼Œå¦‚æœä¸ä½¿ç”¨è¯¥æ¨¡å‹çš„è¯ï¼Œå¦‚æœç”¨æˆ·è‡ªå®šä¹‰ä¸€ä¸ªjava.lang.Objectç±»ä¸”å­˜æ”¾åœ¨classpathä¸­ï¼Œé‚£ä¹ˆç³»ç»Ÿä¸­å°†ä¼šå‡ºç°å¤šä¸ªObjectç±»ï¼Œåº”ç”¨ç¨‹åºä¹Ÿä¼šå˜å¾—å¾ˆæ··ä¹±ã€‚å¦‚æœæˆ‘ä»¬è‡ªå®šä¹‰ä¸€ä¸ªrt.jarä¸­å·²æœ‰ç±»çš„åŒåJavaç±»ï¼Œä¼šå‘ç°JVMå¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼Œä½†è¯¥ç±»æ°¸è¿œæ— æ³•è¢«åŠ è½½è¿è¡Œã€‚ åœ¨rt.jaråŒ…ä¸­çš„java.lang.ClassLoaderç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æŸ¥çœ‹ç±»åŠ è½½å®ç°è¿‡ç¨‹çš„ä»£ç ï¼Œå…·ä½“æºç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324252627282930protected synchronized Class&lt;?&gt; loadClass(String name, boolean resolve) throws ClassNotFoundException&#123; // First, check if the class has already been loaded //é¦–å…ˆæ£€æŸ¥è¯·æ±‚çš„ç±»æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ Class c = findLoadedClass(name); if (c == null) &#123; try &#123; //å§”æ´¾çˆ¶ç±»åŠ è½½å™¨åŠ è½½ if (parent != null) &#123; c = parent.loadClass(name, false); //å§”æ´¾å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ &#125; else &#123; c = findBootstrapClassOrNull(name); &#125; //çˆ¶ç±»åŠ è½½å™¨æ— æ³•å®Œæˆç±»åŠ è½½è¯·æ±‚ &#125; catch (ClassNotFoundException e) &#123; // ClassNotFoundException thrown if class not found // from the non-null parent class loader &#125; //æœ¬èº«ç±»åŠ è½½å™¨è¿›è¡Œç±»åŠ è½½ if (c == null) &#123; // If still not found, then invoke findClass in order // to find the class. c = findClass(name); &#125; &#125; if (resolve) &#123; resolveClass(c); &#125; return c; &#125; é€šè¿‡ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒåŒäº²å§”æ´¾æ¨¡å‹æ˜¯é€šè¿‡loadClass()æ–¹æ³•æ¥å®ç°çš„ï¼Œæ ¹æ®ä»£ç ä»¥åŠä»£ç ä¸­çš„æ³¨é‡Šå¯ä»¥å¾ˆæ¸…æ¥šåœ°äº†è§£æ•´ä¸ªè¿‡ç¨‹å…¶å®éå¸¸ç®€å•ï¼šå…ˆæ£€æŸ¥æ˜¯å¦å·²ç»è¢«åŠ è½½è¿‡ï¼Œå¦‚æœæ²¡æœ‰åˆ™è°ƒç”¨çˆ¶åŠ è½½å™¨çš„loadClass()æ–¹æ³•ï¼Œå¦‚æœçˆ¶åŠ è½½å™¨ä¸ºç©ºåˆ™é»˜è®¤ä½¿ç”¨å¯åŠ¨ç±»åŠ è½½å™¨ä½œä¸ºçˆ¶åŠ è½½å™¨ã€‚å¦‚æœçˆ¶ç±»åŠ è½½å™¨åŠ è½½å¤±è´¥ï¼Œåˆ™å…ˆæŠ›å‡ºClassNotFoundExceptionï¼Œç„¶åå†è°ƒç”¨è‡ªå·±çš„findClass()æ–¹æ³•è¿›è¡ŒåŠ è½½ã€‚ æ³¨æ„ï¼ŒåŒäº²å§”æ´¾æ¨¡å‹æ˜¯Javaè®¾è®¡è€…æ¨èç»™å¼€å‘è€…çš„ç±»åŠ è½½å™¨çš„å®ç°æ–¹å¼ï¼Œå¹¶ä¸æ˜¯å¼ºåˆ¶è§„å®šçš„ã€‚å¤§å¤šæ•°çš„ç±»åŠ è½½å™¨éƒ½éµå¾ªè¿™ä¸ªæ¨¡å‹ï¼Œä½†æ˜¯JDKä¸­ä¹Ÿæœ‰è¾ƒå¤§è§„æ¨¡ç ´ååŒäº²æ¨¡å‹çš„æƒ…å†µï¼Œä¾‹å¦‚çº¿ç¨‹ä¸Šä¸‹æ–‡ç±»åŠ è½½å™¨ï¼ˆThread Context ClassLoaderï¼‰çš„å‡ºç°ã€‚ æ€»ç»“æ•´ä¸ªç±»åŠ è½½è¿‡ç¨‹ä¸­ï¼Œé™¤äº†åœ¨åŠ è½½é˜¶æ®µç”¨æˆ·åº”ç”¨ç¨‹åºå¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨å‚ä¸ä¹‹å¤–ï¼Œå…¶ä½™æ‰€æœ‰çš„åŠ¨ä½œå®Œå…¨ç”±è™šæ‹Ÿæœºä¸»å¯¼å’Œæ§åˆ¶ã€‚åˆ°äº†åˆå§‹åŒ–æ‰å¼€å§‹æ‰§è¡Œç±»ä¸­å®šä¹‰çš„Javaç¨‹åºä»£ç ï¼Œä½†è¿™é‡Œçš„æ‰§è¡Œä»£ç åªæ˜¯ä¸ªå¼€ç«¯ï¼Œå®ƒä»…é™äºï¼ˆï¼‰æ–¹æ³•ã€‚ç±»åŠ è½½è¿‡ç¨‹ä¸­ä¸»è¦æ˜¯å°†Classæ–‡ä»¶ï¼ˆå‡†ç¡®åœ°è®²ï¼Œåº”è¯¥æ˜¯ç±»çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼‰åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­ï¼ŒçœŸæ­£æ‰§è¡Œå­—èŠ‚ç çš„æ“ä½œï¼Œåœ¨åŠ è½½å®Œæˆåæ‰çœŸæ­£å¼€å§‹ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://sunny0715.github.io/tags/jvm/"}]},{"title":"UMLå·¥å…·-PowerDesignerè®¾è®¡æ•°æ®åº“","slug":"UMLå·¥å…·-PowerDesignerè®¾è®¡æ•°æ®åº“","date":"2017-12-06T07:47:06.000Z","updated":"2018-03-13T05:53:11.889Z","comments":true,"path":"2017/12/06/UMLå·¥å…·-PowerDesignerè®¾è®¡æ•°æ®åº“/","link":"","permalink":"https://sunny0715.github.io/2017/12/06/UMLå·¥å…·-PowerDesignerè®¾è®¡æ•°æ®åº“/","excerpt":"å¼•è¨€åœ¨æ•°æ®åº“çš„å¼€å‘è®¾è®¡ä¸­ï¼ŒPowerDesigerï¼ˆPDï¼‰æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¸¸ç”¨çš„UMLå·¥å…·ã€‚PowerDesigerä¸ºå„ç±»æ•°æ®æ¨¡å‹æä¾›äº†ç›´è§‚çš„ç¬¦å·è¡¨ç¤ºï¼Œä¸ä»…ä½¿è®¾è®¡äººå‘˜èƒ½æ›´æ–¹ä¾¿ã€æ›´å¿«æ·åœ°ä½¿éè®¡ç®—æœºä¸“ä¸šæŠ€æœ¯äººå‘˜å±•ç¤ºæ•°æ®åº“è®¾è®¡å’Œåº”ç”¨ç³»ç»Ÿè®¾è®¡ï¼Œä½¿ç³»ç»Ÿè®¾è®¡äººå‘˜ä¸ä½¿ç”¨ç³»ç»Ÿçš„ä¸šåŠ¡äººå‘˜æ›´æ˜“äºç›¸äº’ç†è§£å’Œäº¤æµï¼ŒåŒæ—¶ä¹Ÿä½¿é¡¹ç›®ç»„å†…çš„äº¤æµæ›´ä¸ºç›´è§‚ã€å‡†ç¡®ï¼Œæ›´ä¾¿äºåè°ƒå·¥ä½œï¼Œä»è€ŒåŠ é€Ÿç³»ç»Ÿçš„è®¾è®¡å’Œå¼€å‘è¿‡ç¨‹ã€‚PowerDesigerè®¾è®¡å®Œæˆåçš„æ•°æ®åº“å¯ç›´æ¥ç”ŸæˆSQLè¯­å¥ã€‚","text":"å¼•è¨€åœ¨æ•°æ®åº“çš„å¼€å‘è®¾è®¡ä¸­ï¼ŒPowerDesigerï¼ˆPDï¼‰æ˜¯ä¸€ä¸ªè¾ƒä¸ºå¸¸ç”¨çš„UMLå·¥å…·ã€‚PowerDesigerä¸ºå„ç±»æ•°æ®æ¨¡å‹æä¾›äº†ç›´è§‚çš„ç¬¦å·è¡¨ç¤ºï¼Œä¸ä»…ä½¿è®¾è®¡äººå‘˜èƒ½æ›´æ–¹ä¾¿ã€æ›´å¿«æ·åœ°ä½¿éè®¡ç®—æœºä¸“ä¸šæŠ€æœ¯äººå‘˜å±•ç¤ºæ•°æ®åº“è®¾è®¡å’Œåº”ç”¨ç³»ç»Ÿè®¾è®¡ï¼Œä½¿ç³»ç»Ÿè®¾è®¡äººå‘˜ä¸ä½¿ç”¨ç³»ç»Ÿçš„ä¸šåŠ¡äººå‘˜æ›´æ˜“äºç›¸äº’ç†è§£å’Œäº¤æµï¼ŒåŒæ—¶ä¹Ÿä½¿é¡¹ç›®ç»„å†…çš„äº¤æµæ›´ä¸ºç›´è§‚ã€å‡†ç¡®ï¼Œæ›´ä¾¿äºåè°ƒå·¥ä½œï¼Œä»è€ŒåŠ é€Ÿç³»ç»Ÿçš„è®¾è®¡å’Œå¼€å‘è¿‡ç¨‹ã€‚PowerDesigerè®¾è®¡å®Œæˆåçš„æ•°æ®åº“å¯ç›´æ¥ç”ŸæˆSQLè¯­å¥ã€‚ ä½¿ç”¨ODBCè¿æ¥MySQLå‡†å¤‡å·¥ä½œPowerDesigneræœ¬èº«æ˜¯32ä½çš„ç¨‹åºï¼ˆç‰¹åˆ«é‡è¦ï¼‰ï¼Œæ•…ä¸ç®¡åœ¨32ä½æˆ–è€…64ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œéƒ½éœ€è¦å®‰è£…32ä½çš„MySQL Connector /ODBCã€‚ MySQL Connector /ODBCä¸‹è½½åœ°å€ï¼šhttps://dev.mysql.com/downloads/connector/odbc/ è¿æ¥æ•°æ®åº“ å®‰è£…å®ŒODBCä¹‹åï¼Œæ‰“å¼€PowerDesignerï¼Œæ–°å»ºä¸€ä¸ªModelï¼ŒFileâ€”&gt;New Model é€‰æ‹©å·¥å…·æ ä¸­çš„Databaseâ€”&gt; Update Model from Databaseï¼Œå¦‚ä¸‹å›¾ æ‰“å¼€é…ç½®å¯¹è¯æ¡†ï¼Œé€‰æ‹©[Using a data source]ï¼Œç‚¹å‡»è¾“å…¥æ¡†åçš„å›¾æ ‡ é…ç½®ODBCæ•°æ®æº è¯´æ˜ï¼šè¿™é‡Œæä¾›äº†ANSIå’ŒUnicodeä¸¤ç§å­—ç¬¦é›†ç‰ˆæœ¬çš„Driverï¼ŒUnicodeæä¾›æ›´ä¸°å¯Œçš„å­—ç¬¦é›†ï¼Œä¸€èˆ¬æ¨èä½¿ç”¨Unicodeã€‚ ç‚¹å‡»å®Œæˆï¼Œé…ç½®è¿æ¥ä¿¡æ¯ã€‚ 123456789è¯´æ˜ï¼šData Source Nameï¼šæŒ‡å®šå½“å‰é…ç½®çš„ODBCæ•°æ®æºåç§°ï¼Œå¯éšæ„å¡«å†™ã€‚Descriptionï¼šæŒ‡å®šODBCæ•°æ®æºçš„æè¿°ä¿¡æ¯ï¼Œå¯æ ¹æ®ç”¨é€”éšæ„å¡«å†™ã€‚TCP/IP Serverï¼šé‡‡ç”¨TCP/IPåè®®è¿æ¥æœåŠ¡å™¨ï¼Œå¦‚æœæ˜¯æœ¬åœ°å¡«å†™localhostæˆ–è€…127.0.0.1ï¼ˆæ ¹æ®å®é™…MySQLç”¨æˆ·æƒ…å†µé€‰æ‹©ï¼‰ï¼Œå¦‚æœæ˜¯è¿œç¨‹æœåŠ¡å™¨åˆ™å¡«å†™ç›¸åº”IPåœ°å€å³å¯ã€‚Portï¼šé»˜è®¤3306ï¼Œæ ¹æ®å®é™…MySQLçš„ç«¯å£è®¾ç½®å¡«å†™ã€‚lNamed Pipeï¼šå‘½åç®¡é“æ–¹å¼è¿æ¥ï¼Œåªé€‚ç”¨äºwidowsä¸‹çš„æœ¬åœ°è¿æ¥ã€‚è¿æ¥æ€§èƒ½æ¯”TCP/IPæ–¹å¼æ›´é«˜ï¼Œæ›´å®‰å…¨ã€‚è¯·æŒ‰ç…§MySQLçš„é…ç½®æ–‡ä»¶my.iniä¸­çš„socketå‚æ•°æŒ‡å®šçš„å€¼å¡«å†™ï¼Œå¦‚æœæ²¡æœ‰è®¾ç½®åˆ™é»˜è®¤ä¸ºMySQLï¼ˆä½†æ˜¯ç›®å‰ä¸ºæ­¢è¿™ç§æ–¹å¼æˆ‘è¿˜æ²¡æœ‰æµ‹è¯•æˆåŠŸï¼‰ã€‚Userï¼šæ•°æ®åº“ç”¨æˆ·åã€‚Passwordï¼šæ•°æ®åº“å¯†ç ã€‚Databaseï¼šæ•°æ®åº“ä¸­çš„databaseã€‚ ä¿¡æ¯è¾“å…¥å®Œä¹‹åå¯ä»¥é€‰æ‹©Testæµ‹è¯•é…ç½®æ˜¯å¦æ­£ç¡®ï¼Œç‚¹å‡»OKå°±ç»“æŸäº†é…ç½®ã€‚ åˆ°è¿™é‡Œå·²ç»å¯ä»¥è¿æ¥æ•°æ®åº“äº†ã€‚ è®¾è®¡æ•°æ®åº“å¦‚æœåœ¨å·²æœ‰çš„æ•°æ®åº“ä¸Šéœ€è¦è®¾è®¡å’Œä¿®æ”¹ï¼Œå…ˆå–æ¶ˆæ‰€æœ‰è¡¨ï¼Œå†é€‰æ‹©éœ€è¦è®¾è®¡æˆ–ä¿®æ”¹çš„æ•°æ®åº“ï¼Œé€‰æ‹©è¡¨ï¼Œç‚¹å‡»okã€‚ è¿æ¥åçš„UMLå¦‚ä¸‹ï¼Œå¯ä»¥æ–°å»ºå’Œä¿®æ”¹è¡¨ åŒæ—¶å¯å¯¹è¡¨è¿›è¡Œä¸»å¤–é”®è®¾è®¡ï¼Œç°åœ¨ä¸»å¤–é”®å·²ç»å¾ˆå°‘ç”¨åˆ°äº†ã€‚ åŒå‡»è¡¨ä¹‹é—´çš„è¿æ¥çº¿ï¼Œç‚¹å‡»Joins ç‚¹å‡»ã€ç¡®å®šã€‘æŒ‰é’®ï¼Œå³å¯å¦‚æˆ‘ä»¬æ‰€æ„¿ï¼š ç”Ÿæˆå»ºè¡¨è¯­å¥ç‚¹å‡»Databaseâ€”&gt;Generate Database ç‚¹å‡»ã€ç¡®å®šã€‘æŒ‰é’®ä¹‹åï¼Œå¯ä»¥åœ¨æ¡Œé¢ä¸Šæ‰¾åˆ°shiro.sqlè¿™æ ·çš„ä¸€ä¸ªæ–‡ä»¶ï¼Œæ‰“å¼€ï¼Œå³å¯çœ‹åˆ°å»ºè¡¨è¯­å¥ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778/*==============================================================*//* DBMS name: MySQL 5.0 *//* Created on: 2017.12.6 17:22:25 *//*==============================================================*/drop table if exists shiro.u_permission;drop table if exists shiro.u_role;drop table if exists shiro.u_role_permission;drop table if exists shiro.u_user;drop table if exists shiro.u_user_role;/*==============================================================*//* User: shiro *//*==============================================================*/create user shiro;/*==============================================================*//* Table: u_permission *//*==============================================================*/create table shiro.u_permission( id bigint(20) not null auto_increment, url national varchar(256) comment 'urlåœ°å€', name national varchar(64) comment 'urlæè¿°', primary key (id));/*==============================================================*//* Table: u_role *//*==============================================================*/create table shiro.u_role( id bigint(20) not null auto_increment, name national varchar(32) comment 'è§’è‰²åç§°', type national varchar(10) comment 'è§’è‰²ç±»å‹', primary key (id));/*==============================================================*//* Table: u_role_permission *//*==============================================================*/create table shiro.u_role_permission( rid bigint(20) comment 'è§’è‰²ID', pid bigint(20) comment 'æƒé™ID');/*==============================================================*//* Table: u_user *//*==============================================================*/create table shiro.u_user( id bigint(20) not null auto_increment, nickname national varchar(20) comment 'ç”¨æˆ·æ˜µç§°', email national varchar(128) comment 'é‚®ç®±|ç™»å½•å¸å·', pswd national varchar(32) comment 'å¯†ç ', create_time datetime comment 'åˆ›å»ºæ—¶é—´', last_login_time datetime comment 'æœ€åç™»å½•æ—¶é—´', status bigint(1) default 1 comment '1:æœ‰æ•ˆï¼Œ0:ç¦æ­¢ç™»å½•', primary key (id));/*==============================================================*//* Table: u_user_role *//*==============================================================*/create table shiro.u_user_role( uid bigint(20) comment 'ç”¨æˆ·ID', rid bigint(20) comment 'è§’è‰²ID');alter table shiro.u_user_role add constraint FK_Reference_1 foreign key (uid) references shiro.u_user (id) on delete restrict on update restrict; å¾—åˆ°SQLè¯­å¥åå¯ç›´æ¥å¯¼å…¥åˆ°æ•°æ®åº“ã€‚ç”±æ­¤æˆ‘ä»¬è®¾è®¡æ•°æ®åº“å·²ç»å®Œæˆã€‚ æ€»ç»“è¿™é‡Œåªæ˜¯ç®€å•ä»‹ç»äº†PowerDesignerè¿›è¡Œæ•°æ®åº“æ¨¡å‹è®¾è®¡ï¼Œè‡ªåŠ¨ç”ŸæˆSQLè¯­å¥ç­‰åŠŸèƒ½ã€‚PowerDesignerè¿˜æœ‰å¾ˆå¤šæŠ€å·§å’ŒåŠŸèƒ½åœ¨æ‘¸ç´¢ä¸­ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"tool","slug":"tool","permalink":"https://sunny0715.github.io/tags/tool/"},{"name":"mysql","slug":"mysql","permalink":"https://sunny0715.github.io/tags/mysql/"}]},{"title":"Java String internæ–¹æ³•","slug":"Java-String-internæ–¹æ³•","date":"2017-12-01T02:27:19.000Z","updated":"2018-03-13T05:48:34.428Z","comments":true,"path":"2017/12/01/Java-String-internæ–¹æ³•/","link":"","permalink":"https://sunny0715.github.io/2017/12/01/Java-String-internæ–¹æ³•/","excerpt":"å¼•è¨€Stringç±»æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒçš„intern()æ–¹æ³•ä¹‹å‰è¿˜çœŸçš„ä¸å¤ªäº†è§£ï¼Œé€šè¿‡è°·æ­Œç™¾åº¦ä¸€ç•ªä¹‹åç»ˆäºææ˜ç™½äº†ã€‚ intern()æ–¹æ³•è®¾è®¡çš„åˆè¡·ï¼Œå°±æ˜¯é‡ç”¨Stringå¯¹è±¡ï¼Œä»¥èŠ‚çœå†…å­˜æ¶ˆè€—ã€‚","text":"å¼•è¨€Stringç±»æˆ‘ä»¬ç»å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯å®ƒçš„intern()æ–¹æ³•ä¹‹å‰è¿˜çœŸçš„ä¸å¤ªäº†è§£ï¼Œé€šè¿‡è°·æ­Œç™¾åº¦ä¸€ç•ªä¹‹åç»ˆäºææ˜ç™½äº†ã€‚ intern()æ–¹æ³•è®¾è®¡çš„åˆè¡·ï¼Œå°±æ˜¯é‡ç”¨Stringå¯¹è±¡ï¼Œä»¥èŠ‚çœå†…å­˜æ¶ˆè€—ã€‚ æ¡ˆä¾‹123String str1 = new String(\"rainbow\") + new String(\"horse\");System.out.println(str1.intern() == str1);System.out.println(str1 == \"rainbowhorse\"); åœ¨JDK1.7ä¸‹è¾“å‡ºç»“æœä¸ºï¼š 12truetrue å†å°†ä¸Šé¢çš„ä¾‹å­åŠ ä¸Šä¸€è¡Œä»£ç ï¼š 1234String str2 = \"rainbowhorse\"; //æ–°åŠ çš„ä¸€è¡Œä»£ç ï¼Œå…¶ä½™ä¸å˜ String str1 = new String(\"rainbow\") + new String(\"horse\");System.out.println(str1.intern() == str1);System.out.println(str1 == \"rainbowhorse\"); å†è¿è¡Œï¼Œç»“æœä¸ºï¼š 12falsefalse åœ¨JVMè¿è¡Œæ—¶æ•°æ®åŒºä¸­çš„æ–¹æ³•åŒºæœ‰ä¸€ä¸ªå¸¸é‡æ± ï¼Œä½†æ˜¯å‘ç°åœ¨JDK1.6ä»¥åå¸¸é‡æ± è¢«æ”¾ç½®åœ¨äº†å †ç©ºé—´ï¼Œå› æ­¤å¸¸é‡æ± ä½ç½®çš„ä¸åŒå½±å“åˆ°äº†Stringçš„intern()æ–¹æ³•çš„è¡¨ç°ã€‚ ä¸ºä»€ä¹ˆä½¿ç”¨intern()æ–¹æ³•å°±å¦‚å¼•è¨€æ‰€è¯´çš„ï¼Œintern()æ–¹æ³•è®¾è®¡çš„åˆè¡·ï¼Œå°±æ˜¯é‡ç”¨Stringå¯¹è±¡ï¼Œä»¥èŠ‚çœå†…å­˜æ¶ˆè€—ã€‚ä¸‹é¢é€šè¿‡ä¾‹å­æ¥è¯´æ˜ï¼š 12345678910111213141516171819202122public class Test &#123; static final int MAX = 100000; static final String[] arr = new String[MAX]; public static void main(String[] args) throws Exception &#123; // ä¸ºé•¿åº¦ä¸º10çš„Integeræ•°ç»„éšæœºèµ‹å€¼ Integer[] sample = new Integer[10]; Random random = new Random(1000); for (int i = 0; i &lt; sample.length; i++) &#123; sample[i] = random.nextInt(); &#125; // è®°å½•ç¨‹åºå¼€å§‹æ—¶é—´ long t = System.currentTimeMillis(); // ä½¿ç”¨/ä¸ä½¿ç”¨internæ–¹æ³•ä¸º10ä¸‡ä¸ªStringèµ‹å€¼ï¼Œå€¼æ¥è‡ªäºIntegeræ•°ç»„çš„10ä¸ªæ•° for (int i = 0; i &lt; MAX; i++) &#123; arr[i] = new String(String.valueOf(sample[i % sample.length])); // arr[i] = new String(String.valueOf(sample[i % sample.length])).intern(); &#125; System.out.println((System.currentTimeMillis() - t) + \"ms\"); System.gc(); &#125;&#125; è¿™ä¸ªä¸»è¦æ˜¯ä¸ºäº†è¯æ˜ä½¿ç”¨intern()æ¯”ä¸ä½¿ç”¨intern()æ¶ˆè€—çš„å†…å­˜æ›´å°‘ã€‚ å…ˆå®šä¹‰ä¸€ä¸ªé•¿åº¦ä¸º10çš„Integeræ•°ç»„ï¼Œå¹¶éšæœºä¸ºå…¶èµ‹å€¼ï¼Œåœ¨é€šè¿‡forå¾ªç¯ä¸ºé•¿åº¦ä¸º10ä¸‡çš„Stringå¯¹è±¡ä¾æ¬¡èµ‹å€¼ï¼Œè¿™äº›å€¼éƒ½æ¥è‡ªäºIntegeræ•°ç»„ã€‚ä¸¤ç§æƒ…å†µåˆ†åˆ«è¿è¡Œï¼Œå¯é€šè¿‡Window â€”&gt; Preferences â€“&gt; Java â€“&gt; Installed JREsè®¾ç½®JVMå¯åŠ¨å‚æ•°ä¸º-agentlib:hprof=heap=dump,format=bï¼Œå°†ç¨‹åºè¿è¡Œå®Œåçš„hprofç½®äºå·¥ç¨‹ç›®å½•ä¸‹ã€‚å†é€šè¿‡MATæ’ä»¶æŸ¥çœ‹è¯¥hprofæ–‡ä»¶ã€‚ ä¸ä½¿ç”¨intern()æ–¹æ³• ä½¿ç”¨intern()æ–¹æ³• ä»è¿è¡Œç»“æœæ¥çœ‹ï¼Œä¸ä½¿ç”¨intern()çš„æƒ…å†µä¸‹ï¼Œç¨‹åºç”Ÿæˆäº†101762ä¸ªStringå¯¹è±¡ï¼Œè€Œä½¿ç”¨äº†intern()æ–¹æ³•æ—¶ï¼Œç¨‹åºä»…ç”Ÿæˆäº†1772ä¸ªStringå¯¹è±¡ã€‚è¯æ˜äº†intern()èŠ‚çœå†…å­˜çš„ç»“è®ºã€‚ ä½†æ˜¯ä¼šå‘ç°ä½¿ç”¨äº†intern()æ–¹æ³•åç¨‹åºè¿è¡Œæ—¶é—´æœ‰æ‰€å¢åŠ ã€‚è¿™æ˜¯å› ä¸ºç¨‹åºä¸­æ¯æ¬¡éƒ½æ˜¯ç”¨äº†new Stringååˆè¿›è¡Œintern()æ“ä½œçš„è€—æ—¶æ—¶é—´ï¼Œä½†æ˜¯ä¸ä½¿ç”¨intern()å ç”¨å†…å­˜ç©ºé—´å¯¼è‡´GCçš„æ—¶é—´æ˜¯è¦è¿œè¿œå¤§äºè¿™ç‚¹æ—¶é—´çš„ã€‚ æ·±å…¥ç†è§£intern()æ–¹æ³•JDK1.7åï¼Œå¸¸é‡æ± è¢«æ”¾å…¥åˆ°å †ç©ºé—´ä¸­ï¼Œè¿™å¯¼è‡´intern()å‡½æ•°çš„åŠŸèƒ½ä¸åŒã€‚è¿™ç‚¹å¾ˆé‡è¦ã€‚ çœ‹çœ‹ä¸‹é¢ä»£ç ï¼Œè¿™ä¸ªä¾‹å­æ˜¯ç½‘ä¸Šæµä¼ è¾ƒå¹¿çš„ä¸€ä¸ªä¾‹å­ï¼Œæˆ‘ä¹Ÿæ˜¯ç…§æŠ„è¿‡æ¥çš„ã€‚ 123456789String s = new String(\"1\"); s.intern(); String s2 = \"1\"; System.out.println(s == s2); String s3 = new String(\"1\") + new String(\"1\"); s3.intern(); String s4 = \"11\"; System.out.println(s3 == s4); è¾“å‡ºç»“æœä¸ºï¼š 12JDK1.6ä»¥åŠä»¥ä¸‹ï¼šfalse false JDK1.7ä»¥åŠä»¥ä¸Šï¼šfalse true å†åˆ†åˆ«è°ƒæ•´ä¸Šé¢ä»£ç 2ã€3è¡Œï¼Œ7ã€8è¡Œçš„é¡ºåºï¼š 123456789String s = new String(\"1\"); String s2 = \"1\"; s.intern(); System.out.println(s == s2); String s3 = new String(\"1\") + new String(\"1\"); String s4 = \"11\"; s3.intern(); System.out.println(s3 == s4); è¾“å‡ºç»“æœä¸ºï¼š 12JDK1.6ä»¥åŠä»¥ä¸‹ï¼šfalse false JDK1.7ä»¥åŠä»¥ä¸Šï¼šfalse false JDK1.6 åœ¨JDK1.6ä¸­æ‰€æœ‰çš„è¾“å‡ºç»“æœéƒ½æ˜¯ falseï¼Œå› ä¸ºJDK1.6ä»¥åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼Œå¸¸é‡æ± æ˜¯æ”¾åœ¨ Perm åŒºï¼ˆå±äºæ–¹æ³•åŒºï¼‰ä¸­çš„ï¼ŒPermåŒºæ˜¯å’Œå †åŒºå®Œå…¨åˆ†å¼€çš„ã€‚ ä½¿ç”¨å¼•å·å£°æ˜çš„å­—ç¬¦ä¸²éƒ½æ˜¯ä¼šç›´æ¥åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆçš„ï¼Œè€Œnew å‡ºæ¥çš„Stringå¯¹è±¡æ˜¯æ”¾åœ¨å †ç©ºé—´ä¸­çš„ã€‚æ‰€ä»¥ä¸¤è€…çš„å†…å­˜åœ°å€è‚¯å®šæ˜¯ä¸ç›¸åŒçš„ï¼Œå³ä½¿è°ƒç”¨äº†intern()æ–¹æ³•ä¹Ÿæ˜¯ä¸å½±å“çš„ã€‚ intern()æ–¹æ³•åœ¨JDK1.6ä¸­çš„ä½œç”¨æ˜¯ï¼šæ¯”å¦‚String s = new String(â€œrainbowhorseâ€)ï¼Œå†è°ƒç”¨s.intern()ï¼Œæ­¤æ—¶è¿”å›å€¼è¿˜æ˜¯å­—ç¬¦ä¸²â€rainbowhorseâ€ï¼Œè¡¨é¢ä¸Šçœ‹èµ·æ¥å¥½åƒè¿™ä¸ªæ–¹æ³•æ²¡ä»€ä¹ˆç”¨å¤„ã€‚ä½†å®é™…ä¸Šï¼Œåœ¨JDK1.6ä¸­å®ƒåšäº†ä¸ªå°åŠ¨ä½œï¼šæ£€æŸ¥å­—ç¬¦ä¸²æ± é‡Œæ˜¯å¦å­˜åœ¨â€rainbowhorseâ€è¿™ä¹ˆä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¦‚æœå­˜åœ¨ï¼Œå°±è¿”å›æ± é‡Œçš„å­—ç¬¦ä¸²ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œè¯¥æ–¹æ³•æŠŠâ€rainbowhorseâ€æ·»åŠ åˆ°å­—ç¬¦ä¸²æ± ä¸­ï¼Œç„¶åå†è¿”å›å®ƒçš„å¼•ç”¨ã€‚ JDK1.7ä¾‹ä¸€åˆ†æ123456789String s = new String(\"1\"); s.intern(); String s2 = \"1\"; System.out.println(s == s2); String s3 = new String(\"1\") + new String(\"1\"); s3.intern(); String s4 = \"11\"; System.out.println(s3 == s4); String s = newString(â€œ1â€)ï¼Œç”Ÿæˆäº†å¸¸é‡æ± ä¸­çš„â€œ1â€ å’Œå †ç©ºé—´ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚ s.intern()ï¼Œè¿™ä¸€è¡Œçš„ä½œç”¨æ˜¯så¯¹è±¡å»å¸¸é‡æ± ä¸­å¯»æ‰¾åå‘ç°â€1â€å·²ç»å­˜åœ¨äºå¸¸é‡æ± ä¸­äº†ã€‚ String s2 = â€œ1â€ï¼Œè¿™è¡Œä»£ç æ˜¯ç”Ÿæˆä¸€ä¸ªs2çš„å¼•ç”¨æŒ‡å‘å¸¸é‡æ± ä¸­çš„â€œ1â€å¯¹è±¡ã€‚ ç»“æœå°±æ˜¯ s å’Œ s2 çš„å¼•ç”¨åœ°å€æ˜æ˜¾ä¸åŒã€‚å› æ­¤è¿”å›äº†falseã€‚ String s3 = new String(â€œ1â€) + newString(â€œ1â€)ï¼Œè¿™è¡Œä»£ç åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆâ€œ1â€ ï¼Œå¹¶åœ¨å †ç©ºé—´ä¸­ç”Ÿæˆs3å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ˆå†…å®¹ä¸ºâ€11â€ï¼‰ã€‚æ³¨æ„æ­¤æ—¶å¸¸é‡æ± ä¸­æ˜¯æ²¡æœ‰ â€œ11â€å¯¹è±¡çš„ã€‚ s3.intern()ï¼Œè¿™ä¸€è¡Œä»£ç ï¼Œæ˜¯å°† s3ä¸­çš„â€œ11â€å­—ç¬¦ä¸²æ”¾å…¥ String å¸¸é‡æ± ä¸­ï¼Œæ­¤æ—¶å¸¸é‡æ± ä¸­ä¸å­˜åœ¨â€œ11â€å­—ç¬¦ä¸²ï¼ŒJDK1.6çš„åšæ³•æ˜¯ç›´æ¥åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆä¸€ä¸ª â€œ11â€ çš„å¯¹è±¡ã€‚ ä½†æ˜¯åœ¨JDK1.7ä¸­ï¼Œå¸¸é‡æ± ä¸­ä¸éœ€è¦å†å­˜å‚¨ä¸€ä»½å¯¹è±¡äº†ï¼Œå¯ä»¥ç›´æ¥å­˜å‚¨å †ä¸­çš„å¼•ç”¨ã€‚è¿™ä»½å¼•ç”¨ç›´æ¥æŒ‡å‘ s3 å¼•ç”¨çš„å¯¹è±¡ï¼Œä¹Ÿå°±æ˜¯è¯´s3.intern() ==s3ä¼šè¿”å›trueã€‚ String s4 = â€œ11â€ï¼Œ è¿™ä¸€è¡Œä»£ç ä¼šç›´æ¥å»å¸¸é‡æ± ä¸­åˆ›å»ºï¼Œä½†æ˜¯å‘ç°å·²ç»æœ‰è¿™ä¸ªå¯¹è±¡äº†ï¼Œæ­¤æ—¶ä¹Ÿå°±æ˜¯æŒ‡å‘ s3 å¼•ç”¨å¯¹è±¡çš„ä¸€ä¸ªå¼•ç”¨ã€‚å› æ­¤s3 == s4è¿”å›äº†trueã€‚ ä¾‹äºŒåˆ†æ123456789String s = new String(\"1\"); String s2 = \"1\"; s.intern(); System.out.println(s == s2); String s3 = new String(\"1\") + new String(\"1\"); String s4 = \"11\"; s3.intern(); System.out.println(s3 == s4); String s = newString(â€œ1â€)ï¼Œç”Ÿæˆäº†å¸¸é‡æ± ä¸­çš„â€œ1â€ å’Œå †ç©ºé—´ä¸­çš„å­—ç¬¦ä¸²å¯¹è±¡ã€‚ String s2 = â€œ1â€ï¼Œè¿™è¡Œä»£ç æ˜¯ç”Ÿæˆä¸€ä¸ªs2çš„å¼•ç”¨æŒ‡å‘å¸¸é‡æ± ä¸­çš„â€œ1â€å¯¹è±¡ï¼Œä½†æ˜¯å‘ç°å·²ç»å­˜åœ¨äº†ï¼Œé‚£ä¹ˆå°±ç›´æ¥æŒ‡å‘äº†å®ƒã€‚ s.intern()ï¼Œè¿™ä¸€è¡Œåœ¨è¿™é‡Œå°±æ²¡ä»€ä¹ˆå®é™…ä½œç”¨äº†ã€‚å› ä¸ºâ€1â€å·²ç»å­˜åœ¨äº†ã€‚ ç»“æœå°±æ˜¯ s å’Œ s2 çš„å¼•ç”¨åœ°å€æ˜æ˜¾ä¸åŒã€‚å› æ­¤è¿”å›äº†falseã€‚ String s3 = new String(â€œ1â€) + newString(â€œ1â€)ï¼Œè¿™è¡Œä»£ç åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ç”Ÿæˆâ€œ1â€ ï¼Œå¹¶åœ¨å †ç©ºé—´ä¸­ç”Ÿæˆs3å¼•ç”¨æŒ‡å‘çš„å¯¹è±¡ï¼ˆå†…å®¹ä¸ºâ€11â€ï¼‰ã€‚æ³¨æ„æ­¤æ—¶å¸¸é‡æ± ä¸­æ˜¯æ²¡æœ‰ â€œ11â€å¯¹è±¡çš„ã€‚ String s4 = â€œ11â€ï¼Œ è¿™ä¸€è¡Œä»£ç ä¼šç›´æ¥å»ç”Ÿæˆå¸¸é‡æ± ä¸­çš„â€11â€ã€‚ s3.intern()ï¼Œè¿™ä¸€è¡Œåœ¨è¿™é‡Œå°±æ²¡ä»€ä¹ˆå®é™…ä½œç”¨äº†ã€‚å› ä¸ºâ€11â€å·²ç»å­˜åœ¨äº†ã€‚ ç»“æœå°±æ˜¯ s3 å’Œ s4 çš„å¼•ç”¨åœ°å€æ˜æ˜¾ä¸åŒã€‚å› æ­¤è¿”å›äº†falseã€‚ æ€»ç»“ä»JDK 1.7åï¼ŒHotSpot å°†å¸¸é‡æ± ä»æ°¸ä¹…ä»£ç§»åˆ°äº†å…ƒç©ºé—´ï¼Œæ­£å› ä¸ºå¦‚æ­¤ï¼ŒJDK 1.7 åçš„internæ–¹æ³•åœ¨å®ç°ä¸Šå‘ç”Ÿäº†æ¯”è¾ƒå¤§çš„æ”¹å˜ï¼ŒJDK 1.7åï¼Œinternæ–¹æ³•è¿˜æ˜¯ä¼šå…ˆå»æŸ¥è¯¢å¸¸é‡æ± ä¸­æ˜¯å¦æœ‰å·²ç»å­˜åœ¨ï¼Œå¦‚æœå­˜åœ¨ï¼Œåˆ™è¿”å›å¸¸é‡æ± ä¸­çš„å¼•ç”¨ï¼Œè¿™ä¸€ç‚¹ä¸ä¹‹å‰æ²¡æœ‰åŒºåˆ«ï¼ŒåŒºåˆ«åœ¨äºï¼Œå¦‚æœåœ¨å¸¸é‡æ± æ‰¾ä¸åˆ°å¯¹åº”çš„å­—ç¬¦ä¸²ï¼Œåˆ™ä¸ä¼šå†å°†å­—ç¬¦ä¸²æ‹·è´åˆ°å¸¸é‡æ± ï¼Œè€Œåªæ˜¯åœ¨å¸¸é‡æ± ä¸­ç”Ÿæˆä¸€ä¸ªå¯¹åŸå­—ç¬¦ä¸²çš„å¼•ç”¨ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"}]},{"title":"JVMå…¥é—¨","slug":"JVMå…¥é—¨","date":"2017-11-20T07:27:10.000Z","updated":"2018-03-13T05:50:16.365Z","comments":true,"path":"2017/11/20/JVMå…¥é—¨/","link":"","permalink":"https://sunny0715.github.io/2017/11/20/JVMå…¥é—¨/","excerpt":"å¼•è¨€JVMï¼ˆJava Virtual Machineï¼‰Java è™šæ‹Ÿæœºæ˜¯æ•´ä¸ª Java å¹³å°çš„åŸºçŸ³ï¼Œæ˜¯ Java ç³»ç»Ÿå®ç°ç¡¬ä»¶æ— å…³ä¸æ“ä½œç³»ç»Ÿæ— å…³çš„å…³é”®éƒ¨åˆ†ï¼Œæ˜¯ä¿éšœç”¨æˆ·æœºå™¨å…äºæ¶æ„ä»£ç æŸå®³çš„å±éšœã€‚Javaå¼€å‘äººå‘˜ä¸éœ€è¦äº†è§£JVMæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½†æ˜¯ï¼Œäº†è§£ JVM æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½çš„å¼€å‘java ç¨‹åºã€‚è¿‘äº›å¤©ä¸€ç›´åœ¨çœ‹å‘¨å¿—æ˜çš„ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¿™æœ¬ä¹¦ï¼Œè¿™æœ¬ä¹¦å†™çš„å ªç§°ç»å…¸ï¼Œå¯¹äºJVMçš„å­¦ä¹ éå¸¸æœ‰å¸®åŠ©ã€‚","text":"å¼•è¨€JVMï¼ˆJava Virtual Machineï¼‰Java è™šæ‹Ÿæœºæ˜¯æ•´ä¸ª Java å¹³å°çš„åŸºçŸ³ï¼Œæ˜¯ Java ç³»ç»Ÿå®ç°ç¡¬ä»¶æ— å…³ä¸æ“ä½œç³»ç»Ÿæ— å…³çš„å…³é”®éƒ¨åˆ†ï¼Œæ˜¯ä¿éšœç”¨æˆ·æœºå™¨å…äºæ¶æ„ä»£ç æŸå®³çš„å±éšœã€‚Javaå¼€å‘äººå‘˜ä¸éœ€è¦äº†è§£JVMæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œä½†æ˜¯ï¼Œäº†è§£ JVM æœ‰åŠ©äºæˆ‘ä»¬æ›´å¥½çš„å¼€å‘java ç¨‹åºã€‚è¿‘äº›å¤©ä¸€ç›´åœ¨çœ‹å‘¨å¿—æ˜çš„ã€Šæ·±å…¥ç†è§£Javaè™šæ‹Ÿæœºã€‹è¿™æœ¬ä¹¦ï¼Œè¿™æœ¬ä¹¦å†™çš„å ªç§°ç»å…¸ï¼Œå¯¹äºJVMçš„å­¦ä¹ éå¸¸æœ‰å¸®åŠ©ã€‚ è¿è¡Œæ—¶æ•°æ®åŒºåŸŸJVMå°†å†…å­˜ä¸»è¦åˆ’åˆ†ä¸ºï¼šæ–¹æ³•åŒºã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆã€å †ã€ç¨‹åºè®¡æ•°å™¨ã€‚JVMè¿è¡Œæ—¶æ•°æ®åŒºå¦‚ä¸‹ï¼š ç¨‹åºè®¡æ•°å™¨(çº¿ç¨‹ç§æœ‰)ç¨‹åºè®¡æ•°å™¨æ˜¯ä¸€å—è¾ƒå°çš„å†…å­˜ç©ºé—´ï¼Œå®ƒå¯ä»¥çœ‹ä½œæ˜¯å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨ã€‚åœ¨è™šæ‹Ÿæœºçš„æ¦‚å¿µæ¨¡å‹é‡Œï¼Œå­—èŠ‚ç è§£é‡Šå™¨å·¥ä½œæ—¶å°±æ˜¯é€šè¿‡æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼æ¥é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œåˆ†æ”¯ã€å¾ªç¯ã€è·³è½¬ã€å¼‚å¸¸å¤„ç†ã€çº¿ç¨‹æ¢å¤ç­‰åŸºç¡€åŠŸèƒ½éƒ½éœ€è¦ä¾èµ–è¿™ä¸ªè®¡æ•°å™¨æ¥å®Œæˆã€‚ ç”±äºJavaè™šæ‹Ÿæœºçš„è™šæ‹Ÿæœºçš„å¤šçº¿ç¨‹æ˜¯é€šè¿‡çº¿ç¨‹è½®æµåˆ‡æ¢å¹¶åˆ†é…å¤„ç†å™¨æ‰§è¡Œæ—¶é—´çš„æ–¹å¼æ¥å®ç°çš„ï¼Œä¸€ä¸ªå¤„ç†å™¨éƒ½åªä¼šæ‰§è¡Œä¸€æ¡çº¿ç¨‹ä¸­çš„æŒ‡ä»¤ã€‚å› æ­¤ï¼Œä¸ºäº†çº¿ç¨‹åˆ‡æ¢åèƒ½æ¢å¤åˆ°æ­£ç¡®çš„æ‰§è¡Œä½ç½®ï¼Œæ¯æ¡çº¿ç¨‹éƒ½éœ€è¦æœ‰ä¸€ä¸ªç‹¬ç«‹çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå„æ¡çº¿ç¨‹ä¹‹é—´è®¡æ•°å™¨äº’ä¸å½±å“ï¼Œç‹¬ç«‹å­˜å‚¨ï¼Œæ‰€ä»¥ç¨‹åºè®¡æ•°å™¨æ˜¯ç§æœ‰ç©ºé—´ã€‚ æ­¤å†…å­˜åŒºåŸŸæ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­æ²¡æœ‰è§„å®šä»»ä½•OutOfMemoryErroræƒ…å†µçš„åŒºåŸŸã€‚ Javaè™šæ‹Ÿæœºæ ˆ(çº¿ç¨‹ç§æœ‰)ç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚â€œæ ˆâ€å°±æ˜¯è™šæ‹Ÿæœºæ ˆï¼Œæˆ–è€…è¯´æ˜¯è™šæ‹Ÿæœºæ ˆä¸­å±€éƒ¨å˜é‡è¡¨éƒ¨åˆ†ã€‚ å±€éƒ¨å˜é‡è¡¨å­˜æ”¾äº†ç¼–è¯‘æœŸå¯çŸ¥çš„åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆbooleanã€byteã€charã€shortã€intã€floatã€longã€doubleï¼‰ã€å¯¹è±¡å¼•ç”¨ï¼ˆreferenceç±»å‹ï¼Œå®ƒä¸ç­‰åŒäºå¯¹è±¡æœ¬èº«ï¼Œå¯èƒ½æ˜¯ä¸€ä¸ªæŒ‡å‘å¯¹è±¡èµ·å§‹åœ°å€çš„å¼•ç”¨æŒ‡é’ˆï¼Œä¹Ÿå¯èƒ½æ˜¯æŒ‡å‘ä¸€ä¸ªä»£è¡¨å¯¹è±¡çš„å¥æŸ„æˆ–å…¶ä»–ä¸æ­¤å¯¹è±¡ç›¸å…³çš„ä½ç½®ï¼‰å’ŒreturnAddressï¼ˆæŒ‡å‘äº†ä¸€æ¡å­—èŠ‚ç æŒ‡ä»¤çš„åœ°å€ï¼‰ã€‚å…¶ä¸­64ä½é•¿åº¦çš„longå’Œdoubleç±»å‹çš„æ•°æ®ä¼šå ç”¨2ä¸ªå±€éƒ¨å˜é‡ç©ºé—´ï¼ˆSlotï¼‰ï¼Œå…¶ä½™çš„æ•°æ®ç±»å‹åªå ç”¨ä¸€ä¸ªã€‚ è¿™ä¸ªåŒºåŸŸå¯èƒ½å‡ºç°çš„ä¸¤ç§å¼‚å¸¸ï¼š ä¸€ç§æ˜¯StackOverflowErrorï¼Œå½“å‰çº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æ·±åº¦æ—¶ï¼Œä¼šæŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ã€‚åˆ¶é€ è¿™ç§å¼‚å¸¸å¾ˆç®€å•ï¼šå°†ä¸€ä¸ªå‡½æ•°åå¤é€’å½’è‡ªå·±ï¼Œæœ€ç»ˆä¼šå‡ºç°æ ˆæº¢å‡ºé”™è¯¯ï¼ˆStackOverflowErrorï¼‰ã€‚ å¦ä¸€ç§å¼‚å¸¸æ˜¯OutOfMemoryErrorå¼‚å¸¸ï¼Œå½“è™šæ‹Ÿæœºæ ˆå¯ä»¥åŠ¨æ€æ‰©å±•æ—¶ï¼ˆå½“å‰å¤§éƒ¨åˆ†è™šæ‹Ÿæœºéƒ½å¯ä»¥ï¼‰ï¼Œå¦‚æœæ— æ³•ç”³è¯·è¶³å¤Ÿå¤šçš„å†…å­˜å°±ä¼šæŠ›å‡ºOutOfMemoryErrorï¼Œ æœ¬åœ°æ–¹æ³•æ ˆæœ¬åœ°æ–¹æ³•æ ˆä¸è™šæ‹Ÿæœºæ‰€å‘æŒ¥çš„ä½œç”¨å¾ˆç›¸ä¼¼ï¼Œä»–ä»¬çš„åŒºåˆ«åœ¨äºè™šæ‹Ÿæœºæ ˆä¸ºæ‰§è¡ŒJavaä»£ç æ–¹æ³•æœåŠ¡ï¼Œè€Œæœ¬åœ°æ–¹æ³•æ ˆæ˜¯ä¸ºNativeæ–¹æ³•æœåŠ¡ã€‚ä¸è™šæ‹Ÿæœºæ ˆä¸€æ ·ï¼Œæœ¬åœ°æ–¹æ³•æ ˆä¹Ÿä¼šæŠ›å‡ºStackOverflowErrorå’ŒOutOfMemoryErrorå¼‚å¸¸ã€‚ Javaå †(çº¿ç¨‹å…±äº«åŒºåŸŸ)Javaå †æ˜¯Javaè™šæ‹Ÿæœºæ‰€ç®¡ç†å†…å­˜ä¸­æœ€å¤§çš„ä¸€å—ã€‚Javaå †æ˜¯è¢«æ‰€æœ‰çº¿ç¨‹å…±äº«çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºã€‚æ­¤åŒºåŸŸå†…å­˜çš„å”¯ä¸€ç›®çš„å°±æ˜¯å­˜æ”¾å¯¹è±¡å®ä¾‹ï¼Œå‡ ä¹æ‰€æœ‰çš„å¯¹è±¡å®ä¾‹éƒ½åœ¨è¿™é‡Œåˆ†é…å†…å­˜ã€‚åœ¨Javaè™šæ‹Ÿæœºè§„èŒƒä¸­çš„æè¿°å°±æ˜¯ï¼šæ‰€æœ‰å¯¹è±¡å®ä¾‹åŠæ•°ç»„éƒ½è¦åœ¨å †ä¸Šåˆ†é…ã€‚éšç€JITç¼–è¯‘å™¨çš„å‘å±•ï¼Œæ‰€æœ‰å¯¹è±¡åœ¨å †ä¸Šåˆ†é…æ¸æ¸å˜å¾—ä¸é‚£ä¹ˆâ€œç»å¯¹â€äº†ã€‚ Javaå †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸã€‚ç”±äºç°åœ¨çš„æ”¶é›†å™¨åŸºæœ¬ä¸Šé‡‡ç”¨çš„éƒ½æ˜¯åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œæ‰€æœ‰Javaå †å¯ä»¥ç»†åˆ†ä¸ºï¼šæ–°ç”Ÿä»£å’Œè€å¹´ä»£ã€‚åœ¨ç»†è‡´åˆ†å°±æ˜¯æŠŠæ–°ç”Ÿä»£åˆ†ä¸ºï¼šEdenç©ºé—´ã€From Survivorç©ºé—´ã€To Survivorç©ºé—´ã€‚ Javaå †å¯ä»¥å¤„äºç‰©ç†ä¸Šä¸è¿ç»­çš„å†…å­˜ç©ºé—´ä¸­ï¼Œåªè¦é€»è¾‘ä¸Šæ˜¯è¿ç»­çš„å³å¯ï¼Œå°±åƒç£ç›˜ç©ºé—´ä¸€æ ·ã€‚ å½“å †æ— æ³•å†æ‰©å±•æ—¶ï¼Œä¼šæŠ›å‡ºOutOfMemoryErrorå¼‚å¸¸ã€‚ æ–¹æ³•åŒº(çº¿ç¨‹å…±äº«åŒºåŸŸ)æ–¹æ³•åŒºå­˜æ”¾çš„æ˜¯ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç­‰æ•°æ®ã€‚æ–¹æ³•åŒºæ˜¯å„ä¸ªçº¿ç¨‹å…±äº«åŒºåŸŸï¼Œæˆ‘ä»¬åœ¨å†™Javaä»£ç æ—¶ï¼Œæ¯ä¸ªçº¿ç¨‹åº¦å¯ä»¥è®¿é—®åŒä¸€ä¸ªç±»çš„é™æ€å˜é‡å¯¹è±¡ã€‚ç”±äºä½¿ç”¨åå°„æœºåˆ¶çš„åŸå› ï¼Œè™šæ‹Ÿæœºå¾ˆéš¾æ¨æµ‹é‚£ä¸ªç±»ä¿¡æ¯ä¸å†ä½¿ç”¨ï¼Œå› æ­¤è¿™å—åŒºåŸŸçš„å›æ”¶å¾ˆéš¾ã€‚ 1è¿è¡Œæ—¶å¸¸é‡æ± æ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ã€‚Classæ–‡ä»¶ä¸­é™¤äº†æœ‰ç±»çš„ç‰ˆæœ¬ã€å­—æ®µã€æ–¹æ³•ã€æ¥å£ç­‰æè¿°ä¿¡æ¯å¤–ï¼Œè¿˜æœ‰ä¸€é¡¹ä¿¡æ¯æ˜¯å¸¸é‡æ± ï¼Œç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨ï¼Œè¿™éƒ¨åˆ†å†…å®¹å°†åœ¨ç±»åŠ è½½åè¿›å…¥æ–¹æ³•åŒºçš„è¿è¡Œæ—¶å¸¸é‡æ± ä¸­å­˜æ”¾ã€‚ å¦å¤–ï¼Œå¯¹è¿™å—åŒºåŸŸä¸»è¦æ˜¯é’ˆå¯¹å¸¸é‡æ± å›æ”¶ï¼Œå€¼å¾—æ³¨æ„çš„æ˜¯JDK1.7å·²ç»æŠŠå¸¸é‡æ± è½¬ç§»åˆ°å †é‡Œé¢äº†ã€‚åŒæ ·ï¼Œå½“æ–¹æ³•åŒºæ— æ³•æ»¡è¶³å†…å­˜åˆ†é…éœ€æ±‚æ—¶ï¼Œä¼šæŠ›å‡ºOutOfMemoryErrorã€‚ GCç®—æ³•Javaä¸C++ä¹‹é—´æœ‰ä¸€å µç”±å†…å­˜åŠ¨æ€åˆ†é…å’Œåƒåœ¾æ”¶é›†æŠ€æœ¯æ‰€å›´æˆçš„â€œé«˜å¢™â€ï¼Œå¢™å¤–é¢çš„äººæƒ³è¿›å»ï¼Œå¢™é‡Œé¢çš„äººå´æƒ³å‡ºæ¥ã€‚ æ ‡è®°-æ¸…é™¤ç®—æ³•(Mark-Sweep)æœ€åŸºç¡€çš„æ”¶é›†ç®—æ³•æ˜¯â€œæ ‡è®°-æ¸…é™¤â€ï¼ˆMark-Sweepï¼‰ç®—æ³•ï¼Œå¦‚åŒå®ƒçš„åå­—ä¸€æ ·ï¼Œç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€ä¸¤ä¸ªé˜¶æ®µï¼šé¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚ å®ƒçš„ä¸è¶³ä¸»è¦æœ‰ä¸¤ä¸ªï¼š æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜ï¼› ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ä»¥ååœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶ï¼Œæ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚ å¤åˆ¶ç®—æ³•(Copy)ä¸ºäº†è§£å†³æ•ˆç‡é—®é¢˜ï¼Œå¤åˆ¶ç®—æ³•æ˜¯å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­ä¸€å—ã€‚å½“è¿™å—å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å†…å­˜ä¸Šé¢ã€‚ç„¶åå†æŠŠå·²ç»ä½¿ç”¨è¿‡çš„å†…å­˜ä¸€æ¬¡æ¸…ç†æ‰ã€‚è¿™ä½¿å¾—æ¯æ¬¡åªå¯¹åŠä¸ªåŒºåŸŸè¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡æƒ…å†µã€‚ ä½†æ˜¯ï¼Œè¿™ä»£ä»·å®åœ¨æ˜¯è®©äººæ— æ³•æ¥å—ï¼Œéœ€è¦ç‰ºç‰²ä¸€èˆ¬çš„å†…å­˜ç©ºé—´ã€‚ ç ”ç©¶å‘ç°ï¼Œå¤§éƒ¨åˆ†å¯¹è±¡(70%~95%)éƒ½æ˜¯â€œæœç”Ÿå¤•æ­»â€ï¼Œæ‰€ä»¥ä¸éœ€è¦å®‰è£…1:1æ¯”ä¾‹åˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„Edenç©ºé—´å’Œä¸¤å—è¾ƒå°çš„Survivorç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨Edenç©ºé—´å’Œä¸€å—Survivorç©ºé—´ï¼Œé»˜è®¤æ¯”ä¾‹ä¸ºEdenï¼šSurvivor=8:1ã€‚æ–°ç”Ÿä»£åŒºåŸŸå°±æ˜¯è¿™ä¹ˆåˆ’åˆ†ï¼Œæ¯æ¬¡å®ä¾‹åœ¨Edenå’Œä¸€å—Survivorä¸­åˆ†é…ï¼Œå›æ”¶æ—¶ï¼Œå°†å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å‰©ä¸‹çš„å¦ä¸€å—Survivorã€‚è¿™æ ·åªæœ‰10%çš„å†…å­˜ä¼šè¢«æµªè´¹ï¼Œä½†æ˜¯å¸¦æ¥çš„æ•ˆç‡å´å¾ˆé«˜ã€‚ å½“å‰©ä¸‹çš„Survivorå†…å­˜ä¸è¶³æ—¶ï¼Œå¯ä»¥å»è€å¹´ä»£å†…å­˜è¿›è¡Œåˆ†é…æ‹…ä¿ã€‚å¦‚ä½•ç†è§£åˆ†é…æ‹…ä¿å‘¢ï¼Œå…¶å®å°±æ˜¯ï¼Œå†…å­˜ä¸è¶³æ—¶ï¼Œå»è€å¹´ä»£å†…å­˜ç©ºé—´åˆ†é…ï¼Œç„¶åç­‰æ–°ç”Ÿä»£å†…å­˜ç¼“è¿‡æ¥äº†ä¹‹åï¼ŒæŠŠå†…å­˜å½’è¿˜ç»™è€å¹´ä»£ï¼Œä¿æŒæ–°ç”Ÿä»£ä¸­çš„Edenï¼šSurvivor=8:1.å¦å¤–ï¼Œä¸¤ä¸ªSurvivoråˆ†åˆ«æœ‰è‡ªå·±çš„åç§°ï¼šFrom Survivorã€To Survivorã€‚äºŒè€…èº«ä»½ç»å¸¸è°ƒæ¢ï¼Œå³æœ‰æ—¶è¿™å—å†…å­˜ä¸Edenä¸€èµ·å‚ä¸åˆ†é…ï¼Œæœ‰æ—¶æ˜¯å¦ä¸€å—ã€‚å› ä¸ºä»–ä»¬ä¹‹é—´ç»å¸¸ç›¸äº’å¤åˆ¶ã€‚ æ ‡è®°æ•´ç†(Mark-Compact)å¤åˆ¶æ”¶é›†ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶å°±è¦è¿›è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šé™ä½ã€‚æ›´å…³é”®çš„æ˜¯ï¼Œå¦‚æœä¸æƒ³æµªè´¹50%çš„ç©ºé—´ï¼Œå°±éœ€è¦æœ‰é¢å¤–æ‰“çš„ç©ºé—´è¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œä»¥åº”å¯¹è¢«ä½¿ç”¨çš„å†…å­˜ä¸­æ‰€æœ‰å¯¹è±¡éƒ½100%å­˜æ´»çš„æç«¯æƒ…å†µï¼Œæ‰€ä»¥åœ¨è€å¹´ä»£ä¸€èˆ¬ä¸èƒ½ç›´æ¥é€‰ç”¨è¿™ç§ç®—æ³•ã€‚ æ ‡è®°æ•´ç†ç®—æ³•å¾ˆç®€å•ï¼Œå°±æ˜¯å…ˆæ ‡è®°éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åæŠŠæ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ç§»åŠ¨åˆ°å†…å­˜çš„ä¸€ç«¯ï¼Œæœ€åç›´æ¥æ¸…ç†æ‰è¾¹ç•Œæ„å¤–çš„å†…å­˜ã€‚è¿™æ ·çš„å¥½å¤„æ˜¯é¿å…äº†å†…å­˜ç¢ç‰‡ã€‚ åˆ†ä»£æ”¶é›†ç®—æ³•å½“å‰å•†ä¸šè™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨â€œåˆ†ä»£æ”¶é›†â€ç®—æ³•ï¼Œè¿™ç§ç®—æ³•åªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ã€‚ä¸€èˆ¬æ˜¯æŠŠJavaå †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚ åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†æ—¶éƒ½å‘ç°æœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼ˆ70%-95%ï¼‰ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œé‚£å°±é‡‡ç”¨å¤åˆ¶ç®—æ³•ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å­˜æ´»å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ”¶é›†ã€‚è€Œè€å¹´ä»£ä¸­å› ä¸ºå¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œæ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå°±å¿…é¡»ä½¿ç”¨â€œæ ‡è®°-æ¸…é™¤â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•æ¥è¿›è¡Œå›æ”¶ã€‚ HotSpotç®—æ³•å®ç°æšä¸¾æ ¹èŠ‚ç‚¹å¯è¾¾æ€§åˆ†æåˆ¤æ–­jvmå¯¹è±¡æ˜¯å¦å­˜æ´»ã€‚GCRootsçš„å¯¹è±¡åšä¸ºèµ·ç‚¹ï¼Œä»èµ·ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢èµ°è¿‡è·¯å¾„å«å¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ°GCRootsæ²¡æœ‰å¼•ç”¨é“¾æ—¶ï¼Œåˆ¤æ–­å¯¹è±¡æ­»äº¡ã€‚åœ¨jvmä¸­ï¼Œåšä¸ºGCRootsçš„å¯¹è±¡ï¼š è™šæ‹Ÿæœºæ ˆ(æ ˆæ¡¢ä¸­çš„æœ¬åœ°å˜é‡è¡¨)ä¸­çš„å¼•ç”¨çš„å¯¹è±¡; æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡; æ–¹æ³•åŒºä¸­çš„å¸¸é‡å¼•ç”¨çš„å¯¹è±¡; æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIçš„å¼•ç”¨çš„å¯¹è±¡ ã€‚ ä»å¯è¾¾æ€§åˆ†æä¸­ä»GC RootsèŠ‚ç‚¹æ‰¾å¼•ç”¨é“¾è¿™ä¸ªæ“ä½œä¸ºä¾‹ï¼Œå¯åšä¸ºGC Rootsçš„èŠ‚ç‚¹ä¸»è¦åœ¨å…¨å±€æ€§çš„å¼•ç”¨ï¼ˆç±»å¦‚å¸¸é‡æˆ–ç±»é™æ€å˜é‡ï¼‰ä¸æ‰§è¡Œä¸Šä¸‹æ–‡ï¼ˆç±»å¦‚æ ˆæ¡¢çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­ï¼Œç°åœ¨å¾ˆå¤šåº”ç”¨ä»…ä»…æ–¹æ³•åŒºå°±æœ‰æ•°ç™¾å…†ï¼Œå¦‚æœè¦é€ä¸ªæ£€æŸ¥è¿™é‡Œé¢çš„åº”ç”¨ï¼Œé‚£ä¹ˆå¿…ç„¶ä¼šé€é¥å¾ˆå¤šçš„æ—¶é—´ã€‚ å¯è¾¾æ€§åˆ†æå¯¹æ‰§è¡Œæ—¶é—´çš„æ•æ„Ÿè¿˜ä½“ç°åœ¨GCåœé¡¿ä¸Šï¼Œå› ä¸ºåˆ†æå·¥ä½œå¿…é¡»è¦å†ä¸€ä¸ªèƒ½ç¡®ä¿ä¸€è‡´æ€§çš„å¿«ç…§ä¸­è¿›è¡Œè¿™æ˜¯å¯¼è‡´GCè¿›è¡Œæ—¶å¿…é¡»åœé¡¿æ‰€æœ‰Javaçº¿ç¨‹ï¼ˆSTWï¼‰çš„å…¶ä¸­ä¸€ä¸ªé‡è¦åŸå› ï¼Œå³ä½¿åœ¨å·ç§°ï¼ˆå‡ ä¹ï¼‰ä¸ä¼šå‘ç”Ÿåœé¡¿çš„CMSæ”¶é›†å™¨ä¸­ï¼Œæšä¸¾æ ¹èŠ‚ç‚¹æ—¶ä¹Ÿæ˜¯å¿…é¡»è¦åœé¡¿çš„ã€‚ åƒåœ¾æ”¶é›†å™¨å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚ Javaè™šæ‹Ÿæœºè§„èŒƒä¸­å¯¹åƒåœ¾æ”¶é›†å™¨åº”è¯¥å¦‚ä½•å®ç°å¹¶æ²¡æœ‰ä»»ä½•è§„å®šï¼Œå› æ­¤ä¸åŒçš„å‚å•†ã€ä¸åŒç‰ˆæœ¬çš„è™šæ‹Ÿæœºæ‰€æä¾›çš„åƒåœ¾æ”¶é›†å™¨éƒ½å¯èƒ½ä¼šæœ‰å¾ˆå¤§å·®åˆ«ï¼Œå¹¶ä¸”ä¸€èˆ¬éƒ½ä¼šæä¾›å‚æ•°ä¾›ç”¨æˆ·æ ¹æ®è‡ªå·±çš„åº”ç”¨ç‰¹ç‚¹å’Œè¦æ±‚ç»„åˆå‡ºå„ä¸ªå¹´ä»£æ‰€ä½¿ç”¨çš„æ”¶é›†å™¨ã€‚ å›¾ä¸­å±•ç¤ºäº†7ç§ä½œç”¨äºä¸åŒåˆ†ä»£çš„æ”¶é›†å™¨ï¼Œå¦‚æœä¸¤ä¸ªæ”¶é›†å™¨ä¹‹é—´å­˜åœ¨è¿çº¿ï¼Œå°±è¯´æ˜å®ƒä»¬å¯ä»¥æ­é…ä½¿ç”¨ã€‚è™šæ‹Ÿæœºæ‰€å¤„çš„åŒºåŸŸï¼Œåˆ™è¡¨ç¤ºå®ƒæ˜¯å±äºæ–°ç”Ÿä»£æ”¶é›†å™¨è¿˜æ˜¯è€å¹´ä»£æ”¶é›†å™¨ã€‚ æ¦‚å¿µç†è§£ å¹¶å‘å’Œå¹¶è¡Œè¿™ä¸¤ä¸ªåè¯éƒ½æ˜¯å¹¶å‘ç¼–ç¨‹ä¸­çš„æ¦‚å¿µï¼Œåœ¨è°ˆè®ºåƒåœ¾æ”¶é›†å™¨çš„ä¸Šä¸‹æ–‡è¯­å¢ƒä¸­ï¼Œå®ƒä»¬å¯ä»¥è§£é‡Šå¦‚ä¸‹ã€‚ å¹¶è¡Œï¼ˆParallelï¼‰ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ã€‚ å¹¶å‘ï¼ˆConcurrentï¼‰ï¼šæŒ‡ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œçš„ï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†ç¨‹åºè¿è¡Œäºå¦ä¸€ä¸ªCPUä¸Šã€‚ Minor GC å’Œ Full GC æ–°ç”Ÿä»£GCï¼ˆMinor GCï¼‰ï¼šæŒ‡å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼Œå› ä¸ºJavaå¯¹è±¡å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥Minor GCéå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚ è€å¹´ä»£GCï¼ˆMajor GC / Full GCï¼‰ï¼šæŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„GCï¼Œå‡ºç°äº†Major GCï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„Minor GCï¼ˆä½†éç»å¯¹çš„ï¼Œåœ¨Parallel Scavengeæ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡ŒMajor GCçš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹ï¼‰ã€‚Major GCçš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯”Minor GCæ…¢10å€ä»¥ä¸Šã€‚ ååé‡ ååé‡å°±æ˜¯CPUç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸CPUæ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼ï¼Œå³ååé‡ = è¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ /ï¼ˆè¿è¡Œç”¨æˆ·ä»£ç æ—¶é—´ + åƒåœ¾æ”¶é›†æ—¶é—´ï¼‰ã€‚è™šæ‹Ÿæœºæ€»å…±è¿è¡Œäº†100åˆ†é’Ÿï¼Œå…¶ä¸­åƒåœ¾æ”¶é›†èŠ±æ‰1åˆ†é’Ÿï¼Œé‚£ååé‡å°±æ˜¯99%ã€‚ Serialæ”¶é›†å™¨Serialæ”¶é›†å™¨æ˜¯æœ€åŸºæœ¬ã€å‘å±•å†å²æœ€æ‚ ä¹…çš„æ”¶é›†å™¨ï¼Œæ›¾ç»ï¼ˆåœ¨JDK 1.3.1ä¹‹å‰ï¼‰æ˜¯è™šæ‹Ÿæœºæ–°ç”Ÿä»£æ”¶é›†çš„å”¯ä¸€é€‰æ‹©ã€‚ ç‰¹æ€§ï¼šè¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹çš„æ”¶é›†å™¨ï¼Œä½†å®ƒçš„â€œå•çº¿ç¨‹â€çš„æ„ä¹‰å¹¶ä¸ä»…ä»…è¯´æ˜å®ƒåªä¼šä½¿ç”¨ä¸€ä¸ªCPUæˆ–ä¸€æ¡æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œæ›´é‡è¦çš„æ˜¯åœ¨å®ƒè¿›è¡Œåƒåœ¾æ”¶é›†æ—¶ï¼Œå¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚Stop The World(STW) åº”ç”¨åœºæ™¯ï¼šSerialæ”¶é›†å™¨æ˜¯è™šæ‹Ÿæœºè¿è¡Œåœ¨Clientæ¨¡å¼ä¸‹çš„é»˜è®¤æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚ ä¼˜åŠ¿ï¼šç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹æ¯”ï¼‰ï¼Œå¯¹äºé™å®šå•ä¸ªCPUçš„ç¯å¢ƒæ¥è¯´ï¼ŒSerialæ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œä¸“å¿ƒåšåƒåœ¾æ”¶é›†è‡ªç„¶å¯ä»¥è·å¾—æœ€é«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚ ParNewæ”¶é›†å™¨ ç‰¹æ€§ï¼šParNewæ”¶é›†å™¨å…¶å®å°±æ˜¯Serialæ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬ï¼Œé™¤äº†ä½¿ç”¨å¤šæ¡çº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†ä¹‹å¤–ï¼Œå…¶ä½™è¡Œä¸ºåŒ…æ‹¬Serialæ”¶é›†å™¨å¯ç”¨çš„æ‰€æœ‰æ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€Stop The Worldã€å¯¹è±¡åˆ†é…è§„åˆ™ã€å›æ”¶ç­–ç•¥ç­‰éƒ½ä¸Serialæ”¶é›†å™¨å®Œå…¨ä¸€æ ·ï¼Œåœ¨å®ç°ä¸Šï¼Œè¿™ä¸¤ç§æ”¶é›†å™¨ä¹Ÿå…±ç”¨äº†ç›¸å½“å¤šçš„ä»£ç ã€‚ åº”ç”¨åœºæ™¯ï¼šParNewæ”¶é›†å™¨æ˜¯è®¸å¤šè¿è¡Œåœ¨Serveræ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä¸­é¦–é€‰çš„æ–°ç”Ÿä»£æ”¶é›†å™¨ã€‚ å¾ˆé‡è¦çš„åŸå› æ˜¯ï¼šé™¤äº†Serialæ”¶é›†å™¨å¤–ï¼Œç›®å‰åªæœ‰å®ƒèƒ½ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œã€‚åœ¨JDK 1.5æ—¶æœŸï¼ŒHotSpotæ¨å‡ºäº†ä¸€æ¬¾åœ¨å¼ºäº¤äº’åº”ç”¨ä¸­å‡ ä¹å¯è®¤ä¸ºæœ‰åˆ’æ—¶ä»£æ„ä¹‰çš„åƒåœ¾æ”¶é›†å™¨â€”â€”CMSæ”¶é›†å™¨ï¼Œè¿™æ¬¾æ”¶é›†å™¨æ˜¯HotSpotè™šæ‹Ÿæœºä¸­ç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œã€‚ä¸å¹¸çš„æ˜¯ï¼ŒCMSä½œä¸ºè€å¹´ä»£çš„æ”¶é›†å™¨ï¼Œå´æ— æ³•ä¸JDK 1.4.0ä¸­å·²ç»å­˜åœ¨çš„æ–°ç”Ÿä»£æ”¶é›†å™¨Parallel Scavengeé…åˆå·¥ä½œï¼Œæ‰€ä»¥åœ¨JDK 1.5ä¸­ä½¿ç”¨CMSæ¥æ”¶é›†è€å¹´ä»£çš„æ—¶å€™ï¼Œæ–°ç”Ÿä»£åªèƒ½é€‰æ‹©ParNewæˆ–è€…Serialæ”¶é›†å™¨ä¸­çš„ä¸€ä¸ªã€‚ Serialæ”¶é›†å™¨ VS ParNewæ”¶é›†å™¨ï¼šParNewæ”¶é›†å™¨åœ¨å•CPUçš„ç¯å¢ƒä¸­ç»å¯¹ä¸ä¼šæœ‰æ¯”Serialæ”¶é›†å™¨æ›´å¥½çš„æ•ˆæœï¼Œç”šè‡³ç”±äºå­˜åœ¨çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè¯¥æ”¶é›†å™¨åœ¨é€šè¿‡è¶…çº¿ç¨‹æŠ€æœ¯å®ç°çš„ä¸¤ä¸ªCPUçš„ç¯å¢ƒä¸­éƒ½ä¸èƒ½ç™¾åˆ†ä¹‹ç™¾åœ°ä¿è¯å¯ä»¥è¶…è¶ŠSerialæ”¶é›†å™¨ã€‚ç„¶è€Œï¼Œéšç€å¯ä»¥ä½¿ç”¨çš„CPUçš„æ•°é‡çš„å¢åŠ ï¼Œå®ƒå¯¹äºGCæ—¶ç³»ç»Ÿèµ„æºçš„æœ‰æ•ˆåˆ©ç”¨è¿˜æ˜¯å¾ˆæœ‰å¥½å¤„çš„ã€‚ Parallel Scavengeæ”¶é›†å™¨ ç‰¹æ€§ï¼šParallel Scavengeæ”¶é›†å™¨æ˜¯ä¸€ä¸ªæ–°ç”Ÿä»£æ”¶é›†å™¨ï¼Œå®ƒä¹Ÿæ˜¯ä½¿ç”¨å¤åˆ¶ç®—æ³•çš„æ”¶é›†å™¨ï¼Œåˆæ˜¯å¹¶è¡Œçš„å¤šçº¿ç¨‹æ”¶é›†å™¨ã€‚ åº”ç”¨åœºæ™¯ï¼šåœé¡¿æ—¶é—´è¶ŠçŸ­å°±è¶Šé€‚åˆéœ€è¦ä¸ç”¨æˆ·äº¤äº’çš„ç¨‹åºï¼Œè‰¯å¥½çš„å“åº”é€Ÿåº¦èƒ½æå‡ç”¨æˆ·ä½“éªŒï¼Œè€Œé«˜ååé‡åˆ™å¯ä»¥é«˜æ•ˆç‡åœ°åˆ©ç”¨CPUæ—¶é—´ï¼Œå°½å¿«å®Œæˆç¨‹åºçš„è¿ç®—ä»»åŠ¡ï¼Œä¸»è¦é€‚åˆåœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡ã€‚ å¯¹æ¯”åˆ†æï¼š Parallel Scavengeæ”¶é›†å™¨ VS CMSç­‰æ”¶é›†å™¨ï¼šParallel Scavengeæ”¶é›†å™¨çš„ç‰¹ç‚¹æ˜¯å®ƒçš„å…³æ³¨ç‚¹ä¸å…¶ä»–æ”¶é›†å™¨ä¸åŒï¼ŒCMSç­‰æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ˜¯å°½å¯èƒ½åœ°ç¼©çŸ­åƒåœ¾æ”¶é›†æ—¶ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´ï¼Œè€ŒParallel Scavengeæ”¶é›†å™¨çš„ç›®æ ‡åˆ™æ˜¯è¾¾åˆ°ä¸€ä¸ªå¯æ§åˆ¶çš„ååé‡ï¼ˆThroughputï¼‰ã€‚ç”±äºä¸ååé‡å…³ç³»å¯†åˆ‡ï¼ŒParallel Scavengeæ”¶é›†å™¨ä¹Ÿç»å¸¸ç§°ä¸ºâ€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨ã€‚ Parallel Scavengeæ”¶é›†å™¨ VS ParNewæ”¶é›†å™¨ï¼šParallel Scavengeæ”¶é›†å™¨ä¸ParNewæ”¶é›†å™¨çš„ä¸€ä¸ªé‡è¦åŒºåˆ«æ˜¯å®ƒå…·æœ‰è‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ã€‚ GCè‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼šParallel Scavengeæ”¶é›†å™¨æœ‰ä¸€ä¸ªå‚æ•°-XX:+UseAdaptiveSizePolicyã€‚å½“è¿™ä¸ªå‚æ•°æ‰“å¼€ä¹‹åï¼Œå°±ä¸éœ€è¦æ‰‹å·¥æŒ‡å®šæ–°ç”Ÿä»£çš„å¤§å°ã€Edenä¸SurvivoråŒºçš„æ¯”ä¾‹ã€æ™‹å‡è€å¹´ä»£å¯¹è±¡å¹´é¾„ç­‰ç»†èŠ‚å‚æ•°äº†ï¼Œè™šæ‹Ÿæœºä¼šæ ¹æ®å½“å‰ç³»ç»Ÿçš„è¿è¡Œæƒ…å†µæ”¶é›†æ€§èƒ½ç›‘æ§ä¿¡æ¯ï¼ŒåŠ¨æ€è°ƒæ•´è¿™äº›å‚æ•°ä»¥æä¾›æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–è€…æœ€å¤§çš„ååé‡ï¼Œè¿™ç§è°ƒèŠ‚æ–¹å¼ç§°ä¸ºGCè‡ªé€‚åº”çš„è°ƒèŠ‚ç­–ç•¥ï¼ˆGC Ergonomicsï¼‰ã€‚ Serial Oldæ”¶é›†å™¨ ç‰¹æ€§ï¼šSerial Oldæ˜¯Serialæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ï¼Œä½¿ç”¨æ ‡è®°ï¼æ•´ç†ç®—æ³•ã€‚ åº”ç”¨åœºæ™¯ï¼š Clientæ¨¡å¼Serial Oldæ”¶é›†å™¨çš„ä¸»è¦æ„ä¹‰ä¹Ÿæ˜¯åœ¨äºç»™Clientæ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºä½¿ç”¨ã€‚ Serveræ¨¡å¼å¦‚æœåœ¨Serveræ¨¡å¼ä¸‹ï¼Œé‚£ä¹ˆå®ƒä¸»è¦è¿˜æœ‰ä¸¤å¤§ç”¨é€”ï¼šä¸€ç§ç”¨é€”æ˜¯åœ¨JDK 1.5ä»¥åŠä¹‹å‰çš„ç‰ˆæœ¬ä¸­ä¸Parallel Scavengeæ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦ä¸€ç§ç”¨é€”å°±æ˜¯ä½œä¸ºCMSæ”¶é›†å™¨çš„åå¤‡é¢„æ¡ˆï¼Œåœ¨å¹¶å‘æ”¶é›†å‘ç”ŸConcurrent Mode Failureæ—¶ä½¿ç”¨ã€‚ Parallel Oldæ”¶é›†å™¨ ç‰¹æ€§ï¼šParallel Oldæ˜¯Parallel Scavengeæ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ï¼Œä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°ï¼æ•´ç†â€ç®—æ³•ã€‚ åº”ç”¨åœºæ™¯ï¼šåœ¨æ³¨é‡ååé‡ä»¥åŠCPUèµ„æºæ•æ„Ÿçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘Parallel ScavengeåŠ Parallel Oldæ”¶é›†å™¨ã€‚ è¿™ä¸ªæ”¶é›†å™¨æ˜¯åœ¨JDK 1.6ä¸­æ‰å¼€å§‹æä¾›çš„ï¼Œåœ¨æ­¤ä¹‹å‰ï¼Œæ–°ç”Ÿä»£çš„Parallel Scavengeæ”¶é›†å™¨ä¸€ç›´å¤„äºæ¯”è¾ƒå°´å°¬çš„çŠ¶æ€ã€‚åŸå› æ˜¯ï¼Œå¦‚æœæ–°ç”Ÿä»£é€‰æ‹©äº†Parallel Scavengeæ”¶é›†å™¨ï¼Œè€å¹´ä»£é™¤äº†Serial Oldæ”¶é›†å™¨å¤–åˆ«æ— é€‰æ‹©ï¼ˆParallel Scavengeæ”¶é›†å™¨æ— æ³•ä¸CMSæ”¶é›†å™¨é…åˆå·¥ä½œï¼‰ã€‚ç”±äºè€å¹´ä»£Serial Oldæ”¶é›†å™¨åœ¨æœåŠ¡ç«¯åº”ç”¨æ€§èƒ½ä¸Šçš„â€œæ‹–ç´¯â€ï¼Œä½¿ç”¨äº†Parallel Scavengeæ”¶é›†å™¨ä¹Ÿæœªå¿…èƒ½åœ¨æ•´ä½“åº”ç”¨ä¸Šè·å¾—ååé‡æœ€å¤§åŒ–çš„æ•ˆæœï¼Œç”±äºå•çº¿ç¨‹çš„è€å¹´ä»£æ”¶é›†ä¸­æ— æ³•å……åˆ†åˆ©ç”¨æœåŠ¡å™¨å¤šCPUçš„å¤„ç†èƒ½åŠ›ï¼Œåœ¨è€å¹´ä»£å¾ˆå¤§è€Œä¸”ç¡¬ä»¶æ¯”è¾ƒé«˜çº§çš„ç¯å¢ƒä¸­ï¼Œè¿™ç§ç»„åˆçš„ååé‡ç”šè‡³è¿˜ä¸ä¸€å®šæœ‰ParNewåŠ CMSçš„ç»„åˆâ€œç»™åŠ›â€ã€‚ç›´åˆ°Parallel Oldæ”¶é›†å™¨å‡ºç°åï¼Œâ€œååé‡ä¼˜å…ˆâ€æ”¶é›†å™¨ç»ˆäºæœ‰äº†æ¯”è¾ƒåå‰¯å…¶å®çš„åº”ç”¨ç»„åˆã€‚ CMSæ”¶é›†å™¨ ç‰¹æ€§ï¼š CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚ç›®å‰å¾ˆå¤§ä¸€éƒ¨åˆ†çš„Javaåº”ç”¨é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–è€…B/Sç³»ç»Ÿçš„æœåŠ¡ç«¯ä¸Šï¼Œè¿™ç±»åº”ç”¨å°¤å…¶é‡è§†æœåŠ¡çš„å“åº”é€Ÿåº¦ï¼Œå¸Œæœ›ç³»ç»Ÿåœé¡¿æ—¶é—´æœ€çŸ­ï¼Œä»¥ç»™ç”¨æˆ·å¸¦æ¥è¾ƒå¥½çš„ä½“éªŒã€‚CMSæ”¶é›†å™¨å°±éå¸¸ç¬¦åˆè¿™ç±»åº”ç”¨çš„éœ€æ±‚ã€‚CMSæ”¶é›†å™¨æ˜¯åŸºäºâ€œæ ‡è®°â€”æ¸…é™¤â€ç®—æ³•å®ç°çš„ï¼Œå®ƒçš„è¿ä½œè¿‡ç¨‹ç›¸å¯¹äºå‰é¢å‡ ç§æ”¶é›†å™¨æ¥è¯´æ›´å¤æ‚ä¸€äº›ï¼Œæ•´ä¸ªè¿‡ç¨‹åˆ†ä¸º4ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼ˆCMS initial markï¼‰åˆå§‹æ ‡è®°ä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œé€Ÿåº¦å¾ˆå¿«ï¼Œéœ€è¦â€œStop The Worldâ€ã€‚ å¹¶å‘æ ‡è®°ï¼ˆCMS concurrent markï¼‰å¹¶å‘æ ‡è®°é˜¶æ®µå°±æ˜¯è¿›è¡ŒGC Roots Tracingçš„è¿‡ç¨‹ã€‚ é‡æ–°æ ‡è®°ï¼ˆCMS remarkï¼‰é‡æ–°æ ‡è®°é˜¶æ®µæ˜¯ä¸ºäº†ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œè¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µç¨é•¿ä¸€äº›ï¼Œä½†è¿œæ¯”å¹¶å‘æ ‡è®°çš„æ—¶é—´çŸ­ï¼Œä»ç„¶éœ€è¦â€œStop The Worldâ€ã€‚ å¹¶å‘æ¸…é™¤ï¼ˆCMS concurrent sweepï¼‰å¹¶å‘æ¸…é™¤é˜¶æ®µä¼šæ¸…é™¤å¯¹è±¡ã€‚ ç”±äºæ•´ä¸ªè¿‡ç¨‹ä¸­è€—æ—¶æœ€é•¿çš„å¹¶å‘æ ‡è®°å’Œå¹¶å‘æ¸…é™¤è¿‡ç¨‹æ”¶é›†å™¨çº¿ç¨‹éƒ½å¯ä»¥ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å·¥ä½œï¼Œæ‰€ä»¥ï¼Œä»æ€»ä½“ä¸Šæ¥è¯´ï¼ŒCMSæ”¶é›†å™¨çš„å†…å­˜å›æ”¶è¿‡ç¨‹æ˜¯ä¸ç”¨æˆ·çº¿ç¨‹ä¸€èµ·å¹¶å‘æ‰§è¡Œçš„ã€‚ ä¼˜ç‚¹ï¼šCMSæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„æ”¶é›†å™¨ï¼Œå®ƒçš„ä¸»è¦ä¼˜ç‚¹åœ¨åå­—ä¸Šå·²ç»ä½“ç°å‡ºæ¥äº†ï¼šå¹¶å‘æ”¶é›†ã€ä½åœé¡¿ã€‚ ç¼ºç‚¹ï¼š CMSæ”¶é›†å™¨å¯¹CPUèµ„æºéå¸¸æ•æ„Ÿå…¶å®ï¼Œé¢å‘å¹¶å‘è®¾è®¡çš„ç¨‹åºéƒ½å¯¹CPUèµ„æºæ¯”è¾ƒæ•æ„Ÿã€‚åœ¨å¹¶å‘é˜¶æ®µï¼Œå®ƒè™½ç„¶ä¸ä¼šå¯¼è‡´ç”¨æˆ·çº¿ç¨‹åœé¡¿ï¼Œä½†æ˜¯ä¼šå› ä¸ºå ç”¨äº†ä¸€éƒ¨åˆ†çº¿ç¨‹ï¼ˆæˆ–è€…è¯´CPUèµ„æºï¼‰è€Œå¯¼è‡´åº”ç”¨ç¨‹åºå˜æ…¢ï¼Œæ€»ååé‡ä¼šé™ä½ã€‚CMSé»˜è®¤å¯åŠ¨çš„å›æ”¶çº¿ç¨‹æ•°æ˜¯ï¼ˆCPUæ•°é‡+3ï¼‰/ 4ï¼Œä¹Ÿå°±æ˜¯å½“CPUåœ¨4ä¸ªä»¥ä¸Šæ—¶ï¼Œå¹¶å‘å›æ”¶æ—¶åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸å°‘äº25%çš„CPUèµ„æºï¼Œå¹¶ä¸”éšç€CPUæ•°é‡çš„å¢åŠ è€Œä¸‹é™ã€‚ä½†æ˜¯å½“CPUä¸è¶³4ä¸ªï¼ˆè­¬å¦‚2ä¸ªï¼‰æ—¶ï¼ŒCMSå¯¹ç”¨æˆ·ç¨‹åºçš„å½±å“å°±å¯èƒ½å˜å¾—å¾ˆå¤§ã€‚ CMSæ”¶é›†å™¨æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾CMSæ”¶é›†å™¨æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼Œå¯èƒ½å‡ºç°â€œConcurrent Mode Failureâ€å¤±è´¥è€Œå¯¼è‡´å¦ä¸€æ¬¡Full GCçš„äº§ç”Ÿã€‚ ç”±äºCMSå¹¶å‘æ¸…ç†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜åœ¨è¿è¡Œç€ï¼Œä¼´éšç¨‹åºè¿è¡Œè‡ªç„¶å°±è¿˜ä¼šæœ‰æ–°çš„åƒåœ¾ä¸æ–­äº§ç”Ÿï¼Œè¿™ä¸€éƒ¨åˆ†åƒåœ¾å‡ºç°åœ¨æ ‡è®°è¿‡ç¨‹ä¹‹åï¼ŒCMSæ— æ³•åœ¨å½“æ¬¡æ”¶é›†ä¸­å¤„ç†æ‰å®ƒä»¬ï¼Œåªå¥½ç•™å¾…ä¸‹ä¸€æ¬¡GCæ—¶å†æ¸…ç†æ‰ã€‚è¿™ä¸€éƒ¨åˆ†åƒåœ¾å°±ç§°ä¸ºâ€œæµ®åŠ¨åƒåœ¾â€ã€‚ä¹Ÿæ˜¯ç”±äºåœ¨åƒåœ¾æ”¶é›†é˜¶æ®µç”¨æˆ·çº¿ç¨‹è¿˜éœ€è¦è¿è¡Œï¼Œé‚£ä¹Ÿå°±è¿˜éœ€è¦é¢„ç•™æœ‰è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ç»™ç”¨æˆ·çº¿ç¨‹ä½¿ç”¨ï¼Œå› æ­¤CMSæ”¶é›†å™¨ä¸èƒ½åƒå…¶ä»–æ”¶é›†å™¨é‚£æ ·ç­‰åˆ°è€å¹´ä»£å‡ ä¹å®Œå…¨è¢«å¡«æ»¡äº†å†è¿›è¡Œæ”¶é›†ï¼Œéœ€è¦é¢„ç•™ä¸€éƒ¨åˆ†ç©ºé—´æä¾›å¹¶å‘æ”¶é›†æ—¶çš„ç¨‹åºè¿ä½œä½¿ç”¨ã€‚è¦æ˜¯CMSè¿è¡ŒæœŸé—´é¢„ç•™çš„å†…å­˜æ— æ³•æ»¡è¶³ç¨‹åºéœ€è¦ï¼Œå°±ä¼šå‡ºç°ä¸€æ¬¡â€œConcurrent Mode Failureâ€å¤±è´¥ï¼Œè¿™æ—¶è™šæ‹Ÿæœºå°†å¯åŠ¨åå¤‡é¢„æ¡ˆï¼šä¸´æ—¶å¯ç”¨Serial Oldæ”¶é›†å™¨æ¥é‡æ–°è¿›è¡Œè€å¹´ä»£çš„åƒåœ¾æ”¶é›†ï¼Œè¿™æ ·åœé¡¿æ—¶é—´å°±å¾ˆé•¿äº†ã€‚ CMSæ”¶é›†å™¨ä¼šäº§ç”Ÿå¤§é‡ç©ºé—´ç¢ç‰‡CMSæ˜¯ä¸€æ¬¾åŸºäºâ€œæ ‡è®°â€”æ¸…é™¤â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œè¿™æ„å‘³ç€æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚ ç©ºé—´ç¢ç‰‡è¿‡å¤šæ—¶ï¼Œå°†ä¼šç»™å¤§å¯¹è±¡åˆ†é…å¸¦æ¥å¾ˆå¤§éº»çƒ¦ï¼Œå¾€å¾€ä¼šå‡ºç°è€å¹´ä»£è¿˜æœ‰å¾ˆå¤§ç©ºé—´å‰©ä½™ï¼Œä½†æ˜¯æ— æ³•æ‰¾åˆ°è¶³å¤Ÿå¤§çš„è¿ç»­ç©ºé—´æ¥åˆ†é…å½“å‰å¯¹è±¡ï¼Œä¸å¾—ä¸æå‰è§¦å‘ä¸€æ¬¡Full GCã€‚ G1æ”¶é›†å™¨ ç‰¹æ€§ï¼šG1ï¼ˆGarbage-Firstï¼‰æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡ç«¯åº”ç”¨çš„åƒåœ¾æ”¶é›†å™¨ã€‚HotSpotå¼€å‘å›¢é˜Ÿèµ‹äºˆå®ƒçš„ä½¿å‘½æ˜¯æœªæ¥å¯ä»¥æ›¿æ¢æ‰JDK 1.5ä¸­å‘å¸ƒçš„CMSæ”¶é›†å™¨ã€‚ä¸å…¶ä»–GCæ”¶é›†å™¨ç›¸æ¯”ï¼ŒG1å…·å¤‡å¦‚ä¸‹ç‰¹ç‚¹ã€‚ å¹¶è¡Œä¸å¹¶å‘G1èƒ½å……åˆ†åˆ©ç”¨å¤šCPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ªCPUæ¥ç¼©çŸ­Stop-The-Worldåœé¡¿çš„æ—¶é—´ï¼Œéƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCåŠ¨ä½œï¼ŒG1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®©Javaç¨‹åºç»§ç»­æ‰§è¡Œã€‚ åˆ†ä»£æ”¶é›†ä¸å…¶ä»–æ”¶é›†å™¨ä¸€æ ·ï¼Œåˆ†ä»£æ¦‚å¿µåœ¨G1ä¸­ä¾ç„¶å¾—ä»¥ä¿ç•™ã€‚è™½ç„¶G1å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ªGCå †ï¼Œä½†å®ƒèƒ½å¤Ÿé‡‡ç”¨ä¸åŒçš„æ–¹å¼å»å¤„ç†æ–°åˆ›å»ºçš„å¯¹è±¡å’Œå·²ç»å­˜æ´»äº†ä¸€æ®µæ—¶é—´ã€ç†¬è¿‡å¤šæ¬¡GCçš„æ—§å¯¹è±¡ä»¥è·å–æ›´å¥½çš„æ”¶é›†æ•ˆæœã€‚ ç©ºé—´æ•´åˆä¸CMSçš„â€œæ ‡è®°â€”æ¸…ç†â€ç®—æ³•ä¸åŒï¼ŒG1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°â€”æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼Œä»å±€éƒ¨ï¼ˆä¸¤ä¸ªRegionä¹‹é—´ï¼‰ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ï¼Œä½†æ— è®ºå¦‚ä½•ï¼Œè¿™ä¸¤ç§ç®—æ³•éƒ½æ„å‘³ç€G1è¿ä½œæœŸé—´ä¸ä¼šäº§ç”Ÿå†…å­˜ç©ºé—´ç¢ç‰‡ï¼Œæ”¶é›†åèƒ½æä¾›è§„æ•´çš„å¯ç”¨å†…å­˜ã€‚è¿™ç§ç‰¹æ€§æœ‰åˆ©äºç¨‹åºé•¿æ—¶é—´è¿è¡Œï¼Œåˆ†é…å¤§å¯¹è±¡æ—¶ä¸ä¼šå› ä¸ºæ— æ³•æ‰¾åˆ°è¿ç»­å†…å­˜ç©ºé—´è€Œæå‰è§¦å‘ä¸‹ä¸€æ¬¡GCã€‚ å¯é¢„æµ‹çš„åœé¡¿è¿™æ˜¯G1ç›¸å¯¹äºCMSçš„å¦ä¸€å¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1å’ŒCMSå…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½†G1é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡Næ¯«ç§’ã€‚ åœ¨G1ä¹‹å‰çš„å…¶ä»–æ”¶é›†å™¨è¿›è¡Œæ”¶é›†çš„èŒƒå›´éƒ½æ˜¯æ•´ä¸ªæ–°ç”Ÿä»£æˆ–è€…è€å¹´ä»£ï¼Œè€ŒG1ä¸å†æ˜¯è¿™æ ·ã€‚ä½¿ç”¨G1æ”¶é›†å™¨æ—¶ï¼ŒJavaå †çš„å†…å­˜å¸ƒå±€å°±ä¸å…¶ä»–æ”¶é›†å™¨æœ‰å¾ˆå¤§å·®åˆ«ï¼Œå®ƒå°†æ•´ä¸ªJavaå †åˆ’åˆ†ä¸ºå¤šä¸ªå¤§å°ç›¸ç­‰çš„ç‹¬ç«‹åŒºåŸŸï¼ˆRegionï¼‰ï¼Œè™½ç„¶è¿˜ä¿ç•™æœ‰æ–°ç”Ÿä»£å’Œè€å¹´ä»£çš„æ¦‚å¿µï¼Œä½†æ–°ç”Ÿä»£å’Œè€å¹´ä»£ä¸å†æ˜¯ç‰©ç†éš”ç¦»çš„äº†ï¼Œå®ƒä»¬éƒ½æ˜¯ä¸€éƒ¨åˆ†Regionï¼ˆä¸éœ€è¦è¿ç»­ï¼‰çš„é›†åˆã€‚ G1æ”¶é›†å™¨ä¹‹æ‰€ä»¥èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œæ˜¯å› ä¸ºå®ƒå¯ä»¥æœ‰è®¡åˆ’åœ°é¿å…åœ¨æ•´ä¸ªJavaå †ä¸­è¿›è¡Œå…¨åŒºåŸŸçš„åƒåœ¾æ”¶é›†ã€‚G1è·Ÿè¸ªå„ä¸ªRegioné‡Œé¢çš„åƒåœ¾å †ç§¯çš„ä»·å€¼å¤§å°ï¼ˆå›æ”¶æ‰€è·å¾—çš„ç©ºé—´å¤§å°ä»¥åŠå›æ”¶æ‰€éœ€æ—¶é—´çš„ç»éªŒå€¼ï¼‰ï¼Œåœ¨åå°ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆå›æ”¶ä»·å€¼æœ€å¤§çš„Regionï¼ˆè¿™ä¹Ÿå°±æ˜¯Garbage-Firståç§°çš„æ¥ç”±ï¼‰ã€‚è¿™ç§ä½¿ç”¨Regionåˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œä¿è¯äº†G1æ”¶é›†å™¨åœ¨æœ‰é™çš„æ—¶é—´å†…å¯ä»¥è·å–å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡ã€‚ æ‰§è¡Œè¿‡ç¨‹ï¼šG1æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´å¯åˆ’åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š åˆå§‹æ ‡è®°ï¼ˆInitial Markingï¼‰åˆå§‹æ ‡è®°é˜¶æ®µä»…ä»…åªæ˜¯æ ‡è®°ä¸€ä¸‹GC Rootsèƒ½ç›´æ¥å…³è”åˆ°çš„å¯¹è±¡ï¼Œå¹¶ä¸”ä¿®æ”¹TAMSï¼ˆNext Top at Mark Startï¼‰çš„å€¼ï¼Œè®©ä¸‹ä¸€é˜¶æ®µç”¨æˆ·ç¨‹åºå¹¶å‘è¿è¡Œæ—¶ï¼Œèƒ½åœ¨æ­£ç¡®å¯ç”¨çš„Regionä¸­åˆ›å»ºæ–°å¯¹è±¡ï¼Œè¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†è€—æ—¶å¾ˆçŸ­ã€‚ å¹¶å‘æ ‡è®°ï¼ˆConcurrent Markingï¼‰å¹¶å‘æ ‡è®°é˜¶æ®µæ˜¯ä»GC Rootå¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºå­˜æ´»çš„å¯¹è±¡ï¼Œè¿™é˜¶æ®µè€—æ—¶è¾ƒé•¿ï¼Œä½†å¯ä¸ç”¨æˆ·ç¨‹åºå¹¶å‘æ‰§è¡Œã€‚ æœ€ç»ˆæ ‡è®°ï¼ˆFinal Markingï¼‰æœ€ç»ˆæ ‡è®°é˜¶æ®µæ˜¯ä¸ºäº†ä¿®æ­£åœ¨å¹¶å‘æ ‡è®°æœŸé—´å› ç”¨æˆ·ç¨‹åºç»§ç»­è¿ä½œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†æ ‡è®°è®°å½•ï¼Œè™šæ‹Ÿæœºå°†è¿™æ®µæ—¶é—´å¯¹è±¡å˜åŒ–è®°å½•åœ¨çº¿ç¨‹Remembered Set Logsé‡Œé¢ï¼Œæœ€ç»ˆæ ‡è®°é˜¶æ®µéœ€è¦æŠŠRemembered Set Logsçš„æ•°æ®åˆå¹¶åˆ°Remembered Setä¸­ï¼Œè¿™é˜¶æ®µéœ€è¦åœé¡¿çº¿ç¨‹ï¼Œä½†æ˜¯å¯å¹¶è¡Œæ‰§è¡Œã€‚ ç­›é€‰å›æ”¶ï¼ˆLive Data Counting and Evacuationï¼‰ç­›é€‰å›æ”¶é˜¶æ®µé¦–å…ˆå¯¹å„ä¸ªRegionçš„å›æ”¶ä»·å€¼å’Œæˆæœ¬è¿›è¡Œæ’åºï¼Œæ ¹æ®ç”¨æˆ·æ‰€æœŸæœ›çš„GCåœé¡¿æ—¶é—´æ¥åˆ¶å®šå›æ”¶è®¡åˆ’ï¼Œè¿™ä¸ªé˜¶æ®µå…¶å®ä¹Ÿå¯ä»¥åšåˆ°ä¸ç”¨æˆ·ç¨‹åºä¸€èµ·å¹¶å‘æ‰§è¡Œï¼Œä½†æ˜¯å› ä¸ºåªå›æ”¶ä¸€éƒ¨åˆ†Regionï¼Œæ—¶é—´æ˜¯ç”¨æˆ·å¯æ§åˆ¶çš„ï¼Œè€Œä¸”åœé¡¿ç”¨æˆ·çº¿ç¨‹å°†å¤§å¹…æé«˜æ”¶é›†æ•ˆç‡ã€‚ CMSæ”¶é›†å™¨ VS G1æ”¶é›†å™¨ï¼š G1æ”¶é›†å™¨å‡ ä¹å¯ä»¥è¯´è¿˜æ²¡æœ‰ç»è¿‡å®é™…åº”ç”¨çš„è€ƒéªŒï¼Œç½‘ç»œä¸Šå…³äºG1æ”¶é›†å™¨çš„æ€§èƒ½æµ‹è¯•ä¹Ÿéå¸¸è´«ä¹ï¼Œå¦‚æœç°åœ¨é‡‡ç”¨çš„æ”¶é›†å™¨æ²¡æœ‰å‡ºç°ä»»ä½•é—®é¢˜ï¼Œé‚£å°±æ²¡æœ‰ç†ç”±ç°åœ¨å»é€‰æ‹©G1ï¼Œå¦‚æœåº”ç”¨è¿½æ±‚ä½åœé¡¿ï¼Œé‚£G1ç°åœ¨å·²ç»å¯ä»¥ä½œä¸ºä¸€ä¸ªå¯å°è¯•çš„é€‰æ‹©ï¼Œå¦‚æœåº”ç”¨è¿½æ±‚ååé‡ï¼Œé‚£ä¹ˆG1å¹¶ä¸ä¼šå¸¦æ¥ä»€ä¹ˆç‰¹åˆ«çš„å¥½å¤„ã€‚ æ€»ç»“å†…å­˜å›æ”¶ä¸åƒåœ¾æ”¶é›†å™¨åœ¨å¾ˆå¤šæ—¶å€™éƒ½æ˜¯å½±å“ç³»ç»Ÿæ€§èƒ½ã€å¹¶å‘èƒ½åŠ›çš„ä¸»è¦å› ç´ ä¹‹ä¸€ï¼Œè™šæ‹Ÿæœºä¹‹æ‰€ä»¥æä¾›å¤šç§ä¸åŒçš„æ”¶é›†å™¨ä»¥åŠæä¾›å¤§é‡çš„è°ƒèŠ‚å‚æ•°ï¼Œæ˜¯å› ä¸ºåªæœ‰æ ¹æ®å®é™…åº”ç”¨éœ€æ±‚ï¼Œå®ç°æ–¹å¼é€‰æ‹©æœ€ä¼˜çš„æ”¶é›†æ–¹å¼æ‰èƒ½è·å–æœ€é«˜çš„æ€§èƒ½ï¼Œæ²¡æœ‰å›ºå®šæ”¶é›†å™¨ã€å‚æ•°ç»„åˆï¼Œä¹Ÿå°±æ²¡æœ‰æœ€ä¼˜çš„è°ƒä¼˜æ–¹æ³•ï¼Œè™šæ‹Ÿæœºä¹Ÿæœ‰æ²¡æœ‰ä»€ä¹ˆå¿…ç„¶çš„å†…å­˜å›æ”¶è¡Œä¸ºã€‚ è™½ç„¶æˆ‘ä»¬æ˜¯åœ¨å¯¹å„ä¸ªæ”¶é›†å™¨è¿›è¡Œæ¯”è¾ƒï¼Œä½†å¹¶éä¸ºäº†æŒ‘é€‰å‡ºä¸€ä¸ªæœ€å¥½çš„æ”¶é›†å™¨ã€‚å› ä¸ºç›´åˆ°ç°åœ¨ä¸ºæ­¢è¿˜æ²¡æœ‰æœ€å¥½çš„æ”¶é›†å™¨å‡ºç°ï¼Œæ›´åŠ æ²¡æœ‰ä¸‡èƒ½çš„æ”¶é›†å™¨ï¼Œæ‰€ä»¥æˆ‘ä»¬é€‰æ‹©çš„åªæ˜¯å¯¹å…·ä½“åº”ç”¨æœ€åˆé€‚çš„æ”¶é›†å™¨ã€‚è¿™ç‚¹ä¸éœ€è¦å¤šåŠ è§£é‡Šå°±èƒ½è¯æ˜ï¼šå¦‚æœæœ‰ä¸€ç§æ”¾ä¹‹å››æµ·çš†å‡†ã€ä»»ä½•åœºæ™¯ä¸‹éƒ½é€‚ç”¨çš„å®Œç¾æ”¶é›†å™¨å­˜åœ¨ï¼Œé‚£HotSpotè™šæ‹Ÿæœºå°±æ²¡å¿…è¦å®ç°é‚£ä¹ˆå¤šä¸åŒçš„æ”¶é›†å™¨äº†ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"jvm","slug":"jvm","permalink":"https://sunny0715.github.io/tags/jvm/"}]},{"title":"Javaç”ŸæˆPDF","slug":"Javaç”ŸæˆPDF","date":"2017-11-13T07:51:53.000Z","updated":"2018-03-13T05:49:18.726Z","comments":true,"path":"2017/11/13/Javaç”ŸæˆPDF/","link":"","permalink":"https://sunny0715.github.io/2017/11/13/Javaç”ŸæˆPDF/","excerpt":"å¼•è¨€åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œéœ€è¦æä¾›ç›¸å…³çš„ç”µå­å‡­è¯ï¼Œæ¯”å¦‚ç½‘é“¶/æ”¯ä»˜å®ä¸­è½¬è´¦çš„ç”µå­å›å•ï¼Œç­¾çº¦çš„ç”µå­åˆåŒã€è¯ä¹¦ç­‰ã€‚æ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹ï¼Œä¸‹è½½ï¼Œæ‰“å°ã€‚ç›®å‰å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼ŒæŠŠç›¸å…³æ•°æ®ä¿¡æ¯ï¼Œç”Ÿæˆå¯¹åº”çš„PDFæ–‡ä»¶è¿”å›ç»™ç”¨æˆ·ã€‚ä¹‹å‰æœ‰å†™è¿‡ä¸€ç¯‡åšå®¢å…³äºJAVAå®ç°HTMLè½¬PDFï¼Œä¸åŒåœºæ™¯ä¸‹çš„ä¸šåŠ¡ä¸åŒï¼Œç°åœ¨éœ€è¦ä½¿ç”¨PDFç”Ÿæˆè¯ä¹¦ï¼Œè¿™ç¯‡åšå®¢ä¸»è¦ä»‹ç»iTextçš„ä½¿ç”¨ã€‚ æœ¬åšå®¢é¡¹ç›®åœ°å€ï¼šhttps://github.com/Sunny0715/java_pdf_demo","text":"å¼•è¨€åœ¨æŸäº›ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œéœ€è¦æä¾›ç›¸å…³çš„ç”µå­å‡­è¯ï¼Œæ¯”å¦‚ç½‘é“¶/æ”¯ä»˜å®ä¸­è½¬è´¦çš„ç”µå­å›å•ï¼Œç­¾çº¦çš„ç”µå­åˆåŒã€è¯ä¹¦ç­‰ã€‚æ–¹ä¾¿ç”¨æˆ·æŸ¥çœ‹ï¼Œä¸‹è½½ï¼Œæ‰“å°ã€‚ç›®å‰å¸¸ç”¨çš„è§£å†³æ–¹æ¡ˆæ˜¯ï¼ŒæŠŠç›¸å…³æ•°æ®ä¿¡æ¯ï¼Œç”Ÿæˆå¯¹åº”çš„PDFæ–‡ä»¶è¿”å›ç»™ç”¨æˆ·ã€‚ä¹‹å‰æœ‰å†™è¿‡ä¸€ç¯‡åšå®¢å…³äºJAVAå®ç°HTMLè½¬PDFï¼Œä¸åŒåœºæ™¯ä¸‹çš„ä¸šåŠ¡ä¸åŒï¼Œç°åœ¨éœ€è¦ä½¿ç”¨PDFç”Ÿæˆè¯ä¹¦ï¼Œè¿™ç¯‡åšå®¢ä¸»è¦ä»‹ç»iTextçš„ä½¿ç”¨ã€‚ æœ¬åšå®¢é¡¹ç›®åœ°å€ï¼šhttps://github.com/Sunny0715/java_pdf_demo iTextä»‹ç»iTextæ˜¯è‘—åçš„å¼€æ”¾æºç çš„ç«™ç‚¹sourceforgeä¸€ä¸ªé¡¹ç›®ï¼Œæ˜¯ç”¨äºç”ŸæˆPDFæ–‡æ¡£çš„ä¸€ä¸ªJAVAç±»åº“ã€‚é€šè¿‡iTextä¸ä»…å¯ä»¥ç”ŸæˆPDFæˆ–rtfçš„æ–‡æ¡£ï¼Œè€Œä¸”å¯ä»¥å°†XMLã€HTMLæ–‡ä»¶è½¬åŒ–ä¸ºPDFæ–‡ä»¶ã€‚ iText å®˜ç½‘ï¼šhttp://itextpdf.com/ iText å¼€å‘æ–‡æ¡£ï¼š http://developers.itextpdf.com/developers-home iTextç›®å‰æœ‰ä¸¤å¥—ç‰ˆæœ¬iText5å’ŒiText7ã€‚iText5åº”è¯¥æ˜¯ç½‘ä¸Šç”¨çš„æ¯”è¾ƒå¤šçš„ä¸€ä¸ªç‰ˆæœ¬ã€‚iText5å› ä¸ºæ˜¯å¾ˆå¤šå¼€å‘è€…å‚ä¸è´¡çŒ®ä»£ç ï¼Œå› æ­¤åœ¨ä¸€äº›è§„èŒƒå’Œè®¾è®¡ä¸Šå­˜åœ¨ä¸åˆç†çš„åœ°æ–¹ã€‚iText7æ˜¯åæ¥å®˜æ–¹é’ˆå¯¹iText5çš„é‡æ„ï¼Œä¸¤ä¸ªç‰ˆæœ¬å·®åˆ«è¿˜æ˜¯æŒºå¤§çš„ã€‚ä¸è¿‡åœ¨å®é™…ä½¿ç”¨ä¸­ï¼Œä¸€èˆ¬ç”¨åˆ°çš„éƒ½æ¯”è¾ƒç®€å•ï¼Œæ‰€ä»¥ä¸ç”¨ç‰¹åˆ«æ‹˜æ³¥äºä½¿ç”¨å“ªä¸ªç‰ˆæœ¬ã€‚æ¯”å¦‚æˆ‘ä»¬åœ¨http://mvnrepository.com/ä¸­æœç´¢iTextï¼Œå‡ºæ¥çš„éƒ½æ˜¯iText5çš„ä¾èµ–ã€‚ iTextç®€å•ä½¿ç”¨æ·»åŠ ä¾èµ– 123456&lt;!-- https://mvnrepository.com/artifact/com.itextpdf/itextpdf --&gt;&lt;dependency&gt; &lt;groupId&gt;com.itextpdf&lt;/groupId&gt; &lt;artifactId&gt;itextpdf&lt;/artifactId&gt; &lt;version&gt;5.5.11&lt;/version&gt;&lt;/dependency&gt; æµ‹è¯•ä»£ç ï¼šJavaToPdf 12345678910111213141516171819202122232425262728293031package com.rainbowhorse.test;import com.itextpdf.text.Document;import com.itextpdf.text.DocumentException;import com.itextpdf.text.Paragraph;import com.itextpdf.text.pdf.PdfWriter;import java.io.FileNotFoundException;import java.io.FileOutputStream;/** * ä¸æ”¯æŒä¸­æ–‡ * ClassName: JavaToPdf * @Description: TODO * @author max * @date 2017å¹´11æœˆ13æ—¥ */public class JavaToPdf &#123; // ç”ŸæˆPDFè·¯å¾„ private static final String DEST = \"target/HelloWorld.pdf\"; public static void main(String[] args) throws FileNotFoundException, DocumentException &#123; Document document = new Document(); PdfWriter writer = PdfWriter.getInstance(document, new FileOutputStream(DEST)); document.open(); document.add(new Paragraph(\"hello world\")); document.close(); writer.close(); &#125;&#125; è¿è¡Œç»“æœ iTextä¸­æ–‡æ”¯æŒiTexté»˜è®¤æ˜¯ä¸æ”¯æŒä¸­æ–‡çš„ï¼Œå› æ­¤éœ€è¦æ·»åŠ å¯¹åº”çš„ä¸­æ–‡å­—ä½“,æ¯”å¦‚é»‘ä½“simhei.ttf å¯å‚è€ƒæ–‡æ¡£ï¼šhttp://developers.itextpdf.com/examples/font-examples/using-fonts#1227-tengwarquenya1.java æµ‹è¯•ä»£ç ï¼šJavaToPdfCN 12345678910111213141516171819202122232425262728293031323334353637package com.rainbowhorse.test;import com.itextpdf.text.Document;import com.itextpdf.text.DocumentException;import com.itextpdf.text.Font;import com.itextpdf.text.FontFactory;import com.itextpdf.text.Paragraph;import com.itextpdf.text.pdf.BaseFont;import com.itextpdf.text.pdf.PdfWriter;import java.io.FileNotFoundException;import java.io.FileOutputStream;/** * æ”¯æŒä¸­æ–‡ * ClassName: JavaToPdfCN * @Description: TODO * @author max * @date 2017å¹´11æœˆ13æ—¥ */public class JavaToPdfCN &#123; // ç”ŸæˆPDFè·¯å¾„ private static final String DEST = \"target/HelloWorld_CN.pdf\"; // ä¸­æ–‡å­—ä½“ï¼ˆé»‘ä½“ï¼‰ private static final String FONT = \"simhei.ttf\"; public static void main(String[] args) throws FileNotFoundException, DocumentException &#123; Document document = new Document(); PdfWriter writer = PdfWriter.getInstance(document, new FileOutputStream(DEST)); document.open(); Font font = FontFactory.getFont(FONT, BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED); document.add(new Paragraph(\"hello worldï¼Œæˆ‘æ˜¯rainbowhorseã€‚\", font)); document.close(); writer.close(); &#125;&#125; è¿è¡Œç»“æœ iText-HTMLæ¸²æŸ“åœ¨ä¸€äº›æ¯”è¾ƒå¤æ‚çš„PDFå¸ƒå±€ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡HTMLå»ç”ŸæˆPDF å¯å‚è€ƒæ–‡æ¡£ï¼šhttp://developers.itextpdf.com/examples/xml-worker-itext5/xml-worker-examples æ·»åŠ ä¾èµ– 123456&lt;!-- https://mvnrepository.com/artifact/com.itextpdf.tool/xmlworker --&gt;&lt;dependency&gt; &lt;groupId&gt;com.itextpdf.tool&lt;/groupId&gt; &lt;artifactId&gt;xmlworker&lt;/artifactId&gt; &lt;version&gt;5.5.11&lt;/version&gt;&lt;/dependency&gt; æ·»åŠ æ¨¡æ¿ï¼štemplate.html 12345678910111213141516171819&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\" /&gt;&lt;title&gt;Title&lt;/title&gt;&lt;style&gt;body &#123; font-family: SimHei;&#125;.red &#123; color: red;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=\"red\"&gt;ä½ å¥½ï¼Œrainbowhorse&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; æµ‹è¯•ä»£ç ï¼šJavaToPdfHtml 123456789101112131415161718192021222324252627282930313233343536373839404142package com.rainbowhorse.test;import java.io.FileInputStream;import java.io.FileOutputStream;import java.io.IOException;import java.nio.charset.Charset;import com.itextpdf.text.Document;import com.itextpdf.text.DocumentException;import com.itextpdf.text.pdf.PdfWriter;import com.itextpdf.tool.xml.XMLWorkerFontProvider;import com.itextpdf.tool.xml.XMLWorkerHelper;import com.rainbowhorse.test.util.PathUtil;/** * HTMLè½¬PDF * ClassName: JavaToPdfHtml * @Description: TODO * @author max * @date 2017å¹´11æœˆ13æ—¥ */public class JavaToPdfHtml &#123; // ç”ŸæˆPDFè·¯å¾„ private static final String DEST = \"target/HelloWorld_CN_HTML.pdf\"; // æ¨¡æ¿è·¯å¾„ private static final String HTML = PathUtil.getCurrentPath() + \"/template.html\"; // ä¸­æ–‡å­—ä½“ï¼ˆé»‘ä½“ï¼‰ private static final String FONT = \"simhei.ttf\"; public static void main(String[] args) throws IOException, DocumentException &#123; Document document = new Document(); PdfWriter writer = PdfWriter.getInstance(document, new FileOutputStream(DEST)); document.open(); XMLWorkerFontProvider fontImp = new XMLWorkerFontProvider(XMLWorkerFontProvider.DONTLOOKFORFONTS); fontImp.register(FONT); XMLWorkerHelper.getInstance().parseXHtml(writer, document, new FileInputStream(HTML), null, Charset.forName(\"UTF-8\"), fontImp); document.close(); &#125;&#125; è¿è¡Œç»“æœ æ³¨æ„ï¼š HTMLä¸­å¿…é¡»ä½¿ç”¨æ ‡å‡†çš„è¯­æ³•ï¼Œæ ‡ç­¾ä¸€å®šéœ€è¦é—­åˆã€‚ HTMLä¸­å¦‚æœæœ‰ä¸­æ–‡ï¼Œéœ€è¦åœ¨æ ·å¼ä¸­æ·»åŠ å¯¹åº”å­—ä½“çš„æ ·å¼ã€‚ iText-HTML-Freemarkeræ¸²æŸ“åœ¨å®é™…ä½¿ç”¨ä¸­ï¼ŒHTMLå†…å®¹éƒ½æ˜¯åŠ¨æ€æ¸²æŸ“çš„ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦åŠ å…¥æ¨¡æ¿å¼•æ“æ”¯æŒï¼Œå¯ä»¥ä½¿ç”¨FreeMarker/Velocityï¼Œè¿™é‡Œä½¿ç”¨FreeMarkerä¸¾ä¾‹ã€‚ æ·»åŠ FreeMarkeä¾èµ– 123456&lt;!-- https://mvnrepository.com/artifact/org.freemarker/freemarker --&gt;&lt;dependency&gt; &lt;groupId&gt;org.freemarker&lt;/groupId&gt; &lt;artifactId&gt;freemarker&lt;/artifactId&gt; &lt;version&gt;2.3.19&lt;/version&gt;&lt;/dependency&gt; æ·»åŠ æ¨¡æ¿ï¼štemplate_freemarker.html 12345678910111213141516171819202122232425&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\" /&gt;&lt;title&gt;Title&lt;/title&gt;&lt;style&gt;body &#123; font-family: SimHei;&#125;.blue &#123; color: blue;&#125;.pos &#123; position: absolute; left: 100px; top: 150px&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;div class=\"blue pos\"&gt;ä½ å¥½ï¼Œ$&#123;name&#125;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; æµ‹è¯•ä»£ç ï¼šJavaToPdfHtmlFreeMarker 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495package com.rainbowhorse.test;import java.io.ByteArrayInputStream;import java.io.File;import java.io.FileOutputStream;import java.io.IOException;import java.io.StringWriter;import java.io.Writer;import java.nio.charset.Charset;import java.util.HashMap;import java.util.Map;import com.itextpdf.text.Document;import com.itextpdf.text.DocumentException;import com.itextpdf.text.pdf.PdfWriter;import com.itextpdf.tool.xml.XMLWorkerFontProvider;import com.itextpdf.tool.xml.XMLWorkerHelper;import com.rainbowhorse.test.util.PathUtil;import freemarker.template.Configuration;import freemarker.template.Template;/** * FreeMarkeræ¨¡æ¿çš„HTMLè½¬PDF * ClassName: JavaToPdfHtmlFreeMarker * @Description: TODO * @author max * @date 2017å¹´11æœˆ13æ—¥ */public class JavaToPdfHtmlFreeMarker &#123; // ç”ŸæˆPDFè·¯å¾„ private static final String DEST = \"target/HelloWorld_CN_HTML_FREEMARKER.pdf\"; // æ¨¡æ¿è·¯å¾„ private static final String HTML = \"template_freemarker.html\"; // ä¸­æ–‡å­—ä½“ï¼ˆé»‘ä½“ï¼‰ private static final String FONT = \"simhei.ttf\"; private static Configuration freemarkerCfg = null; static &#123; freemarkerCfg = new Configuration(); // freemarkerçš„æ¨¡æ¿ç›®å½• try &#123; freemarkerCfg.setDirectoryForTemplateLoading(new File(PathUtil.getCurrentPath())); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) throws IOException, DocumentException &#123; Map&lt;String, Object&gt; data = new HashMap&lt;String, Object&gt;(16); data.put(\"name\", \"rainbowhorse\"); String content = JavaToPdfHtmlFreeMarker.freeMarkerRender(data, HTML); JavaToPdfHtmlFreeMarker.createPdf(content, DEST); &#125; public static void createPdf(String content, String dest) throws IOException, DocumentException &#123; Document document = new Document(); PdfWriter writer = PdfWriter.getInstance(document, new FileOutputStream(dest)); document.open(); XMLWorkerFontProvider fontImp = new XMLWorkerFontProvider(XMLWorkerFontProvider.DONTLOOKFORFONTS); fontImp.register(FONT); XMLWorkerHelper.getInstance().parseXHtml(writer, document, new ByteArrayInputStream(content.getBytes()), null, Charset.forName(\"UTF-8\"), fontImp); document.close(); &#125; /** * freemarkeræ¸²æŸ“html */ public static String freeMarkerRender(Map&lt;String, Object&gt; data, String htmlTmp) &#123; Writer out = new StringWriter(); try &#123; // è·å–æ¨¡æ¿,å¹¶è®¾ç½®ç¼–ç æ–¹å¼ Template template = freemarkerCfg.getTemplate(htmlTmp); template.setEncoding(\"UTF-8\"); // åˆå¹¶æ•°æ®æ¨¡å‹ä¸æ¨¡æ¿ template.process(data, out); // å°†åˆå¹¶åçš„æ•°æ®å’Œæ¨¡æ¿å†™å…¥åˆ°æµä¸­ï¼Œè¿™é‡Œä½¿ç”¨çš„å­—ç¬¦æµ out.flush(); return out.toString(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; out.close(); &#125; catch (IOException ex) &#123; ex.printStackTrace(); &#125; &#125; return null; &#125;&#125; è¿è¡Œç»“æœ ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†iTexté€šè¿‡HTMLæ¨¡æ¿ç”ŸæˆPDFçš„åŠŸèƒ½ï¼Œä½†æ˜¯å®é™…åº”ç”¨ä¸­ï¼Œæˆ‘ä»¬å‘ç°iTextå¹¶ä¸èƒ½å¯¹é«˜çº§çš„CSSæ ·å¼è¿›è¡Œè§£æï¼Œæ¯”å¦‚CSSä¸­çš„positionå±æ€§ç­‰ï¼Œå› æ­¤æˆ‘ä»¬è¦å¼•å…¥æ–°çš„ç»„ä»¶ã€‚ Flying Saucer-CSSé«˜çº§ç‰¹æ€§æ”¯æŒFlying Saucer is a pure-Java library for rendering arbitrary well-formed XML (or XHTML) using CSS 2.1 for layout and formatting, output to Swing panels, PDF, and images. Flying Sauceræ˜¯åŸºäºiTextçš„ï¼Œæ”¯æŒå¯¹CSSé«˜çº§ç‰¹æ€§çš„è§£æã€‚ æ·»åŠ ä¾èµ– 12345678910111213&lt;!-- https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-pdf --&gt;&lt;dependency&gt; &lt;groupId&gt;org.xhtmlrenderer&lt;/groupId&gt; &lt;artifactId&gt;flying-saucer-pdf&lt;/artifactId&gt; &lt;version&gt;9.1.5&lt;/version&gt;&lt;/dependency&gt; &lt;!-- https://mvnrepository.com/artifact/org.xhtmlrenderer/flying-saucer-pdf-itext5 --&gt;&lt;dependency&gt; &lt;groupId&gt;org.xhtmlrenderer&lt;/groupId&gt; &lt;artifactId&gt;flying-saucer-pdf-itext5&lt;/artifactId&gt; &lt;version&gt;9.1.5&lt;/version&gt;&lt;/dependency&gt; æ·»åŠ æ¨¡æ¿ï¼štemplate_freemarker_fs.html 1234567891011121314151617181920212223242526272829303132333435363738394041424344&lt;!DOCTYPE html&gt;&lt;html lang=\"en\"&gt;&lt;head&gt;&lt;meta charset=\"UTF-8\" /&gt;&lt;title&gt;Title&lt;/title&gt;&lt;style&gt; @page &#123; size:297mm 230mm; @top-left&#123; content:element(header-left); &#125;; @top-right &#123; content: element(header-right) &#125;; @bottom-left &#123; content: element(footer-left) &#125;; @bottom-right &#123; content: element(footer-right) &#125;; &#125;body &#123; font-family: SimHei;&#125;.color &#123; color: green;&#125;.pos &#123; position: absolute; left: 200px; top: 200px; width: 200px; font-size: 20px;&#125;&lt;/style&gt;&lt;/head&gt;&lt;body&gt; &lt;img src=\"logo.jpg\" /&gt; &lt;div class=\"color pos\"&gt;ä½ å¥½ï¼Œ$&#123;name&#125;&lt;/div&gt;&lt;/body&gt;&lt;/html&gt; æµ‹è¯•ä»£ç ï¼šJavaToPdfHtmlFreeMarkerï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495package com.rainbowhorse.test.flyingsaucer;import java.io.File;import java.io.FileOutputStream;import java.io.IOException;import java.io.StringWriter;import java.io.Writer;import java.util.HashMap;import java.util.Map;import org.xhtmlrenderer.pdf.ITextFontResolver;import org.xhtmlrenderer.pdf.ITextRenderer;import com.itextpdf.text.DocumentException;import com.itextpdf.text.pdf.BaseFont;import com.rainbowhorse.test.util.PathUtil;import freemarker.template.Configuration;import freemarker.template.Template;/** * FreeMarkeræ¨¡æ¿çš„HTMLè½¬PDF Flying Saucer * ClassName: JavaToPdfHtmlFreeMarker * @Description: TODO * @author max * @date 2017å¹´11æœˆ13æ—¥ */public class JavaToPdfHtmlFreeMarker &#123; // ç”ŸæˆPDFè·¯å¾„ private static final String DEST = \"target/HelloWorld_CN_HTML_FREEMARKER_FS.pdf\"; // æ¨¡æ¿è·¯å¾„ private static final String HTML = \"template_freemarker_fs.html\"; // ä¸­æ–‡å­—ä½“ï¼ˆé»‘ä½“ï¼‰ private static final String FONT = \"simhei.ttf\"; // å›¾ç‰‡è·¯å¾„ private static final String LOGO_PATH = \"file:/\" + PathUtil.getCurrentPath() + \"/\"; private static Configuration freemarkerCfg = null; static &#123; freemarkerCfg = new Configuration(); // freemarkerçš„æ¨¡æ¿ç›®å½• try &#123; freemarkerCfg.setDirectoryForTemplateLoading(new File(PathUtil.getCurrentPath())); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) throws IOException, DocumentException, com.lowagie.text.DocumentException &#123; Map&lt;String, Object&gt; data = new HashMap&lt;String, Object&gt;(16); data.put(\"name\", \"rainbowhorse\"); String content = JavaToPdfHtmlFreeMarker.freeMarkerRender(data, HTML); JavaToPdfHtmlFreeMarker.createPdf(content, DEST); &#125; /** * freemarkeræ¸²æŸ“html */ public static String freeMarkerRender(Map&lt;String, Object&gt; data, String htmlTmp) &#123; Writer out = new StringWriter(); try &#123; // è·å–æ¨¡æ¿,å¹¶è®¾ç½®ç¼–ç æ–¹å¼ Template template = freemarkerCfg.getTemplate(htmlTmp); template.setEncoding(\"UTF-8\"); // åˆå¹¶æ•°æ®æ¨¡å‹ä¸æ¨¡æ¿ template.process(data, out); // å°†åˆå¹¶åçš„æ•°æ®å’Œæ¨¡æ¿å†™å…¥åˆ°æµä¸­ï¼Œè¿™é‡Œä½¿ç”¨çš„å­—ç¬¦æµ out.flush(); return out.toString(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; out.close(); &#125; catch (IOException ex) &#123; ex.printStackTrace(); &#125; &#125; return null; &#125; public static void createPdf(String content, String dest) throws IOException, DocumentException, com.lowagie.text.DocumentException &#123; ITextRenderer render = new ITextRenderer(); ITextFontResolver fontResolver = render.getFontResolver(); fontResolver.addFont(FONT, BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED); // è§£æhtmlç”Ÿæˆpdf render.setDocumentFromString(content); // è§£å†³å›¾ç‰‡ç›¸å¯¹è·¯å¾„çš„é—®é¢˜ render.getSharedContext().setBaseURL(LOGO_PATH); render.layout(); render.createPDF(new FileOutputStream(dest)); &#125;&#125; è¿è¡Œç»“æœ åœ¨æŸäº›åœºæ™¯ä¸‹ï¼ŒHTMLä¸­çš„é™æ€èµ„æºæ˜¯åœ¨æœ¬åœ°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨render.getSharedContext().setBaseURL()åŠ è½½æ–‡ä»¶èµ„æº,æ³¨æ„èµ„æºURLéœ€è¦ä½¿ç”¨æ–‡ä»¶åè®® â€œfile://â€ã€‚ å¯¹äºç”Ÿæˆçš„pdfé¡µé¢å¤§å°ï¼Œå¯ä»¥ç”¨cssçš„@pageå±æ€§è®¾ç½®ã€‚ PDFè½¬å›¾ç‰‡åœ¨æŸäº›åœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½åªéœ€è¦è¿”å›å›¾ç‰‡æ ¼å¼çš„ç”µå­å‡­è¯ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Jpedalç»„ä»¶ï¼ŒæŠŠPDFè½¬æˆå›¾ç‰‡ã€‚ æ·»åŠ ä¾èµ– 123456&lt;!-- https://mvnrepository.com/artifact/org.jpedal/jpedal-lgpl --&gt;&lt;dependency&gt; &lt;groupId&gt;org.jpedal&lt;/groupId&gt; &lt;artifactId&gt;jpedal-lgpl&lt;/artifactId&gt; &lt;version&gt;4.74b27&lt;/version&gt;&lt;/dependency&gt; æµ‹è¯•ä»£ç ï¼šJavaToPdfImgHtmlFreeMarker 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159package com.rainbowhorse.test.flyingsaucer;import java.awt.image.BufferedImage;import java.io.ByteArrayOutputStream;import java.io.File;import java.io.FileOutputStream;import java.io.IOException;import java.io.StringWriter;import java.io.Writer;import java.util.HashMap;import java.util.Map;import javax.imageio.ImageIO;import org.jpedal.PdfDecoder;import org.jpedal.exception.PdfException;import org.jpedal.fonts.FontMappings;import org.xhtmlrenderer.pdf.ITextFontResolver;import org.xhtmlrenderer.pdf.ITextRenderer;import com.itextpdf.text.DocumentException;import com.itextpdf.text.pdf.BaseFont;import com.rainbowhorse.test.util.PathUtil;import freemarker.template.Configuration;import freemarker.template.Template;/** * JpedalæŠŠpdfè½¬æˆå›¾ç‰‡ * ClassName: JavaToPdfImgHtmlFreeMarker * @Description: TODO * @author max * @date 2017å¹´11æœˆ13æ—¥ */public class JavaToPdfImgHtmlFreeMarker &#123; private static final String DEST = \"target/HelloWorld_CN_HTML_FREEMARKER_FS_IMG.png\"; private static final String HTML = \"template_freemarker_fs.html\"; private static final String FONT = \"simhei.ttf\"; private static final String LOGO_PATH = \"file://\" + PathUtil.getCurrentPath() + \"/logo.png\"; private static final String IMG_EXT = \"png\"; private static Configuration freemarkerCfg = null; static &#123; freemarkerCfg = new Configuration(); // freemarkerçš„æ¨¡æ¿ç›®å½• try &#123; freemarkerCfg.setDirectoryForTemplateLoading(new File(PathUtil.getCurrentPath())); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; public static void main(String[] args) throws IOException, DocumentException, com.lowagie.text.DocumentException &#123; Map&lt;String, Object&gt; data = new HashMap&lt;String, Object&gt;(16); data.put(\"name\", \"rainbowhorse\"); String content = JavaToPdfImgHtmlFreeMarker.freeMarkerRender(data, HTML); ByteArrayOutputStream pdfStream = JavaToPdfImgHtmlFreeMarker.createPdf(content); ByteArrayOutputStream imgSteam = JavaToPdfImgHtmlFreeMarker.pdfToImg(pdfStream.toByteArray(), 2, 1, IMG_EXT); FileOutputStream fileStream = new FileOutputStream(new File(DEST)); fileStream.write(imgSteam.toByteArray()); fileStream.close(); &#125; /** * freemarkeræ¸²æŸ“html */ public static String freeMarkerRender(Map&lt;String, Object&gt; data, String htmlTmp) &#123; Writer out = new StringWriter(); try &#123; // è·å–æ¨¡æ¿,å¹¶è®¾ç½®ç¼–ç æ–¹å¼ Template template = freemarkerCfg.getTemplate(htmlTmp); template.setEncoding(\"UTF-8\"); // åˆå¹¶æ•°æ®æ¨¡å‹ä¸æ¨¡æ¿ template.process(data, out); // å°†åˆå¹¶åçš„æ•°æ®å’Œæ¨¡æ¿å†™å…¥åˆ°æµä¸­ï¼Œè¿™é‡Œä½¿ç”¨çš„å­—ç¬¦æµ out.flush(); return out.toString(); &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; out.close(); &#125; catch (IOException ex) &#123; ex.printStackTrace(); &#125; &#125; return null; &#125; /** * æ ¹æ®æ¨¡æ¿ç”Ÿæˆpdfæ–‡ä»¶æµ */ public static ByteArrayOutputStream createPdf(String content) &#123; ByteArrayOutputStream outStream = new ByteArrayOutputStream(); ITextRenderer render = new ITextRenderer(); ITextFontResolver fontResolver = render.getFontResolver(); try &#123; fontResolver.addFont(FONT, BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED); &#125; catch (com.lowagie.text.DocumentException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; // è§£æhtmlç”Ÿæˆpdf render.setDocumentFromString(content); // è§£å†³å›¾ç‰‡ç›¸å¯¹è·¯å¾„çš„é—®é¢˜ render.getSharedContext().setBaseURL(LOGO_PATH); render.layout(); try &#123; render.createPDF(outStream); return outStream; &#125; catch (com.lowagie.text.DocumentException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; outStream.close(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; return null; &#125; /** * æ ¹æ®pdfäºŒè¿›åˆ¶æ–‡ä»¶ ç”Ÿæˆå›¾ç‰‡æ–‡ä»¶ * * @param bytes * pdfäºŒè¿›åˆ¶ * @param scaling * æ¸…æ™°åº¦ * @param pageNum * é¡µæ•° */ public static ByteArrayOutputStream pdfToImg(byte[] bytes, float scaling, int pageNum, String formatName) &#123; // æ¨èçš„æ–¹æ³•æ‰“å¼€PdfDecoder PdfDecoder pdfDecoder = new PdfDecoder(true); FontMappings.setFontReplacements(); // ä¿®æ”¹å›¾ç‰‡çš„æ¸…æ™°åº¦ pdfDecoder.scaling = scaling; ByteArrayOutputStream out = new ByteArrayOutputStream(); try &#123; // æ‰“å¼€pdfæ–‡ä»¶ï¼Œç”ŸæˆPdfDecoderå¯¹è±¡ pdfDecoder.openPdfArray(bytes); // bytes is byte[] array with PDF // è·å–ç¬¬pageNumé¡µçš„pdf BufferedImage img = pdfDecoder.getPageAsImage(pageNum); ImageIO.write(img, formatName, out); &#125; catch (PdfException e) &#123; e.printStackTrace(); &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; return out; &#125;&#125; è¾“å‡ºç»“æœ Jpedalæ”¯æŒå°†æŒ‡å®šé¡µPDFç”Ÿæˆå›¾ç‰‡ï¼ŒpdfDecoder.scalingè®¾ç½®å›¾ç‰‡çš„åˆ†è¾¨ç‡(ä¸åŒåˆ†è¾¨ç‡ä¸‹æ–‡ä»¶å¤§å°ä¸åŒ) ï¼Œæ”¯æŒå¤šç§å›¾ç‰‡æ ¼å¼ï¼Œå…·ä½“æ›´å¤šå¯è‡ªè¡Œç ”ç©¶ã€‚ æ€»ç»“å¯¹äºç”µå­å‡­è¯çš„æŠ€æœ¯æ–¹æ¡ˆï¼Œæ€»ç»“å¦‚ä¸‹: HTMLæ¨¡æ¿+modelæ•°æ®ï¼Œé€šè¿‡freemarkerè¿›è¡Œæ¸²æŸ“ï¼Œä¾¿äºç»´æŠ¤å’Œä¿®æ”¹ã€‚ æ¸²æŸ“åçš„HTMLæµï¼Œå¯é€šè¿‡Flying Saucerç»„ä»¶ç”ŸæˆHTMLæ–‡ä»¶æµï¼Œæˆ–è€…ç”ŸæˆHTMLåå†è½¬æˆjpgæ–‡ä»¶æµã€‚ åœ¨Webé¡¹ç›®ä¸­ï¼Œå¯¹åº”çš„æ–‡ä»¶æµï¼Œå¯ä»¥é€šè¿‡ContentTypeè®¾ç½®ï¼Œåœ¨çº¿æŸ¥çœ‹/ä¸‹è½½ï¼Œä¸éœ€é€šè¿‡é™„ä»¶æœåŠ¡ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"}]},{"title":"åˆ†å¸ƒå¼ä¸‹IDç”Ÿæˆç®—æ³• SnowFlake","slug":"åˆ†å¸ƒå¼ä¸‹IDç”Ÿæˆç®—æ³•-SnowFlake","date":"2017-10-30T06:26:21.000Z","updated":"2018-03-13T05:53:41.330Z","comments":true,"path":"2017/10/30/åˆ†å¸ƒå¼ä¸‹IDç”Ÿæˆç®—æ³•-SnowFlake/","link":"","permalink":"https://sunny0715.github.io/2017/10/30/åˆ†å¸ƒå¼ä¸‹IDç”Ÿæˆç®—æ³•-SnowFlake/","excerpt":"å¼•è¨€åœ¨åšç³»ç»Ÿå¼€å‘æ—¶ï¼Œç³»ç»Ÿå”¯ä¸€IDæ˜¯æˆ‘ä»¬åœ¨è®¾è®¡ä¸€ä¸ªç³»ç»Ÿçš„æ—¶å€™ç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œä¹Ÿå¸¸å¸¸ä¸ºè¿™ä¸ªé—®é¢˜çº ç»“ã€‚ç”ŸæˆIDçš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œé€‚åº”ä¸åŒçš„åœºæ™¯ã€éœ€æ±‚åŠæ€§èƒ½è¦æ±‚ã€‚æ‰€ä»¥æœ‰äº›æ¯”è¾ƒå¤æ‚çš„ç³»ç»Ÿä¼šæœ‰å¤šä¸ªIDç”Ÿæˆç­–ç•¥ã€‚åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹å¸¸ç”¨åˆ°çš„IDç”Ÿæˆç­–ç•¥ã€‚","text":"å¼•è¨€åœ¨åšç³»ç»Ÿå¼€å‘æ—¶ï¼Œç³»ç»Ÿå”¯ä¸€IDæ˜¯æˆ‘ä»¬åœ¨è®¾è®¡ä¸€ä¸ªç³»ç»Ÿçš„æ—¶å€™ç»å¸¸é‡åˆ°çš„é—®é¢˜ï¼Œä¹Ÿå¸¸å¸¸ä¸ºè¿™ä¸ªé—®é¢˜çº ç»“ã€‚ç”ŸæˆIDçš„æ–¹æ³•æœ‰å¾ˆå¤šï¼Œé€‚åº”ä¸åŒçš„åœºæ™¯ã€éœ€æ±‚åŠæ€§èƒ½è¦æ±‚ã€‚æ‰€ä»¥æœ‰äº›æ¯”è¾ƒå¤æ‚çš„ç³»ç»Ÿä¼šæœ‰å¤šä¸ªIDç”Ÿæˆç­–ç•¥ã€‚åœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹å¸¸ç”¨åˆ°çš„IDç”Ÿæˆç­–ç•¥ã€‚ æ•°æ®åº“è‡ªå¢é•¿åºåˆ—æˆ–å­—æ®µæœ€å¸¸è§çš„æ–¹å¼ï¼Œåˆ©ç”¨æ•°æ®åº“ï¼Œå…¨è¡¨ä¸­å”¯ä¸€ã€‚å¦‚MySQLçš„AUTO_INCREMENTã€‚ ä¼˜ç‚¹ ç®€å•ï¼Œä»£ç æ–¹ä¾¿ï¼Œæ€§èƒ½å¯ä»¥æ¥å—ã€‚ æ•°å­—IDå¤©ç„¶æ’åºï¼Œå¯¹åˆ†é¡µæˆ–è€…éœ€è¦æ’åºçš„ç»“æœå¾ˆæœ‰å¸®åŠ©ã€‚ ç¼ºç‚¹ ä¸åŒæ•°æ®åº“è¯­æ³•å’Œå®ç°ä¸åŒï¼Œæ•°æ®åº“è¿ç§»çš„æ—¶å€™æˆ–å¤šæ•°æ®åº“ç‰ˆæœ¬æ”¯æŒçš„æ—¶å€™éœ€è¦å¤„ç†ã€‚ åœ¨å•ä¸ªæ•°æ®åº“æˆ–è¯»å†™åˆ†ç¦»æˆ–ä¸€ä¸»å¤šä»çš„æƒ…å†µä¸‹ï¼Œåªæœ‰ä¸€ä¸ªä¸»åº“å¯ä»¥ç”Ÿæˆã€‚æœ‰å•ç‚¹æ•…éšœçš„é£é™©ã€‚ åœ¨æ€§èƒ½è¾¾ä¸åˆ°è¦æ±‚çš„æƒ…å†µä¸‹ï¼Œæ¯”è¾ƒéš¾äºæ‰©å±•ã€‚ å¦‚æœé‡è§å¤šä¸ªç³»ç»Ÿéœ€è¦åˆå¹¶æˆ–è€…æ¶‰åŠåˆ°æ•°æ®è¿ç§»ä¼šç›¸å½“ç—›è‹¦ã€‚ åˆ†è¡¨åˆ†åº“çš„æ—¶å€™ä¼šæœ‰éº»çƒ¦ã€‚ ä¼˜åŒ–æ–¹æ¡ˆé’ˆå¯¹ä¸»åº“å•ç‚¹ï¼Œå¦‚æœæœ‰å¤šä¸ªMasteråº“ï¼Œåˆ™æ¯ä¸ªMasteråº“è®¾ç½®çš„èµ·å§‹æ•°å­—ä¸ä¸€æ ·ï¼Œæ­¥é•¿ä¸€æ ·ï¼Œå¯ä»¥æ˜¯Masterçš„ä¸ªæ•°ã€‚æ¯”å¦‚ï¼šMaster1 ç”Ÿæˆçš„æ˜¯ 1, 4, 7, 10ï¼ŒMaster2ç”Ÿæˆçš„æ˜¯2, 5, 8, 11ï¼ŒMaster3ç”Ÿæˆçš„æ˜¯3, 6, 9, 12ã€‚è¿™æ ·å°±å¯ä»¥æœ‰æ•ˆç”Ÿæˆé›†ç¾¤ä¸­çš„å”¯ä¸€IDï¼Œä¹Ÿå¯ä»¥å¤§å¤§é™ä½IDç”Ÿæˆæ•°æ®åº“æ“ä½œçš„è´Ÿè½½ã€‚ UUIDå¸¸è§çš„æ–¹å¼ã€‚å¯ä»¥åˆ©ç”¨æ•°æ®åº“ä¹Ÿå¯ä»¥åˆ©ç”¨ç¨‹åºç”Ÿæˆï¼Œä¸€èˆ¬æ¥è¯´å…¨çƒå”¯ä¸€ã€‚ ä¼˜ç‚¹ ç®€å•ï¼Œä»£ç æ–¹ä¾¿ã€‚ ç”ŸæˆIDæ€§èƒ½éå¸¸å¥½ï¼ŒåŸºæœ¬ä¸ä¼šæœ‰æ€§èƒ½é—®é¢˜ã€‚ å…¨çƒå”¯ä¸€ï¼Œåœ¨é‡è§æ•°æ®è¿ç§»ï¼Œç³»ç»Ÿæ•°æ®åˆå¹¶ï¼Œæˆ–è€…æ•°æ®åº“å˜æ›´ç­‰æƒ…å†µä¸‹ï¼Œå¯ä»¥ä»å®¹åº”å¯¹ã€‚ ç¼ºç‚¹ æ²¡æœ‰æ’åºï¼Œæ— æ³•ä¿è¯è¶‹åŠ¿é€’å¢ã€‚ UUIDå¾€å¾€æ˜¯ä½¿ç”¨å­—ç¬¦ä¸²å­˜å‚¨ï¼ŒæŸ¥è¯¢çš„æ•ˆç‡æ¯”è¾ƒä½ã€‚ å­˜å‚¨ç©ºé—´æ¯”è¾ƒå¤§ï¼Œå¦‚æœæ˜¯æµ·é‡æ•°æ®åº“ï¼Œå°±éœ€è¦è€ƒè™‘å­˜å‚¨é‡çš„é—®é¢˜ã€‚ ä¼ è¾“æ•°æ®é‡å¤§ã€‚ ä¸å¯è¯»ã€‚ Twitter-SnowFlakeç®—æ³•æœ‰äº›æ—¶å€™æˆ‘ä»¬å¸Œæœ›èƒ½ä½¿ç”¨ç®€å•ä¸€äº›çš„ IDï¼Œå¹¶ä¸”å¸Œæœ› ID èƒ½å¤ŸæŒ‰ç…§æ—¶é—´æœ‰åºç”Ÿæˆï¼Œä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒTwitter å‘æ˜äº† SnowFlake ç®—æ³•ï¼Œä¸ä¾èµ–ç¬¬ä¸‰æ–¹ä»‹è´¨ä¾‹å¦‚ Redisã€æ•°æ®åº“ï¼Œæœ¬åœ°ç”Ÿæˆç¨‹åºç”Ÿæˆåˆ†å¸ƒå¼è‡ªå¢ IDï¼Œè¿™ä¸ª ID åªèƒ½ä¿è¯åœ¨å·¥ä½œç»„ä¸­çš„æœºå™¨ç”Ÿæˆçš„ ID å”¯ä¸€ï¼Œä¸èƒ½åƒ UUID é‚£æ ·ä¿è¯æ—¶ç©ºå”¯ä¸€ã€‚ ç®—æ³•åŸç† é™¤äº†æœ€é«˜ä½bitæ ‡è®°ä¸ºä¸å¯ç”¨ä»¥å¤–ï¼Œå…¶ä½™ä¸‰ç»„bitå ä½å‡å¯æµ®åŠ¨ï¼Œçœ‹å…·ä½“çš„ä¸šåŠ¡éœ€æ±‚è€Œå®šã€‚é»˜è®¤æƒ…å†µä¸‹41bitçš„æ—¶é—´æˆ³å¯ä»¥æ”¯æŒè¯¥ç®—æ³•ä½¿ç”¨åˆ°2082å¹´ï¼Œ10bitçš„å·¥ä½œæœºå™¨idå¯ä»¥æ”¯æŒ1023å°æœºå™¨ï¼Œåºåˆ—å·æ”¯æŒ1æ¯«ç§’äº§ç”Ÿ4095ä¸ªè‡ªå¢åºåˆ—idã€‚ SnowFlake â€“ æ—¶é—´æˆ³è¿™é‡Œæ—¶é—´æˆ³çš„ç»†åº¦æ˜¯æ¯«ç§’çº§ï¼Œå»ºè®®ä½¿ç”¨64ä½linuxç³»ç»Ÿæœºå™¨ï¼Œå› ä¸ºæœ‰vdsoï¼Œgettimeofday()åœ¨ç”¨æˆ·æ€å°±å¯ä»¥å®Œæˆæ“ä½œï¼Œå‡å°‘äº†è¿›å…¥å†…æ ¸æ€çš„æŸè€—ã€‚ SnowFake â€“ å·¥ä½œæœºå™¨IDä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´è¿™ä¸ªbitæ®µçš„ä½¿ç”¨å¯ä»¥æ˜¯è¿›ç¨‹çº§ï¼Œæœºå™¨çº§çš„è¯ä½ å¯ä»¥ä½¿ç”¨MACåœ°å€æ¥å”¯ä¸€æ ‡ç¤ºå·¥ä½œæœºå™¨ï¼Œå·¥ä½œè¿›ç¨‹çº§å¯ä»¥ä½¿ç”¨IP+Pathæ¥åŒºåˆ†å·¥ä½œè¿›ç¨‹ã€‚å¦‚æœå·¥ä½œæœºå™¨æ¯”è¾ƒå°‘ï¼Œå¯ä»¥ä½¿ç”¨é…ç½®æ–‡ä»¶æ¥è®¾ç½®è¿™ä¸ªidæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ï¼Œå¦‚æœæœºå™¨è¿‡å¤šé…ç½®æ–‡ä»¶çš„ç»´æŠ¤æ˜¯ä¸€ä¸ªç¾éš¾æ€§çš„äº‹æƒ…ã€‚ SnowFlake â€“ åºåˆ—å·åºåˆ—å·å°±æ˜¯ä¸€ç³»åˆ—çš„è‡ªå¢idï¼ˆå¤šçº¿ç¨‹å»ºè®®ä½¿ç”¨atomicï¼‰ï¼Œä¸ºäº†å¤„ç†åœ¨åŒä¸€æ¯«ç§’å†…éœ€è¦ç»™å¤šæ¡æ¶ˆæ¯åˆ†é…idï¼Œè‹¥åŒä¸€æ¯«ç§’æŠŠåºåˆ—å·ç”¨å®Œäº†ï¼Œåˆ™ â€œç­‰å¾…è‡³ä¸‹ä¸€æ¯«ç§’â€ã€‚ å…·ä½“å®ç°Sequenceç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197/** * Snowflake ç”Ÿæˆçš„ 64 ä½ long ç±»å‹çš„ IDï¼Œç»“æ„å¦‚ä¸‹:&lt;br&gt; * 0 - 0000000000 0000000000 0000000000 0000000000 0 - 00000 - 00000 - 000000000000 &lt;br&gt; * 1) 01 ä½æ ‡è¯†ï¼Œç”±äº long åœ¨ Java ä¸­æ˜¯æœ‰ç¬¦å·çš„ï¼Œæœ€é«˜ä½æ˜¯ç¬¦å·ä½ï¼Œæ­£æ•°æ˜¯ 0ï¼Œè´Ÿæ•°æ˜¯ 1ï¼ŒID ä¸€èˆ¬ä½¿ç”¨æ­£æ•°ï¼Œæ‰€ä»¥æœ€é«˜ä½æ˜¯ 0&lt;br&gt; * 2) 41 ä½æ—¶é—´æˆª(æ¯«ç§’çº§)ï¼Œæ³¨æ„ï¼Œ41 ä½æ—¶é—´æˆªä¸æ˜¯å­˜å‚¨å½“å‰æ—¶é—´çš„æ—¶é—´æˆªï¼Œè€Œæ˜¯å­˜å‚¨æ—¶é—´æˆªçš„å·®å€¼(å½“å‰æ—¶é—´ - å¼€å§‹æ—¶é—´)å¾—åˆ°çš„å€¼ï¼Œ * å¼€å§‹æ—¶é—´æˆªï¼Œä¸€èˆ¬æ˜¯ä¸šåŠ¡å¼€å§‹çš„æ—¶é—´ï¼Œç”±æˆ‘ä»¬ç¨‹åºæ¥æŒ‡å®šï¼Œå¦‚ SnowflakeIdWorker ä¸­çš„ startTimestamp å±æ€§ã€‚ * 41 ä½çš„æ—¶é—´æˆªï¼Œå¯ä»¥ä½¿ç”¨ 70 å¹´: (2^41)/(1000*60*60*24*365) = 69.7 å¹´&lt;br&gt; * 3) 10 ä½çš„æ•°æ®æœºå™¨ä½ï¼Œå¯ä»¥éƒ¨ç½²åœ¨ 1024 ä¸ªèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬ 5 ä½ datacenterId å’Œ 5 ä½ workerId&lt;br&gt; * 4) 12 ä½åºåˆ—ï¼Œæ¯«ç§’å†…çš„è®¡æ•°ï¼Œ12 ä½çš„è®¡æ•°é¡ºåºå·æ”¯æŒæ¯ä¸ªèŠ‚ç‚¹æ¯æ¯«ç§’(åŒä¸€æœºå™¨ï¼ŒåŒä¸€æ—¶é—´æˆª)äº§ç”Ÿ 4096 ä¸ª ID åºå·&lt;br&gt; * * SnowFlake çš„ä¼˜ç‚¹æ˜¯ï¼Œæ•´ä½“ä¸ŠæŒ‰ç…§æ—¶é—´è‡ªå¢æ’åºï¼Œå¹¶ä¸”æ•´ä¸ªåˆ†å¸ƒå¼ç³»ç»Ÿå†…ä¸ä¼šäº§ç”Ÿ ID ç¢°æ’(ç”±æ•°æ®ä¸­å¿ƒ ID å’Œæœºå™¨ ID ä½œåŒºåˆ†)ï¼Œå¹¶ä¸”æ•ˆç‡è¾ƒ é«˜ï¼Œç»æµ‹è¯•ï¼ŒSnowFlake æ¯ç§’èƒ½å¤Ÿäº§ç”Ÿçº¦ 26 ä¸‡ä¸ª IDã€‚ */public class Sequence &#123; /** å¼€å§‹æ—¶é—´æˆª */ private final long twepoch = 1288834974657L; /** æœºå™¨idæ‰€å çš„ä½æ•° */ private final long workerIdBits = 5L; /** æ•°æ®æ ‡è¯†idæ‰€å çš„ä½æ•° */ private final long datacenterIdBits = 5L; /** æ”¯æŒçš„æœ€å¤§æœºå™¨idï¼Œç»“æœæ˜¯31 (è¿™ä¸ªç§»ä½ç®—æ³•å¯ä»¥å¾ˆå¿«çš„è®¡ç®—å‡ºå‡ ä½äºŒè¿›åˆ¶æ•°æ‰€èƒ½è¡¨ç¤ºçš„æœ€å¤§åè¿›åˆ¶æ•°) */ private final long maxWorkerId = -1L ^ (-1L &lt;&lt; workerIdBits); /** æ”¯æŒçš„æœ€å¤§æ•°æ®æ ‡è¯†idï¼Œç»“æœæ˜¯31 */ private final long maxDatacenterId = -1L ^ (-1L &lt;&lt; datacenterIdBits); /** åºåˆ—åœ¨idä¸­å çš„ä½æ•° */ private final long sequenceBits = 12L; /** æœºå™¨IDå‘å·¦ç§»12ä½ */ private final long workerIdShift = sequenceBits; /** æ•°æ®æ ‡è¯†idå‘å·¦ç§»17ä½(12+5) */ private final long datacenterIdShift = sequenceBits + workerIdBits; /** æ—¶é—´æˆªå‘å·¦ç§»22ä½(5+5+12) */ private final long timestampLeftShift = sequenceBits + workerIdBits + datacenterIdBits; /** ç”Ÿæˆåºåˆ—çš„æ©ç ï¼Œè¿™é‡Œä¸º4095 (0b111111111111=0xfff=4095) */ private final long sequenceMask = -1L ^ (-1L &lt;&lt; sequenceBits); /** å·¥ä½œæœºå™¨ID(0~31) */ private long workerId; /** æ•°æ®ä¸­å¿ƒID(0~31) */ private long datacenterId; /** æ¯«ç§’å†…åºåˆ—(0~4095) */ private long sequence = 0L; /** ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª */ private long lastTimestamp = -1L; public Sequence() &#123; datacenterId = getDatacenterId(maxDatacenterId); workerId = getMaxWorkerId(datacenterId, maxWorkerId); &#125; public Sequence(long workerId, long datacenterId) &#123; if (workerId &gt; maxWorkerId || workerId &lt; 0) &#123; throw new IllegalArgumentException(String.format(\"worker Id can't be greater than %d or less than 0\", maxWorkerId)); &#125; if (datacenterId &gt; maxDatacenterId || datacenterId &lt; 0) &#123; throw new IllegalArgumentException(String.format(\"datacenter Id can't be greater than %d or less than 0\", maxDatacenterId)); &#125; this.workerId = workerId; this.datacenterId = datacenterId; &#125; /** * è·å– maxWorkerId * @param datacenterId æ•°æ®ä¸­å¿ƒid * @param maxWorkerId æœºå™¨id * @return maxWorkerId */ protected static long getMaxWorkerId(long datacenterId, long maxWorkerId) &#123; StringBuilder mpid = new StringBuilder(); mpid.append(datacenterId); String name = ManagementFactory.getRuntimeMXBean().getName(); if (name != null &amp;&amp; !\"\".equals(name)) &#123; // GET jvmPid mpid.append(name.split(\"@\")[0]); &#125; //MAC + PID çš„ hashcode è·å–16ä¸ªä½ä½ return (mpid.toString().hashCode() &amp; 0xffff) % (maxWorkerId + 1); &#125; /** * &lt;p&gt; * æ•°æ®æ ‡è¯†idéƒ¨åˆ† * &lt;/p&gt; * @param maxDatacenterId * @return */ protected static long getDatacenterId(long maxDatacenterId) &#123; long id = 0L; try &#123; InetAddress ip = InetAddress.getLocalHost(); NetworkInterface network = NetworkInterface.getByInetAddress(ip); if (network == null) &#123; id = 1L; &#125; else &#123; byte[] mac = network.getHardwareAddress(); if (null != mac) &#123; id = ((0x000000FF &amp; (long) mac[mac.length - 1]) | (0x0000FF00 &amp; (((long) mac[mac.length - 2]) &lt;&lt; 8))) &gt;&gt; 6; id = id % (maxDatacenterId + 1); &#125; &#125; &#125; catch (Exception e) &#123; System.err.println(\" getDatacenterId: \" + e.getMessage()); &#125; return id; &#125; /** * è·å¾—ä¸‹ä¸€ä¸ªID (è¯¥æ–¹æ³•æ˜¯çº¿ç¨‹å®‰å…¨çš„) * * @return nextId */ public synchronized long nextId() &#123; long timestamp = timeGen(); // å¦‚æœå½“å‰æ—¶é—´å°äºä¸Šä¸€æ¬¡IDç”Ÿæˆçš„æ—¶é—´æˆ³ï¼Œè¯´æ˜ç³»ç»Ÿæ—¶é’Ÿå›é€€è¿‡è¿™ä¸ªæ—¶å€™åº”å½“æŠ›å‡ºå¼‚å¸¸ if (timestamp &lt; lastTimestamp) &#123;// é—°ç§’ long offset = lastTimestamp - timestamp; if (offset &lt;= 5) &#123; try &#123; wait(offset &lt;&lt; 1); timestamp = timeGen(); if (timestamp &lt; lastTimestamp) &#123; throw new RuntimeException(String.format(\"Clock moved backwards. Refusing to generate id for %d milliseconds\", offset)); &#125; &#125; catch (Exception e) &#123; throw new RuntimeException(e); &#125; &#125; else &#123; throw new RuntimeException(String.format(\"Clock moved backwards. Refusing to generate id for %d milliseconds\", offset)); &#125; &#125; //$NON-NLS-è§£å†³è·¨æ¯«ç§’ç”ŸæˆIDåºåˆ—å·å§‹ç»ˆä¸ºå¶æ•°çš„ç¼ºé™·$ // å¦‚æœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ— if (lastTimestamp == timestamp) &#123; sequence = (sequence + 1) &amp; sequenceMask; // æ¯«ç§’å†…åºåˆ—æº¢å‡º if (sequence == 0) &#123; // é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,è·å¾—æ–°çš„æ—¶é—´æˆ³ timestamp = tilNextMillis(lastTimestamp); &#125; &#125; else &#123;// æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½® sequence = 0L; &#125; /** // å¦‚æœæ˜¯åŒä¸€æ—¶é—´ç”Ÿæˆçš„ï¼Œåˆ™è¿›è¡Œæ¯«ç§’å†…åºåˆ— if (lastTimestamp == timestamp) &#123; long old = sequence; sequence = (sequence + 1) &amp; sequenceMask; // æ¯«ç§’å†…åºåˆ—æº¢å‡º if (sequence == old) &#123; // é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’,è·å¾—æ–°çš„æ—¶é—´æˆ³ timestamp = tilNextMillis(lastTimestamp); &#125; &#125; else &#123;// æ—¶é—´æˆ³æ”¹å˜ï¼Œæ¯«ç§’å†…åºåˆ—é‡ç½® sequence = ThreadLocalRandom.current().nextLong(0, 2); &#125; **/ // ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª lastTimestamp = timestamp; // ç§»ä½å¹¶é€šè¿‡æˆ–è¿ç®—æ‹¼åˆ°ä¸€èµ·ç»„æˆ64ä½çš„ID return ((timestamp - twepoch) &lt;&lt; timestampLeftShift) // | (datacenterId &lt;&lt; datacenterIdShift) // | (workerId &lt;&lt; workerIdShift) // | sequence; &#125; /** * é˜»å¡åˆ°ä¸‹ä¸€ä¸ªæ¯«ç§’ï¼Œç›´åˆ°è·å¾—æ–°çš„æ—¶é—´æˆ³ * * @param lastTimestamp ä¸Šæ¬¡ç”ŸæˆIDçš„æ—¶é—´æˆª * @return å½“å‰æ—¶é—´æˆ³ */ protected long tilNextMillis(long lastTimestamp) &#123; long timestamp = timeGen(); while (timestamp &lt;= lastTimestamp) &#123; timestamp = timeGen(); &#125; return timestamp; &#125; /** * è¿”å›ä»¥æ¯«ç§’ä¸ºå•ä½çš„å½“å‰æ—¶é—´ * * @return å½“å‰æ—¶é—´(æ¯«ç§’) */ protected long timeGen() &#123; return SystemClock.now(); &#125;&#125; SystemClockç±»123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657/** * é«˜å¹¶å‘åœºæ™¯ä¸‹System.currentTimeMillis()çš„æ€§èƒ½é—®é¢˜çš„ä¼˜åŒ– * System.currentTimeMillis()çš„è°ƒç”¨æ¯”newä¸€ä¸ªæ™®é€šå¯¹è±¡è¦è€—æ—¶çš„å¤šï¼ˆå…·ä½“è€—æ—¶é«˜å‡ºå¤šå°‘æˆ‘è¿˜æ²¡æµ‹è¯•è¿‡ï¼Œæœ‰äººè¯´æ˜¯100å€å·¦å³ï¼‰&lt;p&gt; * System.currentTimeMillis()ä¹‹æ‰€ä»¥æ…¢æ˜¯å› ä¸ºå»è·Ÿç³»ç»Ÿæ‰“äº†ä¸€æ¬¡äº¤é“&lt;p&gt; * åå°å®šæ—¶æ›´æ–°æ—¶é’Ÿï¼ŒJVMé€€å‡ºæ—¶ï¼Œçº¿ç¨‹è‡ªåŠ¨å›æ”¶&lt;p&gt; * 10äº¿ï¼š43410,206,210.72815533980582%&lt;p&gt; * 1äº¿ï¼š4699,29,162.0344827586207%&lt;p&gt; * 1000ä¸‡ï¼š480,12,40.0%&lt;p&gt; * 100ä¸‡ï¼š50,10,5.0%&lt;p&gt; */public class SystemClock &#123; private final long period; private final AtomicLong now; private SystemClock(long period) &#123; this.period = period; this.now = new AtomicLong(System.currentTimeMillis()); scheduleClockUpdating(); &#125; private static class InstanceHolder &#123; public static final SystemClock INSTANCE = new SystemClock(1); &#125; private static SystemClock instance() &#123; return InstanceHolder.INSTANCE; &#125; private void scheduleClockUpdating() &#123; ScheduledExecutorService scheduler = Executors.newSingleThreadScheduledExecutor(new ThreadFactory() &#123; public Thread newThread(Runnable runnable) &#123; Thread thread = new Thread(runnable, \"System Clock\"); thread.setDaemon(true); return thread; &#125; &#125;); scheduler.scheduleAtFixedRate(new Runnable() &#123; public void run() &#123; now.set(System.currentTimeMillis()); &#125; &#125;, period, period, TimeUnit.MILLISECONDS); &#125; private long currentTimeMillis() &#123; return now.get(); &#125; public static long now() &#123; return instance().currentTimeMillis(); &#125; public static String nowDate() &#123; return new Timestamp(instance().currentTimeMillis()).toString(); &#125;&#125; æµ‹è¯•12345678910111213141516171819public class IdGen &#123; private static Sequence sequence = new Sequence(); /** * ä½¿ç”¨Sequenceç”Ÿæˆä¸»é”®ï¼Œåˆ©ç”¨Snowflakeç®—æ³• */ public static String sequenceId() &#123; long nextId = sequence.nextId(); return String.valueOf(nextId); &#125; //æµ‹è¯•ä»£ç  public static void main(String[] args) &#123; for (int i = 0; i &lt; 1000; i++) &#123; long id = sequenceId(); //System.out.println(Long.toBinaryString(id)); System.out.println(id); &#125;&#125; SnowFlakeç®—æ³•å¯ä»¥æ ¹æ®è‡ªèº«é¡¹ç›®çš„éœ€è¦è¿›è¡Œä¸€å®šçš„ä¿®æ”¹ã€‚æ¯”å¦‚ä¼°ç®—æœªæ¥çš„æ•°æ®ä¸­å¿ƒä¸ªæ•°ï¼Œæ¯ä¸ªæ•°æ®ä¸­å¿ƒçš„æœºå™¨æ•°ä»¥åŠç»Ÿä¸€æ¯«ç§’å¯ä»¥èƒ½çš„å¹¶å‘æ•°æ¥è°ƒæ•´åœ¨ç®—æ³•ä¸­æ‰€éœ€è¦çš„bitæ•°ã€‚ ä¼˜ç‚¹ ä¸ä¾èµ–äºæ•°æ®åº“ï¼Œçµæ´»æ–¹ä¾¿ï¼Œä¸”æ€§èƒ½ä¼˜äºæ•°æ®åº“ã€‚ IDæŒ‰ç…§æ—¶é—´åœ¨å•æœºä¸Šæ˜¯é€’å¢çš„ã€‚ ç¼ºç‚¹åœ¨å•æœºä¸Šæ˜¯é€’å¢çš„ï¼Œä½†æ˜¯ç”±äºæ¶‰åŠåˆ°åˆ†å¸ƒå¼ç¯å¢ƒï¼Œæ¯å°æœºå™¨ä¸Šçš„æ—¶é’Ÿä¸å¯èƒ½å®Œå…¨åŒæ­¥ï¼Œä¹Ÿè®¸æœ‰æ—¶å€™ä¹Ÿä¼šå‡ºç°ä¸æ˜¯å…¨å±€é€’å¢çš„æƒ…å†µã€‚ æ€»ç»“åœ¨é¡¹ç›®ä¸­SnowFlakeç®—æ³•ç”ŸæˆIDæ˜¯ç¬¬ä¸€é€‰æ‹©ï¼Œå…¼å…·æ€§èƒ½å’Œçµæ´»æ€§ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"mysql","slug":"mysql","permalink":"https://sunny0715.github.io/tags/mysql/"}]},{"title":"Javaå¤‡ä»½å’Œè¿˜åŸMySQLæ•°æ®åº“","slug":"Javaå¤‡ä»½å’Œè¿˜åŸMySQLæ•°æ®åº“","date":"2017-09-24T09:43:10.000Z","updated":"2018-03-13T05:48:49.262Z","comments":true,"path":"2017/09/24/Javaå¤‡ä»½å’Œè¿˜åŸMySQLæ•°æ®åº“/","link":"","permalink":"https://sunny0715.github.io/2017/09/24/Javaå¤‡ä»½å’Œè¿˜åŸMySQLæ•°æ®åº“/","excerpt":"å¼•è¨€â€‹ åœ¨é¡¹ç›®ä¸­ç»å¸¸ä¼šç”¨åˆ°Javaç¨‹åºå¤‡ä»½å’Œè¿˜åŸMySQLæ•°æ®åº“çš„å†…å®¹ï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œä½†ç¨‹åºä¹Ÿä¼šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼Œä¹±ç ç­‰ï¼‰ã€‚å®ç°ä¸Šéƒ½æ˜¯ç”¨Runtimeæ‰§è¡ŒMySQLçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç„¶åè¯»å†™IOæµæ•°æ®ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯ç”±äºä½¿ç”¨Javaçš„Runtimeæ¥å®ç°å¤‡ä»½è¿˜åŸåŠŸèƒ½ï¼Œè€Œç”±äºå¤§å®¶çš„è¿è¡Œæ—¶ç¯å¢ƒæœ‰å·®å¼‚æ‰å¯¼è‡´ä»£ç è¿è¡Œä¸æˆåŠŸã€‚åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹è‡ªå·±ä½¿ç”¨çš„å·¥å…·å’Œæ–¹æ³•ã€‚","text":"å¼•è¨€â€‹ åœ¨é¡¹ç›®ä¸­ç»å¸¸ä¼šç”¨åˆ°Javaç¨‹åºå¤‡ä»½å’Œè¿˜åŸMySQLæ•°æ®åº“çš„å†…å®¹ï¼Œéƒ½æ˜¯å¤§åŒå°å¼‚ï¼Œä½†ç¨‹åºä¹Ÿä¼šå‡ºç°å„ç§å„æ ·çš„é—®é¢˜ï¼ˆè¿è¡Œæ—¶å¼‚å¸¸ï¼Œä¹±ç ç­‰ï¼‰ã€‚å®ç°ä¸Šéƒ½æ˜¯ç”¨Runtimeæ‰§è¡ŒMySQLçš„å‘½ä»¤è¡Œå·¥å…·ï¼Œç„¶åè¯»å†™IOæµæ•°æ®ï¼›ä¹Ÿæœ‰å¯èƒ½æ˜¯ç”±äºä½¿ç”¨Javaçš„Runtimeæ¥å®ç°å¤‡ä»½è¿˜åŸåŠŸèƒ½ï¼Œè€Œç”±äºå¤§å®¶çš„è¿è¡Œæ—¶ç¯å¢ƒæœ‰å·®å¼‚æ‰å¯¼è‡´ä»£ç è¿è¡Œä¸æˆåŠŸã€‚åœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹è‡ªå·±ä½¿ç”¨çš„å·¥å…·å’Œæ–¹æ³•ã€‚ ä½¿ç”¨MySQLè‡ªå¸¦å·¥å…·å¤‡ä»½å¤‡ä»½ä½¿ç”¨MySQLçš„mysqldumpå‘½ä»¤æ¥å®ç°ï¼Œç¤ºä¾‹ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455final static Logger logger = LoggerFactory.getLogger(MySQLDatabaseBackupAndRestore.class); /** * Javaä»£ç å®ç°MySQLæ•°æ®åº“å¯¼å‡º * * @param hostIP MySQLæ•°æ®åº“æ‰€åœ¨æœåŠ¡å™¨åœ°å€IP * @param userName è¿›å…¥æ•°æ®åº“æ‰€éœ€è¦çš„ç”¨æˆ·å * @param password è¿›å…¥æ•°æ®åº“æ‰€éœ€è¦çš„å¯†ç  * @param savePath æ•°æ®åº“å¯¼å‡ºæ–‡ä»¶ä¿å­˜è·¯å¾„ * @param fileName æ•°æ®åº“å¯¼å‡ºæ–‡ä»¶æ–‡ä»¶å * @param databaseName è¦å¯¼å‡ºçš„æ•°æ®åº“å * @return è¿”å›trueè¡¨ç¤ºå¯¼å‡ºæˆåŠŸï¼Œå¦åˆ™è¿”å›falseã€‚ * @author maxu */ public static boolean backUpDatabase(String hostIP, String userName, String password, String databaseName, String savePath, String fileName) throws InterruptedException &#123; File saveFile = new File(savePath); if (!saveFile.exists()) &#123;// å¦‚æœç›®å½•ä¸å­˜åœ¨ saveFile.mkdirs();// åˆ›å»ºæ–‡ä»¶å¤¹ &#125; if (!savePath.endsWith(File.separator)) &#123; savePath = savePath + File.separator; &#125; PrintWriter printWriter = null; BufferedReader bufferedReader = null; try &#123; printWriter = new PrintWriter(new OutputStreamWriter(new FileOutputStream(savePath + fileName), \"utf8\")); Process process = Runtime.getRuntime().exec(\" D:\\\\DevTools\\\\MySQL\\\\MySQL5.7\\\\bin\\\\mysqldump.exe -h\" + hostIP + \" -u\" + userName + \" -p\" + password + \" --set-charset=UTF8 \" + databaseName); InputStreamReader inputStreamReader = new InputStreamReader(process.getInputStream(), \"utf8\"); bufferedReader = new BufferedReader(inputStreamReader); String line; while ((line = bufferedReader.readLine()) != null) &#123; printWriter.println(line); &#125; printWriter.flush(); if (process.waitFor() == 0) &#123;//0 è¡¨ç¤ºçº¿ç¨‹æ­£å¸¸ç»ˆæ­¢ã€‚ logger.info(\"æ•°æ®åº“å·²å¤‡ä»½åˆ°â€”â€”&gt;&gt;\" + savePath); return true; &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; finally &#123; try &#123; if (bufferedReader != null) &#123; bufferedReader.close(); &#125; if (printWriter != null) &#123; printWriter.close(); &#125; &#125; catch (IOException e) &#123; e.printStackTrace(); &#125; &#125; return false; &#125; è¿˜åŸ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162 final static Logger logger = LoggerFactory.getLogger(MySQLDatabaseBackupAndRestore.class); /** * Javaä»£ç å®ç°MySQLæ•°æ®åº“è¿˜åŸ * * @param hostIP MySQLæ•°æ®åº“æ‰€åœ¨æœåŠ¡å™¨åœ°å€IP * @param userName è¿›å…¥æ•°æ®åº“æ‰€éœ€è¦çš„ç”¨æˆ·å * @param password è¿›å…¥æ•°æ®åº“æ‰€éœ€è¦çš„å¯†ç  * @param path éœ€è¦è¿˜åŸæ•°æ®åº“æ–‡ä»¶çš„è·¯å¾„ * @param fileName éœ€è¦è¿˜åŸæ•°æ®åº“æ–‡ä»¶çš„åç§° * @param databaseName éœ€è¦è¿˜åŸçš„æ•°æ®åº“åç§° * @return è¿”å›trueè¡¨ç¤ºè¿˜åŸæˆåŠŸï¼Œå¦åˆ™è¿”å›falseã€‚ */ public static boolean restoreDatabase(String hostIP, String userName, String password, String databaseName, String path, String fileName) throws InterruptedException &#123; OutputStream out = null; BufferedReader br = null; PrintStream ps = null; try &#123; // è°ƒç”¨mysqlçš„cmd:cmdå‘½ä»¤åœ¨åå°æ‰§è¡Œï¼Œæ²¡æœ‰å‘½ä»¤çª—å£å‡ºç°æˆ–è€…ä¸€é—ªè€Œè¿‡çš„æƒ…å†µ Process process = Runtime.getRuntime().exec(\"cmd /c start /b D:\\\\DevTools\\\\MySQL\\\\MySQL5.7\\\\bin\\\\mysql -h\" + hostIP + \" -u\" + userName + \" -p\" + password + \" --default-character-set=utf8 \" + databaseName); out = process.getOutputStream();//æ§åˆ¶å°çš„è¾“å…¥ä¿¡æ¯ä½œä¸ºè¾“å‡ºæµ StringBuffer sb = new StringBuffer(\"\"); br = new BufferedReader(new InputStreamReader(new FileInputStream(path + fileName), \"utf8\")); String outStr; String line; while ((line = br.readLine()) != null) &#123; sb.append(line + \"\\r\\n\"); &#125; outStr = sb.toString(); ps = new PrintStream(out, true, \"utf8\"); ps.write(outStr.getBytes());// OutputStreamWriter writer = new OutputStreamWriter(out, \"utf8\");// writer.write(outStr); // æ³¨ï¼šè¿™é‡Œå¦‚æœç”¨ç¼“å†²æ–¹å¼å†™å…¥æ–‡ä»¶çš„è¯ï¼Œä¼šå¯¼è‡´ä¸­æ–‡ä¹±ç ï¼Œç”¨flush()æ–¹æ³•åˆ™å¯ä»¥é¿å…// writer.flush();// writer.close(); if (process.waitFor() == 0) &#123; //0 è¡¨ç¤ºçº¿ç¨‹æ­£å¸¸ç»ˆæ­¢ã€‚ return true; &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); return false; &#125; finally &#123; try &#123; if (ps != null) &#123; ps.close(); &#125; if (br != null) &#123; br.close(); &#125; if (out != null)&#123; out.close(); &#125; &#125; catch (IOException e1) &#123; e1.printStackTrace(); &#125; &#125; return false;&#125; æµ‹è¯• 1234567891011121314151617181920212223public static void main(String[] args)&#123; //æ•°æ®åº“å¤‡ä»½ /*try &#123; if (backUpDatabase(\"localhost\", \"root\", \"root\", \"taotao\", \"D:/\", \"taotao.sql\")) &#123; logger.info(\"æ•°æ®åº“æˆåŠŸå¤‡ä»½ï¼ï¼\"); &#125; else &#123; logger.info(\"æ•°æ®åº“å¤‡ä»½å¤±è´¥ï¼ï¼\"); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125;*/ //æ•°æ®åº“æ¢å¤ try &#123; if (restoreDatabase(\"localhost\", \"root\", \"root\", \"taotao\", \"D:/\", \"taotao.sql\")) &#123; logger.info(\"æ•°æ®åº“æ¢å¤æˆåŠŸï¼ï¼\"); &#125; else &#123; logger.info(\"æ•°æ®åº“æ¢å¤å¤±è´¥ï¼ï¼\"); &#125; &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; ä»£ç ä¸‹è½½ç‚¹å‡»ï¼šä¸‹è½½ Windowsä¸‹batå‘½ä»¤å·¥ä½œç¯å¢ƒ Windows Server 2003 ï¼ŒMySQLå®‰è£…ç›®å½• D:\\DevTools\\MySQL , WinRAR å®‰è£…ç›®å½• C:\\Program Files\\WinRAR\\WinRAR.exe å¤‡ä»½æ•°æ®å­˜å‚¨çš„è·¯å¾„ä¸º D:\\æ•°æ®å¤‡ä»½ï¼Œå¥½äº†ä¸‹é¢å¼€å§‹å†™DOSæ‰¹å¤„ç†å‘½ä»¤äº†ã€‚ä»£ç å¦‚ä¸‹: 123456789101112131415color 9rem ---------------------æ•°æ®åº“å¤‡ä»½å¼€å§‹-----------------------@echo offset \"Ymd=%DATE:~0,4%%DATE:~5,2%%DATE:~8,2%%TIME:~0,2%%TIME:~3,2%%TIME:~6,2%\" REM æ—¥æœŸæ ¼å¼ï¼š20170924200727 md \"D:\\%ymd%\" \"D:\\DevTools\\MySQL\\MySQL5.7\\bin\\mysqldump.exe\" --opt -Q taotao -uroot -proot &gt; D:\\%Ymd%\\taotao.sqlREM ..... è¿™é‡Œå¯ä»¥æ·»åŠ æ›´å¤šçš„å‘½ä»¤ï¼Œè¦çœ‹ä½ æœ‰å¤šå°‘ä¸ªæ•°æ®åº“ï¼Œå…¶ä¸­ -Q åé¢æ˜¯æ•°æ®åº“åç§° -pç´§è·Ÿåé¢æ˜¯å¯†ç REM echo Winrar loading... REM \"C:\\Program Files\\WinRAR\\WinRAR.exe\" a -ep1 -r -o+ -m5 -df \"D:\\æ•°æ®å¤‡ä»½\\%Ymd%.rar\" \"D:\\æ•°æ®å¤‡ä»½\\%Ymd%\" @echo onrem ---------------------æ•°æ®åº“å¤‡ä»½å®Œæˆ-----------------------pause æŠŠä¸Šé¢çš„å‘½ä»¤ä¿å­˜ä¸º backup.bat ï¼ŒåŒå‡»è¿è¡Œï¼Œå°±å¼€å§‹å¤‡ä»½æ•°æ®äº†ã€‚ ç¬¬ ä¸€å¥æ˜¯å»ºç«‹ä¸€ä¸ªå˜é‡ %Ymd% ï¼Œé€šè¿‡ %date% è¿™ä¸ªç³»ç»Ÿå˜é‡å¾—åˆ°æ—¥æœŸï¼Œ%date:~,4% è¡¨ç¤ºå–æ—¥æœŸçš„å‰é¢4ä¸ªå­—ç¬¦å°±æ˜¯å¹´ä»½ï¼Œ%%date:~5,2% è¡¨ç¤ºå–æ—¥æœŸç¬¬5ä¸ªå­—ç¬¦å¼€å§‹çš„2ä¸ªå­—ç¬¦å°±æ˜¯æœˆä»½ï¼Œ%date:~8,2% è¿™ä¸ªå°±æ˜¯æ—¥æœŸå·æ•°ï¼Œå¦‚ 2017-09-24 è¿™ä¸ªæ—¥æœŸæœ€åå¾—åˆ°çš„ç»“æœæ˜¯ 20170924 ç¬¬äºŒå¥å°±æ˜¯ä½¿ç”¨å˜é‡ %Ymd% çš„å€¼å»ºç«‹ä¸€ä¸ªç©ºçš„æ–‡ä»¶å¤¹ã€‚ ç¬¬ä¸‰å¥å¼€å§‹å°±æ˜¯ä½¿ç”¨MySQLçš„å‘½ä»¤å¯¹æ•°æ®åº“mysqlè¿›è¡Œå¤‡ä»½ï¼Œå¹¶å­˜å‚¨åœ¨ D:\\æ•°æ®å¤‡ä»½\\%ymd% è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹é¢ï¼Œè¿™é‡Œå¯ä»¥æœ‰å¾ˆå¤šç±»ä¼¼çš„å‘½ä»¤ï¼Œå¤‡ä»½å¤šä¸ªæ•°æ®åº“ã€‚ æœ€åå°±æ˜¯ä½¿ç”¨ WinRAR å¯¹å¤‡ä»½çš„æ•°æ®è¿›è¡Œå‹ç¼©ï¼Œå¹¶å­˜å‚¨ä¸ºä»¥ %Ymd% å˜é‡å€¼å»ºç«‹çš„RARæ–‡ä»¶åï¼ŒåŒæ—¶åˆ é™¤å¤‡ä»½çš„ %Ymd% ç›®å½•ã€‚ å¦‚æœä½ æƒ³è®©ç³»ç»Ÿè‡ªåŠ¨å®šæœŸå¤‡ä»½ï¼Œå°±å¯ä»¥é€šè¿‡ç³»ç»Ÿçš„ä»»åŠ¡è®¡åˆ’å®šæœŸæ‰§è¡Œè¿™ä¸ªå‘½ä»¤ã€‚ ä½†æ˜¯ç”¨windowsä¸‹batå‘½ä»¤å¤‡ä»½æœ‰ä¸€ä¸ªè‡´å‘½ç¼ºç‚¹ï¼šå¤‡ä»½æ—¶æ•°æ®åº“ä¼šæš‚æ—¶æ–­å¼€ã€‚(30Mæ–­å¼€5så·¦å³) æ€»ç»“ç¬¬äºŒç§æ–¹å¼çš„ç¼ºç‚¹å¤ªè‡´å‘½ï¼šå¤‡ä»½æ—¶æ•°æ®åº“ä¼šæš‚æ—¶æ–­å¼€ã€‚ æ‰€ä»¥ç¬¬ä¸€ç§æ–¹å¼å°†ä¼šæ˜¯æˆ‘ä»¬åœ¨å¼€å‘ä¸­é¦–é€‰çš„æ–¹å¼ï¼Œå› ä¸ºç¬¬äºŒç§æ–¹å¼çš„ç¼ºç‚¹å¯¹ç”¨æˆ·ä½“éªŒçš„å½±å“å¤ªå¤§äº†ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"mysql","slug":"mysql","permalink":"https://sunny0715.github.io/tags/mysql/"}]},{"title":"ç³»ç»Ÿä¸­åŠŸèƒ½ç‚¹çš„ç‰ˆæœ¬æ§åˆ¶","slug":"ç³»ç»Ÿä¸­åŠŸèƒ½ç‚¹çš„ç‰ˆæœ¬æ§åˆ¶","date":"2017-09-21T10:40:41.000Z","updated":"2018-03-13T05:55:03.365Z","comments":true,"path":"2017/09/21/ç³»ç»Ÿä¸­åŠŸèƒ½ç‚¹çš„ç‰ˆæœ¬æ§åˆ¶/","link":"","permalink":"https://sunny0715.github.io/2017/09/21/ç³»ç»Ÿä¸­åŠŸèƒ½ç‚¹çš„ç‰ˆæœ¬æ§åˆ¶/","excerpt":"å¼•è¨€â€‹ å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¼šä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå¦‚SVNã€Gitç­‰ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€æ ·ä¼šé‡åˆ°ä¸€ç§æƒ…å½¢ï¼šåœ¨ä¸€å¥—è¯•é¢˜ç³»ç»Ÿä¸­ï¼Œæœ‰æ–°å»ºé¢˜ç›®ã€ç¼–è¾‘é¢˜ç›®ã€åˆ é™¤é¢˜ç›®ç­‰åŠŸèƒ½ï¼Œä¸”é¢˜ç›®å¯ä»¥è¢«å¤šä¸ªäººä¿®æ”¹ï¼Œæ¯äººä¿®æ”¹ä¸€æ¬¡å³æ˜¯ä¸€ä¸ªç‰ˆæœ¬ã€‚ç°åœ¨çš„éœ€æ±‚å°±æ˜¯éœ€è¦è®°å½•æ¯ä¸€æ¬¡ä¿®æ”¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯æ¬¡ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ï¼Œç”šè‡³è¿˜å¯ä»¥ç‰ˆæœ¬å›æ»šã€‚ â€‹ ä¾‹å¦‚é¢˜ç›®ç¼–å·ä¸º20170919170800000061çš„é¢˜ç›®è¢«Aåˆ›å»ºï¼Œä¾æ¬¡è¢«Bã€Cã€Då„ä¿®æ”¹äº†ä¸€æ¬¡ï¼Œæ­¤æ—¶éœ€è¦æ¯”è¾ƒBå’ŒAé—´çš„å·®å¼‚ã€Cå’ŒBé—´çš„å·®å¼‚ã€Då’ŒCé—´çš„å·®å¼‚ï¼Œåˆ°æœ€åå®¡æ ¸é˜¶æ®µå¦‚æœB çš„ç‰ˆæœ¬æ¯”è¾ƒç¬¦åˆï¼Œåˆ™éœ€è¦æŠŠè¯•é¢˜ç‰ˆæœ¬å†…å®¹å›æ»šåˆ°Bç‰ˆæœ¬ä½œä¸ºæœ€åçš„ç‰ˆæœ¬ã€‚","text":"å¼•è¨€â€‹ å¼€å‘è¿‡ç¨‹ä¸­æˆ‘ä»¬ä¼šä½¿ç”¨ç‰ˆæœ¬æ§åˆ¶å·¥å…·ï¼Œå¦‚SVNã€Gitç­‰ã€‚ä½†æ˜¯æˆ‘ä»¬ä¸€æ ·ä¼šé‡åˆ°ä¸€ç§æƒ…å½¢ï¼šåœ¨ä¸€å¥—è¯•é¢˜ç³»ç»Ÿä¸­ï¼Œæœ‰æ–°å»ºé¢˜ç›®ã€ç¼–è¾‘é¢˜ç›®ã€åˆ é™¤é¢˜ç›®ç­‰åŠŸèƒ½ï¼Œä¸”é¢˜ç›®å¯ä»¥è¢«å¤šä¸ªäººä¿®æ”¹ï¼Œæ¯äººä¿®æ”¹ä¸€æ¬¡å³æ˜¯ä¸€ä¸ªç‰ˆæœ¬ã€‚ç°åœ¨çš„éœ€æ±‚å°±æ˜¯éœ€è¦è®°å½•æ¯ä¸€æ¬¡ä¿®æ”¹çš„è¯¦ç»†ä¿¡æ¯ï¼Œæ¯æ¬¡ç‰ˆæœ¬ä¹‹é—´çš„å·®å¼‚ï¼Œç”šè‡³è¿˜å¯ä»¥ç‰ˆæœ¬å›æ»šã€‚ â€‹ ä¾‹å¦‚é¢˜ç›®ç¼–å·ä¸º20170919170800000061çš„é¢˜ç›®è¢«Aåˆ›å»ºï¼Œä¾æ¬¡è¢«Bã€Cã€Då„ä¿®æ”¹äº†ä¸€æ¬¡ï¼Œæ­¤æ—¶éœ€è¦æ¯”è¾ƒBå’ŒAé—´çš„å·®å¼‚ã€Cå’ŒBé—´çš„å·®å¼‚ã€Då’ŒCé—´çš„å·®å¼‚ï¼Œåˆ°æœ€åå®¡æ ¸é˜¶æ®µå¦‚æœB çš„ç‰ˆæœ¬æ¯”è¾ƒç¬¦åˆï¼Œåˆ™éœ€è¦æŠŠè¯•é¢˜ç‰ˆæœ¬å†…å®¹å›æ»šåˆ°Bç‰ˆæœ¬ä½œä¸ºæœ€åçš„ç‰ˆæœ¬ã€‚ ä»”ç»†åˆ†æä¸€ä¸‹é¢˜å¹²ï¼Œæˆ‘ä»¬çš„éœ€æ±‚æ˜¯1.æ¯”è¾ƒç‰ˆæœ¬çš„å·®å¼‚ï¼Œ2.ç‰ˆæœ¬çš„å›æ»šã€‚ä¹‹å‰æœ‰è€ƒè™‘è¿‡ä¸¤ç§æ–¹æ¡ˆï¼š ä¿®æ”¹æ—¶åœ¨å‰ç«¯è¿›è¡Œæ¯”è¾ƒï¼Œåªè®°å½•ç‰ˆæœ¬çš„å·®å¼‚ï¼Œåå°åªéœ€è¦è¿›è¡Œå­˜å–å³å¯ã€‚ æŠŠæ‰€æœ‰ç‰ˆæœ¬ä¿¡æ¯å…¨éƒ¨å­˜å‚¨åœ¨æ•°æ®åº“ï¼Œåœ¨è¯·æ±‚æ—¶åå°è¿›è¡Œæ¯”è¾ƒå·®å¼‚ã€‚ ç¬¬ä¸€ç§æ–¹æ¡ˆå¸¦æ¥çš„é—®é¢˜æ˜¯æ²¡æ³•è¿›è¡Œç‰ˆæœ¬å›æ»šï¼Œåªè®°å½•ä¸‹æ¥äº†å·®å¼‚ï¼Œå›æ»šæ—¶å°†ä¼šæ˜¯ç¾éš¾ï¼Œé‚£ä¹ˆç¬¬äºŒç§æ–¹æ¡ˆæ‰æ˜¯è¾ƒåˆé€‚çš„é€‰æ‹©ã€‚ ä¸‹å›¾æ˜¯æ•°æ®åº“ä¸­çš„ç‰ˆæœ¬ä¿®æ”¹è®°å½• é¢˜ç›®çš„æ‰€æœ‰ä¿¡æ¯å…¨éƒ¨å­˜å‚¨åœ¨itemJsonä¸­ï¼Œæ¯”è¾ƒç‰ˆæœ¬é—´çš„å·®å¼‚å³æ˜¯æ¯”è¾ƒç‰ˆæœ¬é—´çš„itemJsonï¼Œç°åœ¨çš„ç›®æ ‡å°±æ˜¯è¦æå–ä¸¤ä¸ªç‰ˆæœ¬ä¸­itemJsonä¸­çš„å·®å¼‚ã€‚ é€šè¿‡ä»ç½‘ä¸ŠæŸ¥æ‰¾èµ„æ–™æ‰¾åˆ°äº†ä¸¤ç§æ¯”è¾ƒåˆé€‚çš„æ–¹æ³•ï¼Œå€¼å¾—å€Ÿé‰´ä¸€ä¸‹ã€‚ ç‰ˆæœ¬å·®å¼‚ï¼ˆæ¯”è¾ƒJsonçš„æ–¹æ³•ï¼‰è®¡è¾ƒä¸¤ä¸ªJson(Xï¼ŒY)ï¼Œå…¶ä¸­å¯èƒ½æƒ…å†µï¼š Xå’ŒYä¸­å‡æœ‰ç›¸åŒå­—æ®µ Xä¸­å­˜åœ¨Yä¸­ä¸å­˜åœ¨çš„å­—æ®µ Yä¸­å­˜åœ¨Xä¸­ä¸å­˜åœ¨çš„å­—æ®µ éœ€è¦æŒæ¡ï¼š å„ä¸ªå­—æ®µçš„ç”¨å¤„å’Œæ„ä¹‰ å­—æ®µåœ¨Mapã€Jsonã€JavaBeanã€Listã€JsonStringå½¢æ€ä¹‹é—´çš„è½¬æ¢ é€šè¿‡Mapé—´æ¥æ¯”è¾ƒå¼•å…¥Mavenä¾èµ–123456789101112131415&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.9.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-annotations&lt;/artifactId&gt; &lt;version&gt;2.9.1&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;com.google.guava&lt;/groupId&gt; &lt;artifactId&gt;guava&lt;/artifactId&gt; &lt;version&gt;23.0&lt;/version&gt;&lt;/dependency&gt; å®šä¹‰é™æ€å·¥å…·ç±»123456789101112131415//å¤„ç†jsonå­—ç¬¦ä¸²public static &lt;T&gt; T readJsonToObject(String jsonString, TypeReference&lt;T&gt; tr) &#123; ObjectMapper objectMapper = new ObjectMapper(); if (jsonString == null || \"\".equals(jsonString)) &#123; return null; &#125; else &#123; try &#123; return (T) objectMapper.readValue(jsonString, tr); &#125; catch (Exception e) &#123; logger.debug(\"json error:\" + e); &#125; &#125; return null;&#125; å®šä¹‰Mapæ¯”è¾ƒçš„å·¥å…·ç±»â€‹ é€šè¿‡googleçš„guavaè¡¨è¾¾å¼ä¸­çš„ Maps.difference(map1,map2)æ–¹æ³•è¿›è¡Œæ¯”è¾ƒï¼Œå•æ­¤æ–¹æ³•å¯æ¯”è¾ƒæ­£å¸¸çš„Mapå’ŒStringå†…å®¹ï¼Œå¯¹äºListæ–¹å¼çš„æ¯”è¾ƒï¼ŒåŒæ—¶è¿›è¡Œäº†æ•°å€¼å’Œlistå†…å®¹é¡ºåºçš„æ¯”è¾ƒï¼Œæ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„åŒ¹é…è§„åˆ™ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å¯¹è¿™ä¸ªæ–¹æ³•é…åˆListçš„containAllæ–¹æ³•è¿›ä¸€æ­¥åšå°è£…ã€‚ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495public static List&lt;Map&lt;String, String&gt;&gt; compareMap(Map&lt;String, Object&gt; oldVersion, Map&lt;String, Object&gt; newVersion) &#123; MapDifference&lt;String, Object&gt; difference = Maps.difference(oldVersion, newVersion); // è·å–æ‰€æœ‰ä¸åŒç‚¹ Map&lt;String, MapDifference.ValueDifference&lt;Object&gt;&gt; differenceMap = difference.entriesDiffering(); List&lt;Map&lt;String, String&gt;&gt; result = new ArrayList&lt;&gt;(); Iterator diffIterator = differenceMap.entrySet().iterator(); while (diffIterator.hasNext()) &#123; Map.Entry entry = (java.util.Map.Entry) diffIterator.next(); MapDifference.ValueDifference&lt;Object&gt; valueDifference = (MapDifference.ValueDifference&lt;Object&gt;) entry .getValue(); boolean isList = valueDifference.leftValue() instanceof List &amp;&amp; valueDifference.rightValue() instanceof List; boolean isMap = valueDifference.leftValue() instanceof Map &amp;&amp; valueDifference.rightValue() instanceof Map; if (!isList &amp;&amp; !isMap) &#123; Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); String fieldKey = String.valueOf(entry.getKey()); // é€‰æ‹©é¢˜ä¸­é€‰é¡¹å†…å®¹æ”¹å˜ if (oldVersion.get(\"content\") != null &amp;&amp; oldVersion.get(\"name\") != null) &#123; map.put(\"fieldName\", judgeOption(oldVersion.get(\"name\").toString())); &#125; else &#123; map.put(\"fieldName\", judgeFiledName(fieldKey)); &#125; map.put(\"fieldKey\", fieldKey); map.put(\"oldValue\", judgeFiledKey(fieldKey, valueDifference.leftValue().toString())); map.put(\"newValue\", judgeFiledKey(fieldKey, valueDifference.rightValue().toString())); result.add(map); &#125; // å¤„ç†ç»“æœæ˜¯å¦ä¸ºList,åˆ™é€’å½’æ‰§è¡Œæ¯”è¾ƒè§„åˆ™ if (valueDifference.leftValue() instanceof List &amp;&amp; valueDifference.rightValue() instanceof List) &#123; JSONArray j = JSONArray.parseArray(JSON.toJSONString(valueDifference.leftValue())); JSONArray p = JSONArray.parseArray(JSON.toJSONString(valueDifference.rightValue())); JSONObject js = new JSONObject(); JSONObject js1 = new JSONObject(); for (int i = 0; i &lt; j.size(); i++) &#123; js.put(i + \"\", j.get(i)); &#125; for (int i = 0; i &lt; p.size(); i++) &#123; js1.put(i + \"\", p.get(i)); &#125; Map&lt;String, Object&gt; requestMap = JsonUtils.readJsonToObject(js.toString(), new TypeReference&lt;Map&lt;String, Object&gt;&gt;() &#123; &#125;); Map&lt;String, Object&gt; requestMap1 = JsonUtils.readJsonToObject(js1.toString(), new TypeReference&lt;Map&lt;String, Object&gt;&gt;() &#123; &#125;); List&lt;Map&lt;String, String&gt;&gt; m = compareMap(requestMap, requestMap1); //å½“ä¿®æ”¹å¤šä¸ªé€‰é¡¹ for (int i = 0; i &lt; m.size(); i++) &#123; result.add(compareMap(requestMap, requestMap1).get(i)); &#125; &#125; // å¤„ç†ç»“æœæ˜¯å¦ä¸ºMap,åˆ™é€’å½’æ‰§è¡Œæ¯”è¾ƒè§„åˆ™ if (valueDifference.leftValue() instanceof Map &amp;&amp; valueDifference.rightValue() instanceof Map) &#123; result.add(compareMap((Map&lt;String, Object&gt;) valueDifference.leftValue(), (Map&lt;String, Object&gt;) valueDifference.rightValue()).get(0)); &#125; &#125; // è‹¥Aä¸­æœ‰Bä¸­ä¸å­˜åœ¨çš„å€¼ Map&lt;String, Object&gt; entriesOnlyOnLeft = difference.entriesOnlyOnLeft(); if (entriesOnlyOnLeft != null &amp;&amp; !entriesOnlyOnLeft.isEmpty()) &#123; Iterator it = entriesOnlyOnLeft.entrySet().iterator(); while (it.hasNext()) &#123; Map.Entry&lt;String, String&gt; entry = (java.util.Map.Entry) it.next(); Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); String fieldKey = entry.getKey(); map.put(\"fieldKey\", fieldKey); map.put(\"fieldName\", judgeFiledName(fieldKey)); map.put(\"oldValue\", judgeFiledKey(fieldKey, String.valueOf(entry.getValue()))); map.put(\"newValue\", \"\"); result.add(map); &#125; &#125; // è‹¥Bä¸­æœ‰Aä¸­ä¸å­˜åœ¨çš„å€¼ Map&lt;String, Object&gt; onlyOnRightMap = difference.entriesOnlyOnRight(); if (onlyOnRightMap != null &amp;&amp; !onlyOnRightMap.isEmpty()) &#123; Iterator it = onlyOnRightMap.entrySet().iterator(); while (it.hasNext()) &#123; Map.Entry&lt;String, String&gt; entry = (java.util.Map.Entry) it.next(); Map&lt;String, String&gt; map = new HashMap&lt;&gt;(); String fieldKey = String.valueOf(entry.getKey()); map.put(\"fieldKey\", fieldKey); map.put(\"fieldName\", judgeFiledName(fieldKey)); map.put(\"oldValue\", \"\"); map.put(\"newValue\", judgeFiledKey(fieldKey, String.valueOf(entry.getValue()))); result.add(map); &#125; &#125; return result; &#125; å®šä¹‰é™æ€è°ƒç”¨æ–¹æ³•1234567public static List&lt;Map&lt;String, String&gt;&gt; compareJSON(String jsonOld, String jsonNew) &#123; Map&lt;String, Object&gt; oldVersion = JsonUtils.readJsonToObject(jsonOld, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() &#123; &#125;); Map&lt;String, Object&gt; newVersion = JsonUtils.readJsonToObject(jsonNew, new TypeReference&lt;Map&lt;String, Object&gt;&gt;() &#123; &#125;); return compareMap(oldVersion, newVersion); &#125; è¿”å›ç»“æœç»è¿‡å¤„ç†åçš„è¿”å›ç»“æœ 1234567891011121314151617181920212223242526272829303132333435363738[ &#123; \"newValue\": \"10\", \"fieldName\": \"åˆ†æ•°\", \"fieldKey\": \"score\", \"oldValue\": \"8\" &#125;, &#123; \"newValue\": \"10\", \"fieldName\": \"æ•™æä¾æ®\", \"fieldKey\": \"teachingMaterialBasis\", \"oldValue\": \"2\" &#125;, &#123; \"newValue\": \"2\", \"fieldName\": \"å¤§çº²ä¾æ®\", \"fieldKey\": \"syllabusBasis\", \"oldValue\": \"1\" &#125;, &#123; \"newValue\": \"1.0\", \"fieldName\": \"éš¾åº¦ç³»æ•°\", \"fieldKey\": \"difficult\", \"oldValue\": \"0.4\" &#125;, &#123; \"newValue\": \"æŒæ¡\", \"fieldName\": \"èƒ½åŠ›å±‚æ¬¡\", \"fieldKey\": \"abilityLevel\", \"oldValue\": \"ç†Ÿæ‚‰\" &#125;, &#123; \"newValue\": \"æµ‹è¯•å…³é”®è¯\", \"fieldName\": \"å…³é”®å­—\", \"fieldKey\": \"keyWord\", \"oldValue\": \"ä¸ª\" &#125; ] æŸ¥çœ‹æ‰€æœ‰æºç ç‚¹å‡»ï¼šä¸‹è½½ è½¬ä¸ºJavaBeanæ¯”è¾ƒå°†itemJsonå­—ç¬¦ä¸²è½¬åŒ–ä¸ºJavaBeanï¼Œæ¯”è¾ƒJavaBeanä¹‹å‰çš„å·®å¼‚ã€‚æ¯”è¾ƒJavaBeané—´çš„å·®å¼‚å¯ä»¥ç”¨Javersã€‚ å¼•å…¥Javersçš„Mavenä¾èµ–12345&lt;dependency&gt; &lt;groupId&gt;org.javers&lt;/groupId&gt; &lt;artifactId&gt;javers-core&lt;/artifactId&gt; &lt;version&gt;3.5.0&lt;/version&gt;&lt;/dependency&gt; å°†itemJsonè½¬ä¸ºJavaBeanæ–¹å¼ä¸€ï¼šåˆ©ç”¨Jacksonå·¥å…·ç±»JsonUtils12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758public class JsonUtils &#123; // å®šä¹‰jacksonå¯¹è±¡ private static final ObjectMapper MAPPER = new ObjectMapper(); /** * å°†å¯¹è±¡è½¬æ¢æˆjsonå­—ç¬¦ä¸²ã€‚ * &lt;p&gt;Title: pojoToJson&lt;/p&gt; * &lt;p&gt;Description: &lt;/p&gt; * @param data * @return */ public static String objectToJson(Object data) &#123; try &#123; String string = MAPPER.writeValueAsString(data); return string; &#125; catch (JsonProcessingException e) &#123; e.printStackTrace(); &#125; return null; &#125; /** * å°†jsonç»“æœé›†è½¬åŒ–ä¸ºå¯¹è±¡ * * @param jsonData jsonæ•°æ® * @param clazz å¯¹è±¡ä¸­çš„objectç±»å‹ * @return */ public static &lt;T&gt; T jsonToPojo(String jsonData, Class&lt;T&gt; beanType) &#123; try &#123; T t = MAPPER.readValue(jsonData, beanType); return t; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return null; &#125; /** * å°†jsonæ•°æ®è½¬æ¢æˆpojoå¯¹è±¡list * &lt;p&gt;Title: jsonToList&lt;/p&gt; * &lt;p&gt;Description: &lt;/p&gt; * @param jsonData * @param beanType * @return */ public static &lt;T&gt;List&lt;T&gt; jsonToList(String jsonData, Class&lt;T&gt; beanType) &#123; JavaType javaType = MAPPER.getTypeFactory().constructParametricType(List.class, beanType); try &#123; List&lt;T&gt; list = MAPPER.readValue(jsonData, javaType); return list; &#125; catch (Exception e) &#123; e.printStackTrace(); &#125; return null; &#125;&#125; Jsonè½¬Pojo12Item item1 = JsonUtils.jsonToPojo(itemJsonOld, Item.class);Item item2 = JsonUtils.jsonToPojo(itemJsonNew, Item.class); æ–¹å¼äºŒï¼šåˆ©ç”¨fastJsonå¼•å…¥Mavenä¾èµ–12345&lt;dependency&gt; &lt;groupId&gt;com.alibaba&lt;/groupId&gt; &lt;artifactId&gt;fastjson&lt;/artifactId&gt; &lt;version&gt;1.1.26&lt;/version&gt;&lt;/dependency&gt; Jsonè½¬Pojo12Item item1 = JSONObject.parseObject(json3, Item.class);Item item2 = JSONObject.parseObject(json4, Item.class); åˆ©ç”¨Javersæ¯”è¾ƒJavaBean1234567891011Javers j = JaversBuilder.javers().build(); Diff diff = j.compare(item1, item2); if (diff.hasChanges()) &#123; List&lt;Change&gt; changes = diff.getChanges(); for (Change change : changes) &#123; if (change instanceof ValueChange) &#123; ValueChange valChange = (ValueChange) change; System.out.println(valChange.getPropertyName() + \" -- \" + valChange.getLeft() + \"--\" + valChange.getRight()); &#125; &#125; &#125; ç‰ˆæœ¬å›æ»šâ€‹ å…¶å®ç‰ˆæœ¬å›æ»šåœ¨ä¸Šé¢çš„æ¯”è¾ƒä¸­å·²ç»è¯´äº†ï¼Œå°±æ˜¯æŠŠéœ€è¦å›æ»šçš„ç‰ˆæœ¬itemJsonè½¬åŒ–ä¸ºJavaBeanä¼ ç»™å‰å°ï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä»½æœ€æ–°çš„ç‰ˆæœ¬ä¸ºå½“å‰ç‰ˆæœ¬ï¼Œè®°å½•æ“ä½œäººã€æ“ä½œæ—¶é—´ç­‰ç­‰è®°å½•å³å¯ã€‚éœ€è¦äº†è§£åŠä½¿ç”¨Gsonã€fastJsonã€Jacksonçš„ä½¿ç”¨ï¼ŒåŠä½¿ç”¨å·¥å…·å°†Mapã€Jsonã€JavaBeanã€Listã€JsonStringå¯¹è±¡ä¹‹é—´çŠ¶æ€çš„è½¬æ¢ã€‚ æ€»ç»“ ç†Ÿæ‚‰ä¸šåŠ¡ã€‚ æŒæ¡Mapã€Jsonã€JavaBeanã€Listã€JsonStringå¯¹è±¡ä¹‹é—´çŠ¶æ€çš„è½¬æ¢ã€‚ ç‰ˆæœ¬éœ€è¦å­˜å‚¨æ‰€æœ‰ä¿¡æ¯ä¾¿äºå›æ»šã€‚ ä¸ªäººå€¾å‘ä½¿ç”¨Javersæ¯”è¾ƒJavaBeanè¿›è¡Œæ¯”è¾ƒç‰ˆæœ¬å·®å¼‚ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"}]},{"title":"Spring+Mybatisä¹‹Mapperçƒ­éƒ¨ç½²","slug":"Spring-Mybatisä¹‹Mapperçƒ­éƒ¨ç½²","date":"2017-09-15T08:52:07.000Z","updated":"2018-03-20T02:45:12.021Z","comments":true,"path":"2017/09/15/Spring-Mybatisä¹‹Mapperçƒ­éƒ¨ç½²/","link":"","permalink":"https://sunny0715.github.io/2017/09/15/Spring-Mybatisä¹‹Mapperçƒ­éƒ¨ç½²/","excerpt":"å¼•è¨€â€‹ Spring+Mybatisç»å¸¸ç”¨ï¼Œåœ¨é¡¹ç›®ä¸­æœ€ç—›è‹¦çš„å°±æ˜¯ä¿®æ”¹mapperæ–‡ä»¶çš„æ—¶å€™éœ€è¦é‡å¯ä¸€ä¸‹é¡¹ç›®ï¼Œæ¯ä¿®æ”¹ä¸€æ¬¡å°±éœ€è¦é‡å¯ä¸€æ¬¡é¡¹ç›®ã€‚é¡¹ç›®å°è¿˜å¥½ï¼Œå¦‚æœé¡¹ç›®å¤§ï¼Œé‡å¯ä¸€æ¬¡é¡¹ç›®ç®€ç›´æ˜¯è¦å‘½ã€‚æ‰€ä»¥ï¼Œå»ç½‘ä¸ŠæŸ¥èµ„æ–™çœ‹æœ‰æ²¡æœ‰åŠæ³•è®©mybatisçƒ­éƒ¨ç½²ï¼Œæ¯æ¬¡æ›´æ–°mapperæ–‡ä»¶ä¸éœ€è¦é‡å¯é¡¹ç›®ã€‚ â€‹ åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œç»ˆäºæ‰¾åˆ°äº†ï¼Œè¿™ç©æ„åªè¦å‘ç°mapperæ–‡ä»¶è¢«ä¿®æ”¹ï¼Œå°±ä¼šé‡æ–°åŠ è½½è¢«ä¿®æ”¹çš„mapperæ–‡ä»¶ã€‚ä¸”åªåŠ è½½è¢«ä¿®æ”¹çš„mapperæ–‡ä»¶ï¼è¿™ä¸ªå¯çœäº‹äº†ï¼Œæ•ˆç‡åˆé«˜ï¼Œç®€ç›´çˆ½åˆ°çˆ†ã€‚","text":"å¼•è¨€â€‹ Spring+Mybatisç»å¸¸ç”¨ï¼Œåœ¨é¡¹ç›®ä¸­æœ€ç—›è‹¦çš„å°±æ˜¯ä¿®æ”¹mapperæ–‡ä»¶çš„æ—¶å€™éœ€è¦é‡å¯ä¸€ä¸‹é¡¹ç›®ï¼Œæ¯ä¿®æ”¹ä¸€æ¬¡å°±éœ€è¦é‡å¯ä¸€æ¬¡é¡¹ç›®ã€‚é¡¹ç›®å°è¿˜å¥½ï¼Œå¦‚æœé¡¹ç›®å¤§ï¼Œé‡å¯ä¸€æ¬¡é¡¹ç›®ç®€ç›´æ˜¯è¦å‘½ã€‚æ‰€ä»¥ï¼Œå»ç½‘ä¸ŠæŸ¥èµ„æ–™çœ‹æœ‰æ²¡æœ‰åŠæ³•è®©mybatisçƒ­éƒ¨ç½²ï¼Œæ¯æ¬¡æ›´æ–°mapperæ–‡ä»¶ä¸éœ€è¦é‡å¯é¡¹ç›®ã€‚ â€‹ åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œç»ˆäºæ‰¾åˆ°äº†ï¼Œè¿™ç©æ„åªè¦å‘ç°mapperæ–‡ä»¶è¢«ä¿®æ”¹ï¼Œå°±ä¼šé‡æ–°åŠ è½½è¢«ä¿®æ”¹çš„mapperæ–‡ä»¶ã€‚ä¸”åªåŠ è½½è¢«ä¿®æ”¹çš„mapperæ–‡ä»¶ï¼è¿™ä¸ªå¯çœäº‹äº†ï¼Œæ•ˆç‡åˆé«˜ï¼Œç®€ç›´çˆ½åˆ°çˆ†ã€‚ åˆ›å»ºMapperRefreshåˆ·æ–°ç±»åœ¨srcä¸‹åˆ›å»ºä¸€ä¸ªutilåŒ…ï¼ŒåŒ…ä¸‹é¢åˆ›å»ºä¸€ä¸ªç±»ï¼Œç±»åä¸ºï¼šMapperRefresh ä»£ç ä¸ºä¸‹é¢çš„ä¸€ä¸²ï¼Œæ³¨æ„ä¿®æ”¹ä¸‹mybatis-refresh.properties çš„è·¯å¾„ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359package com.talkweb.nets.netsTestLib.data.util;import java.io.File; import java.io.FileInputStream; import java.io.FileNotFoundException; import java.io.InputStream; import java.lang.reflect.Field; import java.util.ArrayList; import java.util.HashMap; import java.util.List; import java.util.Map; import java.util.Properties; import java.util.Set; import org.apache.commons.lang3.StringUtils; import org.apache.ibatis.builder.xml.XMLMapperBuilder; import org.apache.ibatis.executor.ErrorContext; import org.apache.ibatis.session.Configuration; import org.apache.log4j.Logger; import org.springframework.core.NestedIOException; import org.springframework.core.io.Resource; import com.google.common.collect.Sets; /** * åˆ·æ–°MyBatis Mapper XML çº¿ç¨‹ * @author ThinkGem è¿™ä¸ªæ˜¯åŸè‘—çš„ä½œè€…ï¼Œæˆ‘åªæ˜¯ç›´æ¥æ‹¿æ¥ç”¨äº†ï¼ŒåŸè‘—è«æ€ª * @version 2016-5-29 */ public class MapperRefresh implements java.lang.Runnable &#123; public static Logger log = Logger.getLogger(MapperRefresh.class); private static String filename = \"mybatis-refresh.properties\"; //æ³¨æ„ä¿®æ”¹è·¯å¾„ private static Properties prop = new Properties(); private static boolean enabled; // æ˜¯å¦å¯ç”¨Mapperåˆ·æ–°çº¿ç¨‹åŠŸèƒ½ private static boolean refresh; // åˆ·æ–°å¯ç”¨åï¼Œæ˜¯å¦å¯åŠ¨äº†åˆ·æ–°çº¿ç¨‹ private Set&lt;String&gt; location; // Mapperå®é™…èµ„æºè·¯å¾„ private Resource[] mapperLocations; // Mapperèµ„æºè·¯å¾„ private Configuration configuration; // MyBatisé…ç½®å¯¹è±¡ private Long beforeTime = 0L; // ä¸Šä¸€æ¬¡åˆ·æ–°æ—¶é—´ private static int delaySeconds; // å»¶è¿Ÿåˆ·æ–°ç§’æ•° private static int sleepSeconds; // ä¼‘çœ æ—¶é—´ private static String mappingPath; // xmlæ–‡ä»¶å¤¹åŒ¹é…å­—ç¬¦ä¸²ï¼Œéœ€è¦æ ¹æ®éœ€è¦ä¿®æ”¹ static &#123; try &#123; prop.load(MapperRefresh.class.getResourceAsStream(filename)); &#125; catch (Exception e) &#123; e.printStackTrace(); System.out.println(\"Load mybatis-refresh â€œ\"+filename+\"â€ file error.\"); &#125; enabled = \"true\".equalsIgnoreCase(getPropString(\"enabled\")); delaySeconds = getPropInt(\"delaySeconds\"); sleepSeconds = getPropInt(\"sleepSeconds\"); mappingPath = getPropString(\"mappingPath\"); delaySeconds = delaySeconds == 0 ? 50 : delaySeconds; sleepSeconds = sleepSeconds == 0 ? 3 : sleepSeconds; mappingPath = StringUtils.isBlank(mappingPath) ? \"mappings\" : mappingPath; log.debug(\"[enabled] \" + enabled); log.debug(\"[delaySeconds] \" + delaySeconds); log.debug(\"[sleepSeconds] \" + sleepSeconds); log.debug(\"[mappingPath] \" + mappingPath); &#125; public static boolean isRefresh() &#123; return refresh; &#125; public MapperRefresh(Resource[] mapperLocations, Configuration configuration) &#123; this.mapperLocations = mapperLocations; this.configuration = configuration; &#125; @Override public void run() &#123; beforeTime = System.currentTimeMillis(); log.debug(\"[location] \" + location); log.debug(\"[configuration] \" + configuration); if (enabled) &#123; // å¯åŠ¨åˆ·æ–°çº¿ç¨‹ final MapperRefresh runnable = this; new Thread(new java.lang.Runnable() &#123; @Override public void run() &#123; if (location == null)&#123; location = Sets.newHashSet(); log.debug(\"MapperLocation's length:\" + mapperLocations.length); for (Resource mapperLocation : mapperLocations) &#123; String s = mapperLocation.toString().replaceAll(\"\\\\\\\\\", \"/\"); s = s.substring(\"file [\".length(), s.lastIndexOf(mappingPath) + mappingPath.length()); if (!location.contains(s)) &#123; location.add(s); log.debug(\"Location:\" + s); &#125; &#125; log.debug(\"Locarion's size:\" + location.size()); &#125; try &#123; Thread.sleep(delaySeconds * 1000); &#125; catch (InterruptedException e2) &#123; e2.printStackTrace(); &#125; refresh = true; System.out.println(\"========= Enabled refresh mybatis mapper =========\"); while (true) &#123; try &#123; for (String s : location) &#123; runnable.refresh(s, beforeTime); &#125; &#125; catch (Exception e1) &#123; e1.printStackTrace(); &#125; try &#123; Thread.sleep(sleepSeconds * 1000); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;, \"MyBatis-Mapper-Refresh\").start(); &#125; &#125; /** * æ‰§è¡Œåˆ·æ–° * @param filePath åˆ·æ–°ç›®å½• * @param beforeTime ä¸Šæ¬¡åˆ·æ–°æ—¶é—´ * @throws NestedIOException è§£æå¼‚å¸¸ * @throws FileNotFoundException æ–‡ä»¶æœªæ‰¾åˆ° * @author ThinkGem */ @SuppressWarnings(&#123; \"rawtypes\", \"unchecked\" &#125;) private void refresh(String filePath, Long beforeTime) throws Exception &#123; // æœ¬æ¬¡åˆ·æ–°æ—¶é—´ Long refrehTime = System.currentTimeMillis(); // è·å–éœ€è¦åˆ·æ–°çš„Mapperæ–‡ä»¶åˆ—è¡¨ List&lt;File&gt; fileList = this.getRefreshFile(new File(filePath), beforeTime); if (fileList.size() &gt; 0) &#123; log.debug(\"Refresh file: \" + fileList.size()); &#125; for (int i = 0; i &lt; fileList.size(); i++) &#123; InputStream inputStream = new FileInputStream(fileList.get(i)); String resource = fileList.get(i).getAbsolutePath(); try &#123; // æ¸…ç†åŸæœ‰èµ„æºï¼Œæ›´æ–°ä¸ºè‡ªå·±çš„StrictMapæ–¹ä¾¿ï¼Œå¢é‡é‡æ–°åŠ è½½ String[] mapFieldNames = new String[]&#123; \"mappedStatements\", \"caches\", \"resultMaps\", \"parameterMaps\", \"keyGenerators\", \"sqlFragments\" &#125;; for (String fieldName : mapFieldNames)&#123; Field field = configuration.getClass().getDeclaredField(fieldName); field.setAccessible(true); Map map = ((Map)field.get(configuration)); if (!(map instanceof StrictMap))&#123; Map newMap = new StrictMap(StringUtils.capitalize(fieldName) + \"collection\"); for (Object key : map.keySet())&#123; try &#123; newMap.put(key, map.get(key)); &#125;catch(IllegalArgumentException ex)&#123; newMap.put(key, ex.getMessage()); &#125; &#125; field.set(configuration, newMap); &#125; &#125; // æ¸…ç†å·²åŠ è½½çš„èµ„æºæ ‡è¯†ï¼Œæ–¹ä¾¿è®©å®ƒé‡æ–°åŠ è½½ã€‚ Field loadedResourcesField = configuration.getClass().getDeclaredField(\"loadedResources\"); loadedResourcesField.setAccessible(true); Set loadedResourcesSet = ((Set)loadedResourcesField.get(configuration)); loadedResourcesSet.remove(resource); //é‡æ–°ç¼–è¯‘åŠ è½½èµ„æºæ–‡ä»¶ã€‚ XMLMapperBuilder xmlMapperBuilder = new XMLMapperBuilder(inputStream, configuration, resource, configuration.getSqlFragments()); xmlMapperBuilder.parse(); &#125; catch (Exception e) &#123; throw new NestedIOException(\"Failed to parse mapping resource: '\" + resource + \"'\", e); &#125; finally &#123; ErrorContext.instance().reset(); &#125; System.out.println(\"Refresh file: \" + mappingPath + StringUtils.substringAfterLast(fileList.get(i).getAbsolutePath(), mappingPath)); if (log.isDebugEnabled()) &#123; log.debug(\"Refresh file: \" + fileList.get(i).getAbsolutePath()); log.debug(\"Refresh filename: \" + fileList.get(i).getName()); &#125; &#125; // å¦‚æœåˆ·æ–°äº†æ–‡ä»¶ï¼Œåˆ™ä¿®æ”¹åˆ·æ–°æ—¶é—´ï¼Œå¦åˆ™ä¸ä¿®æ”¹ if (fileList.size() &gt; 0) &#123; this.beforeTime = refrehTime; &#125; &#125; /** * è·å–éœ€è¦åˆ·æ–°çš„æ–‡ä»¶åˆ—è¡¨ * @param dir ç›®å½• * @param beforeTime ä¸Šæ¬¡åˆ·æ–°æ—¶é—´ * @return åˆ·æ–°æ–‡ä»¶åˆ—è¡¨ */ private List&lt;File&gt; getRefreshFile(File dir, Long beforeTime) &#123; List&lt;File&gt; fileList = new ArrayList&lt;File&gt;(); File[] files = dir.listFiles(); if (files != null) &#123; for (int i = 0; i &lt; files.length; i++) &#123; File file = files[i]; if (file.isDirectory()) &#123; fileList.addAll(this.getRefreshFile(file, beforeTime)); &#125; else if (file.isFile()) &#123; if (this.checkFile(file, beforeTime)) &#123; fileList.add(file); &#125; &#125; else &#123; System.out.println(\"Error file.\" + file.getName()); &#125; &#125; &#125; return fileList; &#125; /** * åˆ¤æ–­æ–‡ä»¶æ˜¯å¦éœ€è¦åˆ·æ–° * @param file æ–‡ä»¶ * @param beforeTime ä¸Šæ¬¡åˆ·æ–°æ—¶é—´ * @return éœ€è¦åˆ·æ–°è¿”å›trueï¼Œå¦åˆ™è¿”å›false */ private boolean checkFile(File file, Long beforeTime) &#123; if (file.lastModified() &gt; beforeTime) &#123; return true; &#125; return false; &#125; /** * è·å–æ•´æ•°å±æ€§ * @param key * @return */ private static int getPropInt(String key) &#123; int i = 0; try &#123; i = Integer.parseInt(getPropString(key)); &#125; catch (Exception e) &#123; &#125; return i; &#125; /** * è·å–å­—ç¬¦ä¸²å±æ€§ * @param key * @return */ private static String getPropString(String key) &#123; return prop == null ? null : prop.getProperty(key); &#125; /** * é‡å†™ org.apache.ibatis.session.Configuration.StrictMap ç±» * æ¥è‡ª MyBatis3.4.0ç‰ˆæœ¬ï¼Œä¿®æ”¹ put æ–¹æ³•ï¼Œå…è®¸åå¤ putæ›´æ–°ã€‚ */ public static class StrictMap&lt;V&gt; extends HashMap&lt;String, V&gt; &#123; private static final long serialVersionUID = -4950446264854982944L; private String name; public StrictMap(String name, int initialCapacity, float loadFactor) &#123; super(initialCapacity, loadFactor); this.name = name; &#125; public StrictMap(String name, int initialCapacity) &#123; super(initialCapacity); this.name = name; &#125; public StrictMap(String name) &#123; super(); this.name = name; &#125; public StrictMap(String name, Map&lt;String, ? extends V&gt; m) &#123; super(m); this.name = name; &#125; @SuppressWarnings(\"unchecked\") public V put(String key, V value) &#123; // ThinkGem å¦‚æœç°åœ¨çŠ¶æ€ä¸ºåˆ·æ–°ï¼Œåˆ™åˆ·æ–°(å…ˆåˆ é™¤åæ·»åŠ ) if (MapperRefresh.isRefresh()) &#123; remove(key); MapperRefresh.log.debug(\"refresh key:\" + key.substring(key.lastIndexOf(\".\") + 1)); &#125; // ThinkGem end if (containsKey(key)) &#123; throw new IllegalArgumentException(name + \" already contains value for \" + key); &#125; if (key.contains(\".\")) &#123; final String shortKey = getShortName(key); if (super.get(shortKey) == null) &#123; super.put(shortKey, value); &#125; else &#123; super.put(shortKey, (V) new Ambiguity(shortKey)); &#125; &#125; return super.put(key, value); &#125; public V get(Object key) &#123; V value = super.get(key); if (value == null) &#123; throw new IllegalArgumentException(name + \" does not contain value for \" + key); &#125; if (value instanceof Ambiguity) &#123; throw new IllegalArgumentException(((Ambiguity) value).getSubject() + \" is ambiguous in \" + name + \" (try using the full name including the namespace, or rename one of the entries)\"); &#125; return value; &#125; private String getShortName(String key) &#123; final String[] keyparts = key.split(\"\\\\.\"); return keyparts[keyparts.length - 1]; &#125; protected static class Ambiguity &#123; private String subject; public Ambiguity(String subject) &#123; this.subject = subject; &#125; public String getSubject() &#123; return subject; &#125; &#125; &#125; &#125; é‡å†™SqlSessionFactoryBeanMyBatisæœ‰å‡ ä¸ªä¸å¤ªå¥½çš„åœ°æ–¹ï¼Œæ˜¯å½“å®ä½“ç±»åˆ«åé‡åçš„æ—¶å€™ï¼ŒMapper XMLæœ‰é”™è¯¯çš„æ—¶å€™ï¼Œç³»ç»Ÿå¯åŠ¨æ—¶ä¼šä¸€ç›´ç­‰å¾…æ— æ³•æ­£å¸¸å¯åŠ¨ï¼ˆå…¶å®æ˜¯åŠ è½½å¤±è´¥ååˆé‡æ–°åŠ è½½ï¼Œè¿›å…¥äº†æ­»å¾ªç¯ï¼‰ï¼Œè¿™é‡Œé‡å†™ä¸‹SqlSessionFactoryBean.javaæ–‡ä»¶ï¼Œè§£å†³è¿™ä¸ªé—®é¢˜ï¼Œåœ¨è¿™ä¸ªæ–‡ä»¶é‡Œä¹ŸåŠ å…¥å¯åŠ¨ä¸Šé¢å†™çš„çº¿ç¨‹ç±»ï¼š 1ã€ä¿®æ”¹å®ä½“ç±»é‡åçš„æ—¶å€™æŠ›å‡ºå¹¶æ‰“å°å¼‚å¸¸ï¼Œå¦åˆ™ç³»ç»Ÿä¼šä¸€ç›´é€’å½’é€ æˆæ— æ³•å¯åŠ¨ã€‚2ã€MapperXMLæœ‰é”™è¯¯çš„æ—¶å€™æŠ›å‡ºå¹¶æ‰“å°å¼‚å¸¸ï¼Œå¦åˆ™ç³»ç»Ÿä¼šä¸€ç›´é€’å½’é€ æˆæ— æ³•å¯åŠ¨ã€‚3ã€åŠ å…¥å¯åŠ¨MapperRefresh.javaçº¿ç¨‹æœåŠ¡ã€‚ æ€è·¯å°±æ˜¯ç”¨æˆ‘ä»¬è‡ªå·±é‡å†™çš„SqlSessionFactoryBean.classæ›¿æ¢mybatis-spring-1.2.2.jarä¸­çš„SqlSessionFactoryBean.classã€‚ åœ¨å½“å‰é¡¹ç›®ä¸‹æ–°å»ºä¸€ä¸ªåŒ…ï¼šå³é”® src &gt; new Package &gt; org.mybatis.springï¼Œåˆ›å»ºSqlSessionFactoryBean.javaç±»ã€‚ å¤åˆ¶ä¸‹é¢ä¸€ä¸²ä»£ç åˆ°SqlSessionFactoryBean.javaï¼Œæ³¨æ„å¯¼å…¥MapperRefreshæ­£ç¡®çš„åŒ…ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313package org.mybatis.spring;import java.io.IOException;import java.sql.SQLException;import java.util.Properties;import javax.sql.DataSource;import org.apache.ibatis.builder.xml.XMLConfigBuilder;import org.apache.ibatis.builder.xml.XMLMapperBuilder;import org.apache.ibatis.executor.ErrorContext;import org.apache.ibatis.logging.Log;import org.apache.ibatis.logging.LogFactory;import org.apache.ibatis.mapping.DatabaseIdProvider;import org.apache.ibatis.mapping.Environment;import org.apache.ibatis.plugin.Interceptor;import org.apache.ibatis.reflection.factory.ObjectFactory;import org.apache.ibatis.reflection.wrapper.ObjectWrapperFactory;import org.apache.ibatis.session.Configuration;import org.apache.ibatis.session.SqlSessionFactory;import org.apache.ibatis.session.SqlSessionFactoryBuilder;import org.apache.ibatis.transaction.TransactionFactory;import org.apache.ibatis.type.TypeAliasRegistry;import org.apache.ibatis.type.TypeHandler;import org.apache.ibatis.type.TypeHandlerRegistry;import org.mybatis.spring.transaction.SpringManagedTransactionFactory;import org.springframework.beans.factory.FactoryBean;import org.springframework.beans.factory.InitializingBean;import org.springframework.context.ApplicationEvent;import org.springframework.context.ApplicationListener;import org.springframework.context.event.ContextRefreshedEvent;import org.springframework.core.NestedIOException;import org.springframework.core.io.Resource;import org.springframework.jdbc.datasource.TransactionAwareDataSourceProxy;import org.springframework.util.Assert;import org.springframework.util.ObjectUtils;import org.springframework.util.StringUtils;import com.talkweb.nets.netsTestLib.data.util.MapperRefresh;public class SqlSessionFactoryBean implements FactoryBean&lt;SqlSessionFactory&gt;, InitializingBean, ApplicationListener&lt;ApplicationEvent&gt; &#123; private static final Log logger = LogFactory.getLog(SqlSessionFactoryBean.class); private Resource configLocation; private Resource[] mapperLocations; private DataSource dataSource; private TransactionFactory transactionFactory; private Properties configurationProperties; private SqlSessionFactoryBuilder sqlSessionFactoryBuilder = new SqlSessionFactoryBuilder(); private SqlSessionFactory sqlSessionFactory; private String environment = SqlSessionFactoryBean.class.getSimpleName(); private boolean failFast; private Interceptor[] plugins; private TypeHandler&lt;?&gt;[] typeHandlers; private String typeHandlersPackage; private Class&lt;?&gt;[] typeAliases; private String typeAliasesPackage; private Class&lt;?&gt; typeAliasesSuperType; private DatabaseIdProvider databaseIdProvider; private ObjectFactory objectFactory; private ObjectWrapperFactory objectWrapperFactory; public void setObjectFactory(ObjectFactory objectFactory) &#123; this.objectFactory = objectFactory; &#125; public void setObjectWrapperFactory(ObjectWrapperFactory objectWrapperFactory) &#123; this.objectWrapperFactory = objectWrapperFactory; &#125; public DatabaseIdProvider getDatabaseIdProvider() &#123; return this.databaseIdProvider; &#125; public void setDatabaseIdProvider(DatabaseIdProvider databaseIdProvider) &#123; this.databaseIdProvider = databaseIdProvider; &#125; public void setPlugins(Interceptor[] plugins) &#123; this.plugins = plugins; &#125; public void setTypeAliasesPackage(String typeAliasesPackage) &#123; this.typeAliasesPackage = typeAliasesPackage; &#125; public void setTypeAliasesSuperType(Class&lt;?&gt; typeAliasesSuperType) &#123; this.typeAliasesSuperType = typeAliasesSuperType; &#125; public void setTypeHandlersPackage(String typeHandlersPackage) &#123; this.typeHandlersPackage = typeHandlersPackage; &#125; public void setTypeHandlers(TypeHandler&lt;?&gt;[] typeHandlers) &#123; this.typeHandlers = typeHandlers; &#125; public void setTypeAliases(Class&lt;?&gt;[] typeAliases) &#123; this.typeAliases = typeAliases; &#125; public void setFailFast(boolean failFast) &#123; this.failFast = failFast; &#125; public void setConfigLocation(Resource configLocation) &#123; this.configLocation = configLocation; &#125; public void setMapperLocations(Resource[] mapperLocations) &#123; this.mapperLocations = mapperLocations; &#125; public void setConfigurationProperties(Properties sqlSessionFactoryProperties) &#123; this.configurationProperties = sqlSessionFactoryProperties; &#125; public void setDataSource(DataSource dataSource) &#123; if ((dataSource instanceof TransactionAwareDataSourceProxy)) &#123; this.dataSource = ((TransactionAwareDataSourceProxy) dataSource).getTargetDataSource(); &#125; else this.dataSource = dataSource; &#125; public void setSqlSessionFactoryBuilder(SqlSessionFactoryBuilder sqlSessionFactoryBuilder) &#123; this.sqlSessionFactoryBuilder = sqlSessionFactoryBuilder; &#125; public void setTransactionFactory(TransactionFactory transactionFactory) &#123; this.transactionFactory = transactionFactory; &#125; public void setEnvironment(String environment) &#123; this.environment = environment; &#125; public void afterPropertiesSet() throws Exception &#123; Assert.notNull(this.dataSource, \"Property 'dataSource' is required\"); Assert.notNull(this.sqlSessionFactoryBuilder, \"Property 'sqlSessionFactoryBuilder' is required\"); this.sqlSessionFactory = buildSqlSessionFactory(); &#125; protected SqlSessionFactory buildSqlSessionFactory() throws IOException &#123; XMLConfigBuilder xmlConfigBuilder = null; Configuration configuration; if (this.configLocation != null) &#123; xmlConfigBuilder = new XMLConfigBuilder(this.configLocation.getInputStream(), null, this.configurationProperties); configuration = xmlConfigBuilder.getConfiguration(); &#125; else &#123; if (logger.isDebugEnabled()) &#123; logger.debug(\"Property 'configLocation' not specified, using default MyBatis Configuration\"); &#125; configuration = new Configuration(); configuration.setVariables(this.configurationProperties); &#125; if (this.objectFactory != null) &#123; configuration.setObjectFactory(this.objectFactory); &#125; if (this.objectWrapperFactory != null) &#123; configuration.setObjectWrapperFactory(this.objectWrapperFactory); &#125; if (StringUtils.hasLength(this.typeAliasesPackage)) &#123; String[] typeAliasPackageArray = StringUtils.tokenizeToStringArray(this.typeAliasesPackage, \",; \\t\\n\"); for (String packageToScan : typeAliasPackageArray) &#123; // ä¿®æ”¹å¤„ï¼šThinkGem ä¿®æ”¹å®ä½“ç±»é‡åçš„æ—¶å€™æŠ›å‡ºå¹¶æ‰“å°å¼‚å¸¸ï¼Œå¦åˆ™ç³»ç»Ÿä¼šä¸€ç›´é€’å½’é€ æˆæ— æ³•å¯åŠ¨ try &#123; configuration.getTypeAliasRegistry().registerAliases(packageToScan, typeAliasesSuperType == null ? Object.class : typeAliasesSuperType); &#125; catch (Exception ex) &#123; logger.error(\"Scanned package: '\" + packageToScan + \"' for aliases\", ex); throw new NestedIOException(\"Scanned package: '\" + packageToScan + \"' for aliases\", ex); &#125; finally &#123; ErrorContext.instance().reset(); &#125; // ä¿®æ”¹å¤„ï¼šThinkGem end if (logger.isDebugEnabled()) &#123; logger.debug(\"Scanned package: '\" + packageToScan + \"' for aliases\"); &#125; &#125; &#125; if (!ObjectUtils.isEmpty(this.typeAliases)) &#123; for (Class typeAlias : this.typeAliases) &#123; configuration.getTypeAliasRegistry().registerAlias(typeAlias); if (logger.isDebugEnabled()) &#123; logger.debug(\"Registered type alias: '\" + typeAlias + \"'\"); &#125; &#125; &#125; if (!ObjectUtils.isEmpty(this.plugins)) &#123; for (Interceptor plugin : this.plugins) &#123; configuration.addInterceptor(plugin); if (logger.isDebugEnabled()) &#123; logger.debug(\"Registered plugin: '\" + plugin + \"'\"); &#125; &#125; &#125; if (StringUtils.hasLength(this.typeHandlersPackage)) &#123; String[] typeHandlersPackageArray = StringUtils.tokenizeToStringArray(this.typeHandlersPackage, \",; \\t\\n\"); for (String packageToScan : typeHandlersPackageArray) &#123; configuration.getTypeHandlerRegistry().register(packageToScan); if (logger.isDebugEnabled()) &#123; logger.debug(\"Scanned package: '\" + packageToScan + \"' for type handlers\"); &#125; &#125; &#125; if (!ObjectUtils.isEmpty(this.typeHandlers)) &#123; for (TypeHandler typeHandler : this.typeHandlers) &#123; configuration.getTypeHandlerRegistry().register(typeHandler); if (logger.isDebugEnabled()) &#123; logger.debug(\"Registered type handler: '\" + typeHandler + \"'\"); &#125; &#125; &#125; if (xmlConfigBuilder != null) &#123; try &#123; xmlConfigBuilder.parse(); if (logger.isDebugEnabled()) logger.debug(\"Parsed configuration file: '\" + this.configLocation + \"'\"); &#125; catch (Exception ex) &#123; throw new NestedIOException(\"Failed to parse config resource: \" + this.configLocation, ex); &#125; finally &#123; ErrorContext.instance().reset(); &#125; &#125; if (this.transactionFactory == null) &#123; this.transactionFactory = new SpringManagedTransactionFactory(); &#125; Environment environment = new Environment(this.environment, this.transactionFactory, this.dataSource); configuration.setEnvironment(environment); if (this.databaseIdProvider != null) &#123; try &#123; configuration.setDatabaseId(this.databaseIdProvider.getDatabaseId(this.dataSource)); &#125; catch (SQLException e) &#123; throw new NestedIOException(\"Failed getting a databaseId\", e); &#125; &#125; if (!ObjectUtils.isEmpty(this.mapperLocations)) &#123; for (Resource mapperLocation : this.mapperLocations) &#123; if (mapperLocation == null) &#123; continue; &#125; try &#123; XMLMapperBuilder xmlMapperBuilder = new XMLMapperBuilder(mapperLocation.getInputStream(), configuration, mapperLocation.toString(), configuration.getSqlFragments()); xmlMapperBuilder.parse(); &#125; catch (Exception e) &#123; // ä¿®æ”¹å¤„ï¼šThinkGem MapperXMLæœ‰é”™è¯¯çš„æ—¶å€™æŠ›å‡ºå¹¶æ‰“å°å¼‚å¸¸ï¼Œå¦åˆ™ç³»ç»Ÿä¼šä¸€ç›´é€’å½’é€ æˆæ— æ³•å¯åŠ¨ logger.error(\"Failed to parse mapping resource: '\" + mapperLocation + \"'\", e); throw new NestedIOException(\"Failed to parse mapping resource: '\" + mapperLocation + \"'\", e); &#125; finally &#123; ErrorContext.instance().reset(); &#125; if (logger.isDebugEnabled()) &#123; logger.debug(\"Parsed mapper file: '\" + mapperLocation + \"'\"); &#125; &#125; // ä¿®æ”¹å¤„ï¼šThinkGem å¯åŠ¨åˆ·æ–°MapperXMLå®šæ—¶å™¨ï¼ˆæœ‰åŠ©äºå¼€å‘è€…è°ƒè¯•ï¼‰ã€‚ new MapperRefresh(this.mapperLocations, configuration).run(); &#125; else if (logger.isDebugEnabled()) &#123; logger.debug(\"Property 'mapperLocations' was not specified or no matching resources found\"); &#125; return this.sqlSessionFactoryBuilder.build(configuration); &#125; public SqlSessionFactory getObject() throws Exception &#123; if (this.sqlSessionFactory == null) &#123; afterPropertiesSet(); &#125; return this.sqlSessionFactory; &#125; public Class&lt;? extends SqlSessionFactory&gt; getObjectType() &#123; return this.sqlSessionFactory == null ? SqlSessionFactory.class : this.sqlSessionFactory.getClass(); &#125; public boolean isSingleton() &#123; return true; &#125; public void onApplicationEvent(ApplicationEvent event) &#123; if ((this.failFast) &amp;&amp; ((event instanceof ContextRefreshedEvent))) &#123; this.sqlSessionFactory.getConfiguration().getMappedStatementNames(); &#125; &#125;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬å°±éœ€è¦æŠŠè¿™ä¸ªSqlSessionFactoryBean.javaæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶ï¼Œç„¶åå†å¤åˆ¶åˆ°mybatis-spring-1.2.2.jaråŒ…é‡Œé¢ ã€‚é‡æ–°éƒ¨ç½²å½“å‰é¡¹ç›® Servers &gt; Tomcat 8.x &gt; å³é”®ä½ çš„é¡¹ç›® Remove deployment ç„¶åå† Add Deploymentâ€¦ä½ çš„é¡¹ç›®ã€‚ å»Tomcat 8çš„æ ¹ç›®å½•æ‰¾åˆ°å¯¹åº”çš„SqlSessionFactoryBean.classæ–‡ä»¶å¤åˆ¶å‡ºæ¥ã€‚ è¿™é‡Œè®°å¾—æ£€æŸ¥ä¸€ä¸‹ç¼–è¯‘è¿‡çš„classæ–‡ä»¶æ˜¯å¦æ­£ç¡®ï¼Œå°†ä½ ç¼–è¯‘å¥½çš„SqlSessionFactoryBean.classæ–‡ä»¶å†æ¬¡æ‹–å…¥ï¼Œç”¨jd-gui.exe(ä¸€æ¬¾JAVAåç¼–è¯‘å·¥å…·)æ¯”è¾ƒæ˜¯ä¸æ˜¯å’Œä¸Šé¢å†™çš„ä»£ç å¯¹åº”ï¼ï¼ï¼ï¼ æ£€æŸ¥æ— è¯¯ä¹‹åï¼ŒæŠŠSqlSessionFactoryBean.classå¤åˆ¶åˆ°mybatis-spring-1.2.2.jar(æ˜¯ä½ æœ¬åœ°é¡¹ç›®ä¸­çš„jar)åŒ…ä¸­ï¼Œæ›¿æ¢åŸæ¥çš„classæ–‡ä»¶ã€‚ â€‹ åˆ›å»ºmybatis-refresh.propertiesæ–‡ä»¶ä¸€åˆ‡å‡†å¤‡å°±ç»ªï¼Œè¿˜å‰©ä¸‹æœ€åä¸€ä¸ªå±æ€§æ–‡ä»¶ï¼Œ åˆ›å»ºmybatis-refresh.propertiesæ–‡ä»¶ï¼Œè®°å¾—æŠŠæ–‡ä»¶æ ¼å¼æ”¹æˆUTF-8ã€‚ mybatis-refresh.propertiesæ–‡ä»¶å†…å®¹ä¸ºï¼š 12345678#æ˜¯å¦å¼€å¯åˆ·æ–°çº¿ç¨‹enabled=true#å»¶è¿Ÿå¯åŠ¨åˆ·æ–°ç¨‹åºçš„ç§’æ•°delaySeconds=60 #åˆ·æ–°æ‰«æé—´éš”çš„æ—¶é•¿ç§’æ•°sleepSeconds=3#æ‰«æMapperæ–‡ä»¶çš„èµ„æºè·¯å¾„mappingPath=mapper æµ‹è¯• åˆ é™¤org.mybatis.springåŒ…åŠä¸‹é¢çš„SqlSessionFactoryBean.javaæ–‡ä»¶ã€‚ å¯åŠ¨é¡¹ç›®ï¼Œç„¶åéšä¾¿ä¿®æ”¹ä¸€ä¸ªmapper.xmlæ–‡ä»¶ï¼Œç„¶åç¨ç­‰ç‰‡åˆ»ï¼Œåœ¨æ§åˆ¶å°å‡ºç°å¦‚ä¸‹è¾“å‡ºï¼Œå°±è¡¨ç¤ºä½ æˆåŠŸå•¦ï¼è¿™æ ·å°±ä¸ç”¨é‡å¯é¡¹ç›®ï¼Œä¹Ÿèƒ½åŠ è½½åˆ°ä½ ä¿®æ”¹çš„mapper.xmlæ–‡ä»¶äº† ã€‚ æ³¨æ„ æ³¨æ„å„ä¸ªæ–‡ä»¶çš„ä½ç½®å’Œåç§°ã€‚ æ³¨æ„MapperRefresh.javaæ–‡ä»¶ä¸­mybatis-refresh.propertiesçš„è·¯å¾„ã€‚ æ³¨æ„ç”¨jd-gui.exeæ£€æŸ¥ç¼–è¯‘åçš„SqlSessionFactoryBean.classæ–‡ä»¶ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"mybatis","slug":"mybatis","permalink":"https://sunny0715.github.io/tags/mybatis/"}]},{"title":"Spring-AOPä¸¤ç§é…ç½®æ–¹å¼","slug":"Spring-AOPä¸¤ç§é…ç½®æ–¹å¼","date":"2017-09-09T11:44:46.000Z","updated":"2018-03-13T05:52:30.194Z","comments":true,"path":"2017/09/09/Spring-AOPä¸¤ç§é…ç½®æ–¹å¼/","link":"","permalink":"https://sunny0715.github.io/2017/09/09/Spring-AOPä¸¤ç§é…ç½®æ–¹å¼/","excerpt":"å¼•è¨€AOPAOPï¼ˆAspect Oriented Programmingï¼‰ï¼Œå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå¯ä»¥è¯´æ˜¯OOPï¼ˆObject Oriented Programmingï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰çš„è¡¥å……å’Œå®Œå–„ã€‚OOPå¼•å…¥å°è£…ã€ç»§æ‰¿ã€å¤šæ€ç­‰æ¦‚å¿µæ¥å»ºç«‹ä¸€ç§å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œç”¨äºæ¨¡æ‹Ÿå…¬å…±è¡Œä¸ºçš„ä¸€ä¸ªé›†åˆã€‚ä¸è¿‡OOPå…è®¸å¼€å‘è€…å®šä¹‰çºµå‘çš„å…³ç³»ï¼Œä½†å¹¶ä¸é€‚åˆå®šä¹‰æ¨ªå‘çš„å…³ç³»ï¼Œä¾‹å¦‚æ—¥å¿—åŠŸèƒ½ã€‚æ—¥å¿—ä»£ç å¾€å¾€æ¨ªå‘åœ°æ•£å¸ƒåœ¨æ‰€æœ‰å¯¹è±¡å±‚æ¬¡ä¸­ï¼Œè€Œä¸å®ƒå¯¹åº”çš„å¯¹è±¡çš„æ ¸å¿ƒåŠŸèƒ½æ¯«æ— å…³ç³»å¯¹äºå…¶ä»–ç±»å‹çš„ä»£ç ï¼Œå¦‚å®‰å…¨æ€§ã€å¼‚å¸¸å¤„ç†å’Œé€æ˜çš„æŒç»­æ€§ä¹Ÿéƒ½æ˜¯å¦‚æ­¤ï¼Œè¿™ç§æ•£å¸ƒåœ¨å„å¤„çš„æ— å…³çš„ä»£ç è¢«ç§°ä¸ºæ¨ªåˆ‡ï¼ˆcross cuttingï¼‰ï¼Œåœ¨OOPè®¾è®¡ä¸­ï¼Œå®ƒå¯¼è‡´äº†å¤§é‡ä»£ç çš„é‡å¤ï¼Œè€Œä¸åˆ©äºå„ä¸ªæ¨¡å—çš„é‡ç”¨ã€‚","text":"å¼•è¨€AOPAOPï¼ˆAspect Oriented Programmingï¼‰ï¼Œå³é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå¯ä»¥è¯´æ˜¯OOPï¼ˆObject Oriented Programmingï¼Œé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼‰çš„è¡¥å……å’Œå®Œå–„ã€‚OOPå¼•å…¥å°è£…ã€ç»§æ‰¿ã€å¤šæ€ç­‰æ¦‚å¿µæ¥å»ºç«‹ä¸€ç§å¯¹è±¡å±‚æ¬¡ç»“æ„ï¼Œç”¨äºæ¨¡æ‹Ÿå…¬å…±è¡Œä¸ºçš„ä¸€ä¸ªé›†åˆã€‚ä¸è¿‡OOPå…è®¸å¼€å‘è€…å®šä¹‰çºµå‘çš„å…³ç³»ï¼Œä½†å¹¶ä¸é€‚åˆå®šä¹‰æ¨ªå‘çš„å…³ç³»ï¼Œä¾‹å¦‚æ—¥å¿—åŠŸèƒ½ã€‚æ—¥å¿—ä»£ç å¾€å¾€æ¨ªå‘åœ°æ•£å¸ƒåœ¨æ‰€æœ‰å¯¹è±¡å±‚æ¬¡ä¸­ï¼Œè€Œä¸å®ƒå¯¹åº”çš„å¯¹è±¡çš„æ ¸å¿ƒåŠŸèƒ½æ¯«æ— å…³ç³»å¯¹äºå…¶ä»–ç±»å‹çš„ä»£ç ï¼Œå¦‚å®‰å…¨æ€§ã€å¼‚å¸¸å¤„ç†å’Œé€æ˜çš„æŒç»­æ€§ä¹Ÿéƒ½æ˜¯å¦‚æ­¤ï¼Œè¿™ç§æ•£å¸ƒåœ¨å„å¤„çš„æ— å…³çš„ä»£ç è¢«ç§°ä¸ºæ¨ªåˆ‡ï¼ˆcross cuttingï¼‰ï¼Œåœ¨OOPè®¾è®¡ä¸­ï¼Œå®ƒå¯¼è‡´äº†å¤§é‡ä»£ç çš„é‡å¤ï¼Œè€Œä¸åˆ©äºå„ä¸ªæ¨¡å—çš„é‡ç”¨ã€‚ AOPæŠ€æœ¯æ°æ°ç›¸åï¼Œå®ƒåˆ©ç”¨ä¸€ç§ç§°ä¸ºâ€æ¨ªåˆ‡â€çš„æŠ€æœ¯ï¼Œå‰–è§£å¼€å°è£…çš„å¯¹è±¡å†…éƒ¨ï¼Œå¹¶å°†é‚£äº›å½±å“äº†å¤šä¸ªç±»çš„å…¬å…±è¡Œä¸ºå°è£…åˆ°ä¸€ä¸ªå¯é‡ç”¨æ¨¡å—ï¼Œå¹¶å°†å…¶å‘½åä¸ºâ€Aspectâ€ï¼Œå³åˆ‡é¢ã€‚æ‰€è°“â€åˆ‡é¢â€ï¼Œç®€å•è¯´å°±æ˜¯é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»å°è£…èµ·æ¥ï¼Œä¾¿äºå‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—ä¹‹é—´çš„è€¦åˆåº¦ï¼Œå¹¶æœ‰åˆ©äºæœªæ¥çš„å¯æ“ä½œæ€§å’Œå¯ç»´æŠ¤æ€§ã€‚ ä½¿ç”¨â€æ¨ªåˆ‡â€æŠ€æœ¯ï¼ŒAOPæŠŠè½¯ä»¶ç³»ç»Ÿåˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼šæ ¸å¿ƒå…³æ³¨ç‚¹å’Œæ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚ä¸šåŠ¡å¤„ç†çš„ä¸»è¦æµç¨‹æ˜¯æ ¸å¿ƒå…³æ³¨ç‚¹ï¼Œä¸ä¹‹å…³ç³»ä¸å¤§çš„éƒ¨åˆ†æ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹ã€‚æ¨ªåˆ‡å…³æ³¨ç‚¹çš„ä¸€ä¸ªç‰¹ç‚¹æ˜¯ï¼Œä»–ä»¬ç»å¸¸å‘ç”Ÿåœ¨æ ¸å¿ƒå…³æ³¨ç‚¹çš„å¤šå¤„ï¼Œè€Œå„å¤„åŸºæœ¬ç›¸ä¼¼ï¼Œæ¯”å¦‚æƒé™è®¤è¯ã€æ—¥å¿—ã€äº‹åŠ¡ã€‚AOPçš„ä½œç”¨åœ¨äºåˆ†ç¦»ç³»ç»Ÿä¸­çš„å„ç§å…³æ³¨ç‚¹ï¼Œå°†æ ¸å¿ƒå…³æ³¨ç‚¹å’Œæ¨ªåˆ‡å…³æ³¨ç‚¹åˆ†ç¦»å¼€æ¥ã€‚ AOPæ ¸å¿ƒæ¦‚å¿µ1ã€æ¨ªåˆ‡å…³æ³¨ç‚¹ å¯¹å“ªäº›æ–¹æ³•è¿›è¡Œæ‹¦æˆªï¼Œæ‹¦æˆªåæ€ä¹ˆå¤„ç†ï¼Œè¿™äº›å…³æ³¨ç‚¹ç§°ä¹‹ä¸ºæ¨ªåˆ‡å…³æ³¨ç‚¹ 2ã€åˆ‡é¢ï¼ˆAspectï¼‰ ç±»æ˜¯å¯¹ç‰©ä½“ç‰¹å¾çš„æŠ½è±¡ï¼Œåˆ‡é¢å°±æ˜¯å¯¹æ¨ªåˆ‡å…³æ³¨ç‚¹çš„æŠ½è±¡ 3ã€è¿æ¥ç‚¹ï¼ˆJoinpointï¼‰ è¢«æ‹¦æˆªåˆ°çš„ç‚¹ï¼Œå› ä¸ºSpringåªæ”¯æŒæ–¹æ³•ç±»å‹çš„è¿æ¥ç‚¹ï¼Œæ‰€ä»¥åœ¨Springä¸­è¿æ¥ç‚¹æŒ‡çš„å°±æ˜¯è¢«æ‹¦æˆªåˆ°çš„æ–¹æ³•ï¼Œå®é™…ä¸Šè¿æ¥ç‚¹è¿˜å¯ä»¥æ˜¯å­—æ®µæˆ–è€…æ„é€ å™¨ 4ã€åˆ‡å…¥ç‚¹ï¼ˆPointcutï¼‰ å¯¹è¿æ¥ç‚¹è¿›è¡Œæ‹¦æˆªçš„å®šä¹‰ 5ã€é€šçŸ¥ï¼ˆAdviceï¼‰ æ‰€è°“é€šçŸ¥æŒ‡çš„å°±æ˜¯æŒ‡æ‹¦æˆªåˆ°è¿æ¥ç‚¹ä¹‹åè¦æ‰§è¡Œçš„ä»£ç ï¼Œé€šçŸ¥åˆ†ä¸ºå‰ç½®ã€åç½®ã€å¼‚å¸¸ã€æœ€ç»ˆã€ç¯ç»•é€šçŸ¥äº”ç±» 6ã€ç›®æ ‡å¯¹è±¡ ä»£ç†çš„ç›®æ ‡å¯¹è±¡ 7ã€ç»‡å…¥ï¼ˆWeaveï¼‰ å°†åˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡å¹¶å¯¼è‡´ä»£ç†å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹ 8ã€å¼•å…¥ï¼ˆIntroductionï¼‰ åœ¨ä¸ä¿®æ”¹ä»£ç çš„å‰æä¸‹ï¼Œå¼•å…¥å¯ä»¥åœ¨è¿è¡ŒæœŸä¸ºç±»åŠ¨æ€åœ°æ·»åŠ ä¸€äº›æ–¹æ³•æˆ–å­—æ®µ Springå¯¹AOPçš„æ”¯æŒSpringä¸­AOPä»£ç†ç”±Springçš„IOCå®¹å™¨è´Ÿè´£ç”Ÿæˆã€ç®¡ç†ï¼Œå…¶ä¾èµ–å…³ç³»ä¹Ÿç”±IOCå®¹å™¨è´Ÿè´£ç®¡ç†ã€‚å› æ­¤ï¼ŒAOPä»£ç†å¯ä»¥ç›´æ¥ä½¿ç”¨å®¹å™¨ä¸­çš„å…¶å®ƒbeanå®ä¾‹ä½œä¸ºç›®æ ‡ï¼Œè¿™ç§å…³ç³»å¯ç”±IOCå®¹å™¨çš„ä¾èµ–æ³¨å…¥æä¾›ã€‚Springåˆ›å»ºä»£ç†çš„è§„åˆ™ä¸ºï¼š 1ã€é»˜è®¤ä½¿ç”¨JavaåŠ¨æ€ä»£ç†æ¥åˆ›å»ºAOPä»£ç†ï¼Œè¿™æ ·å°±å¯ä»¥ä¸ºä»»ä½•æ¥å£å®ä¾‹åˆ›å»ºä»£ç†äº† 2ã€å½“éœ€è¦ä»£ç†çš„ç±»ä¸æ˜¯ä»£ç†æ¥å£çš„æ—¶å€™ï¼ŒSpringä¼šåˆ‡æ¢ä¸ºä½¿ç”¨CGLIBä»£ç†ï¼Œä¹Ÿå¯å¼ºåˆ¶ä½¿ç”¨CGLIB AOPç¼–ç¨‹å…¶å®æ˜¯å¾ˆç®€å•çš„äº‹æƒ…ï¼Œçºµè§‚AOPç¼–ç¨‹ï¼Œç¨‹åºå‘˜åªéœ€è¦å‚ä¸ä¸‰ä¸ªéƒ¨åˆ†ï¼š 1ã€å®šä¹‰æ™®é€šä¸šåŠ¡ç»„ä»¶ 2ã€å®šä¹‰åˆ‡å…¥ç‚¹ï¼Œä¸€ä¸ªåˆ‡å…¥ç‚¹å¯èƒ½æ¨ªåˆ‡å¤šä¸ªä¸šåŠ¡ç»„ä»¶ 3ã€å®šä¹‰å¢å¼ºå¤„ç†ï¼Œå¢å¼ºå¤„ç†å°±æ˜¯åœ¨AOPæ¡†æ¶ä¸ºæ™®é€šä¸šåŠ¡ç»„ä»¶ç»‡å…¥çš„å¤„ç†åŠ¨ä½œ æ‰€ä»¥è¿›è¡ŒAOPç¼–ç¨‹çš„å…³é”®å°±æ˜¯å®šä¹‰åˆ‡å…¥ç‚¹å’Œå®šä¹‰å¢å¼ºå¤„ç†ï¼Œä¸€æ—¦å®šä¹‰äº†åˆé€‚çš„åˆ‡å…¥ç‚¹å’Œå¢å¼ºå¤„ç†ï¼ŒAOPæ¡†æ¶å°†è‡ªåŠ¨ç”ŸæˆAOPä»£ç†ï¼Œå³ï¼šä»£ç†å¯¹è±¡çš„æ–¹æ³•=å¢å¼ºå¤„ç†+è¢«ä»£ç†å¯¹è±¡çš„æ–¹æ³•ã€‚ Springé…ç½®AOPçš„ä¸¤ç§æ–¹å¼æ³¨è§£é…ç½®AOPæ³¨è§£é…ç½®AOPï¼ˆä½¿ç”¨ AspectJ ç±»åº“å®ç°çš„ï¼‰ï¼Œå¤§è‡´åˆ†ä¸ºä¸‰æ­¥ï¼š ä½¿ç”¨æ³¨è§£@Aspectæ¥å®šä¹‰ä¸€ä¸ªåˆ‡é¢ï¼Œåœ¨åˆ‡é¢ä¸­å®šä¹‰åˆ‡å…¥ç‚¹(@Pointcut),é€šçŸ¥ç±»å‹(@Before, @AfterReturning,@After,@AfterThrowing,@Around). å¼€å‘éœ€è¦è¢«æ‹¦æˆªçš„ç±»ã€‚ å°†åˆ‡é¢é…ç½®åˆ°xmlä¸­ï¼Œå½“ç„¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨è‡ªåŠ¨æ‰«æBeançš„æ–¹å¼ã€‚è¿™æ ·çš„è¯ï¼Œé‚£å°±äº¤ç”±Spring AOPå®¹å™¨ç®¡ç†ã€‚ applicationContextçš„é…ç½® 123456789101112131415161718192021&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xmlns:aop=\"http://www.springframework.org/schema/aop\" xsi:schemaLocation=\"http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd\"&gt; &lt;!-- proxy-target-classç­‰äºtrueæ˜¯å¼ºåˆ¶ä½¿ç”¨cglibä»£ç†ï¼Œproxy-target-classé»˜è®¤æ˜¯falseï¼Œå¦‚æœä½ çš„ç±»å®ç°äº†æ¥å£ å°±èµ°JDKä»£ç†ï¼Œå¦‚æœæ²¡æœ‰ï¼Œèµ°cglibä»£ç† --&gt; &lt;!-- å¯¹äºå•ä¾‹æ¨¡å¼å»ºè®®ä½¿ç”¨cglibä»£ç†ï¼Œè™½ç„¶JDKåŠ¨æ€ä»£ç†æ¯”cglibä»£ç†é€Ÿåº¦å¿«ï¼Œä½†æ€§èƒ½ä¸å¦‚cglib --&gt; &lt;!-- æ¿€æ´»è‡ªåŠ¨ä»£ç†åŠŸèƒ½ æ‰“å¼€aopå¯¹@Aspectjçš„æ³¨è§£æ”¯æŒ ,ç›¸å½“äºä¸ºæ³¨è§£æä¾›è§£æåŠŸèƒ½--&gt; &lt;aop:aspectj-autoproxy proxy-target-class=\"true\"/&gt; &lt;!-- æ¿€æ´»ç»„ä»¶æ‰«æåŠŸèƒ½,åœ¨åŒ…com.spring.aopåŠå…¶å­åŒ…ä¸‹é¢è‡ªåŠ¨æ‰«æé€šè¿‡æ³¨è§£é…ç½®çš„ç»„ä»¶ --&gt; &lt;context:component-scan base-package=\"com.spring.aop\"/&gt; &lt;!-- åˆ‡é¢ --&gt; &lt;bean id=\"serviceAspect\" class=\"com.spring.aop.aspect.ServiceAspect\" /&gt;&lt;/beans&gt; ä¸ºAspectåˆ‡é¢ç±»æ·»åŠ æ³¨è§£ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485package com.spring.aop.aspect;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import org.aspectj.lang.JoinPoint;import org.aspectj.lang.ProceedingJoinPoint;import org.aspectj.lang.annotation.After;import org.aspectj.lang.annotation.AfterReturning;import org.aspectj.lang.annotation.AfterThrowing;import org.aspectj.lang.annotation.Around;import org.aspectj.lang.annotation.Aspect;import org.aspectj.lang.annotation.Before;import org.aspectj.lang.annotation.Pointcut;import org.springframework.stereotype.Component;/** * ç³»ç»ŸæœåŠ¡ç»„ä»¶Aspectåˆ‡é¢Bean *///å£°æ˜è¿™æ˜¯ä¸€ä¸ªç»„ä»¶@Component//å£°æ˜è¿™æ˜¯ä¸€ä¸ªåˆ‡é¢Bean@Aspectpublic class ServiceAspect &#123; private final static Log log = LogFactory.getLog(ServiceAspect.class); //é…ç½®åˆ‡å…¥ç‚¹,è¯¥æ–¹æ³•æ— æ–¹æ³•ä½“,ä¸»è¦ä¸ºæ–¹ä¾¿åŒç±»ä¸­å…¶ä»–æ–¹æ³•ä½¿ç”¨æ­¤å¤„é…ç½®çš„åˆ‡å…¥ç‚¹ @Pointcut(\"execution(* com.spring.aop.service..*(..))\") public void aspect()&#123; &#125; /* * é…ç½®å‰ç½®é€šçŸ¥,ä½¿ç”¨åœ¨æ–¹æ³•aspect()ä¸Šæ³¨å†Œçš„åˆ‡å…¥ç‚¹ * åŒæ—¶æ¥å—JoinPointåˆ‡å…¥ç‚¹å¯¹è±¡,å¯ä»¥æ²¡æœ‰è¯¥å‚æ•° */ @Before(\"aspect()\") public void before(JoinPoint joinPoint)&#123; if(log.isInfoEnabled())&#123; log.info(\"before \" + joinPoint); &#125; &#125; //é…ç½®åç½®é€šçŸ¥,ä½¿ç”¨åœ¨æ–¹æ³•aspect()ä¸Šæ³¨å†Œçš„åˆ‡å…¥ç‚¹ @After(\"aspect()\") public void after(JoinPoint joinPoint)&#123; if(log.isInfoEnabled())&#123; log.info(\"after \" + joinPoint); &#125; &#125; //é…ç½®ç¯ç»•é€šçŸ¥,ä½¿ç”¨åœ¨æ–¹æ³•aspect()ä¸Šæ³¨å†Œçš„åˆ‡å…¥ç‚¹ @Around(\"aspect()\") public void around(JoinPoint joinPoint)&#123; long start = System.currentTimeMillis(); try &#123; ((ProceedingJoinPoint) joinPoint).proceed(); long end = System.currentTimeMillis(); if(log.isInfoEnabled())&#123; log.info(\"around \" + joinPoint + \"\\tUse time : \" + (end - start) + \" ms!\"); &#125; &#125; catch (Throwable e) &#123; long end = System.currentTimeMillis(); if(log.isInfoEnabled())&#123; log.info(\"around \" + joinPoint + \"\\tUse time : \" + (end - start) + \" ms with exception : \" + e.getMessage()); &#125; &#125; &#125; //é…ç½®åç½®è¿”å›é€šçŸ¥,ä½¿ç”¨åœ¨æ–¹æ³•aspect()ä¸Šæ³¨å†Œçš„åˆ‡å…¥ç‚¹ @AfterReturning(\"aspect()\") public void afterReturn(JoinPoint joinPoint)&#123; if(log.isInfoEnabled())&#123; log.info(\"afterReturn \" + joinPoint); &#125; &#125; //é…ç½®æŠ›å‡ºå¼‚å¸¸åé€šçŸ¥,ä½¿ç”¨åœ¨æ–¹æ³•aspect()ä¸Šæ³¨å†Œçš„åˆ‡å…¥ç‚¹ @AfterThrowing(pointcut=\"aspect()\", throwing=\"ex\") public void afterThrow(JoinPoint joinPoint, Exception ex)&#123; if(log.isInfoEnabled())&#123; log.info(\"afterThrow \" + joinPoint + \"\\t\" + ex.getMessage()); &#125; &#125; &#125; UserService.java 123456789101112131415161718192021222324252627282930313233343536package com.spring.aop.service;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import com.spring.mvc.bean.User;/** * ç”¨æˆ·æœåŠ¡æ¨¡å‹ */public class UserService &#123; private final static Log log = LogFactory.getLog(UserService.class); public User get(long id)&#123; if(log.isInfoEnabled())&#123; log.info(\"getUser method . . .\"); &#125; return new User(); &#125; public void save(User user)&#123; if(log.isInfoEnabled())&#123; log.info(\"saveUser method . . .\"); &#125; &#125; public boolean delete(long id) throws Exception&#123; if(log.isInfoEnabled())&#123; log.info(\"delete method . . .\"); throw new Exception(\"spring aop ThrowAdviceæ¼”ç¤º\"); &#125; return false; &#125; &#125; æµ‹è¯•ä»£ç  12345678910111213141516171819202122232425262728293031323334package com.spring.aop;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import org.springframework.context.ApplicationContext;import org.springframework.context.support.ClassPathXmlApplicationContext;import com.spring.aop.service.UserService;import com.spring.mvc.bean.User;/** * Spring AOPæµ‹è¯• */public class Tester &#123; private final static Log log = LogFactory.getLog(Tester.class); public static void main(String[] args) &#123; //å¯åŠ¨Springå®¹å™¨ ApplicationContext context = new ClassPathXmlApplicationContext(\"applicationContext.xml\"); //è·å–serviceç»„ä»¶ UserService service = (UserService) context.getBean(\"userService\"); //ä»¥æ™®é€šçš„æ–¹å¼è°ƒç”¨UserServiceå¯¹è±¡çš„ä¸‰ä¸ªæ–¹æ³• User user = service.get(1L); service.save(user); try &#123; service.delete(1L); &#125; catch (Exception e) &#123; if(log.isWarnEnabled())&#123; log.warn(\"Delete user : \" + e.getMessage()); &#125; &#125; &#125;&#125; æ§åˆ¶å°è¾“å‡ºå¦‚ä¸‹ï¼š 12345678910111213141516INFO [spring.aop.aspect.ServiceAspect:40] before execution(User com.spring.aop.service.UserService.get(long))INFO [spring.aop.service.UserService:19] getUser method . . .INFO [spring.aop.aspect.ServiceAspect:60] around execution(User com.spring.aop.service.UserService.get(long)) Use time : 42 ms!INFO [spring.aop.aspect.ServiceAspect:48] after execution(User com.spring.aop.service.UserService.get(long))INFO [spring.aop.aspect.ServiceAspect:74] afterReturn execution(User com.spring.aop.service.UserService.get(long))INFO [spring.aop.aspect.ServiceAspect:40] before execution(void com.spring.aop.service.UserService.save(User))INFO [spring.aop.service.UserService:26] saveUser method . . .INFO [spring.aop.aspect.ServiceAspect:60] around execution(void com.spring.aop.service.UserService.save(User)) Use time : 2 ms!INFO [spring.aop.aspect.ServiceAspect:48] after execution(void com.spring.aop.service.UserService.save(User))INFO [spring.aop.aspect.ServiceAspect:74] afterReturn execution(void com.spring.aop.service.UserService.save(User))INFO [spring.aop.aspect.ServiceAspect:40] before execution(boolean com.spring.aop.service.UserService.delete(long))INFO [spring.aop.service.UserService:32] delete method . . .INFO [spring.aop.aspect.ServiceAspect:65] around execution(boolean com.spring.aop.service.UserService.delete(long)) Use time : 5 ms with exception : spring aop ThrowAdviceæ¼”ç¤ºINFO [spring.aop.aspect.ServiceAspect:48] after execution(boolean com.spring.aop.service.UserService.delete(long))INFO [spring.aop.aspect.ServiceAspect:74] afterReturn execution(boolean com.spring.aop.service.UserService.delete(long))WARN [studio.spring.aop.Tester:32] Delete user : Null return value from advice does not match primitive return type for: public boolean com.spring.aop.service.UserService.delete(long) throws java.lang.Exception å¯ä»¥çœ‹åˆ°ï¼Œæ­£å¦‚æˆ‘ä»¬é¢„æœŸçš„é‚£æ ·ï¼Œè™½ç„¶æˆ‘ä»¬å¹¶æ²¡æœ‰å¯¹UserSerivceç±»åŒ…æ‹¬å…¶è°ƒç”¨æ–¹å¼åšä»»ä½•æ”¹å˜ï¼Œä½†æ˜¯Springä»ç„¶æ‹¦æˆªåˆ°äº†å…¶ä¸­æ–¹æ³•çš„è°ƒç”¨ï¼Œæˆ–è®¸è¿™æ­£æ˜¯AOPçš„é­”åŠ›æ‰€åœ¨ã€‚ XMLé…ç½®AOPXMLé…ç½® 12345678910111213141516171819202122232425&lt;?xml version=\"1.0\" encoding=\"UTF-8\"?&gt;&lt;beans xmlns=\"http://www.springframework.org/schema/beans\" xmlns:xsi=\"http://www.w3.org/2001/XMLSchema-instance\" xmlns:context=\"http://www.springframework.org/schema/context\" xmlns:aop=\"http://www.springframework.org/schema/aop\" xsi:schemaLocation=\"http://www.springframework.org/schema/aop http://www.springframework.org/schema/aop/spring-aop-3.1.xsd http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-3.0.xsd\"&gt; &lt;!-- ç³»ç»ŸæœåŠ¡ç»„ä»¶çš„åˆ‡é¢Bean --&gt; &lt;bean id=\"serviceAspect\" class=\"com.spring.aop.aspect.ServiceAspect\"/&gt; &lt;!-- AOPé…ç½® --&gt; &lt;aop:config&gt; &lt;!-- å£°æ˜ä¸€ä¸ªåˆ‡é¢,å¹¶æ³¨å…¥åˆ‡é¢Bean,ç›¸å½“äº@Aspect --&gt; &lt;aop:aspect id=\"simpleAspect\" ref=\"serviceAspect\"&gt; &lt;!-- é…ç½®ä¸€ä¸ªåˆ‡å…¥ç‚¹,ç›¸å½“äº@Pointcut --&gt; &lt;aop:pointcut expression=\"execution(* com.spring.aop.service..*(..))\" id=\"simplePointcut\"/&gt; &lt;!-- é…ç½®é€šçŸ¥,ç›¸å½“äº@Beforeã€@Afterã€@AfterReturnã€@Aroundã€@AfterThrowing --&gt; &lt;aop:before pointcut-ref=\"simplePointcut\" method=\"before\"/&gt; &lt;aop:after pointcut-ref=\"simplePointcut\" method=\"after\"/&gt; &lt;aop:after-returning pointcut-ref=\"simplePointcut\" method=\"afterReturn\"/&gt; &lt;aop:after-throwing pointcut-ref=\"simplePointcut\" method=\"afterThrow\" throwing=\"ex\"/&gt; &lt;/aop:aspect&gt; &lt;/aop:config&gt;&lt;/beans&gt; ServiceAspect.java 1234567891011121314151617181920212223//é…ç½®å‰ç½®é€šçŸ¥,æ‹¦æˆªè¿”å›å€¼ä¸ºcom.spring.mvc.bean.Userçš„æ–¹æ³•@Before(\"execution(com.spring.mvc.bean.User com.spring.aop.service..*(..))\")public void beforeReturnUser(JoinPoint joinPoint)&#123; if(log.isInfoEnabled())&#123; log.info(\"beforeReturnUser \" + joinPoint); &#125;&#125;//é…ç½®å‰ç½®é€šçŸ¥,æ‹¦æˆªå‚æ•°ä¸ºcom.spring.mvc.bean.Userçš„æ–¹æ³•@Before(\"execution(* com.spring.aop.service..*(com.spring.mvc.bean.User))\")public void beforeArgUser(JoinPoint joinPoint)&#123; if(log.isInfoEnabled())&#123; log.info(\"beforeArgUser \" + joinPoint); &#125;&#125;//é…ç½®å‰ç½®é€šçŸ¥,æ‹¦æˆªå«æœ‰longç±»å‹å‚æ•°çš„æ–¹æ³•,å¹¶å°†å‚æ•°å€¼æ³¨å…¥åˆ°å½“å‰æ–¹æ³•çš„å½¢å‚idä¸­@Before(\"aspect()&amp;&amp;args(id)\")public void beforeArgId(JoinPoint joinPoint, long id)&#123; if(log.isInfoEnabled())&#123; log.info(\"beforeArgId \" + joinPoint + \"\\tID:\" + id); &#125;&#125; UserService.java 123456789101112131415161718192021222324252627282930313233343536package com.spring.aop.service;import org.apache.commons.logging.Log;import org.apache.commons.logging.LogFactory;import com.spring.mvc.bean.User;/** * ç”¨æˆ·æœåŠ¡æ¨¡å‹ */public class UserService &#123; private final static Log log = LogFactory.getLog(UserService.class); public User get(long id)&#123; if(log.isInfoEnabled())&#123; log.info(\"getUser method . . .\"); &#125; return new User(); &#125; public void save(User user)&#123; if(log.isInfoEnabled())&#123; log.info(\"saveUser method . . .\"); &#125; &#125; public boolean delete(long id) throws Exception&#123; if(log.isInfoEnabled())&#123; log.info(\"delete method . . .\"); throw new Exception(\"spring aop ThrowAdviceæ¼”ç¤º\"); &#125; return false; &#125; &#125; æ€»ç»“SpringAopå¯ä»¥ç”¨æ¥ï¼š Springå£°æ˜å¼äº‹åŠ¡ç®¡ç†é…ç½®ã€‚ åœ¨æ‰§è¡Œæ–¹æ³•å‰,åˆ¤æ–­æ˜¯å¦å…·æœ‰æƒé™ã€‚ å¯¹éƒ¨åˆ†å‡½æ•°çš„è°ƒç”¨è¿›è¡Œæ—¥å¿—è®°å½•ã€‚ç›‘æ§éƒ¨åˆ†é‡è¦å‡½æ•°ï¼Œè‹¥æŠ›å‡ºæŒ‡å®šçš„å¼‚å¸¸ï¼Œå¯ä»¥ä»¥çŸ­ä¿¡æˆ–é‚®ä»¶æ–¹å¼é€šçŸ¥ç›¸å…³äººå‘˜ã€‚ ä½¿ç”¨Spring AOPå®ç°MySQLæ•°æ®åº“è¯»å†™åˆ†ç¦»ã€‚ ä¿¡æ¯è¿‡æ»¤ â€¦â€¦","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"spring","slug":"spring","permalink":"https://sunny0715.github.io/tags/spring/"}]},{"title":"è·¨é¡µé¢(Tab/Window)é€šä¿¡çš„å‡ ç§æ–¹æ³•","slug":"è·¨é¡µé¢-Tab-Window-é€šä¿¡çš„å‡ ç§æ–¹æ³•","date":"2017-09-01T02:32:43.000Z","updated":"2018-03-13T05:54:15.005Z","comments":true,"path":"2017/09/01/è·¨é¡µé¢-Tab-Window-é€šä¿¡çš„å‡ ç§æ–¹æ³•/","link":"","permalink":"https://sunny0715.github.io/2017/09/01/è·¨é¡µé¢-Tab-Window-é€šä¿¡çš„å‡ ç§æ–¹æ³•/","excerpt":"â€‹ ä»Šå¤©å¼€å‘ä¸€ä¸ªåŠŸèƒ½é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œåœ¨Aé¡µé¢ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…åæ‰“å¼€Bé¡µé¢è¿›è¡Œä¿®æ”¹æˆ–åˆ é™¤ï¼Œåˆ é™¤åBé¡µé¢å…³é—­ï¼Œç„¶ååˆ·æ–°Aé¡µé¢é‡Œé¢çš„æ•°æ®ã€‚ç›¸å½“äºå°±æ˜¯ä¸¤ä¸ªé¡µé¢ä¹‹é—´è¿›è¡Œé€šè®¯ï¼Œä½œä¸ºåç«¯çš„æˆ‘ç¬¬ä¸€æƒ³æ³•æ˜¯åˆ©ç”¨webSocket è¿›è¡Œé€šè®¯ï¼Œä¹‹åé€šè¿‡è°·æ­Œå’Œç™¾åº¦æ‰¾å‡ºäº†æ›´ä¸ºç®€ä¾¿çš„æ–¹æ³•ã€‚","text":"â€‹ ä»Šå¤©å¼€å‘ä¸€ä¸ªåŠŸèƒ½é‡åˆ°ä¸€ä¸ªéœ€æ±‚ï¼Œåœ¨Aé¡µé¢ç‚¹å‡»æŸ¥çœ‹è¯¦æƒ…åæ‰“å¼€Bé¡µé¢è¿›è¡Œä¿®æ”¹æˆ–åˆ é™¤ï¼Œåˆ é™¤åBé¡µé¢å…³é—­ï¼Œç„¶ååˆ·æ–°Aé¡µé¢é‡Œé¢çš„æ•°æ®ã€‚ç›¸å½“äºå°±æ˜¯ä¸¤ä¸ªé¡µé¢ä¹‹é—´è¿›è¡Œé€šè®¯ï¼Œä½œä¸ºåç«¯çš„æˆ‘ç¬¬ä¸€æƒ³æ³•æ˜¯åˆ©ç”¨webSocket è¿›è¡Œé€šè®¯ï¼Œä¹‹åé€šè¿‡è°·æ­Œå’Œç™¾åº¦æ‰¾å‡ºäº†æ›´ä¸ºç®€ä¾¿çš„æ–¹æ³•ã€‚ åˆ©ç”¨webSocketè¿›è¡Œé€šè®¯â€‹ ç¬¬ä¸€æƒ³æ³•æ˜¯è¿™ä¸ªï¼Œä½†æ˜¯è¿™æ ·çš„è¯å·¥ä½œé‡å·¨å¤§è€Œä¸”è¿˜éœ€è¦åç«¯æ”¯æŒï¼Œå¤ªéº»çƒ¦äº†ï¼Œå¯¹äºæˆ‘è¿™ç§æ‡’äººç›´æ¥å°±æ”¾å¼ƒäº†ï¼Œå»å¯»æ‰¾æœ‰æ²¡æœ‰æ›´ç®€ä¾¿çš„æ–¹æ³•ã€‚ å®šæ—¶å™¨ä¸æ–­æ£€æŸ¥cookieså˜åŒ–åœ¨stackoverflowä¸Šçœ‹åˆ°ä¸€ä¸ªæ–¹æ¡ˆï¼Œå¤§è‡´æ€è·¯æ˜¯ï¼š åœ¨é¡µé¢Aè®¾ç½®ä¸€ä¸ªä½¿ç”¨ setInterval å®šæ—¶å™¨ä¸æ–­åˆ·æ–°ï¼Œæ£€æŸ¥ Cookies çš„å€¼æ˜¯å¦å‘ç”Ÿå˜åŒ–ï¼Œå¦‚æœå˜åŒ–å°±è¿›è¡Œåˆ·æ–°çš„æ“ä½œã€‚ ç”±äº Cookies æ˜¯åœ¨åŒåŸŸå¯è¯»çš„ï¼Œæ‰€ä»¥åœ¨é¡µé¢ B å®¡æ ¸çš„æ—¶å€™æ”¹å˜ Cookies çš„å€¼ï¼Œé¡µé¢ A è‡ªç„¶æ˜¯å¯ä»¥æ‹¿åˆ°çš„ã€‚è¿™æ ·åšç¡®å®å¯ä»¥å®ç°æˆ‘æƒ³è¦çš„åŠŸèƒ½ï¼Œä½†æ˜¯è¿™æ ·çš„æ–¹æ³•ç›¸å½“æµªè´¹èµ„æºã€‚è™½ç„¶åœ¨è¿™ä¸ªæ€§èƒ½è¿‡ç››çš„æ—¶ä»£ï¼Œæµªè´¹ä¸æµªè´¹ä¹Ÿæ„Ÿè§‰ä¸å‡ºæ¥ï¼Œä½†æ˜¯è¿™ç§å®ç°æ–¹æ¡ˆï¼Œç¡®å®ä¸å¤Ÿä¼˜(zhuÄng)é›…ï¼ˆbÄ«ï¼‰ã€‚ localStorageçš„äº‹ä»¶åŠŸå¤«ä¸è´Ÿæœ‰å¿ƒäººï¼Œåæ¥å‘ç° window æœ‰ä¸€ä¸ª StorageEvent ï¼Œæ¯å½“ localStorage æ”¹å˜çš„æ—¶å€™å¯ä»¥è§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚ï¼ˆè¿™ä¸ªåŸç†å°±åƒä½ ç»™ä¸€ä¸ªDOM ç»‘å®šäº† click äº‹ä»¶ï¼Œå½“ä½ ç‚¹å‡»å®ƒçš„æ—¶å€™ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘ã€‚ï¼‰ä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ç»™ window ç»‘å®šè¿™ä¸ªäº‹ä»¶åï¼Œæ¯å½“æˆ‘æ”¹å˜ localStorage çš„æ—¶å€™ï¼Œä»–éƒ½ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚ 123window.addEventListener(&apos;storage&apos;, function (event) &#123; console.log(event);&#125;); è¿™ä¸ªå›è°ƒä¸­çš„eventä¸æ™®é€šçš„EVNET,åŸºæœ¬å·®ä¸å¤šï¼Œä½†æ˜¯å®ƒæ¯”å…¶ä»–çš„eventå¤šäº†å¦‚ä¸‹å‡ ä¸ªå±æ€§: å±æ€§ æè¿° key å—å½±å“çš„ localStorage çš„ key newValue æ–°çš„å€¼ oldValue æ—§çš„å€¼ url è§¦å‘æ­¤äº‹ä»¶çš„url æ¯å½“ä¸€ä¸ªé¡µé¢æ”¹å˜äº† localStorage çš„å€¼ï¼Œéƒ½ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶ã€‚ä¹Ÿå°±æ˜¯è¯´å¯ä»¥å¾ˆå®¹æ˜“çš„é€šè¿‡æ”¹å˜ localStorage çš„å€¼ï¼Œæ¥å®ç°æµè§ˆå™¨ä¸­è·¨é¡µé¢( tab / window )ä¹‹é—´çš„é€šè®¯ã€‚è®°ä½è¿™ä¸ªäº‹ä»¶åªæœ‰åœ¨ localStorage å‘ç”Ÿæ”¹å˜çš„æ—¶å€™æ‰ä¼šè¢«è§¦å‘ï¼Œå¦‚æœæ²¡æ”¹å˜åˆ™ä¸ä¼šè§¦å‘æ­¤äº‹ä»¶ã€‚ 123localStorage.setItem(&apos;delete&apos;,1); //è§¦å‘localStorage.setItem(&apos;delete&apos;,1); //ä¸è§¦å‘localStorage.setItem(&apos;delete&apos;,2); //è§¦å‘ åœ¨ä½¿ç”¨çš„æ—¶å€™åŠ¡å¿…æ³¨æ„è¿™ä¸€ç‚¹ã€‚æœ€ç»ˆå®ç°ä»£ç : é¡µé¢Aï¼š 123456//é¡µé¢ Awindow.addEventListener(&apos;storage&apos;, function (event) &#123; if(event.key === &apos;delete_verify_list&apos;)&#123; //é¡µé¢æ“ä½œ &#125;&#125;); é¡µé¢Bï¼š 1234567891011121314//é¡µé¢ B/** * è·å–ä¸€ä¸ªéšæœºid * @return &#123;String&#125; - è¿”å›ä¸€ä¸ª5ä½çš„éšæœºå­—ç¬¦ä¸² */function randomId() &#123; return (Math.random() * 1E18).toString(36).slice(0, 5).toUpperCase();&#125;//æ¯å½“éœ€è¦é¡µé¢Aæ›´æ–°æ—¶ æ‰§è¡Œæ­¤æ–¹æ³•if (localStorage) &#123; //ä¸ºä¿è¯æ¯æ¬¡é¡µé¢Aéƒ½æ‰§è¡Œï¼Œæ­¤å¤„æˆ‘è®¾ç½®é‡Œä¸€ä¸ªéšæœºå­—ç¬¦ä¸² localStorage.setItem(&apos;delete_verify_list&apos;, randomId());&#125; å‚è€ƒï¼šhttps://ponyfoo.com/articles/cross-tab-communication","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://sunny0715.github.io/tags/å‰ç«¯/"}]},{"title":"JAVAå®ç°HTMLè½¬PDF","slug":"JAVAå®ç°HTMLè½¬PDF","date":"2017-07-27T05:22:32.000Z","updated":"2018-03-13T05:49:40.032Z","comments":true,"path":"2017/07/27/JAVAå®ç°HTMLè½¬PDF/","link":"","permalink":"https://sunny0715.github.io/2017/07/27/JAVAå®ç°HTMLè½¬PDF/","excerpt":"â€‹ æœ€è¿‘å…¬å¸é‡Œé¢æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œåœ¨çº¿é¢˜å¡ï¼Œå°±æ˜¯æŠŠå®¢æˆ·åœ¨çº¿ç¼–è¾‘çš„é¢˜å¡æ ·å¼ä¿å­˜ä¸‹æ¥ï¼Œç„¶åå¯ä»¥å¯¼å‡ºä¸ºPDFæ ¼å¼ã€‚äºæ˜¯ä¸Šç½‘æ‰¾äº†ä¸€ç³»åˆ—çš„èµ„æ–™ï¼Œæ‰¾åˆ°äº†ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š ä½¿ç”¨wkhtmltox ä½¿ç”¨iText+Flying Saucer ä½†æ˜¯è¿˜æ˜¯å¼ºçƒˆæ¨èç”¨ç¬¬ä¸€ç§æ–¹æ³•ã€‚","text":"â€‹ æœ€è¿‘å…¬å¸é‡Œé¢æœ‰ä¸€ä¸ªä»»åŠ¡ï¼Œåœ¨çº¿é¢˜å¡ï¼Œå°±æ˜¯æŠŠå®¢æˆ·åœ¨çº¿ç¼–è¾‘çš„é¢˜å¡æ ·å¼ä¿å­˜ä¸‹æ¥ï¼Œç„¶åå¯ä»¥å¯¼å‡ºä¸ºPDFæ ¼å¼ã€‚äºæ˜¯ä¸Šç½‘æ‰¾äº†ä¸€ç³»åˆ—çš„èµ„æ–™ï¼Œæ‰¾åˆ°äº†ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š ä½¿ç”¨wkhtmltox ä½¿ç”¨iText+Flying Saucer ä½†æ˜¯è¿˜æ˜¯å¼ºçƒˆæ¨èç”¨ç¬¬ä¸€ç§æ–¹æ³•ã€‚ ä½¿ç”¨wkhtmltox(æ¨è)wkhtmltoxå®ç°ç½‘é¡µè½¬æ¢æˆå›¾ç‰‡æˆ–PDF å‘½ä»¤å®ç° è¿›å…¥wkhtmltoxå®˜ç½‘è½¯ä»¶ä¸‹è½½ ï¼šhttps://wkhtmltopdf.org/downloads.html å®‰è£…å®Œæˆåè¿›å…¥${home}/binç›®å½•ä¸‹æœ‰ä¸¤ä¸ªexeæ–‡ä»¶ï¼Œé€šè¿‡åç§°å°±å¯ä»¥è¾¨åˆ«wkhtmltoimage.exeæ˜¯å°†HTMLè½¬åŒ–ä¸ºimageï¼Œwkhtmltopdf.exeæ˜¯å°†HTMLè½¬åŒ–ä¸ºPDFæ–‡ä»¶ï¼Œè¿™æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ è¿›å…¥${home}/binç›®å½•ä¸‹æ‰“å¼€cmdè¾“å…¥ä»¥ä¸‹å‘½ä»¤éªŒè¯ 12wkhtmltopdf HTMLè·¯å¾„ ä¿å­˜è·¯å¾„å¦‚ï¼š wkhtmltopdf www.baidu.com d:\\test.pdf ç”Ÿæˆå®Œæˆåä¼šå‡ºç°Doneã€‚ ä»£ç å®ç°JAVAä»£ç ä¸­è°ƒç”¨wkhtmltopdfç”ŸæˆPDFæ–‡ä»¶ï¼Œä»¥ä¸‹ä¸ºä»£ç ç‰‡æ®µ 1234567891011121314151617181920212223242526272829303132333435363738/** * HTMLTOPPDF * åˆ©ç”¨wkhtmltopdfç”ŸæˆPDF */public class HtmlToPDF &#123; //wkhtmltopdf.exeå®‰è£…è·¯å¾„ public static final String toPdfTool = \"E:\\\\SmallTools\\\\wkhtmltox\\\\wkhtmltopdf\\\\bin\\\\wkhtmltopdf.exe\"; //éœ€è¦ç”ŸæˆPDFçš„URL public static final String srcPath = \"http://www.jianshu.com/p/4d65857ffe5e\"; public static void main(String[] args) throws Exception&#123; //è®¾ç½®çº¸å¼ å¤§å°: A4, Letter, etc. String pageSize = \"A4\"; //ç”Ÿæˆåå­˜æ”¾è·¯å¾„ String destPath = \"E:\\\\PDFç”Ÿæˆæ•™ç¨‹åŠè®²è§£.pdf\"; convert(pageSize, destPath); &#125; public static void convert(String pageSize, String destPath)&#123; File file = new File(destPath); File parent = file.getParentFile(); if (!parent.exists())&#123; parent.mkdirs(); &#125; StringBuilder cmd = new StringBuilder(); cmd.append(toPdfTool).append(\" \"); cmd.append(\"--page-size \"); cmd.append(pageSize).append(\" \"); cmd.append(srcPath).append(\" \"); cmd.append(destPath); try &#123; Runtime.getRuntime().exec(cmd.toString()); &#125;catch (IOException e)&#123; e.printStackTrace(); &#125; &#125;&#125; è¯¦ç»†å‚æ•°è¯´æ˜å¯å‚è€ƒï¼šhttp://www.jianshu.com/p/4d65857ffe5e ä½¿ç”¨iText+Flying Saucer123456789itextå¯å®ç° 1.å¯ä»¥è¿›è¡Œå—çš„åˆ›å»º2.è¡¨æ ¼çš„ä½¿ç”¨3.è®¾ç½®é¡µé¢çš„äº‹ä»¶4.å­—ä½“çš„è®¾ç½®5.å›¾ç‰‡çš„è®¾ç½®ï¼ˆåŒ…å«æ°´å°ï¼‰6.HTMLè½¬åŒ–æˆPDFï¼ˆæ”¯æŒcss,javascriptï¼‰7.è¡¨å•åˆ›å»º8.PDFä¹‹é—´çš„æ“ä½œç­‰è¯¦ç»†çš„å†…å®¹å¯ä»¥æŸ¥çœ‹ç½‘ç«™çš„è¯´æ˜ã€‚ Mavené…ç½®12345678910&lt;dependency&gt; &lt;groupId&gt;com.itextpdf&lt;/groupId&gt; &lt;artifactId&gt;itextpdf&lt;/artifactId&gt; &lt;version&gt;5.8.8&lt;/version&gt;&lt;/dependency&gt;&lt;dependency&gt; &lt;groupId&gt;org.xhtmlrenderer&lt;/groupId&gt; &lt;artifactId&gt;flying-saucer-pdf&lt;/artifactId&gt; &lt;version&gt;9.1.6&lt;/version&gt;&lt;/dependency&gt; ä»£ç ç‰‡æ®µ1234567891011121314151617181920212223/** * ç”Ÿæˆpdfï¼Œæ·»åŠ ç”Ÿæˆpdfæ‰€ä½¿ç”¨çš„å­—ç¬¦é›†.æ³¨ï¼šè¿™é‡Œå­—ç¬¦é›†è¦å’Œæ¨¡æ¿ä¸­ä½¿ç”¨çš„å­—ç¬¦é›†ä¸€ä¸€è‡´ã€‚ */public class HtmlToPDF &#123; public static void main(String[] args) throws Exception&#123; Document document = new Document(PageSize.A4.rotate()); //è®¾ç½®ä¸ºA4çº¸å¤§å° ITextRenderer renderer = new ITextRenderer(); ITextFontResolver fontResolver = renderer.getFontResolver(); fontResolver.addFont(\"D:/simsun.ttc\", BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED); // step 2 PdfWriter writer = PdfWriter.getInstance(document, new FileOutputStream(\"D:\\\\pdf.pdf\")); // step 3 document.open(); // step 4 XMLWorkerHelper.getInstance().parseXHtml(writer, document, new FileInputStream(\"D:/a.html\")); //step 5 document.close(); System.out.println( \"PDF Created!\" ); &#125;&#125; æ³¨æ„äº‹é¡¹ .è¾“å…¥çš„HTMLé¡µé¢å¿…é¡»æ˜¯æ ‡å‡†çš„XHTMLé¡µé¢ã€‚é¡µé¢çš„é¡¶ä¸Šå¿…é¡»æ˜¯è¿™æ ·çš„æ ¼å¼ï¼š 12&lt;!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional//EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\"&gt; &lt;html xmlns=\"http://www.w3.org/1999/xhtml\"&gt; ç”ŸæˆPDFï¼Œæ·»åŠ ç”ŸæˆPDFæ‰€ä½¿ç”¨çš„å­—ç¬¦é›†.æ³¨ï¼šè¿™é‡Œå­—ç¬¦é›†è¦å’Œæ¨¡æ¿ä¸­ä½¿ç”¨çš„å­—ç¬¦é›†ä¸€ä¸€è‡´ã€‚ æ¯”å¦‚:javaä¸­ä½¿ç”¨å®‹ä½“ renderer.getFontResolver().addFont(â€œC:/Windows/Fonts/simsun.ttcâ€, BaseFont.IDENTITY_H, BaseFont.NOT_EMBEDDED); é‚£ä¹ˆHTMLçš„bodyä¸­æ ·å¼å¿…é¡»åŠ ä¸Š style=â€™font-family:SimSunâ€™ï¼Œè¦æ˜¯ä½¿ç”¨å…¶ä»–å­—ç¬¦ç”Ÿæˆpdfæ—¶å€™ï¼Œä¸­æ–‡å°±ä¼šä¸æ˜¾ç¤ºç”ŸæˆPDF è®¾ç½®PDFçš„é¡µé¢å¤§å°æ¨¡æ¿é¡µé¢ä¸­æ·»åŠ è¯¥æ ·å¼ï¼š@page { size: 8.5in 11in; }è¿™æ—¶å€™ç”ŸæˆPDFé¡µé¢æ­£å¥½æ˜¯A4çº¸å¤§å° æ‰€éœ€çš„jaråŒ…ï¼Œä¸‹è½½ç‚¹æˆ‘ã€‚æ ¸å¿ƒjaræ˜¯ä¿®æ”¹åçš„ æ¯”è¾ƒå’Œæ€»ç»“æ¯”è¾ƒitext 1231. javaç”ŸæˆPDFå¤§éƒ¨åˆ†éƒ½æ˜¯ç”¨itextï¼Œitextçš„ç¡®æ˜¯javaå¼€æºç»„ä»¶çš„ç¬¬ä¸€é€‰æ‹©ã€‚ä¸è¿‡itextä¹Ÿæœ‰å±€é™ï¼Œå°±æ˜¯è¦è‡ªå·±å†™æ¨¡ç‰ˆï¼Œç³»ç»Ÿä¸­çš„è¡¨å•æ•°é‡æœ‰å¥½å‡ ç™¾ä¸ªï¼Œä¸ºæ¯ä¸ªè¡¨å•åšä¸€ä¸ªå¯¼å‡ºæ¨¡ç‰ˆä¸ç°å®ã€‚2. å¹¶ä¸”itextä¸­æ–‡é€‚é…ä¸æ˜¯å¾ˆå¥½å’Œæ¢è¡Œé—®é¢˜ã€‚3. ä¸”å¯¹HTMLæ ¼å¼è¦æ±‚ä¸¥æ ¼ã€‚ wkhtmltopdf 1231. ç”ŸæˆPDFæ—¶ä¼šè‡ªåŠ¨æ ¹æ®ä½ åœ¨HTMLé¡µé¢ä¸­Hæ ‡ç­¾ç”Ÿæˆæ ‘å½¢ç›®å½•ç»“æ„ã€‚2. å°å·§æ–¹ä¾¿ï¼Œè½¬æ¢é€Ÿåº¦å¿«ã€‚3. è·¨å¹³å°ï¼Œåœ¨Liunxä¸‹ç”¨ï¼Œåœ¨winä¸‹ä¹Ÿå¯ä»¥ç”¨ã€‚ æ€»ç»“â€‹ ç»¼ä¸Šæ¯”è¾ƒï¼Œwkhtmltopdfæ˜¯å°†HTMLè½¬ä¸ºå›¾ç‰‡æˆ–æ˜¯PDFæœ€å¥½çš„é€‰æ‹©ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"}]},{"title":"é™æ€æœåŠ¡å™¨æ­å»ºåŠå‰ç«¯çŸ¥è¯†ç‚¹","slug":"é™æ€æœåŠ¡å™¨æ­å»ºåŠå‰ç«¯çŸ¥è¯†ç‚¹","date":"2017-06-13T06:24:21.000Z","updated":"2018-03-25T04:28:42.066Z","comments":true,"path":"2017/06/13/é™æ€æœåŠ¡å™¨æ­å»ºåŠå‰ç«¯çŸ¥è¯†ç‚¹/","link":"","permalink":"https://sunny0715.github.io/2017/06/13/é™æ€æœåŠ¡å™¨æ­å»ºåŠå‰ç«¯çŸ¥è¯†ç‚¹/","excerpt":"å¼•è¨€â€‹ è™½ç„¶æ˜¯åšåå°å¼€å‘ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™è‡ªå·±ä¹Ÿå…¼é¡¾äº†å‰å°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é¡¹ç›®éƒ½æ˜¯å‰åå°åˆ†ç¦»å¼€å‘ï¼Œæ‰€ä»¥åœ¨å¼€å‘æœŸé—´è‡ªå·±ä¹Ÿæ€»ç»“å’Œå­¦ä¹ äº†å‰ç«¯äº†ä¸€äº›å°çŸ¥è¯†ï¼Œåœ¨è¿™é‡Œè¿›è¡Œæ€»ç»“ï¼Œä»¥ä¾¿è‡ªå·±æ¸©ä¹ ã€‚","text":"å¼•è¨€â€‹ è™½ç„¶æ˜¯åšåå°å¼€å‘ï¼Œä½†æ˜¯å¾ˆå¤šæ—¶å€™è‡ªå·±ä¹Ÿå…¼é¡¾äº†å‰å°ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„é¡¹ç›®éƒ½æ˜¯å‰åå°åˆ†ç¦»å¼€å‘ï¼Œæ‰€ä»¥åœ¨å¼€å‘æœŸé—´è‡ªå·±ä¹Ÿæ€»ç»“å’Œå­¦ä¹ äº†å‰ç«¯äº†ä¸€äº›å°çŸ¥è¯†ï¼Œåœ¨è¿™é‡Œè¿›è¡Œæ€»ç»“ï¼Œä»¥ä¾¿è‡ªå·±æ¸©ä¹ ã€‚ NodeJSæ­å»ºé™æ€èµ„æºæœåŠ¡å™¨å¯¹Node.jsåªæœ‰æµ…æ˜¾çš„è®¤è¯†ï¼Œä½†æ˜¯æœ‰æ—¶å€™åˆè¦è‡ªå·±æ­å»ºé™æ€æœåŠ¡å™¨è¿›è¡Œæµ‹è¯•ã€‚æ­å»ºé™æ€æœåŠ¡å™¨éœ€è¦ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š ä¸‹è½½node.jsï¼Œè¿›å…¥node.jså®˜ç½‘ä¸‹è½½http://nodejs.cnå¯¹åº”çš„ç‰ˆæœ¬ã€‚ å®‰è£…node.jsã€‚ å¯åŠ¨node.jsï¼Œåœ¨å‘½ä»¤è¡Œè¾“å…¥å‘½ä»¤å®‰è£…éœ€è¦çš„æ¨¡å—ï¼Œä¾æ¬¡æ‰§è¡Œå‘½ä»¤ã€‚ 123npm install expressnpm install requestnpm install http-server ç®€å•çš„é™æ€æœåŠ¡å™¨æ–°å»ºserver.jsï¼Œå†…å®¹ä¸º 1234567891011var express = require('express');var http = require(\"http\");var request = require('request');var app = express();//å¯åŠ¨ç«¯å£ä¸º81var port = process.env.PORT||81; //é™æ€èµ„æºå­˜æ”¾çš„è·¯å¾„ app.use(express.static('E:/SmallTools/StaticServer'));http.createServer(app).listen(port);console.log(\"æœåŠ¡å¯åŠ¨æˆåŠŸ\"); å¯åŠ¨server.js é€šè¿‡httpè¯·æ±‚è®¿é—®a.htmlé¡µé¢ å¯ä»¥è®¿é—®è¯´æ˜æ­å»ºæˆåŠŸï¼ å¸¦åå‘ä»£ç†é™æ€æœåŠ¡å™¨æ­å»ºæ–°å»ºserver-kaow-school.jsï¼Œå†…å®¹ä¸º 123456789101112131415161718192021222324var express = require('express');var http = require(\"http\");var https = require('https');var request = require('request');var app = express();//app.disable('x-powered-by');var port = process.env.PORT||81;app.use(express.static('E:/SmallTools/StaticServer'));function proxy(app,route,remoteDomain)&#123; app.use(route,function(req,res)&#123; var url = remoteDomain+req.url; req.pipe(request(url)).pipe(res); &#125;);&#125;//10.9.4.215:8380 æµ‹è¯•æœåŠ¡å™¨ipproxy(app,'/163','http://www.163.com');//proxy(app,'/MonitorService/','http://10.9.4.215:9192/MonitorService/'); http.createServer(app).listen(port);console.log(\"æœåŠ¡å™¨å¯åŠ¨å®Œæˆ,è¯·ä½¿ç”¨locahost:\"+port+\"è®¿é—®\"); å¯åŠ¨server-kaow-school.js é€šè¿‡httpè¯·æ±‚è®¿é—®b.htmlé¡µé¢ è®¿é—®/163 å¯ä»¥è®¿é—®è¯´æ˜å¸¦åå‘ä»£ç†çš„é™æ€æœåŠ¡å™¨æ­å»ºæˆåŠŸï¼ å‰ç«¯çŸ¥è¯†ç‚¹ JSå­—ç¬¦ä¸²æˆªå–ç©ºç™½trim()çš„åŸå‹å®ç°123String.prototype.trim = function()&#123; return this.replace( /(^\\s*)|(\\s*$)/g , ''\");&#125; JSå±è”½é”®ç›˜æŒ‰é”®12345678910111213141516171819202122232425262728293031323334353637383940414243444546&lt;body oncontextmenu=\"return false\" onselectstart=\"return false\" ondragstart=\"return false\" onbeforecopy=\"return false\" onmouseup=document.selection.empty() oncopy=document.selection.empty() onselect=document.selection.empty()&gt;&lt;/body&gt; è®²ä¸Šé¢çº¢è‰²æ˜¾ç¤ºçš„æ’å…¥åˆ°ç½‘é¡µä¸­å°±å¯ä»¥å®ç°é¼ æ ‡å³å‡»æ— æ•ˆç¦æ­¢é€‰æ‹© onselectstart=\"return false\" ç¦æ­¢æ‹–æ”¾ ondragstart=\"return false\" ç¦æ­¢æ‹·è´ ncopy=document.selection.empty() ç¦æ­¢ä¿å­˜(æ”¾åœ¨headé‡Œé¢) &lt;noscript&gt;&lt;iframe src=\"*.htm\"&gt;&lt;/iframe&gt;&lt;/noscript&gt;ç¦æ­¢ç²˜è´´ &lt;input type=text onpaste=\"return false\"&gt;å…³é—­è¾“å…¥æ³• &lt;input style=\"ime-mode:disabled\"&gt;å±è”½é¼ æ ‡å³é”® function document.oncontextmenu()&#123;event.returnValue=false;&#125;å±è”½F1å¸®åŠ© function window.onhelp()&#123;return false&#125; å±è”½å…¶ä»–é”®function document.onkeydown() &#123; if ((window.event.altKey)&amp;&amp; ((window.event.keyCode==37)|| //å±è”½ Alt+ æ–¹å‘é”® â† (window.event.keyCode==39))) //å±è”½ Alt+ æ–¹å‘é”® â†’ &#123; alert(\"ä¸å‡†ä½ ä½¿ç”¨ALT+æ–¹å‘é”®å‰è¿›æˆ–åé€€ç½‘é¡µï¼\"); event.returnValue=false; &#125; /* æ³¨ï¼šè¿™è¿˜ä¸æ˜¯çœŸæ­£åœ°å±è”½ Alt+ æ–¹å‘é”®ï¼Œ å› ä¸º Alt+ æ–¹å‘é”®å¼¹å‡ºè­¦å‘Šæ¡†æ—¶ï¼ŒæŒ‰ä½ Alt é”®ä¸æ”¾ï¼Œ ç”¨é¼ æ ‡ç‚¹æ‰è­¦å‘Šæ¡†ï¼Œè¿™ç§å±è”½æ–¹æ³•å°±å¤±æ•ˆäº†ã€‚ä»¥åè‹¥ æœ‰å“ªä½é«˜æ‰‹æœ‰çœŸæ­£å±è”½ Alt é”®çš„æ–¹æ³•ï¼Œè¯·å‘ŠçŸ¥ã€‚*/ if ((event.keyCode==8) || //å±è”½é€€æ ¼åˆ é™¤é”® (event.keyCode==116)|| //å±è”½ F5 åˆ·æ–°é”® (event.ctrlKey &amp;&amp; event.keyCode==82))&#123; //Ctrl + R event.keyCode=0; event.returnValue=false; &#125; å±è”½F11 if (event.keyCode==122)&#123;event.keyCode=0;event.returnValue=false;&#125;å±è”½ Ctrl+n if (event.ctrlKey &amp;&amp; event.keyCode==78) event.returnValue=false; if (event.shiftKey &amp;&amp; event.keyCode==121) event.returnValue=false; //å±è”½ shift+F10 if (window.event.srcElement.tagName == \"A\" &amp;&amp; window.event.shiftKey) window.event.returnValue = false; //å±è”½ shift åŠ é¼ æ ‡å·¦é”®æ–°å¼€ä¸€ç½‘é¡µ if ((window.event.altKey)&amp;&amp;(window.event.keyCode==115))&#123; //å±è”½Alt+F4 window.showModelessDialog(\"about:blank\",\"\",\"dialogWidth:1px;dialogheight:1px\"); return false; &#125; &#125;å±è”½æ‰“å°ï¼š&lt;style&gt; @media print&#123; * &#123;display:none&#125; &#125; &lt;/style&gt; HTMLä¹‹é—´ä¼ å€¼(é€šè¿‡è§£æurl)123456789101112131415161718192021222324var hrefInfo = getUrlVars(window.location.href); // å¾—åˆ°å‚æ•°ä¿¡æ¯ if (hrefInfo.logId &amp;&amp; hrefInfo.logId != \"undefined\") &#123; fillData(hrefInfo.logId); logId = hrefInfo.logId; &#125; else &#123; &#125;//è§£æurlä¸­çš„å‚æ•°function getUrlVars(hrf) &#123; var vars = [], hash; var locationHref = !hrf ? window.location.href : hrf; locationHref = locationHref.replace(/#/g, \"\"); if (locationHref.indexOf('%') &gt; 0) &#123; locationHref = unescape(locationHref); &#125; var hashes = locationHref.slice(locationHref.indexOf('?') + 1).split('&amp;'); for ( var i = 0; i &lt; hashes.length; i++) &#123; hash = hashes[i].split('='); vars.push(hash[0]); vars[hash[0]] = hash[1]; &#125; return vars;&#125; Jqueryè·å–radio,checkbox123456789101112//è·å–radioçš„id $(\"input[name='r']:checked\").attr(\"id\"); //è·å¾—checkboxæ•°ç›®$(\"input[name='c']:checked\").length;//éå†checkbox$(\"input[name='c']:check\").eq(i).attr(\"id\");//å…¨é€‰checkbox$(\"input[name='c']:checkbox\").attr(\"checked\",\"true\");//è·å–é€‰ä¸­çš„checkbox $(\"input[name='c']:checked\").map(function()&#123;return $(this).val();&#125;).get().join(\",\");//è·å–ä¸‹æ‹‰æ¡†é€‰ä¸­çš„id $(\"#s option:selected\").attr(\"value\"); Jqueryé¡µé¢æŸ¥è¯¢(æ•°æ®é‡å¤§æ—¶ç¦ç”¨)12345678910111213141516 function search()&#123; var nameSearch = $(\"#itemName\").val(); //æœç´¢æ¡†ID var tableObj = $(\"#itemList tr:gt(0)\"); // tableçš„ID if(nameSearch.trim()!=\"\")&#123; tableObj.hide(); tableObj.each(function()&#123; var tr = $(this); var fuHe = tr.children(\":eq(0)\").html(); if(fuHe.indexOf(nameSearch)==0)&#123; tr.show(); &#125; &#125;); &#125;else&#123; tableObj.show(); &#125; &#125; Jquery å›è½¦(Enter)ç§»åˆ°ä¸‹ä¸€ä¸ªè¾“å…¥æ¡†1234567891011121314$(document).ready(function () &#123; $('input:text:first').focus(); $('input:text').bind(\"keydown\", function (e) &#123; if (e.which == 13) &#123; //Enter key e.preventDefault(); //to skip default behaviour of enter key var nextinput = $('input:text')[$('input:text').index(this) + 1]; if (nextinput != undefined) &#123; nextinput.focus(); &#125; else &#123; alert(\"æ²¡æœ‰ä¸‹ä¸€ä¸ªè¾“å…¥æ¡†ï¼\"); &#125; &#125; &#125;); &#125;); JS,Jqueryè·å–å„ç§å±å¹•çš„å®½åº¦å’Œé«˜åº¦12345678910111213141516171819202122232425262728//Javascript:ç½‘é¡µå¯è§åŒºåŸŸå®½ï¼š document.body.clientWidthç½‘é¡µå¯è§åŒºåŸŸé«˜ï¼š document.body.clientHeightç½‘é¡µå¯è§åŒºåŸŸå®½ï¼š document.body.offsetWidth (åŒ…æ‹¬è¾¹çº¿çš„å®½)ç½‘é¡µå¯è§åŒºåŸŸé«˜ï¼š document.body.offsetHeight (åŒ…æ‹¬è¾¹çº¿çš„é«˜)ç½‘é¡µæ­£æ–‡å…¨æ–‡å®½ï¼š document.body.scrollWidthç½‘é¡µæ­£æ–‡å…¨æ–‡é«˜ï¼š document.body.scrollHeightç½‘é¡µè¢«å·å»çš„é«˜ï¼š document.body.scrollTopç½‘é¡µè¢«å·å»çš„å·¦ï¼š document.body.scrollLeftç½‘é¡µæ­£æ–‡éƒ¨åˆ†ä¸Šï¼š window.screenTopç½‘é¡µæ­£æ–‡éƒ¨åˆ†å·¦ï¼š window.screenLeftå±å¹•åˆ†è¾¨ç‡çš„é«˜ï¼š window.screen.heightå±å¹•åˆ†è¾¨ç‡çš„å®½ï¼š window.screen.widthå±å¹•å¯ç”¨å·¥ä½œåŒºé«˜åº¦ï¼š window.screen.availHeightå±å¹•å¯ç”¨å·¥ä½œåŒºå®½åº¦ï¼š window.screen.availWidth //JQuery:$(document).ready(function()&#123; alert($(window).height()); //æµè§ˆå™¨å½“å‰çª—å£å¯è§†åŒºåŸŸé«˜åº¦ alert($(document).height()); //æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£çš„é«˜åº¦ alert($(document.body).height());//æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£bodyçš„é«˜åº¦ alert($(document.body).outerHeight(true));//æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£bodyçš„æ€»é«˜åº¦ åŒ…æ‹¬border padding margin alert($(window).width()); //æµè§ˆå™¨å½“å‰çª—å£å¯è§†åŒºåŸŸå®½åº¦ alert($(document).width());//æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£å¯¹è±¡å®½åº¦ alert($(document.body).width());//æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£bodyçš„å®½åº¦ alert($(document.body).outerWidth(true));//æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£bodyçš„æ€»å®½åº¦ åŒ…æ‹¬border padding margin&#125;) Ajax,Getæ—¶è¯·æ±‚å¼‚æ­¥ç¼“å­˜é—®é¢˜ç”¨Ajaxçš„Getæ–¹å¼è¯·æ±‚åŒä¸€ä¸ªåœ°å€è·å–æ•°æ®æ—¶ï¼Œç»å¸¸ç¢°åˆ°å›è°ƒå‡½æ•°æˆåŠŸæ‰§è¡Œï¼Œå‰å°åˆæœ‰æ•°æ®çš„æƒ…å†µï¼Œä½†æ˜¯æ— æ³•è¯·æ±‚åˆ°åå°è·å¾—æœ€æ–°çš„æ•°æ®ã€‚åŸå› æ˜¯ajaxå­˜åœ¨å¼‚æ­¥ç¼“å­˜çš„é—®é¢˜ã€‚ å› ä¸ºajaxæœ¬èº«è‡ªå¸¦æœ‰å®æ—¶å¼‚æ­¥è¯·æ±‚çš„åŠŸèƒ½ï¼Œè€ŒIEç¼“å­˜å¯¼è‡´è¯·æ±‚æ—¶ä¸ä¼šè¯·æ±‚åå°ï¼Œä¼šç›´æ¥è¯»å–ç¼“å­˜çš„æ•°æ®ã€‚ è§£å†³åŠæ³•ï¼š ajax getè¯·æ±‚æ—¶æ¯”è¾ƒç®€å• åªéœ€å°†cacheè®¾ç½®ä¸ºfalseå°±å¥½ã€‚ 123456789$.ajax(&#123; type: 'get', //getè¯·æ±‚æ—¶ url: '....', cache: false, //ä¸ç¼“å­˜ data: &#123; &#125;, success: function (result) &#123; // &#125; &#125;); è®¿é—®å°±åœ¨URLåé¢åŠ ä¸Š URL?+new Date();[æ€»ä¹‹å°±æ˜¯ä½¿æ¯æ¬¡è®¿é—®çš„URLå­—ç¬¦ä¸²ä¸ä¸€æ ·çš„] è®¾è®¡WEBé¡µé¢çš„æ—¶å€™ ä¹Ÿåº”è¯¥éµå®ˆè¿™ä¸ªåŸåˆ™ï¼Œå› ä¸ºè¯·æ±‚åŒä¸€ä¸ªåœ°å€ä¼šç›´æ¥è¯»å–ç¼“å­˜ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å‚æ•°ä¸­åŠ ä¸€ä¸ªéšæœºæ•°æ•° è®©æ¯æ¬¡å‚æ•°ä¸ä¸€æ ·å°±å¥½ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://sunny0715.github.io/tags/å‰ç«¯/"}]},{"title":"å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µå¼€å‘","slug":"å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µå¼€å‘","date":"2017-06-01T07:27:34.000Z","updated":"2018-03-13T05:54:42.015Z","comments":true,"path":"2017/06/01/å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µå¼€å‘/","link":"","permalink":"https://sunny0715.github.io/2017/06/01/å¾®ä¿¡å…¬ä¼—å·ç½‘é¡µå¼€å‘/","excerpt":"å¼•è¨€æœ€è¿‘ä¸€ç›´å‚ä¸å…¬å¸å¼€å‘å…¬ä¼—å·ï¼Œå…³äºé¡¹ç›®å®æ–½å¹³å°PCç«¯ç®€åŒ–ä¸ºå¾®ä¿¡å…¬ä¼—å·ï¼Œä¸»è¦æ¶æ„ä¸ºå‰å°H5ï¼Œä½¿ç”¨æ—¶çš„å¾®ä¿¡çš„WeUIçš„SDKï¼Œåå°å°±æ˜¯ç°åœ¨æµè¡Œçš„SpringMVC+Mybatiesï¼Œå‚ä¸äº†å…¨ç¨‹å¼€å‘ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†ä¸å°‘çš„é—®é¢˜ï¼Œç°åœ¨è®°å½•ä¸‹æ¥ï¼Œå¸Œæœ›ä»¥åèƒ½å¤Ÿç”¨å¾—åˆ°ã€‚","text":"å¼•è¨€æœ€è¿‘ä¸€ç›´å‚ä¸å…¬å¸å¼€å‘å…¬ä¼—å·ï¼Œå…³äºé¡¹ç›®å®æ–½å¹³å°PCç«¯ç®€åŒ–ä¸ºå¾®ä¿¡å…¬ä¼—å·ï¼Œä¸»è¦æ¶æ„ä¸ºå‰å°H5ï¼Œä½¿ç”¨æ—¶çš„å¾®ä¿¡çš„WeUIçš„SDKï¼Œåå°å°±æ˜¯ç°åœ¨æµè¡Œçš„SpringMVC+Mybatiesï¼Œå‚ä¸äº†å…¨ç¨‹å¼€å‘ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ä¹Ÿé‡åˆ°äº†ä¸å°‘çš„é—®é¢˜ï¼Œç°åœ¨è®°å½•ä¸‹æ¥ï¼Œå¸Œæœ›ä»¥åèƒ½å¤Ÿç”¨å¾—åˆ°ã€‚ HTMLé¡µé¢ä¹‹é—´ä¼ å€¼JSPä¹‹é—´ä¼ å€¼å·²ç»å¾ˆç†Ÿæ‚‰ï¼ŒHTMLä¹‹é—´ä¼ å€¼æ˜¯é€šè¿‡è§£æURLè·å–æ‰€éœ€å‚æ•°ã€‚ 12//URLä¼ å€¼URL + \"?logId=\" + logId; 12345678910111213141516171819202122232425262728//è·å–æ‰€éœ€å‚æ•°var hrefInfo = getUrlVars(window.location.href); if (hrefInfo.logId &amp;&amp; hrefInfo.logId != \"undefined\") &#123; fillData(hrefInfo.logId); logId = hrefInfo.logId; &#125; else &#123;&#125;// å¾—åˆ°urlä¸­çš„å‚æ•°function getUrlVars(hrf) &#123; var vars = [], hash; var locationHref = !hrf ? window.location.href : hrf; locationHref = locationHref.replace(/#/g, \"\"); if (locationHref.indexOf('%') &gt; 0) &#123; locationHref = unescape(locationHref); &#125; var hashes = locationHref.slice(locationHref.indexOf('?') + 1).split('&amp;'); for ( var i = 0; i &lt; hashes.length; i++) &#123; hash = hashes[i].split('='); vars.push(hash[0]); vars[hash[0]] = hash[1]; &#125; return vars;&#125; JSã€JQueryè·å–å„ç§å±å¹•çš„é«˜åº¦å’Œå®½åº¦åœ¨ç§»åŠ¨ç«¯ç»å¸¸ä¼šç”¨åˆ°è·å–å±å¹•çš„é«˜åº¦å’Œå®½åº¦ï¼Œåœ¨è¿™é‡Œæ€»ç»“ä¸€ä¸‹ã€‚ 12345678910111213Javascript:document.body.clientWidth //ç½‘é¡µå¯è§åŒºåŸŸå®½document.body.clientHeight //ç½‘é¡µå¯è§åŒºåŸŸé«˜document.body.offsetWidth (åŒ…æ‹¬è¾¹çº¿çš„å®½) //ç½‘é¡µå¯è§åŒºåŸŸå®½document.body.offsetHeight (åŒ…æ‹¬è¾¹çº¿çš„é«˜) //ç½‘é¡µå¯è§åŒºåŸŸé«˜document.body.scrollWidth //ç½‘é¡µæ­£æ–‡å…¨æ–‡å®½document.body.scrollHeight //ç½‘é¡µæ­£æ–‡å…¨æ–‡é«˜document.body.scrollTop //ç½‘é¡µè¢«å·å»çš„é«˜document.body.scrollLeft //ç½‘é¡µè¢«å·å»çš„å·¦window.screenTop //ç½‘é¡µæ­£æ–‡éƒ¨åˆ†ä¸Šwindow.screen.width //å±å¹•åˆ†è¾¨ç‡çš„å®½window.screen.availHeight //å±å¹•å¯ç”¨å·¥ä½œåŒºé«˜åº¦window.screen.availWidth //å±å¹•å¯ç”¨å·¥ä½œåŒºå®½åº¦ 123456789101112JQuery:$(document).ready(function()&#123;alert($(window).height()); //æµè§ˆå™¨å½“å‰çª—å£å¯è§†åŒºåŸŸé«˜åº¦alert($(document).height()); //æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£çš„é«˜åº¦alert($(document.body).height()); //æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£bodyçš„é«˜åº¦alert($(document.body).outerHeight(true));//æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£bodyçš„æ€»é«˜åº¦ åŒ…æ‹¬border padding marginalert($(window).width()); //æµè§ˆå™¨å½“å‰çª—å£å¯è§†åŒºåŸŸå®½åº¦alert($(document).width()); //æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£å¯¹è±¡å®½åº¦alert($(document.body).width()); //æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£bodyçš„å®½åº¦alert($(document.body).outerWidth(true));//æµè§ˆå™¨å½“å‰çª—å£æ–‡æ¡£bodyçš„æ€»å®½åº¦ åŒ…æ‹¬border padding margin&#125;) å¾®ä¿¡æµè§ˆå™¨ç¼“å­˜æ¸…ç†å¾®ä¿¡æµè§ˆå™¨ç¼“å­˜ä¸€ç›´éƒ½æ˜¯ç›¸å½“æ¶å¿ƒçš„å­˜åœ¨ï¼Œåªè¦é¡µé¢åŠ è½½ï¼Œé‚£ä¹ˆé™æ€é¡µé¢å°±ä¼šè¢«ç¼“å­˜ï¼Œé€šè¿‡Googleå’Œç™¾åº¦æ‰¾åˆ°äº†ä»¥ä¸‹ä¸¤ç§æ–¹æ³•ï¼š è®¾ç½®HTTPå¤´éƒ¨é€šè¿‡è¿™åªHTTPå¤´éƒ¨ç¦æ­¢æµè§ˆå™¨ç¼“å­˜ï¼Œæ•ˆæœæ²¡æœ‰è¾¾åˆ°è¦æ±‚ï¼Œä¸å»ºè®®ä½¿ç”¨ Androidä¸‹å¯åœ¨å¾®ä¿¡ä¸­æ‰“å¼€http://debugx5.qq.comæ¸…é™¤å¾®ä¿¡ç¼“å­˜ã€‚ 1234567891011&lt;html manifest=\"IGNORE.manifest\"&gt; &lt;meta charset=\"utf-8\"&gt;&lt;meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\"&gt;&lt;meta http-equiv=\"pragma\" content=\"no-cache\"&gt;&lt;meta http-equiv=\"cache-control\" content=\"no-cache\"&gt;&lt;meta name=\"viewport\" content=\"width=device-width, initial-scale=1, user-scalable=no\"&gt;&lt;link rel=\"shortcut icon\" href=\"../../view/images/favicon.ico\" type=\"image/x-icon\" /&gt; æ›´æ–°ç‰ˆæœ¬å·HTTPå¤´éƒ¨ç¦æ­¢ç¼“å­˜ä¸èƒ½ç”¨ï¼Œå°±åªèƒ½æ¯æ¬¡éƒ½æ›´æ–°ç‰ˆæœ¬å·(åŠ éšæœºæ•°)æ¥è¾¾åˆ°è‡ªå·±çš„è¦æ±‚äº†ã€‚ ä½¿ç”¨SeaJsæ‹¦æˆªæ‰€æœ‰.jså’Œ.csså¹¶åœ¨å°¾éƒ¨åŠ ä¸Šéšæœºæ•°ã€‚ å¼•å…¥SeaJs1&lt;script src=\"../../util/sea.js\"&gt;&lt;/script&gt; é…ç½®seajs_config.js éœ€è¦é…ç½®seajs_config.jså…¨å±€å˜é‡ï¼Œæ¯ä¸€ä¸ªHTMLé¡µé¢éƒ½è¦å¼•å…¥ï¼Œå…³äºæ›´å¤šSeaJsé…ç½®http://yslove.net/seajs/ 1234567891011var time = new Date().getTime();var sea_config = &#123; \"base\":\"/\", //webå‘å¸ƒè·¯å¾„ \"debug\":\"true\", //2:æ¯æ¬¡ä»åå°è·å–æ–°çš„js,true:consoleå‡ºbug,false:é»˜è®¤ \"charset\":\"utf-8\", //å­—ç¬¦é›† preload: [\"util/jquery-1.8.0.min.js\"], //é¢„åŠ è½½jquery map: [ //é…ç½®æ˜ å°„ï¼Œç”¨æ¥ç‰ˆæœ¬æ›´æ–°å¼ºåˆ¶æµè§ˆå™¨åˆ·æ–° ['.js','.js?version=' + time], ['.css','.css?version=' + time] ]&#125;; 12345//HTMLé¡µé¢å¼•å…¥&lt;script src=\"../../config/seaConfig/seajs_config.js\"&gt;&lt;/script&gt;&lt;script&gt; seajs.config(sea_config);&lt;/script&gt; Ajaxè¯·æ±‚ç¼“å­˜ åœ¨ç¼–ç æœŸé—´ï¼Œå› ä¸ºæœ‰ä¸ªè§’è‰²æ˜¯æŸ¥çœ‹æ‰€æœ‰é¡¹ç›®ä¸”æ•°æ®é‡ä¹Ÿæ¯”è¾ƒå¤§ï¼Œæ‰€ä»¥æŠŠAjaxè¯·æ±‚æ–¹å¼ä»POSTæ”¹ä¸ºäº†GETï¼Œç»“æœå°±å‘ç°Ajaxè¯·æ±‚è¢«ç¼“å­˜ï¼Œåªæœ‰ç¬¬ä¸€æ¬¡æŸ¥è¯¢æœ‰æ•ˆï¼Œå…¶åå…¨éƒ¨æ˜¯ä»ç¼“å­˜ä¸­å–ï¼ŒæŸ¥è¯¢èµ„æ–™åæ‰å‘ç°æ˜¯POSTæ”¹ä¸ºGETå¼•èµ·çš„ è§£å†³æ–¹æ³•ä¸€12345678910//ajax getè¯·æ±‚æ—¶æ¯”è¾ƒç®€å• åªéœ€å°†cacheè®¾ç½®ä¸ºfalseå°±å¥½ $.ajax(&#123; type: 'get',//getè¯·æ±‚æ—¶ url: '........', cache: false,//ä¸ç¼“å­˜ data: &#123; &#125;, success: function (result) &#123; &#125; &#125;); è§£å†³æ–¹æ³•äºŒ1234è®¿é—®å°±åœ¨URLåé¢åŠ ä¸Š[æ€»ä¹‹å°±æ˜¯ä½¿æ¯æ¬¡è®¿é—®çš„URLå­—ç¬¦ä¸²ä¸ä¸€æ ·çš„]URL?+new Date();è®¾è®¡WEBé¡µé¢çš„æ—¶å€™ ä¹Ÿåº”è¯¥éµå®ˆè¿™ä¸ªåŸåˆ™å› ä¸ºè¯·æ±‚åŒä¸€ä¸ªåœ°å€ä¼šç›´æ¥è¯»å–ç¼“å­˜ï¼Œæ‰€ä»¥å¯ä»¥åœ¨å‚æ•°ä¸­åŠ ä¸€ä¸ªéšæœºæ•°æ•° è®©æ¯æ¬¡å‚æ•°ä¸ä¸€æ ·å°±å¥½ IOSä¸‹Iframeæ»šåŠ¨é—®é¢˜ ç§»åŠ¨ç«¯åœ¨IOSä¸‹çš„é—®é¢˜å±…å¤šï¼Œåæ¥æµ‹è¯•ç»„æµ‹å‡ºçš„bugå¤šæ•°å±äºåœ¨IOSä¸‹å±æ€§ä¸å…¼å®¹é—®é¢˜ï¼Œå…¶ä¸­å°±æœ‰IOSä¸‹Iframeé‡Œé¢é¡µé¢æ— æ³•æ»šåŠ¨ï¼Œè§£å†³æ–¹æ³•å¦‚ä¸‹ 1234567891011121314151617181920212223242526&lt;!DOCTYPE html&gt;&lt;html lang=\"zh-cn\"&gt;&lt;head&gt;&lt;meta charset=\"utf-8\" /&gt;&lt;title&gt;IOS frame æ»šåŠ¨æ¡ demo&lt;/title&gt;&lt;/head&gt;&lt;body&gt;&lt;style&gt;#wrapper&#123;height:500px;-webkit-overflow-scrolling:touch;overflow:auto;&#125;&lt;/style&gt;&lt;div class=\"container\"&gt; æˆ‘æ˜¯ä¸€å †å¾ˆé•¿ã€‚å¾ˆé•¿ï¼Œå¾ˆé«˜ï¼Œå¾ˆé«˜çš„å†…å®¹ã€‚&lt;/div&gt;&lt;script src=\"../jquery.js\"&gt;&lt;/script&gt;&lt;script&gt; var UA = navigator.userAgent; var forIOS = function()&#123; if(!UA.match(/iPad/) &amp;&amp; !UA.match(/iPhone/) &amp;&amp; !UA.match(/iPod/))&#123; return; &#125; if($('#wrapper').length)&#123;return;&#125; $('body').children().not('script').wrapAll('&lt;div id=\"wrapper\"&gt;&lt;/div&gt;'); &#125;();&lt;/script&gt;&lt;/body&gt;&lt;/html&gt; æ€»ç»“è¿™æ¬¡æ˜¯æˆ‘ç¬¬ä¸€æ¬¡å¼€å‘å¾®ä¿¡ç«¯ï¼Œä»å‰ç«¯çš„ä¸ç†Ÿæ‚‰åˆ°ç†Ÿç»ƒï¼Œè‡ªå·±æˆé•¿äº†è®¸å¤šã€‚åŒæ—¶é‡åˆ°äº†å¾ˆå¤šé—®é¢˜ï¼Œå°¤å…¶æ˜¯åœ¨IOSä¸‹çš„å…¼å®¹é—®é¢˜ï¼Œæ¯”å¦‚è¿˜æœ‰åƒIOSä¸‹fixedå±æ€§ä¸èƒ½ç”¨ç­‰é—®é¢˜ã€‚å¾ˆå¤šä¸œè¥¿åªæœ‰è‡ªå·±æ‘¸ç´¢æ‰çŸ¥é“ï¼Œè¿™æ¬¡ä¹Ÿç®—æ˜¯è®©è‡ªå·±åœ¨å…¨æ ˆå·¥ç¨‹å¸ˆçš„é“è·¯ä¸Šåˆè¿›äº†ä¸€æ­¥ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"ç§»åŠ¨ç«¯","slug":"ç§»åŠ¨ç«¯","permalink":"https://sunny0715.github.io/tags/ç§»åŠ¨ç«¯/"},{"name":"å‰ç«¯","slug":"å‰ç«¯","permalink":"https://sunny0715.github.io/tags/å‰ç«¯/"}]},{"title":"MySQLä¼˜åŒ–","slug":"MySQLä¼˜åŒ–","date":"2017-04-17T04:31:55.000Z","updated":"2018-03-13T05:51:53.654Z","comments":true,"path":"2017/04/17/MySQLä¼˜åŒ–/","link":"","permalink":"https://sunny0715.github.io/2017/04/17/MySQLä¼˜åŒ–/","excerpt":"å¼•è¨€æ•°æ®åº“åœ¨æ¯ä¸ªé¡¹ç›®ä¸­éƒ½ä¼šç”¨åˆ°ï¼Œç°åœ¨åˆåˆ†ä¸ºä¸¤ä¸ªé—¨æ´¾ï¼Œä¸€ç§å…³ç³»å‹æ•°æ®åº“ï¼Œå¸¸è§çš„æœ‰MySQLã€SQL Serverã€Oracleã€DB2ç­‰ã€‚å¦ä¸€ç§æ˜¯éå…³ç³»å‹æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯NOSQL( Not Only SQL)ï¼Œå¸¸è§çš„NOSQLæ•°æ®åº“æœ‰Redis ã€MongoDBã€Cassandraç­‰ã€‚æ•°æ®åº“çš„ä¼˜åŒ–ç›´æ¥å½±å“åˆ°ç½‘ç«™çš„æ€§èƒ½ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹MySQLçš„ä¼˜åŒ–ã€‚","text":"å¼•è¨€æ•°æ®åº“åœ¨æ¯ä¸ªé¡¹ç›®ä¸­éƒ½ä¼šç”¨åˆ°ï¼Œç°åœ¨åˆåˆ†ä¸ºä¸¤ä¸ªé—¨æ´¾ï¼Œä¸€ç§å…³ç³»å‹æ•°æ®åº“ï¼Œå¸¸è§çš„æœ‰MySQLã€SQL Serverã€Oracleã€DB2ç­‰ã€‚å¦ä¸€ç§æ˜¯éå…³ç³»å‹æ•°æ®åº“ï¼Œä¹Ÿå°±æ˜¯NOSQL( Not Only SQL)ï¼Œå¸¸è§çš„NOSQLæ•°æ®åº“æœ‰Redis ã€MongoDBã€Cassandraç­‰ã€‚æ•°æ®åº“çš„ä¼˜åŒ–ç›´æ¥å½±å“åˆ°ç½‘ç«™çš„æ€§èƒ½ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹MySQLçš„ä¼˜åŒ–ã€‚ å…³äºMySQLMySQL æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å¼€æºå…³ç³»å‹æ•°æ®åº“ç®¡ç†ç³»ç»Ÿï¼Œç›®å‰ MySQL è¢«å¹¿æ³›åœ°åº”ç”¨åœ¨ Internet ä¸Šçš„ä¸­å°å‹ç½‘ç«™ä¸­ã€‚ç”±äºå…¶ä½“ç§¯å°ã€é€Ÿåº¦å¿«ã€æ€»ä½“æ‹¥æœ‰æˆæœ¬ä½ï¼Œå°¤å…¶æ˜¯å¼€æ”¾æºç è¿™ä¸€ç‰¹ç‚¹ï¼Œè®¸å¤šä¸­å°å‹ç½‘ç«™ä¸ºäº†é™ä½ç½‘ç«™æ€»ä½“æ‹¥æœ‰æˆæœ¬è€Œé€‰æ‹©äº† MySQL ä½œä¸ºç½‘ç«™æ•°æ®åº“ã€‚æ¯”å¦‚æ·˜å®ã€äº¬ä¸œç­‰çŸ¥åå…¬å¸ä¹Ÿéƒ½åœ¨ä½¿ç”¨ã€‚ MySQLçš„å­˜å‚¨å¼•æ“æœ‰åˆ†ä¸ºå¾ˆå¤šç§ã€‚MyISAMã€InnoDBç­‰ã€‚æ¯ä¸ªå¼•æ“çš„ç‰¹æ€§éƒ½ä¸ä¸€æ ·ï¼Œå¯ä»¥åœ¨ä¸åŒçš„æƒ…å†µä¸‹é€‰æ‹©ä¸åŒçš„å­˜å‚¨å¼•æ“ã€‚ MySQLçš„ä¼˜åŒ–å¯¹äºä¸€ä¸ªå°é¡¹ç›®æ¥è¯´ï¼ŒMySQLä¼˜åŒ–ä¸å¦å¯èƒ½æ²¡æœ‰é‚£ä¹ˆé‡è¦ï¼Œå¸¦æ¥çš„ä¼˜åŒ–æ•ˆæœä¹Ÿæ²¡æœ‰é‚£ä¹ˆæ˜æ˜¾ã€‚ä½†æ˜¯å¦‚æœé¢å¯¹çš„æ˜¯ä¸€ä¸ªåƒä¸‡çº§çš„å¤§è¡¨ã€åƒä¸‡çº§ç”šè‡³ä¸Šäº¿çš„æ•°æ®é‡æ—¶ï¼Œä¼˜åŒ–æ˜¯å¿…ä¸å¯å°‘çš„ã€‚é‚£ä¹ˆè¦ä»å¦‚ä¸‹å‡ æ–¹é¢æ¥åšä¼˜åŒ–ï¼š å­˜å‚¨å¼•æ“ä¸€èˆ¬æƒ…å†µå¯ä»¥é€‰æ‹©MyISAMå­˜å‚¨å¼•æ“ï¼Œå¦‚æœéœ€è¦äº‹åŠ¡æ”¯æŒå¿…é¡»ä½¿ç”¨InnoDBå­˜å‚¨å¼•æ“ã€‚ MyISAMç±»å‹çš„è¡¨å¼ºè°ƒçš„æ˜¯æ€§èƒ½ï¼Œå…¶æ‰§è¡Œæ•°åº¦æ¯”InnoDBç±»å‹æ›´å¿«ï¼Œä½†æ˜¯ä¸æä¾›äº‹åŠ¡æ”¯æŒï¼Œè€ŒInnoDBæä¾›äº‹åŠ¡æ”¯æŒä»¥åŠå¤–éƒ¨é”®ç­‰é«˜çº§æ•°æ®åº“åŠŸèƒ½ã€‚ å‘½åè§„åˆ™æœ¬ç€çº¦å®šä¼˜å…ˆäºé…ç½®ï¼ˆConvention Over Configurationï¼‰çš„åŸåˆ™ï¼Œè¡¨çš„å‘½åè§„åˆ™ä¸€æ ·å¾ˆé‡è¦ã€‚ MySQLæ•°æ®åº“ã€è¡¨ã€å­—æ®µç­‰åç§°ç»Ÿä¸€ä½¿ç”¨å°å†™ï¼Œå•è¯é—´ç”¨_ä¸‹åˆ’çº¿åˆ†éš”ã€‚ è¡¨åå’Œå­—æ®µåä¸å®œè¿‡é•¿ï¼ˆä¸è¶…è¿‡64ä¸ªå­—ç¬¦ï¼‰ã€‚ å»ºè®®æ•°æ®åº“ç»Ÿä¸€è®¾ç½®ç¼–ç ä¸ºutf8ï¼Œä¸ä»…ä»…æ˜¯ä¸ºäº†åº”ä»˜æ•°æ®åº“é—´å¯¼å…¥å¯¼å‡ºè¿‡ç¨‹ä¸­ã€å› ç¼–ç æ ¼å¼ä¸ç»Ÿä¸€è€Œå¯¼è‡´çš„æ¼äººçš„ä¹±ç é—®é¢˜ï¼Œä¹Ÿæ˜¯å› ä¸ºutf8æ˜¯ä¸€ç§ä¸‡å›½ç ï¼ˆUnicodeï¼‰ã€‚ è¯­å¥+ç´¢å¼•ç´¢å¼•çš„åˆç†å»ºç«‹å’ŒæŸ¥è¯¢è¯­å¥çš„ä¼˜åŒ–å¯ä»¥è¿…é€Ÿæå‡æ•°æ®åº“æ€§èƒ½ã€‚ è®¾è®¡é˜¶æ®µå°±éœ€è¦é¢„è®¡QPSï¼ˆQuery Per Secondï¼‰åŠæ•°æ®è§„æ¨¡ï¼Œå‚è€ƒä¸šåŠ¡åœºæ™¯å¯¹æ•°æ®çš„è¦æ±‚ï¼Œåˆç†è®¾è®¡è¡¨ç»“æ„ï¼ˆå‚è€ƒmysqlåœ¨çº¿DDLé—®é¢˜ï¼‰ï¼Œç”šè‡³è¿åè®¾è®¡èŒƒå¼åšåˆ°é€‚å½“å†—ä½™ã€‚ç”Ÿäº§ç¯å¢ƒåˆ†ææ…¢æ—¥å¿—ï¼Œä¼˜åŒ–è¯­å¥ã€‚ç´¢å¼•çš„è®¾è®¡éœ€è¦çŸ¥é“ç´¢å¼•æ˜¯æ€ä¹ˆç”¨çš„ï¼Œæ¯”å¦‚innodbçš„åŠ é”æœºåˆ¶ã€‚ åƒåœ¾æŸ¥è¯¢æ‹–æ…¢æ€§èƒ½ã€‚ä¸åˆç†çš„schemaè®¾è®¡ä¹Ÿä¼šå¯¼è‡´æ•°æ®å­˜å–æ…¢ã€‚ç´¢å¼•çš„ä½œç”¨ä¸å¿…å¤šè¯´ï¼Œä½†å¦‚innodbä¸‹ï¼Œé”™çš„ç´¢å¼•å¸¦æ¥çš„å¯èƒ½ä¸åªæ˜¯æŸ¥è¯¢å˜æ…¢ã€‚ MySQLè¯­å¥ä¼˜åŒ–æ˜¯æˆ‘ä»¬æœ€å¸¸è§ä¹Ÿæ˜¯å¼€å‘è¿‡ç¨‹ä¸­æœ€éœ€è¦æ³¨æ„çš„ã€‚å„ç§å…³é”®å­—çš„ä½¿ç”¨åœºåˆã€å¤šè¡¨ä¹‹é—´çš„å…³è”(æ®è¯´é˜¿é‡Œçš„è¦æ±‚æ˜¯å…³è”è¡¨ä¸è¶…å¤šä¸‰ä¸ª)ã€ç´¢å¼•çš„åˆç†ä½¿ç”¨ã€æ‰¹é‡æ’å…¥ã€æ‰¹é‡æ›´æ–°ã€æ‰¹é‡åˆ é™¤ã€ä¸´æ—¶è¡¨çš„ä½¿ç”¨ç­‰ç­‰ã€‚ ç¼“å­˜å½“æ•°æ®åº“çš„å‹åŠ›å¤ªå¤§æ—¶å¯ä»¥å°†ä¸€éƒ¨åˆ†å‹åŠ›è½¬å«åˆ°ç¼“å­˜ï¼ˆæˆ‘å¸¸ç”¨çš„æ˜¯Redisï¼‰ï¼Œå…¶æµç¨‹å¦‚ä¸‹ï¼š å¤åˆ¶åŠè¯»å†™åˆ†ç¦»è¿™ä¸ªæ˜¯å¤§å¤šæ•°åœºæ™¯ä¸‹éƒ½æ˜¯å¿…é¡»çš„ã€‚å› ä¸ºå¤åˆ¶å¯ä»¥å®ç°å¤‡ä»½ã€é«˜å¯ç”¨ã€è´Ÿè½½å‡è¡¡ã€‚ å…¶ä¸­è¯»å†™åˆ†ç¦»å¯ä»¥åœ¨åº”ç”¨å±‚åšï¼Œæ•ˆç‡é«˜ï¼Œä¹Ÿå¯ä»¥ç”¨ä¸‰æ–¹å·¥å…·ï¼Œå¦‚360çš„atlasã€‚ åˆ‡åˆ†åˆ‡åˆ†åŒ…æ‹¬å‚ç›´åˆ‡åˆ†å’Œæ°´å¹³åˆ‡åˆ†ï¼Œå®ç°æ–¹å¼ä¸ŠåˆåŒ…æ‹¬åˆ†åº“ã€åˆ†è¡¨ã€‚ å‚ç›´åˆ‡åˆ†ä¿è¯ä¸šåŠ¡çš„ç‹¬ç«‹æ€§ï¼Œé˜²æ­¢ä¸åŒä¸šåŠ¡äº‰æŠ¢èµ„æºï¼Œæ¯•ç«Ÿä¸šåŠ¡æ˜¯æœ‰ä¼˜å…ˆçº§çš„ã€‚ æ°´å¹³åˆ‡åˆ†ä¸»è¦ç”¨äºçªç ´å•æœºç“¶é¢ˆã€‚é™¤äº†ä¸»ä¸»å¤–ï¼Œåªæœ‰åˆ‡åˆ†èƒ½çœŸæ­£åšåˆ°å°†è´Ÿè½½åˆ†é…ä¸‹å»ã€‚ åˆ‡åˆ†åä¹Ÿå¯å¯¹ä¸åŒç‰‡æ•°æ®è¿›è¡Œä¸åŒä¼˜åŒ–ã€‚å¦‚æŒ‰æ—¶é—´åˆ‡åˆ†ï¼Œè¶…è¿‡ä¸€å®šæ—¶é—´æ•°æ®ä¸å…è®¸ä¿®æ”¹ï¼Œå°±å¯ä»¥å¼•å…¥å‹ç¼©äº†ï¼Œæ•°æ®ä¼ è¾“åŠè¯»å–å‡å°‘å¾ˆå¤šã€‚ æ ¹æ®ä¸šåŠ¡å‚ç›´åˆ‡åˆ†ã€‚ä¸šåŠ¡å†…éƒ¨åˆ†åº“ã€åˆ†è¡¨ã€‚ä¸€èˆ¬éƒ½éœ€è¦ä¿®æ”¹åº”ç”¨ã€‚é™¤åˆ†è¡¨å¤–ï¼Œå…¶ä½™å®ç°ä¸æ˜¯å¾ˆå¤æ‚ã€‚æœ‰ç¬¬ä¸‰æ–¹ç»„ä»¶å¯ç”¨ï¼Œä½†é€šç”¨é«˜æ•ˆåˆçµæ´»çš„æ–¹å¼ï¼Œè¿˜æ˜¯è‡ªå·±å†™clientã€‚ å‚ç›´åˆ‡åˆ†ä¸€èˆ¬éƒ½è¦åšï¼Œåªä¸è¿‡ä¸šåŠ¡ç²’åº¦å¤§å°è€Œå·²ã€‚ åˆ†åº“æœ‰æ˜¯ç»å¸¸ç”¨çš„ï¼Œå°±ç®—å½“å‰å‹åŠ›å°ï¼Œä¹Ÿå°½é‡åˆ†å‡ºå‡ ä¸ªé€»è¾‘åº“å‡ºæ¥ã€‚ç­‰è§„æ¨¡ä¸Šå»äº†ï¼Œå¾ˆæ–¹ä¾¿å°±è¿ç§»æ‰©å±•ã€‚ æ°´å¹³æ‹†åˆ†æœ‰ä¸€å®šéš¾åº¦ï¼Œä½†å¦‚æœå°†æ¥ä¸€å®šä¼šåˆ°è¿™ä¸ªè§„æ¨¡ï¼Œåˆå¯èƒ½ç”¨åˆ°ï¼Œå»ºè®®è¶Šæ—©åšè¶Šå¥½ã€‚å› ä¸ºå¯¹åº”ç”¨çš„æ”¹åŠ¨è¾ƒå¤§ï¼Œè€Œä¸”è¿ç§»æˆæœ¬é«˜ã€‚ æ€»ç»“MySQLæ€»ç»“å¯ä»¥è¯´æ˜¯ï¼š ä¼˜åŒ–SQLï¼Œä¼˜åŒ–ç»“æ„ï¼Œä¼˜åŒ–å­˜å‚¨ã€‚ å¯¹äºMySQLçš„ä¼˜åŒ–æˆ‘è¿˜éœ€è¦è¿›ä¸€æ­¥æé«˜ï¼Œä»è¡¨çš„è®¾è®¡å»ºç«‹åˆ°åæœŸçš„ç»´æŠ¤è€ƒè™‘çš„é—®é¢˜æœ‰å¾ˆå¤šï¼Œæ¯ä¸€æ­¥éƒ½éœ€è¦æ³¨æ„ã€‚æ²¡æœ‰DBAï¼Œåªæœ‰è‡ªå·±æ¥å®ç°ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"mysql","slug":"mysql","permalink":"https://sunny0715.github.io/tags/mysql/"}]},{"title":"LinuxåŸºæœ¬å‘½ä»¤","slug":"LinuxåŸºæœ¬å‘½ä»¤","date":"2017-04-07T07:59:22.000Z","updated":"2018-03-13T05:50:31.591Z","comments":true,"path":"2017/04/07/LinuxåŸºæœ¬å‘½ä»¤/","link":"","permalink":"https://sunny0715.github.io/2017/04/07/LinuxåŸºæœ¬å‘½ä»¤/","excerpt":"å¼•è¨€ä¹‹å‰çš„å…¬å¸æœ‰ç”¨è¿‡Linuxï¼Œè‡ªå·±ä¹Ÿå­¦ä¹ äº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯å¾ˆä¹…æ²¡æœ‰ç”¨äº†ï¼Œæœ€è¿‘åˆåœ¨è…¾è®¯äº‘ç§Ÿäº†ä¸ªç©ºé—´æŠŠç³»ç»Ÿè£…æˆCentosç³»ç»Ÿäº†ï¼Œæ‰€ä»¥åˆæŠŠLinuxç³»ç»Ÿé‡æ–°æ¡èµ·æ¥ï¼Œé‡æ¸©ä¸‹Linuxçš„åŸºæœ¬çŸ¥è¯†ã€‚","text":"å¼•è¨€ä¹‹å‰çš„å…¬å¸æœ‰ç”¨è¿‡Linuxï¼Œè‡ªå·±ä¹Ÿå­¦ä¹ äº†ä¸€æ®µæ—¶é—´ï¼Œä½†æ˜¯å¾ˆä¹…æ²¡æœ‰ç”¨äº†ï¼Œæœ€è¿‘åˆåœ¨è…¾è®¯äº‘ç§Ÿäº†ä¸ªç©ºé—´æŠŠç³»ç»Ÿè£…æˆCentosç³»ç»Ÿäº†ï¼Œæ‰€ä»¥åˆæŠŠLinuxç³»ç»Ÿé‡æ–°æ¡èµ·æ¥ï¼Œé‡æ¸©ä¸‹Linuxçš„åŸºæœ¬çŸ¥è¯†ã€‚ Linuxç®€ä»‹ç®€ä»‹Linuxï¼Œå…è´¹å¼€æºï¼Œå¤šç”¨æˆ·å¤šä»»åŠ¡ç³»ç»Ÿã€‚åŸºäºLinuxæœ‰å¤šä¸ªç‰ˆæœ¬çš„è¡ç”Ÿã€‚RedHatã€Ubuntuã€Debian å®‰è£…VMwareæˆ–VirtualBoxè™šæ‹Ÿæœºã€‚Linuxçš„å®šä¹‰å’Œå†å²å³è½¬ç™¾åº¦ç™¾ç§‘ã€‚å…·ä½“å®‰è£…æ­¥éª¤ï¼Œæ‰¾ç™¾åº¦ã€‚ å¸¸ç”¨ç‰ˆæœ¬æˆ‘å¸¸ç”¨çš„Linuxç‰ˆæœ¬æœ‰ä¸¤ä¸ªCentoså’ŒUbuntuï¼Œå…¨éƒ½æ˜¯å¼€æºå…è´¹çš„,å…¶ä¸­Ubuntuå±äºæ¡Œé¢ç‰ˆã€‚ 123Centosæ˜¯å…è´¹çš„ä¼ä¸šç‰ˆLinuxæ“ä½œç³»ç»Ÿã€‚æ˜¯RedHatä¼ä¸šç‰ˆçš„ä¼˜åŒ–æ“ä½œç³»ç»Ÿã€‚å…·ä½“å¯ä»¥å‚ç…§ç™¾ç§‘ï¼šhttp://baike.baidu.com/view/26404.htmã€‚é‡Œé¢æœ‰è¯¦è§£ã€‚å¦é™„å…¶å®˜ç½‘:http://www.centos.org/ã€‚å¦å¤–ï¼Œå®ƒé€‚åˆä½œä¸ºæœåŠ¡å™¨ç”¨ã€‚ 1Ubuntuä¹‹å‰æœ‰åœ¨ç¯å¢ƒä¸­å¼€å‘è¿‡é¡¹ç›®ï¼Œè™½ç„¶æ—¶é—´ä¸ä¹…ï¼Œä½†è¿˜æ˜¯æœ‰æ‰€ä½“ä¼šã€‚å…è´¹ã€æ— æ¯’ã€å…æŠ˜è…¾ã€æ¯”è¾ƒæ¥è¿‘åº•å±‚ã€‚ åŸºæœ¬å‘½ä»¤ Linux æ“ä½œç³»ç»Ÿä½æ•°è¯†åˆ«: uname -aï¼ˆuname -pï¼‰ Linux 32ä½æ“ä½œç³»ç»Ÿï¼šLinux x86 i586 i386 i686 iâ€¦ Linux 64ä½æ“ä½œç³»ç»Ÿï¼šLinux x64x86_64 X64 â€¦ man å‘½ä»¤ä¸ä¼šç”¨äº†ï¼Œæ‰¾ç”·äºº å¦‚ï¼šman ls ifconfig æ˜¾ç¤ºç³»ç»Ÿä¿¡æ¯ ls æˆ–ll æŸ¥çœ‹ç›®å½•æ–‡ä»¶ pwd æŸ¥çœ‹ç›®å‰è·¯å¾„ cat æ–‡ä»¶å ä»ç¬¬ä¸€ä¸ªå­—èŠ‚å¼€å§‹æ­£å‘æŸ¥çœ‹æ–‡ä»¶çš„å†…å®¹ head -2 file1 æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„å‰ä¸¤è¡Œ tail -2 file1 æŸ¥çœ‹ä¸€ä¸ªæ–‡ä»¶çš„æœ€åä¸¤è¡Œ mv è€å æ–°å é‡å‘½å/å‰ªåˆ‡ cp è€æ–‡ä»¶è·¯å¾„+æ–‡ä»¶å æ–°æ–‡ä»¶è·¯å¾„ï¼ˆ+æ–‡ä»¶åï¼‰ å¤åˆ¶ cd è¿›å…¥ä¸ªäººçš„ä¸»ç›®å½• cd è·¯å¾„å è¿›å…¥æ–°è·¯å¾„ cd .. åé€€ä¸€æ­¥ date æ˜¾ç¤ºç³»ç»Ÿæ—¥æœŸ shutdown -h now å…³é—­ç³»ç»Ÿ(1) shutdown -r now é‡å¯(1) reboot é‡å¯(2) halt å…³æœº(æ¨è) logout æ³¨é”€ mkdir dir1 åˆ›å»ºä¸€ä¸ªå«åš â€˜dir1â€™ çš„ç›®å½•â€™ rm -f file1 åˆ é™¤ä¸€ä¸ªå«åš â€˜file1â€™ çš„æ–‡ä»¶â€™ rmdir dir1 åˆ é™¤ä¸€ä¸ªå«åš â€˜dir1â€™ çš„ç›®å½•â€™ rm -rf dir1 åˆ é™¤ä¸€ä¸ªå«åš â€˜dir1â€™ çš„ç›®å½•å¹¶åŒæ—¶åˆ é™¤å…¶å†… find / -name file1 ä» â€˜/â€˜ å¼€å§‹è¿›å…¥æ ¹æ–‡ä»¶ç³»ç»Ÿæœç´¢æ–‡ä»¶å’Œç›®å½• tar -zxvf archive.tar è§£å‹ä¸€ä¸ªåŒ… rpm -ivh package.rpm å®‰è£…ä¸€ä¸ªrpmåŒ… é«˜çº§ä¸€ç‚¹çš„å‘½ä»¤ï¼Œä¹Ÿæ˜¯æ¯”è¾ƒéš¾æ‡‚ã€éœ€è¦å®è·µå’Œç¢ç£¨çš„å‘½ä»¤ï¼š chmod +æƒé™(ugo) (uã€gã€oè¡¨ç¤ºuserã€groupã€other) ä¸‰ç§åŸºæœ¬æƒé™ R è¯» æ•°å€¼è¡¨ç¤ºä¸º4 W å†™ æ•°å€¼è¡¨ç¤ºä¸º2 X å¯æ‰§è¡Œ æ•°å€¼è¡¨ç¤ºä¸º1 â€‹ ä¾‹å¦‚ï¼šchmod 777 è¡¨ç¤ºuserã€groupã€otheréƒ½å…·æœ‰RWXæƒé™ã€‚ grep [options] grepå‘½ä»¤æ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…· grep â€˜testâ€™ d*æ˜¾ç¤ºæ‰€æœ‰ä»¥då¼€å¤´çš„æ–‡ä»¶ä¸­åŒ…å« testçš„è¡Œã€‚ ps [options] å¯¹è¿›ç¨‹è¿›è¡Œç›‘æµ‹å’Œæ§åˆ¶ ps -aux|grep 8080 æŸ¥çœ‹8080ç«¯å£å ç”¨æƒ…å†µ yum yum [options][command] [package ...] å·¥å…· yum list åˆ—å‡ºå½“å‰ç³»ç»Ÿä¸­å®‰è£…çš„æ‰€æœ‰åŒ… wget wget [OPTION]â€¦ [URL]â€¦ wgetæ˜¯ä¸€ä¸ªä»ç½‘ç»œä¸Šè‡ªåŠ¨ä¸‹è½½æ–‡ä»¶çš„è‡ªç”±å·¥å…· wget http://example.com/file.iso ä»ç½‘ä¸Šä¸‹è½½å•ä¸ªæ–‡ä»¶ â€¦â€¦â€¦â€¦â€¦ æ€»ç»“Linuxåšå¤§ç²¾æ·±ï¼Œæœ‰å¾ˆå¤šçš„å‘½ä»¤è‡ªå·±ä½¿ç”¨çš„æ¯”è¾ƒå°‘ä¹Ÿæ²¡æœ‰ç”¨åˆ°ï¼Œç”¨åˆ°çš„æ—¶å€™å†å»æŸ¥èµ„æ–™ã€‚ æ›´å¤šçš„å‘½ä»¤å¯ä»¥æŸ¥çœ‹http://www.cnblogs.com/skillup/articles/1877812.html","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"},{"name":"linux","slug":"linux","permalink":"https://sunny0715.github.io/tags/linux/"}]},{"title":"JAVAå®ç°ç®€å•ç½‘ç»œçˆ¬è™«","slug":"JAVAå®ç°ç®€å•çˆ¬è™«","date":"2017-04-01T06:17:39.000Z","updated":"2018-03-13T05:49:52.521Z","comments":true,"path":"2017/04/01/JAVAå®ç°ç®€å•çˆ¬è™«/","link":"","permalink":"https://sunny0715.github.io/2017/04/01/JAVAå®ç°ç®€å•çˆ¬è™«/","excerpt":"","text":"çˆ¬è™«åŸºæœ¬ç†è§£ é€šä¿—ä¸€ç‚¹ï¼Œçˆ¬è™«æ˜¯ç”¨æ¥å¿«é€Ÿã€æ‰¹é‡è·å–æˆ‘ä»¬åœ¨ç½‘ç»œéœ€è¦çš„ä¸œè¥¿ï¼Œè¿‡æ»¤æ‰ä¸éœ€è¦çš„ä¸œè¥¿ï¼Œæ¯”å¦‚æˆ‘å¯ä»¥çˆ¬ä¸€ä¸ªç½‘ç«™çš„æ‰€æœ‰å›¾ç‰‡çœçš„ä¸€å¼ ä¸€å¼ å»ä¿å­˜ï¼Œä¹Ÿå¯ä»¥çˆ¬å…¶ä»–æ•°æ®æ¥åšç ”ç©¶ã€ç»Ÿè®¡ã€æ•°æ®åˆ†æï¼Œå³æ˜¯ï¼š (1) å¯¹æŠ“å–ç›®æ ‡çš„æè¿°æˆ–å®šä¹‰ï¼› (2) å¯¹ç½‘é¡µæˆ–æ•°æ®çš„åˆ†æä¸è¿‡æ»¤ï¼› (3) å¯¹URLçš„æœç´¢ç­–ç•¥ã€‚ å¾ˆå¤šè¯­è¨€éƒ½å¯ä»¥åšçˆ¬è™«ï¼Œåœ¨è¿™é‡Œè®°å½•JAVAåšä¸€ä¸ªç®€å•çš„çˆ¬è™«ï¼Œç­‰ä»¥åå­¦ä¼šå…¶ä»–è¯­è¨€äº†å†ç”¨å…¶ä»–è¯­è¨€åšçˆ¬è™«ï¼Œå“ˆå“ˆâ€¦ å®ç°çˆ¬è™«éœ€è¦çŸ¥è¯†ç‚¹ ç®€å•HTMLã€CSSã€JSç­‰å‰ç«¯çŸ¥è¯† æ­£åˆ™è¡¨è¾¾å¼ï¼ˆå¾ˆé‡è¦ï¼Œç”¨äºè¿‡æ»¤ä¸éœ€è¦çš„ä¿¡æ¯ï¼‰ JAVAè¯­è¨€çŸ¥è¯†ï¼ˆå¯æ¢æˆå…¶ä»–è¯­è¨€ï¼‰ å‚æ•° é¦–å…ˆä½ è¦ç»™å®ƒä¸€ä¸ªç§å­é“¾æ¥URL åœ¨ç§å­é“¾æ¥çš„é¡µé¢æŸ¥æ‰¾å…¶ä»–çš„URLï¼Œé‡å¤1æ­¥éª¤ æœ‰é“¾æ¥æœ‰é¡µé¢ï¼Œç„¶åä½ å¯ä»¥åœ¨é¡µé¢ä¸­æŸ¥æ‰¾éœ€è¦çš„å†…å®¹ ç®€å•çˆ¬è™«ä»£ç åœ¨è¿™é‡Œåšä¸ªç¤ºä¾‹ï¼šæŠŠç½‘ç«™https://www.baidu.com/home/news/data/newspage?nid=7953839918275534&amp;n_type=0&amp;p_from=1 å›¾ç‰‡å…¨éƒ¨downä¸‹æ¥å¹¶ä¿å­˜åˆ°æœ¬åœ°ç£ç›˜çš„æ“ä½œã€‚ JAVAåŸºæœ¬æ–¹å¼12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273public class Reptile &#123; public static String doGet(String urlStr) throws Exception &#123; URL url; String html = \"\"; try &#123; url = new URL(urlStr); HttpURLConnection connection = (HttpURLConnection) url.openConnection(); connection.setRequestProperty(\"Accept\", \"text/html\"); connection.setRequestProperty(\"Accept-Charset\", \"utf-8\"); connection.setRequestProperty(\"Accept-Language\", \"en-US,en\"); connection.setRequestProperty(\"User-Agent\", \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.22 (KHTML, like Gecko) Chrome/25.0.1364.160 Safari/537.22\"); connection.setRequestMethod(\"GET\"); connection.setConnectTimeout(5000); connection.setDoInput(true); connection.setDoOutput(true); if (connection.getResponseCode() == 200) &#123; System.out.println(\"å·²è¿æ¥ï¼Œæ­£åœ¨è§£æã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\"); InputStream in = connection.getInputStream(); html = StreamTool.inToStringByByte(in); &#125; else &#123; System.out.println(connection.getResponseCode()); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); throw new Exception(\"getè¯·æ±‚å¤±è´¥\"); &#125; return html; &#125; public static void main(String[] args) throws Exception &#123; Reptile reptile = new Reptile() String htmlStr = Reptile.doGet(\"https://www.baidu.com/home/news/data/ newspagenid=7953839918275534&amp;n_type=0&amp;p_from=1\"); File f = new File(\"E://imgs\"); if (!f.exists()) &#123; f.mkdirs(); &#125; Pattern pattern = Pattern.compile(\"&lt;img.*src=(.*?)[^&gt;]*?&gt;\"); //åŒ¹é…Imagæ ‡ç­¾ Matcher matcher = pattern.matcher(htmlStr); // å®šä¹‰ä¸€ä¸ªmatcherç”¨æ¥åšåŒ¹é… System.out.println(\"æ­£åœ¨ä¸‹è½½\"); while (matcher.find()) &#123; String imgs = matcher.group(); Matcher srcMatcher = Pattern.compile(\"https:\\\"?(.*?)(\\\"|&gt;|\\\\s+)\").matcher(imgs); while (srcMatcher.find()) &#123; String src = srcMatcher.group().substring(0,srcMatcher.group().length() - 1); System.out.println(src); // è·å–åç¼€å String imageName = src.substring(src.lastIndexOf(\"/\") + 1,src.length()); reptile.downLoad(src, imageName); //ä¸‹è½½å›¾ç‰‡åˆ°æœ¬åœ° &#125; &#125; &#125; //ä¸‹è½½å›¾ç‰‡åˆ°æœ¬åœ° public void downLoad(String src, String imageName) throws Exception &#123; URL url = new URL(src); URLConnection uri = url.openConnection(); InputStream is = uri.getInputStream(); // è·å–æ•°æ®æµ // å†™å…¥æ•°æ®æµ OutputStream os = new FileOutputStream(new File(\"E://imgs\", imageName)); byte[] buf = new byte[1024]; int len = 0; while ((len = is.read(buf)) != -1) &#123; os.write(buf, 0, len); &#125; os.close(); is.close(); &#125;&#125; JAVAåŸºæœ¬æ–¹æ³•ä¸»è¦æ˜¯åˆ©ç”¨JAVAä¸­çš„æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æˆ‘ä»¬æˆ‘éœ€è¦çš„å…ƒç´ ï¼Œç„¶åå†è¿›è¡Œå…¶ä»–æ“ä½œã€‚ç®€å•ã€ç²—æš´ã€‚ Jsoupæ–¹å¼ Jsoup æ˜¯ä¸€ä¸ª Java çš„å¼€æºHTMLè§£æå™¨ï¼Œå¯ç›´æ¥è§£ææŸä¸ªURLåœ°å€ã€HTMLæ–‡æœ¬å†…å®¹ã€‚åŒæ—¶æä¾›äº†ä¸€å¥—éå¸¸çœåŠ›çš„APIï¼Œå¯é€šè¿‡DOMï¼ŒCSSä»¥åŠç±»ä¼¼äºjQueryçš„æ“ä½œæ–¹æ³•æ¥å–å‡ºå’Œæ“ä½œæ•°æ®ã€‚å¯ä»¥ç›´æ¥ä½¿ç”¨DOMæˆ–è€…JQueryæ–¹æ³•å’Œè¡¨è¾¾å¼å–å‡ºæ•°æ®ã€‚ éœ€è¦ä¸‹è½½JARåŒ…ï¼Œä¸‹è½½åœ°å€ï¼šç‚¹æˆ‘ Jsoup APIï¼šè¯¦è§ï¼šhttp://www.open-open.com/jsoup/ å·¥å…·ç±»StreamTool ï¼šå°†byteå¯¹è±¡è½¬åŒ–ä¸ºStringå¯¹è±¡ 1234567891011121314public class StreamTool &#123;// å°†byteå¯¹è±¡è½¬åŒ–ä¸ºStringå¯¹è±¡ public static String inToStringByByte(InputStream in) throws Exception &#123; ByteArrayOutputStream outStr = new ByteArrayOutputStream(); byte[] buffer = new byte[1024]; int len = 0; StringBuilder content = new StringBuilder(); while ((len = in.read(buffer)) != -1) &#123; content.append(new String(buffer, 0, len, \"UTF-8\")); &#125; outStr.close(); return content.toString(); &#125;&#125; åŸºæœ¬å®ç°ç±»Reptile 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172public class Reptile &#123; public static String doGet(String urlStr) throws Exception &#123; URL url; String html = \"\"; try &#123; url = new URL(urlStr); HttpURLConnection connection = (HttpURLConnection) url.openConnection(); //ä¼ªè£…çˆ¬è™«ï¼Œä¸ç„¶ä¼šæŠ¥403é”™è¯¯ connection.setRequestProperty(\"Accept\", \"text/html\"); connection.setRequestProperty(\"Accept-Charset\", \"utf-8\"); connection.setRequestProperty(\"Accept-Language\", \"en-US,en\"); connection.setRequestProperty(\"User-Agent\",\"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.22 (KHTML, like Gecko) Chrome/25.0.1364.160 Safari/537.22\"); connection.setRequestMethod(\"GET\"); // å®šä¹‰è¯·æ±‚æ–¹å¼ connection.setConnectTimeout(5000); connection.setDoInput(true); //è®¾ç½®æ˜¯å¦å‘httpUrlConnectionè¾“å‡ºï¼Œ é»˜è®¤æƒ…å†µä¸‹æ˜¯false; connection.setDoOutput(true); // è®¾ç½®æ˜¯å¦ä»httpUrlConnectionè¯»å…¥ï¼Œé»˜è®¤æƒ…å†µä¸‹æ˜¯true; if (connection.getResponseCode() == 200) &#123; //è¿æ¥æˆåŠŸ System.out.println(\"å·²è¿æ¥ï¼Œæ­£åœ¨è§£æã€‚ã€‚ã€‚ã€‚ã€‚ã€‚\"); InputStream in = connection.getInputStream(); html = StreamTool.inToStringByByte(in); &#125; else &#123; System.out.println(connection.getResponseCode()); &#125; &#125; catch (Exception e) &#123; e.printStackTrace(); throw new Exception(\"getè¯·æ±‚å¤±è´¥\"); &#125; return html; &#125; public static void main(String[] args) throws Exception &#123; URL url ; InputStream is = null; OutputStream os = null; String urlStr = \"https://www.baidu.com/home/news/data/newspage?nid=7953839918275534&amp;n_type=0&amp;p_from=1\"; String htmlStr = Reptile.doGet(urlStr); Document doc = Jsoup.parse(htmlStr); // å°†è·å–çš„ç½‘é¡µ HTML æºä»£ç è½¬åŒ–ä¸º Documentå¯¹è±¡ File f = new File(\"E://imgs\"); //æŠŠæ–‡ä»¶å­˜åœ¨E://imgs if (!f.exists()) &#123; f.mkdirs(); &#125; Elements pngs = doc.select(\"img[src]\"); //è·å–æ‰€æœ‰å›¾ç‰‡// Elements pngs = doc.select(\"img[src$=.png]\");åªçˆ¬å–pngå›¾ç‰‡ int i = 1; //è®¡æ•° for (Element e : pngs) &#123; String src = e.attr(\"src\"); // è·å–imgä¸­çš„srcè·¯å¾„ String imageName = src.substring(src.lastIndexOf(\"/\") + 1, src.length()); // è·å–åç¼€å System.out.println(\"æ­£åœ¨ä¸‹è½½ç¬¬\" + i + \"å¼ å›¾ç‰‡ï¼š\"+ imageName); URL url = new URL(src); // è¿æ¥url URLConnection uri = url.openConnection(); is = uri.getInputStream(); // è·å–æ•°æ®æµ os = new FileOutputStream(new File(\"E://imgs\",imageName));// å†™å…¥æ•°æ®æµ byte[] buf = new byte[1024]; int len = 0; while ((len = is.read(buf)) != -1) &#123; os.write(buf, 0, len); &#125; i++; &#125; os.close(); is.close(); System.out.println(\"å…±æœ‰\" + (i-1) + \"å¼ å›¾ç‰‡ã€‚\"); &#125;&#125; æ€»ç»“åœ¨è¿™é‡Œåªåšä¸ªä¸€ä¸ªç®€å•çš„çˆ¬è™«ç¤ºä¾‹ï¼Œé€šè¿‡ä¸¤ç§æ–¹å¼çš„æ¯”è¾ƒåï¼Œå‘ç°Jsoupæ›´ä½³ã€‚ JAVAåŸºæœ¬çš„æ–¹å¼èƒ½ç”¨æ­£åˆ™è¡¨è¾¾å¼æ¥åŒ¹é…æ‰€éœ€è¦çš„å…ƒç´ ï¼Œçµæ´»æ€§ä¸é«˜ã€‚ Jsoupè¿™ä¸ªå¼ºå¤§çš„å·¥å…·æä¾›äº†DOMå’ŒJQueryæ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥æ“ä½œèŠ‚ç‚¹ï¼ŒåŒæ—¶ä¹Ÿæ”¯æŒæ­£åˆ™è¡¨è¾¾å¼ï¼Œæ›´åŠ çš„çµæ´»ã€çœåŠ›ï¼ŒåŒæ—¶é€‰æ‹©æ€§ã€å¯ç©æ€§å’Œæ‰©å±•æ€§æ›´é«˜ã€‚Jsoupæ›´å¤šçš„æ–¹æ³•å¯ä»¥æŸ¥çœ‹Jsoupçš„APIã€‚ ç°åœ¨å·²ç»æœ‰å¾ˆå¤šå¼€æºçš„çˆ¬è™«çš„æ¡†æ¶ä¾›æˆ‘ä»¬é€‰æ‹©ï¼Œæ¯”å¦‚webmagicã€Heritrixç­‰ï¼Œå¯ä»¥é€‚å½“é€‰æ‹©ã€‚ é™„è¿˜æœ‰ä¸€ç§æ›´ä¸ºç®€å•å¼ºå¤§çš„æ–¹å¼ï¼Œåœ¨Linuxç¯å¢ƒä¸‹ï¼Œåˆ©ç”¨wgetå‘½ä»¤åªéœ€è¦ä¸€è¡Œå‘½ä»¤å°±å¯ä»¥å®ç°ä»¥ä¸ŠåŠŸèƒ½ã€‚ 1wget -m -H -nd -l 1 -t 1 -A .jpg,.png,.jpeg,.JPEG -e robots=off -P /opt/download --no-check-certificate https://www.baidu.com/home/news/data/newspage?nid=7953839918275534&amp;n_type=0&amp;p_from=1 åœ¨ä¸‹ç¯‡åšå®¢å†™ä¸€ä¸‹Linuxçš„åŸºæœ¬å‘½ä»¤ã€‚","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tool","slug":"tool","permalink":"https://sunny0715.github.io/tags/tool/"}]},{"title":"JAVAå®šæ—¶è°ƒåº¦ Timerå’ŒExecutors","slug":"JAVAå®šæ—¶è°ƒåº¦-Timerå’ŒExecutors","date":"2017-03-27T09:42:49.000Z","updated":"2018-03-13T05:49:02.851Z","comments":true,"path":"2017/03/27/JAVAå®šæ—¶è°ƒåº¦-Timerå’ŒExecutors/","link":"","permalink":"https://sunny0715.github.io/2017/03/27/JAVAå®šæ—¶è°ƒåº¦-Timerå’ŒExecutors/","excerpt":"è¿‘æœŸåœ¨å…¬å¸åšäº†ä¸€ä¸ªå…³äºå®šæ—¶æ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ï¼ˆæ²¡æœ‰ä½¿ç”¨æ¡†æ¶å®šæ—¶ï¼‰ï¼ŒæŸ¥äº†ä¸€ä¸‹èµ„æ–™ï¼Œæœ‰Threadã€Timerå’ŒExecutorsä¸‰ç§æ–¹æ³•ï¼Œä¹‹å‰ä½¿ç”¨çš„æ˜¯Timerï¼Œä½†æ˜¯è¯¦ç»†æŸ¥äº†èµ„æ–™è§‰å¾—Executorsæ›´ä¼˜ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæ¯”è¾ƒä¸€ä¸‹å®ƒä»¬çš„åŒºåˆ«ã€‚","text":"è¿‘æœŸåœ¨å…¬å¸åšäº†ä¸€ä¸ªå…³äºå®šæ—¶æ‰§è¡Œä»»åŠ¡çš„åŠŸèƒ½ï¼ˆæ²¡æœ‰ä½¿ç”¨æ¡†æ¶å®šæ—¶ï¼‰ï¼ŒæŸ¥äº†ä¸€ä¸‹èµ„æ–™ï¼Œæœ‰Threadã€Timerå’ŒExecutorsä¸‰ç§æ–¹æ³•ï¼Œä¹‹å‰ä½¿ç”¨çš„æ˜¯Timerï¼Œä½†æ˜¯è¯¦ç»†æŸ¥äº†èµ„æ–™è§‰å¾—Executorsæ›´ä¼˜ï¼Œæ‰€ä»¥åœ¨è¿™é‡Œæ¯”è¾ƒä¸€ä¸‹å®ƒä»¬çš„åŒºåˆ«ã€‚ Threadç±»è¿™æ˜¯æœ€åŸºæœ¬çš„ï¼Œåˆ›å»ºä¸€ä¸ªThreadï¼Œç„¶åè®©å®ƒåœ¨whileå¾ªç¯é‡Œä¸€ç›´è¿è¡Œç€ï¼Œé€šè¿‡sleepæ–¹æ³•æ¥è¾¾åˆ°å®šæ—¶ä»»åŠ¡çš„æ•ˆæœã€‚è¿™æ ·å¯ä»¥å¿«é€Ÿç®€å•çš„å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š 12345678910111213141516171819202122public class Task1 &#123; public static void main(String[] args) &#123; // run in a second final long timeInterval = 1000; Runnable runnable = new Runnable() &#123; public void run() &#123; while (true) &#123; // ------- code for task to run System.out.println(\"Hello !!\"); // ------- ends here try &#123; Thread.sleep(timeInterval); &#125; catch (InterruptedException e) &#123; e.printStackTrace(); &#125; &#125; &#125; &#125;; Thread thread = new Thread(runnable); thread.start(); &#125; &#125; Threadçš„åšå®šæ—¶ä»»åŠ¡çš„å‡ ç‡ä¸å¤§ï¼Œå› ä¸ºä¸å¯æ§åˆ¶å¯åŠ¨åœæ­¢æ—¶é—´ã€ä¸èƒ½æŒ‡å®šæƒ³è¦çš„delayæ—¶é—´ã€‚ Timerç±» äºç¬¬ä¸€ç§æ–¹å¼ç›¸æ¯”ï¼Œä¼˜åŠ¿ : (1) å½“å¯åŠ¨å’Œå»å–æ¶ˆä»»åŠ¡æ—¶å¯ä»¥æ§åˆ¶ ; (2) ç¬¬ä¸€æ¬¡æ‰§è¡Œä»»åŠ¡æ—¶å¯ä»¥æŒ‡å®šä½ æƒ³è¦çš„delayæ—¶é—´ã€‚ åœ¨å®ç°æ—¶ï¼ŒTimerç±»å¯ä»¥è°ƒåº¦ä»»åŠ¡ï¼ŒTimerTaskåˆ™æ˜¯é€šè¿‡åœ¨run()æ–¹æ³•é‡Œå®ç°å…·ä½“ä»»åŠ¡ã€‚ Timerå®ä¾‹å¯ä»¥è°ƒåº¦å¤šä»»åŠ¡ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ å½“Timerçš„æ„é€ å™¨è¢«è°ƒç”¨æ—¶ï¼Œå®ƒåˆ›å»ºäº†ä¸€ä¸ªçº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹å¯ä»¥ç”¨æ¥è°ƒåº¦ä»»åŠ¡ã€‚ 12345678910111213141516public class Task2 &#123; public static void main(String[] args) &#123; TimerTask task = new TimerTask() &#123; @Override public void run() &#123; // task to run goes here System.out.println(\"Hello !!!\"); &#125; &#125;; Timer timer = new Timer(); long delay = 0; long intevalPeriod = 1 * 1000; // schedules the task to be run in an interval timer.scheduleAtFixedRate(task, delay, intevalPeriod); &#125; // end of main &#125; ç¼ºç‚¹ï¼šå¦‚æœTimerTaskæŠ›å‡ºæœªæ£€æŸ¥çš„å¼‚å¸¸ï¼ŒTimerå°†ä¼šäº§ç”Ÿæ— æ³•é¢„æ–™çš„è¡Œä¸ºã€‚Timerçº¿ç¨‹å¹¶ä¸æ•è·å¼‚å¸¸ï¼Œæ‰€ä»¥ TimerTaskæŠ›å‡ºçš„æœªæ£€æŸ¥çš„å¼‚å¸¸ä¼šç»ˆæ­¢timerçº¿ç¨‹ã€‚è¿™ç§æƒ…å†µä¸‹ï¼ŒTimerä¹Ÿä¸ä¼šå†é‡æ–°æ¢å¤çº¿ç¨‹çš„æ‰§è¡Œäº†;å®ƒé”™è¯¯çš„è®¤ä¸ºæ•´ä¸ªTimeréƒ½è¢«å–æ¶ˆäº†ã€‚æ­¤æ—¶ï¼Œå·²ç»è¢«å®‰æ’ä½†å°šæœªæ‰§è¡Œçš„TimerTaskæ°¸è¿œä¸ä¼šå†æ‰§è¡Œäº†ï¼Œæ–°çš„ä»»åŠ¡ä¹Ÿä¸èƒ½è¢«è°ƒåº¦äº†ã€‚ Executors ScheduledExecutorServiceæ˜¯ä»Java SE5çš„java.util.concurrenté‡Œï¼Œåšä¸ºå¹¶å‘å·¥å…·ç±»è¢«å¼•è¿›çš„ï¼Œè¿™æ˜¯æœ€ç†æƒ³çš„å®šæ—¶ä»»åŠ¡å®ç°æ–¹å¼ã€‚ ç›¸æ¯”äºä¸Šä¸¤ä¸ªæ–¹æ³•ï¼Œå®ƒæœ‰ä»¥ä¸‹å¥½å¤„ : (1) ç›¸æ¯”äºTimerçš„å•çº¿ç¨‹ï¼Œå®ƒæ˜¯é€šè¿‡çº¿ç¨‹æ± çš„æ–¹å¼æ¥æ‰§è¡Œä»»åŠ¡çš„ ; (2) å¯ä»¥å¾ˆçµæ´»çš„å»è®¾å®šç¬¬ä¸€æ¬¡æ‰§è¡Œä»»åŠ¡delayæ—¶é—´ ; (3) æä¾›äº†è‰¯å¥½çš„çº¦å®šï¼Œä»¥ä¾¿è®¾å®šæ‰§è¡Œçš„æ—¶é—´é—´éš” ã€‚ ä¸‹é¢æ˜¯å®ç°ä»£ç ï¼Œæˆ‘ä»¬é€šè¿‡ScheduledExecutorServiceå±•ç¤ºè¿™ä¸ªä¾‹å­ï¼Œé€šè¿‡ä»£ç é‡Œå‚æ•°çš„æ§åˆ¶ï¼Œé¦–æ¬¡æ‰§è¡ŒåŠ äº†delayæ—¶é—´ã€‚ 1234567891011121314public class Task3 &#123; public static void main(String[] args) &#123; Runnable runnable = new Runnable() &#123; public void run() &#123; // task to run goes here System.out.println(\"Hello !!\"); &#125; &#125;; ScheduledExecutorService service = Executors .newSingleThreadScheduledExecutor(); // ç¬¬äºŒä¸ªå‚æ•°ä¸ºé¦–æ¬¡æ‰§è¡Œçš„å»¶æ—¶æ—¶é—´ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°ä¸ºå®šæ—¶æ‰§è¡Œçš„é—´éš”æ—¶é—´ service.scheduleAtFixedRate(runnable, 10, 1, TimeUnit.SECONDS); &#125; &#125; çº¿ç¨‹æ± èƒ½æŒ‰æ—¶é—´è®¡åˆ’æ¥æ‰§è¡Œä»»åŠ¡ï¼Œå…è®¸ç”¨æˆ·è®¾å®šè®¡åˆ’æ‰§è¡Œä»»åŠ¡çš„æ—¶é—´ã€‚ å½“ä»»åŠ¡è¾ƒå¤šæ—¶ï¼Œçº¿ç¨‹æ± å¯èƒ½ä¼šè‡ªåŠ¨åˆ›å»ºæ›´å¤šçš„å·¥ä½œçº¿ç¨‹æ¥æ‰§è¡Œä»»åŠ¡ ã€‚ æ”¯æŒå¤šä¸ªä»»åŠ¡å¹¶å‘æ‰§è¡Œã€‚ æ€»ç»“Timeræ˜¯å•çº¿ç¨‹çš„ã€‚æ‰€ä»¥taskéƒ½æ˜¯ä¸²è¡Œæ‰§è¡Œã€‚å‡å¦‚å…¶ä¸­ä¸€ä¸ªtaskæ‰§è¡Œéœ€è¦å¾ˆé•¿çš„æ—¶é—´ï¼Œé‚£å…¶ä»–çš„taskåªèƒ½å¹²å·´å·´çš„ç­‰ç€ã€‚ ScheduledThreadPoolExecutoræ˜¯ä¸€ä¸ªå¯ä»¥é‡å¤æ‰§è¡Œä»»åŠ¡çš„çº¿ç¨‹æ± ï¼Œå¹¶ä¸”å¯ä»¥æŒ‡å®šä»»åŠ¡çš„é—´éš”å’Œå»¶è¿Ÿæ—¶é—´ã€‚å®ƒä½œä¸ºæ¯”Timer/TimerTaskæ›´åŠ é€šç”¨çš„æ›¿ä»£å“ã€‚å› ä¸ºå®ƒå…è®¸å¤šä¸ªæœåŠ¡çº¿ç¨‹ï¼Œæ¥å—ä¸åŒçš„æ—¶é—´å•ä½ï¼Œä¸”ä¸éœ€è¦ç»§æ‰¿TimeTaskï¼ˆä»…ä»…éœ€è¦å®ç°Runnableæ¥å£ï¼‰ã€‚é…ç½®ScheduledThreadPoolExecutorä¸ºå•çº¿ç¨‹ï¼Œåˆ™ä¸ä½¿ç”¨Timerç­‰æ•ˆã€‚ ä¸Šè¿°ï¼ŒåŸºæœ¬è¯´æ˜äº†åœ¨ä»¥åçš„å¼€å‘ä¸­å°½å¯èƒ½ä½¿ç”¨ScheduledExecutorService(JDK1.5ä»¥å)æ›¿ä»£Timerã€‚ ä¸‹é¢æ˜¯è‡ªå·±åšçš„åŠŸèƒ½ï¼Œé€šè¿‡çŸ­ä¿¡APIå®šæ—¶æŸ¥è¯¢æ•™å¸ˆå›å¤ä¿¡æ¯å¹¶æ›´æ–°æ•°æ®åº“ã€‚ 123456789101112131415161718192021222324252627282930/** * å®šæ—¶æŸ¥è¯¢æ•™å¸ˆå›å¤çŠ¶æ€ * @param a */public void getStatusSchedule(final Date replyEnd)&#123; final SendMessage sendMsg = new SendMessage(); final ScheduledExecutorService service = Executors.newSingleThreadScheduledExecutor(); service.scheduleAtFixedRate(new Runnable() &#123; @Override public void run() &#123; try &#123; Date nowDate = new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\").parse(new SimpleDateFormat(\"yyyy-MM-dd HH:mm:ss\").format(new Date()));//å½“å‰æ—¶é—´ //è‹¥æˆªè‡³æ—¶é—´åœ¨å½“å‰æ—¶é—´ä¹‹å‰æ‰§è¡Œå®šæ—¶ä»»åŠ¡ å¦åˆ™ä¸æ‰§è¡Œ if (!nowDate.before(replyEnd)) &#123; service.shutdown(); //åœæ­¢ä»»åŠ¡ return; &#125;else &#123; Map&lt;String,Object&gt; map = sendMsg.getReplyMsg(); //è·å–å›å¤ä¿¡æ¯ if(!map.isEmpty())&#123; //å½“mapä¸ä¸ºç©ºæ—¶æ‰§è¡Œ updateMsgStatus(map); //æ›´æ–°æ•°æ®åº“ &#125; &#125; &#125; catch (ParseException e) &#123; e.printStackTrace(); &#125; &#125; &#125;, 1, 1, TimeUnit.MINUTES); //æ‰§è¡Œåç¬¬ä¸€æ¬¡æŸ¥è¯¢åœ¨1åˆ†é’Ÿä¹‹åï¼Œæ¯éš”1åˆ†é’ŸæŸ¥è¯¢ä¸€æ¬¡ã€‚ &#125;","categories":[{"name":"technology","slug":"technology","permalink":"https://sunny0715.github.io/categories/technology/"}],"tags":[{"name":"java","slug":"java","permalink":"https://sunny0715.github.io/tags/java/"},{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"}]},{"title":"æµ…è°ˆå…±äº«å•è½¦","slug":"æµ…è°ˆå…±äº«å•è½¦","date":"2017-03-24T09:40:22.000Z","updated":"2018-01-05T01:16:52.638Z","comments":true,"path":"2017/03/24/æµ…è°ˆå…±äº«å•è½¦/","link":"","permalink":"https://sunny0715.github.io/2017/03/24/æµ…è°ˆå…±äº«å•è½¦/","excerpt":"â€‹ è¦è¯´ç›®å‰æœ€ç«çˆ†çš„äº’è”ç½‘ç°è±¡ï¼Œå½“å±å…±äº«å•è½¦ã€‚è¿™é‡Œæ‰€è°“çš„å…±äº«ï¼Œæœ¬è´¨ä¸ŠæŒ‡çš„æ˜¯éœ€æ±‚å…±äº«ã€‚å°±éª‘è½¦çš„éœ€æ±‚ï¼Œä»ä¸€ä¸ªåœ°æ–¹éª‘åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œå°±æ˜¯ç”¨æˆ·è§¦ç‚¹ï¼ˆäº§å“æŠ•æ”¾ï¼‰ã€äº§å“æ“ä½œï¼ˆéª‘è¡Œè¿‡ç¨‹ï¼‰ã€ä»˜è´¹æ¨¡å¼ï¼ˆæ”¯ä»˜ï¼‰çš„æµç¨‹ï¼Œä»ä¸ªä½“ä¸Šæ¥è®²ï¼Œè¿™ä¸ªæµç¨‹æ˜¯å•å‘çš„ã€‚ä½†åœ¨â€œå…±äº«â€çš„æ¨¡å¼ä¸‹ï¼Œæ‰«ç éª‘èµ°ï¼Œåœè½¦å³èµ°ï¼ŒæŠŠä¸åŒçš„äººï¼Œåœ¨ä¸åŒçš„æ—¶é—´å’Œåœ°ç‚¹ï¼Œç›¸åŒçš„éª‘è¡Œéœ€æ±‚ï¼Œé€šè¿‡äº§å“æ“ä½œèŠ‚ç‚¹ï¼Œå½¢æˆéœ€æ±‚é—­ç¯ï¼Œåœè½¦ç‚¹åŒæ—¶åˆæ˜¯éª‘è¡Œå‡ºå‘ç‚¹ï¼Œè¿™å°±æ˜¯éœ€æ±‚å…±äº«ã€‚","text":"â€‹ è¦è¯´ç›®å‰æœ€ç«çˆ†çš„äº’è”ç½‘ç°è±¡ï¼Œå½“å±å…±äº«å•è½¦ã€‚è¿™é‡Œæ‰€è°“çš„å…±äº«ï¼Œæœ¬è´¨ä¸ŠæŒ‡çš„æ˜¯éœ€æ±‚å…±äº«ã€‚å°±éª‘è½¦çš„éœ€æ±‚ï¼Œä»ä¸€ä¸ªåœ°æ–¹éª‘åˆ°å¦ä¸€ä¸ªåœ°æ–¹ï¼Œå°±æ˜¯ç”¨æˆ·è§¦ç‚¹ï¼ˆäº§å“æŠ•æ”¾ï¼‰ã€äº§å“æ“ä½œï¼ˆéª‘è¡Œè¿‡ç¨‹ï¼‰ã€ä»˜è´¹æ¨¡å¼ï¼ˆæ”¯ä»˜ï¼‰çš„æµç¨‹ï¼Œä»ä¸ªä½“ä¸Šæ¥è®²ï¼Œè¿™ä¸ªæµç¨‹æ˜¯å•å‘çš„ã€‚ä½†åœ¨â€œå…±äº«â€çš„æ¨¡å¼ä¸‹ï¼Œæ‰«ç éª‘èµ°ï¼Œåœè½¦å³èµ°ï¼ŒæŠŠä¸åŒçš„äººï¼Œåœ¨ä¸åŒçš„æ—¶é—´å’Œåœ°ç‚¹ï¼Œç›¸åŒçš„éª‘è¡Œéœ€æ±‚ï¼Œé€šè¿‡äº§å“æ“ä½œèŠ‚ç‚¹ï¼Œå½¢æˆéœ€æ±‚é—­ç¯ï¼Œåœè½¦ç‚¹åŒæ—¶åˆæ˜¯éª‘è¡Œå‡ºå‘ç‚¹ï¼Œè¿™å°±æ˜¯éœ€æ±‚å…±äº«ã€‚ å…±äº«å•è½¦æ˜¯æŒ‡ä¼ä¸šä¸æ”¿åºœåˆä½œï¼Œåœ¨åœ°é“ã€å­¦æ ¡ã€å…¬äº¤ç«™ç‚¹ã€å±…æ°‘åŒºã€å•†ä¸šåŒºã€å…¬å…±æœåŠ¡åŒºç­‰æä¾›è‡ªè¡Œè½¦å•è½¦å…±äº«æœåŠ¡ï¼Œæ˜¯å…±äº«ç»æµçš„ä¸€ç§æ–°å½¢æ€ã€‚ â€‹ 2016å¹´åº•ä»¥æ¥ï¼Œå›½å†…å…±äº«å•è½¦çªç„¶å°±ç«çˆ†äº†èµ·æ¥ï¼Œè€Œåœ¨è¡—å¤´ï¼Œä»¿ä½›ä¸€å¤œä¹‹é—´ï¼Œå…±äº«å•è½¦å·²ç»åˆ°äº†â€œæ³›æ»¥â€çš„åœ°æ­¥ï¼Œå„å¤§åŸå¸‚è·¯è¾¹æ’æ»¡å„ç§é¢œè‰²çš„å…±äº«å•è½¦ã€‚ åœºæ™¯åˆ†æâ€‹ æˆ‘ä»¬ç«™åœ¨ç”¨æˆ·è§’åº¦ï¼Œæ— éå°±æ˜¯æ‰¾è½¦ï¼Œç„¶åéª‘è½¦ï¼Œäº¤é’±ã€‚ åœ¨â€œå¯»è½¦-ç”¨è½¦-éª‘è½¦-è¿˜è½¦â€çš„åœºæ™¯é—­ç¯ä¸­ï¼Œéœ€è¦è€ƒè™‘çš„é—®é¢˜æœ‰å¾ˆå¤šï¼Œåˆ—ä¸¾ä»¥ä¸‹è‹¥å¹²ç§ï¼š ä»€ä¹ˆæ ·çš„å¯»è½¦æ–¹å¼æ›´ç¬¦åˆå¤§ä¼—çš„æ—¥å¸¸è¡Œä¸ºï¼Ÿ ç”¨æˆ·ä¸å•è½¦ä¹‹é—´å¦‚ä½•å»ºç«‹ä¸€ä¸€å¯¹åº”çš„è”ç³»ï¼Ÿ ä½¿ç”¨ä½•ç§å¼€é”æ„ä»¶å®ç°è¿œç¨‹å¼€é”å’Œä¸Šé”ï¼Ÿ è®¡è´¹æ–¹å¼åŠè´¹ç”¨èŠ‚ç‚¹ã€ä»·æ ¼ã€æ“ä½œæµç¨‹åˆ†åˆ«é‡‡å–ä»€ä¹ˆæ–¹æ¡ˆï¼Ÿ å¦‚ä½•å¯¹è½¦è¾†è¿›è¡Œè¿œç¨‹ç®¡ç†ï¼Ÿ å¦‚ä½•é˜²æ­¢é€ƒè´¹ã€ç›—çªƒã€ç ´åç­‰è¡ç”Ÿé—®é¢˜ï¼Ÿ åœºæ™¯åˆ†æçš„è¿‡ç¨‹ï¼Œå°±æ˜¯è§£å†³ä»¥ä¸Šè‹¥å¹²é—®é¢˜çš„è¿‡ç¨‹ï¼Œé’ˆå¯¹è¿™äº›é—®é¢˜ï¼Œåˆ†åˆ«æå‡ºä¸åŒçš„ä¸šåŠ¡æµç¨‹å’ŒæŠ€æœ¯æ–¹æ¡ˆã€‚ ä¸šåŠ¡é€»è¾‘åˆ†æä»¥æ‘©æ‹œå•è½¦ä¸ºä¾‹ï¼Œç”¨æˆ·-ç®¡ç†å¹³å°-å•è½¦ ä¹‹é—´çš„å…³ç³»å¦‚ä¸‹å›¾: æŠ€æœ¯å®ç°æ–¹æ¡ˆâ€‹ ç°åœ¨å…±äº«å•è½¦æœ€ç«çš„è¦æ•°æ‘©æ‹œå•è½¦å’ŒOFOå°é»„è½¦äº†ï¼Œæ‘©æ‹œé‡‡ç”¨æ™ºèƒ½é”è€Œofoé‡‡ç”¨çš„æ˜¯æœºæ¢°é”ã€‚ 1 æœºæ¢°é”â€‹ åŸç†ï¼šæœºæ¢°é”çš„åŸç†å¾ˆç®€å•ï¼Œåªéœ€è¦æ‰“å¼€è½¯ä»¶ï¼Œè¾“å…¥å¯¹åº”çš„è½¦ç‰Œå·å°±å¯ä»¥äº†ï¼Œå…¶å®å°±æ˜¯åå°æŸ¥è¯¢æ•°æ®åº“ï¼Œåˆ¤æ–­å•è½¦æ˜¯å¦å¤„äºæ­£å¸¸çŠ¶æ€ï¼Œè¿”å›ç»™ç”¨æˆ·å¼€é”å¯†ç ï¼Œç”¨æˆ·æ‹¿ç€å¼€é”å¯†ç å¼€é”ã€‚ 2 æ™ºèƒ½é”â€‹ åŸç†ï¼šå¯¹äºå•è½¦çš„è¿œç¨‹å¼€é”æœºåˆ¶ï¼Œé‡‡ç”¨è¿œç¨‹é€šä¿¡æ§åˆ¶æœºæ¢°æ„ä»¶çš„ç”µç£è¿åŠ¨æ¥å®ç°ã€‚è¿œç¨‹é€šä¿¡å¯é‡‡ç”¨ä¼ ç»Ÿçš„SIMå¡é€šä¿¡çš„æ–¹å¼ã€‚ ä¸€ã€æ‰‹æœºæ‰«æè‡ªè¡Œè½¦ï¼Œè·å¾—è‡ªè¡Œè½¦å”¯ä¸€çš„IDæ ‡å¿—ï¼Œæ‰‹æœºæ¥ç€ä¼šåƒæœåŠ¡å™¨æäº¤ä¸€ä¸ªè¯·æ±‚ï¼ˆæäº¤ä¿¡æ¯é‡ŒåŒ…å«ï¼šç”¨æˆ·ä¿¡æ¯ï¼Œè¯·æ±‚åŠ¨ä½œï¼Œè½¦è¾†IDï¼‰ï¼›äºŒã€æœåŠ¡å™¨æ”¶åˆ°ç”¨æˆ·å¼€é”è¯·æ±‚ï¼Œæ­¤æ—¶ä¼šæ ¹æ®è¯·æ±‚ä¿¡æ¯ï¼Œæ¥ç€å‘æŒ‡å®šIDçš„è‡ªè¡Œè½¦å‘å‡ºå¼€é”æŒ‡ä»¤;ä¸‰ã€è‡ªè¡Œè½¦æ”¶åˆ°æœåŠ¡å™¨è¯·æ±‚ï¼Œä¼šæ‰§è¡Œç›¸åº”çš„å¼€é”åŠ¨ä½œã€‚ æ™ºèƒ½é”æ˜¯è€—è´¹ç”µèƒ½çš„ï¼Œæ‰€ä»¥æ‘©æ‹œå•è½¦è½¦ç¯®ä¸­è£…æœ‰å¤ªé˜³èƒ½ç”µæ± æ¿ï¼Œå‡å°‘äººåŠ›ç‰©åŠ›ç»´æŠ¤çš„æˆæœ¬ã€ç®€å•ã€é«˜æ•ˆã€‚ â€‹ è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„å¤§å®¹é‡äº’è”ç½‘O2Oåœºæ™¯ï¼Œè¿ç»“ç”¨æˆ·ã€è½¦è¾†ï¼Œç®¡ç†å¹³å°è¿›è¡Œå®æ—¶å¤„ç†æ•ˆç‡è¦æ±‚éå¸¸é«˜ï¼Œéœ€åˆ¶å®šå¯é ã€é«˜æ•ˆçš„ç½‘ç»œæ–¹æ¡ˆã€‚æ ¹æ®ä¸šåŠ¡æµç¨‹ï¼Œæˆ‘ä»¬æ¢³ç†å‡ºç½‘ç»œèŠ‚ç‚¹çš„èŒèƒ½ï¼Œå¹¶ä»æˆæœ¬è€ƒè™‘ä½¿ç”¨æœ€ä¼˜æ–¹æ¡ˆï¼š â€‹ æ˜ç¡®æµç¨‹ï¼Œç•Œé¢ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥çš„ä»»åŠ¡å°±æ˜¯é€šè¿‡ç”¨æˆ·è¯­è¨€å»å®ç°äº§å“æµç¨‹äº†ï¼Œå³ç•Œé¢è®¾è®¡ä¸å¼€å‘å®ç°ï¼Œè¿™é‡Œæˆ‘ä»¬å°±ä¸é˜è¿°äº†ã€‚ ä¸€ç‚¹æ„Ÿæƒ³â€‹ ä»2016å¹´åˆ°ç°åœ¨å·²æœ‰è¿‘åŠå¹´æ—¶é—´ï¼Œå…±äº«å•è½¦çš„ç«äº‰ä¹Ÿæ„ˆæ¼”æ„ˆçƒˆï¼Œè¿‘å‡ å¤©ï¼Œå…±äº«å•è½¦ä»å…è´¹åˆ°çº¢åŒ…â€œæ’’é’±â€ å¯¼è‡´ç«äº‰å‡çº§ï¼Œå…±äº«å•è½¦æ–¹ä¾¿äº†æˆ‘ä»¬çš„å‡ºè¡Œï¼Œä½†æ˜¯å¸¦æ¥çš„é—®é¢˜ä¹Ÿå¾ˆå¤šï¼Œæ”¿åºœä¹Ÿåœ¨ä¸æ–­çš„è§„èŒƒä½¿ç”¨ã€‚ç°åœ¨éƒ½åœ¨å¤„äºèµ„æœ¬æŠ•å…¥å’Œçƒ§é’±å¤§æˆ˜ä¸­ï¼Œå¸Œæœ›å…±äº«å•è½¦ä¸€ç›´å­˜è´§ä¸‹å»ï¼ŒåŒæ—¶å¸Œæœ›å¤§å®¶èƒ½åˆç†ã€åˆæ³•ä½¿ç”¨ã€‚ ä¹‹å‰æœ‰å¬è¯´è¿‡æ‘©æ‹œçš„æ‰«ä¸€æ‰«å¯ä»¥è¿œç¨‹ä½¿ç”¨ï¼Œå‡å¦‚æˆ‘éœ€è¦è½¦åˆæ²¡æœ‰æ³¨å†Œï¼Œæˆ‘å¯ä»¥æ‹ç…§ç»™æœ‰è½¦çš„æœ‹å‹ï¼Œè®©ä»–ä»¬å¸®æˆ‘è¿œç¨‹æ‰«å°±å¯ä»¥å¼€å¯ï¼Œäº²æµ‹ï¼šä¸è¡Œï¼è¿˜æ˜¯è‡ªå·±ä¹–ä¹–æ³¨å†Œä¸€ä¸ªå§ã€‚","categories":[{"name":"society","slug":"society","permalink":"https://sunny0715.github.io/categories/society/"}],"tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"https://sunny0715.github.io/tags/éšç¬”/"}]},{"title":"Markdownè¯­æ³•æŒ‡å—","slug":"Markdownè¯­æ³•","date":"2017-03-21T14:51:10.000Z","updated":"2018-03-13T05:51:37.762Z","comments":true,"path":"2017/03/21/Markdownè¯­æ³•/","link":"","permalink":"https://sunny0715.github.io/2017/03/21/Markdownè¯­æ³•/","excerpt":"èŠ±äº†ä¸€æ®µæ—¶é—´æŠŠè‡ªå·±çš„ä¸ªäººåšå®¢æ­å»ºå¥½äº†ï¼Œä½†æ˜¯åšå®¢å¿…é¡»æ˜¯è¦ç”¨Markdownä¹¦å†™ï¼Œæ‰€ä»¥æŸ¥äº†ä¸€ä¸‹Markdownç¼–è¾‘å™¨çš„è¯­æ³•ï¼Œåœ¨è¿™é‡Œåšä¸ªè®°å½•ã€‚","text":"èŠ±äº†ä¸€æ®µæ—¶é—´æŠŠè‡ªå·±çš„ä¸ªäººåšå®¢æ­å»ºå¥½äº†ï¼Œä½†æ˜¯åšå®¢å¿…é¡»æ˜¯è¦ç”¨Markdownä¹¦å†™ï¼Œæ‰€ä»¥æŸ¥äº†ä¸€ä¸‹Markdownç¼–è¾‘å™¨çš„è¯­æ³•ï¼Œåœ¨è¿™é‡Œåšä¸ªè®°å½•ã€‚ Markdownæ˜¯ä¸€ç§å¯ä»¥ä½¿ç”¨æ™®é€šæ–‡æœ¬ç¼–è¾‘å™¨ç¼–å†™çš„æ ‡è®°è¯­è¨€ï¼Œé€šè¿‡ç®€å•çš„æ ‡è®°è¯­æ³•ï¼Œå®ƒå¯ä»¥ä½¿æ™®é€šæ–‡æœ¬å†…å®¹å…·æœ‰ä¸€å®šçš„æ ¼å¼ã€‚Markdownçš„è¯­æ³•ç®€æ´æ˜äº†ã€å­¦ä¹ å®¹æ˜“ï¼Œè€Œä¸”åŠŸèƒ½æ¯”çº¯æ–‡æœ¬æ›´å¼ºï¼Œå› æ­¤æœ‰å¾ˆå¤šäººç”¨å®ƒå†™åšå®¢ã€‚ä¸–ç•Œä¸Šæœ€æµè¡Œçš„åšå®¢å¹³å°WordPresså’Œå¤§å‹CMSå¦‚Joomlaã€Drupaléƒ½èƒ½å¾ˆå¥½çš„æ”¯æŒMarkdownã€‚å®Œå…¨é‡‡ç”¨Markdownç¼–è¾‘å™¨çš„åšå®¢å¹³å°æœ‰Ghostå’ŒTypechoã€‚ åŸºæœ¬æŠ€å·§1 ä»£ç å¦‚æœä½ åªæƒ³é«˜äº®è¯­å¥ä¸­çš„æŸä¸ªå‡½æ•°åæˆ–å…³é”®å­—ï¼Œå¯ä»¥ä½¿ç”¨ `function_name()` å®ç° é€šå¸¸ç¼–è¾‘å™¨æ ¹æ®ä»£ç ç‰‡æ®µé€‚é…åˆé€‚çš„é«˜äº®æ–¹æ³•ï¼Œä½†ä½ ä¹Ÿå¯ä»¥ç”¨ ``` åŒ…è£¹ä¸€æ®µä»£ç ï¼Œå¹¶æŒ‡å®šä¸€ç§è¯­è¨€ 12345â€‹```javascript$(document).ready(function () &#123; alert('hello world');&#125;);â€‹``` æ”¯æŒçš„è¯­è¨€ï¼šactionscript, apache, bash, clojure, cmake, coffeescript, cpp, cs, css, d, delphi, django, erlang, go, haskell, html, http, ini, java, javascript, json, lisp, lua, markdown, matlab, nginx, objectivec, perl, php, python, r, ruby, scala, smalltalk, sql, tex, vbscript, xml ä¹Ÿå¯ä»¥ä½¿ç”¨ 4 ç©ºæ ¼ç¼©è¿›ï¼Œå†è´´ä¸Šä»£ç ï¼Œå®ç°ç›¸åŒçš„çš„æ•ˆæœ 123 def g(x): yield from range(x, 0, -1) yield from range(x) 2 æ ‡é¢˜æ–‡ç« å†…å®¹è¾ƒå¤šæ—¶ï¼Œå¯ä»¥ç”¨æ ‡é¢˜åˆ†æ®µï¼š 12345678æ ‡é¢˜1======æ ‡é¢˜2-----## å¤§æ ‡é¢˜ ##### å°æ ‡é¢˜ ### 3 ç²—æ–œä½“123*æ–œä½“æ–‡æœ¬* _æ–œä½“æ–‡æœ¬_**ç²—ä½“æ–‡æœ¬** __ç²—ä½“æ–‡æœ¬__***ç²—æ–œä½“æ–‡æœ¬*** ___ç²—æ–œä½“æ–‡æœ¬___ 4 é“¾æ¥4.1 å¸¸ç”¨é“¾æ¥æ–¹æ³• 12æ–‡å­—é“¾æ¥ ![é“¾æ¥åç§°](http://é“¾æ¥ç½‘å€)ç½‘å€é“¾æ¥ &lt;http://é“¾æ¥ç½‘å€&gt; 4.2 é«˜çº§é“¾æ¥æŠ€å·§ 123456è¿™ä¸ªé“¾æ¥ç”¨ 1 ä½œä¸ºç½‘å€å˜é‡ [Google][1].è¿™ä¸ªé“¾æ¥ç”¨ yahoo ä½œä¸ºç½‘å€å˜é‡ [Yahoo!][yahoo].ç„¶ååœ¨æ–‡æ¡£çš„ç»“å°¾ä¸ºå˜é‡èµ‹å€¼ï¼ˆç½‘å€ï¼‰ [1]: http://www.google.com/ [yahoo]: http://www.yahoo.com/ 5 åˆ—è¡¨5.1 æ™®é€šæ— åºåˆ—è¡¨ 123- åˆ—è¡¨æ–‡æœ¬å‰ä½¿ç”¨ [å‡å·+ç©ºæ ¼]+ åˆ—è¡¨æ–‡æœ¬å‰ä½¿ç”¨ [åŠ å·+ç©ºæ ¼]* åˆ—è¡¨æ–‡æœ¬å‰ä½¿ç”¨ [æ˜Ÿå·+ç©ºæ ¼] 5.2 æ™®é€šæœ‰åºåˆ—è¡¨ 1231. åˆ—è¡¨å‰ä½¿ç”¨ [æ•°å­—+ç©ºæ ¼]2. æˆ‘ä»¬ä¼šè‡ªåŠ¨å¸®ä½ æ·»åŠ æ•°å­—7. ä¸ç”¨æ‹…å¿ƒæ•°å­—ä¸å¯¹ï¼Œæ˜¾ç¤ºçš„æ—¶å€™æˆ‘ä»¬ä¼šè‡ªåŠ¨æŠŠè¿™è¡Œçš„ 7 çº æ­£ä¸º 3 5.3 åˆ—è¡¨åµŒå¥— 12345678910111213141516171. åˆ—å‡ºæ‰€æœ‰å…ƒç´ ï¼š - æ— åºåˆ—è¡¨å…ƒç´  A 1. å…ƒç´  A çš„æœ‰åºå­åˆ—è¡¨ - å‰é¢åŠ å››ä¸ªç©ºæ ¼2. åˆ—è¡¨é‡Œçš„å¤šæ®µæ¢è¡Œï¼š å‰é¢å¿…é¡»åŠ å››ä¸ªç©ºæ ¼ï¼Œ è¿™æ ·æ¢è¡Œï¼Œæ•´ä½“çš„æ ¼å¼ä¸ä¼šä¹±3. åˆ—è¡¨é‡Œå¼•ç”¨ï¼š &gt; å‰é¢ç©ºä¸€è¡Œ &gt; ä»ç„¶éœ€è¦åœ¨ &gt; å‰é¢åŠ å››ä¸ªç©ºæ ¼4. åˆ—è¡¨é‡Œä»£ç æ®µï¼šå‰é¢å››ä¸ªç©ºæ ¼ï¼Œä¹‹åæŒ‰ä»£ç è¯­æ³• ``` ä¹¦å†™â€‹``` æˆ–è€…ç›´æ¥ç©ºå…«ä¸ªï¼Œå¼•å…¥ä»£ç å— 6 å¼•ç”¨6.1 æ™®é€šå¼•ç”¨ 12&gt; å¼•ç”¨æ–‡æœ¬å‰ä½¿ç”¨ [å¤§äºå·+ç©ºæ ¼]&gt; æŠ˜è¡Œå¯ä»¥ä¸åŠ ï¼Œæ–°èµ·ä¸€è¡Œéƒ½è¦åŠ ä¸Šå“¦ 6.2 å¼•ç”¨é‡ŒåµŒå¥—å¼•ç”¨ 123&gt; æœ€å¤–å±‚å¼•ç”¨&gt; &gt; å¤šä¸€ä¸ª &gt; åµŒå¥—ä¸€å±‚å¼•ç”¨&gt; &gt; &gt; å¯ä»¥åµŒå¥—å¾ˆå¤šå±‚ 6.3 å¼•ç”¨é‡ŒåµŒå¥—åˆ—è¡¨ 123&gt; - è¿™æ˜¯å¼•ç”¨é‡ŒåµŒå¥—çš„ä¸€ä¸ªåˆ—è¡¨&gt; - è¿˜å¯ä»¥æœ‰å­åˆ—è¡¨&gt; * å­åˆ—è¡¨éœ€è¦ä» - ä¹‹åå»¶åå››ä¸ªç©ºæ ¼å¼€å§‹ 6.4 å¼•ç”¨é‡ŒåµŒå¥—ä»£ç å— 12345&gt; åŒæ ·çš„ï¼Œåœ¨å‰é¢åŠ å››ä¸ªç©ºæ ¼å½¢æˆä»£ç å—&gt; &gt; &gt; æˆ–è€…ä½¿ç”¨ ``` å½¢æˆä»£ç å—&gt; `` 7 å›¾ç‰‡7.1 è·Ÿé“¾æ¥çš„æ–¹æ³•åŒºåˆ«åœ¨äºå‰é¢åŠ äº†ä¸ªæ„Ÿå¹å· !ï¼Œè¿™æ ·æ˜¯ä¸æ˜¯è§‰å¾—å¥½è®°å¤šäº†å‘¢ï¼Ÿ 1![å›¾ç‰‡åç§°](http://å›¾ç‰‡ç½‘å€) 7.2 å½“ç„¶ï¼Œä½ ä¹Ÿå¯ä»¥åƒç½‘å€é‚£æ ·å¯¹å›¾ç‰‡ç½‘å€ä½¿ç”¨å˜é‡ 1234è¿™ä¸ªé“¾æ¥ç”¨ 1 ä½œä¸ºç½‘å€å˜é‡ [Google][1].ç„¶ååœ¨æ–‡æ¡£çš„ç»“å°¾ä½å˜é‡èµ‹å€¼ï¼ˆç½‘å€ï¼‰ [1]: http://www.google.com/logo.png ä¹Ÿå¯ä»¥ä½¿ç”¨ HTML çš„å›¾ç‰‡è¯­æ³•æ¥è‡ªå®šä¹‰å›¾ç‰‡çš„å®½é«˜å¤§å° 1&lt;img src=\"htt://example.com/sample.png\" width=\"400\" height=\"100\"&gt; 8 æ¢è¡Œå¦‚æœå¦èµ·ä¸€è¡Œï¼Œåªéœ€åœ¨å½“å‰è¡Œç»“å°¾åŠ  2 ä¸ªç©ºæ ¼ 12åœ¨å½“å‰è¡Œçš„ç»“å°¾åŠ  2 ä¸ªç©ºæ ¼ è¿™è¡Œå°±ä¼šæ–°èµ·ä¸€è¡Œ å¦‚æœæ˜¯è¦èµ·ä¸€ä¸ªæ–°æ®µè½ï¼Œåªéœ€è¦ç©ºå‡ºä¸€è¡Œå³å¯ã€‚ 9 åˆ†éš”ç¬¦å¦‚æœä½ æœ‰å†™åˆ†å‰²çº¿çš„ä¹ æƒ¯ï¼Œå¯ä»¥æ–°èµ·ä¸€è¡Œè¾“å…¥ä¸‰ä¸ªå‡å·-ã€‚å½“å‰åéƒ½æœ‰æ®µè½æ—¶ï¼Œè¯·ç©ºå‡ºä¸€è¡Œï¼š 12345å‰é¢çš„æ®µè½---åé¢çš„æ®µè½ é«˜çº§æŠ€å·§1 è¡Œå†… HTML å…ƒç´ ç›®å‰åªæ”¯æŒéƒ¨åˆ†æ®µå†… HTML å…ƒç´ æ•ˆæœï¼ŒåŒ…æ‹¬ ï¼Œå¦‚ é”®ä½æ˜¾ç¤º 1ä½¿ç”¨ &lt;kbd&gt;Ctrl&lt;/kbd&gt;+&lt;kbd&gt;Alt&lt;/kbd&gt;+&lt;kbd&gt;Del&lt;/kbd&gt; é‡å¯ç”µè„‘ ä»£ç å— 1ä½¿ç”¨ &lt;pre&gt;&lt;/pre&gt; å…ƒç´ åŒæ ·å¯ä»¥å½¢æˆä»£ç å— ç²—æ–œä½“ 1&lt;b&gt; Markdown åœ¨æ­¤å¤„åŒæ ·é€‚ç”¨ï¼Œå¦‚ *åŠ ç²—* &lt;/b&gt; 2 ç¬¦å·è½¬ä¹‰å¦‚æœä½ çš„æè¿°ä¸­éœ€è¦ç”¨åˆ° markdown çš„ç¬¦å·ï¼Œæ¯”å¦‚ _ # * ç­‰ï¼Œä½†åˆä¸æƒ³å®ƒè¢«è½¬ä¹‰ï¼Œè¿™æ—¶å€™å¯ä»¥åœ¨è¿™äº›ç¬¦å·å‰åŠ åæ–œæ ï¼Œå¦‚ \\_ \\#``\\* è¿›è¡Œé¿å…ã€‚ 12\\_ä¸æƒ³è¿™é‡Œçš„æ–‡æœ¬å˜æ–œä½“\\_\\*\\*ä¸æƒ³è¿™é‡Œçš„æ–‡æœ¬è¢«åŠ ç²—\\*\\* 3 æ‰©å±•æ”¯æŒ jsfiddleã€gistã€runjsã€ä¼˜é…·è§†é¢‘ï¼Œç›´æ¥å¡«å†™ urlï¼Œåœ¨å…¶ä¹‹åä¼šè‡ªåŠ¨æ·»åŠ é¢„è§ˆç‚¹å‡»ä¼šå±•å¼€ç›¸å…³å†…å®¹ã€‚ 1234http://&#123;url_of_the_fiddle&#125;/embedded/[&#123;tabs&#125;/[&#123;style&#125;]]/https://gist.github.com/&#123;gist_id&#125;http://runjs.cn/detail/&#123;id&#125;http://v.youku.com/v_show/id_&#123;video_id&#125;.html 4 å…¬å¼å½“ä½ éœ€è¦åœ¨ç¼–è¾‘å™¨ä¸­æ’å…¥æ•°å­¦å…¬å¼æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ä¸¤ä¸ªç¾å…ƒç¬¦ $$ åŒ…è£¹ TeX æˆ– LaTeX æ ¼å¼çš„æ•°å­¦å…¬å¼æ¥å®ç°ã€‚æäº¤åï¼Œé—®ç­”å’Œæ–‡ç« é¡µä¼šæ ¹æ®éœ€è¦åŠ è½½ Mathjax å¯¹æ•°å­¦å…¬å¼è¿›è¡Œæ¸²æŸ“ã€‚å¦‚ï¼š 12345$$ x = &#123;-b \\pm \\sqrt&#123;b^2-4ac&#125; \\over 2a&#125;. $$$$x \\href&#123;why-equal.html&#125;&#123;=&#125; y^2 + 1$$ åŒæ—¶ä¹Ÿæ”¯æŒ HTML å±æ€§ï¼Œå¦‚ï¼š 12345$$ (x+1)^2 = \\class&#123;hidden&#125;&#123;(x+1)(x+1)&#125; $$$$(x+1)^2 = \\cssId&#123;step1&#125;&#123;\\style&#123;visibility:hidden&#125;&#123;(x+1)(x+1)&#125;&#125;$$ æ€»ç»“markdownè¯­æ³•å†™å¤šäº†è‡ªç„¶å°±ä¼šäº†ï¼Œç½‘ä¸Šæœ‰å¾ˆå¤šmarkdownè¯­æ³•ç¼–è¾‘å™¨ï¼Œæ¯”å¦‚æœ‰é“äº‘ã€é©¬å…‹é£è±¡ã€Typoraç­‰ã€‚æˆ‘ç›®å‰ä½¿ç”¨çš„æ˜¯Typoraç¼–è¾‘å™¨ï¼Œä½¿ç”¨èµ·æ¥æ¯”å…¶ä»–çš„æ›´ç®€å•ã€èˆ’é€‚ï¼Œæ–¹ä¾¿ã€‚","categories":[],"tags":[{"name":"tips","slug":"tips","permalink":"https://sunny0715.github.io/tags/tips/"}]},{"title":"åšå®¢å»ºæˆç¬¬ä¸€å¤©","slug":"åšå®¢å»ºæˆç¬¬ä¸€å¤©","date":"2017-03-07T05:30:26.000Z","updated":"2018-01-05T01:17:10.015Z","comments":true,"path":"2017/03/07/åšå®¢å»ºæˆç¬¬ä¸€å¤©/","link":"","permalink":"https://sunny0715.github.io/2017/03/07/åšå®¢å»ºæˆç¬¬ä¸€å¤©/","excerpt":"","text":"ç»è¿‡å‡ å¤©çš„åŠªåŠ›ï¼Œè‡ªå·±çš„åšå®¢ç»ˆäºæ­å»ºèµ·æ¥äº†ï¼Œæ‰“å¿ƒé‡Œå¾ˆå¼€å¿ƒã€‚ è¿™ä¸æ˜¯è´´å§ï¼Œä¸æ˜¯è±†ç“£ï¼Œä¸æ˜¯CSDNï¼Œè¿™æ˜¯æˆ‘è‡ªå·±åœ¨äº’è”ç½‘ä¸Šçš„ä¸€å°ç‚¹é¢†åœ°ã€‚ ä»å¼€å§‹åšå®¢åŸºæœ¬æ ·å¼ï¼Œåˆ°åŸŸåï¼Œè‡ªå·±ä¸€æ­¥ä¸€æ­¥æ‘¸ç´¢æ­å»ºèµ·æ¥çš„ï¼Œæˆ‘ç›¸ä¿¡è‡ªå·±å¯ä»¥åšçš„æ›´å¥½ï¼ŒåŠ æ²¹!","categories":[{"name":"life","slug":"life","permalink":"https://sunny0715.github.io/categories/life/"}],"tags":[{"name":"éšç¬”","slug":"éšç¬”","permalink":"https://sunny0715.github.io/tags/éšç¬”/"}]}]}